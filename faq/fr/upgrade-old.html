<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Mini-FAQ de mise à jour OpenBSD - Anciennes Versions</title>
</head>
<body bgcolor="#FFFFFF" text="#000000" link="#23238E">


<h1>Mini-FAQ de mise à jour OpenBSD - Anciennes Versions</h1>

<blockquote>
<p>
Ce document contient les entrées de la mini-faq de mise à jour pour les
versions d'OpenBSD qui ne sont plus supportées activement. Pour des informations
sur la version courante, regardez la page
<a href="current.html">Suivre <i>-current</i></a>.
</p>
</blockquote>

<h2>Mettre à jour de la 4.5 à la 4.6</h2>
<ul>
<li><a href="#20090304">2009/03/04 - nouvel utilisateur et groupe pour smtpd</a>
<li><a href="#20090316">2009/03/16 - makemap(8) fonctionne maintenant à
travers mailwrapper(8)</a>
<li><a href="#20090324">2009/03/24 - changement du comportement de
"redistribute default" dans ospfd(8) et ripd(8)</a>
<li><a href="#20090406">2009/04/06 - changements incompatibles sur pf(4)</a>
<li><a href="#20090407">2009/04/07 - réassemblage de fragment activé par défaut</a>
<li><a href="#20090426">2009/04/26 - require-order off par défaut dans pfctl(8)</a>
<li><a href="#20090520">2009/05/20 - nouvel utilisateur et groupe pour rpc.rwalld</a>
<li><a href="#20090525">2009/05/25 - mise à jour de daily(8), weekly,
monthly et security(8)</a>
<li><a href="#20090531">2009/05/31 - pf activé par défaut</a>
<li><a href="#20090602">2009/06/02 - tmux(1) déplacé de ports vers base</a>
<li><a href="#20090603">2009/06/03 - changement ABI httpd</a>
<li><a href="#20090626">2009/06/26 - mise à jour de lynx(1)</a>
<li><a href="#20090703">2009/07/03 - mise à jour du pilote bnx(4)</a>
</ul>

<h2>Mettre à jour de la 4.4 à la 4.5</h2>
<ul>
<li><a href="#20080907">2008/09/07 - syntaxe de ifconfig(8) modifiée</a>
<li><a href="#20080913">2008/09/13 - xcompmgr(1) a été déplacé de ports
 vers xbase</a>
<li><a href="#20080929">2008/09/29 - mise à jour de Perl 5.10.0</a>
<li><a href="#20081003">2008/10/03 - sm-client.st a été déplacé</a>
<li><a href="#20081102">2008/11/02 - mise à jour de Xserver 1.5.2</a>
<li><a href="#20081103">2008/11/03 - mise à jour de Perl 5.10.0</a>
<li><a href="#20081105">2008/11/05 - mise à jour de Perl 5.10.0</a>
<li><a href="#20081106">2008/11/06 - mise à jour de Xserver 1.5.2</a>
<li><a href="#20081107">2008/11/07 - mise à jour de Perl 5.10.0</a>
<li><a href="#20081111">2008/11/11 - support PIE ajouté à gcc 3.3.5 & csu</a>
<li><a href="#20081116">2008/11/16 - mixerctl(1) a été renommé</a>
<li><a href="#20081126">2008/11/26 - btd nécessite un utilisateur et un groupe</a>
<li><a href="#20090204">2009/02/04 - mise à jour de Perl 5.10.0</a>
<li><a href="#20090215">2009/02/15 - syntaxe de ifconfig(8) modifiée</a>
<li><a href="#20090218">2009/02/18 - numéro de version de pfsync(4)
 incrémentée</a>
</ul>

<h2>Mettre à jour de la 4.3 à la 4.4</h2>
<ul>
<li><a href="#20080323">2008/03/23 - configuration de cwm et options de la ligne de commande modifiées</a>
<li><a href="#20080328">2008/03/28 - librairies partagées landisk activées</a>
<li><a href="#20080421">2008/04/21 - les options de la ligne de commande de rtadvd(8) modifiées</a>
<li><a href="#20080508">2008/05/08 - file(1) mis à jour, nécessite un nouveau /etc/magic</a>
<li><a href="#20080522">2008/05/22 - version de protocole du mode sync de spamd(8) changée</a>
<li><a href="#20080606">2008/06/06 - manuel httpd(8) déplacé</a>
<li><a href="#20080607">2008/06/07 - support de dhcpd.interfaces supprimé</a>
<li><a href="#20080609">2008/06/09 - nmeaattach(8) supprimé</a>
<li><a href="#20080609b">2008/06/09 - nouvel utilisateur et groupe _rtadvd</a>
<li><a href="#20080610">2008/06/10 - compteurs par adresse désactivés par défaut sur les tables pf(4)</a>
<li><a href="#20080613">2008/06/13 - mailmode dans mg(1) supprimé</a>
<li><a href="#20080616">2008/06/16 - numéro de version de pfsync(4) incrémenté</a>
<li><a href="#20080627">2008/06/27 - nouvel utilisateur et groupe _ypldap</a>
<li><a href="#20080709">2008/07/09 - yacc(1) mis à jour</a>
<li><a href="#20080710">2008/07/10 - listes TCP/UDP baddynamic, sysctl(8), named(8) et /etc/rc</a>
<li><a href="#20080711-0">2008/07/11 - pilote vidéo openchrome(4)</a>
<li><a href="#20080711-1">2008/07/11 - pilote vidéo ati(4) mis à jour</a>
<li><a href="#20080719">2008/07/19 - traitement des métadonnées dans softraid réécrit</a>
<li><a href="#20080724">2008/07/24 - changements dans libc et libm</a>
</ul>

<h2>Mettre à jour de la 4.2 à la 4.3</h2>
<ul>
<li><a href="#20070903">2007/09/03 - support de _cxa_atexit et en-têtes sys/net "flag day"</a>
<li><a href="#20071008">2007/10/08 - nouvel utilisateur pour ospf6d</a>
<li><a href="#20071020">2007/10/20 - libexpat déplacée vers base</a>
<li><a href="#20071030">2007/10/30 - changements de httpd.conf pour la configuration des modules
</a>
<li><a href="#20071125">2007/11/25 - config(8) "flag day"</a>
<li><a href="#20071128">2007/11/28 - mises à jour AGP</a>
<li><a href="#20071207">2007/12/07 - utilisateur _hoststated renommé _relayd</a>
<li><a href="#20080131">2008/01/31 - nouvel utilisateur pour snmpd</a>
<li><a href="#20080205">2008/02/05 - carp(4) "flag day"</a>
<li><a href="#20080303">2008/03/03 - l'emplacement par défaut de xenocara a changé</a>
</ul>


<h2>Mettre à jour de la 4.1 à la 4.2</h2>
<ul>
<li><a href="#20070326">2007/03/26 - Xenocara remplace XF4 dans <i>-current</i></a>
<li><a href="#20070327">2007/03/27 - la mise à jour de ahci(4) peut entraîner des 
changements de noms de périphériques disques SATA</a>
<li><a href="#20070331">2007/03/31 - langage de filtrage bgpd modifié</a>
<li><a href="#20070510">2007/05/10 - les paquetages utiliseront le libexpat livré avec xenocara</a>
<li><a href="#20070529">2007/05/29 - [i386] apm(4) l'emporte sur acpi(4)</a>
<li><a href="#20070710">2007/07/10 - la mise à jour de wpi(4) nécessite un nouveau firmware</a>
<li><a href="#20070726">2007/07/26 - changements dans la façon dont sudo(8) passe l'environment</a>
<li><a href="#20070801">2007/08/01 - [alpha] quelques NICs de(4) deviennent dc(4)</a>
</ul>


<h2>Mettre à jour de la 4.0 à la 4.1</h2>
<ul>
<li><a href="#20060926">2006/09/26 - Passage à gcc3 (alpha)</a>
<li><a href="#20061006">2006/10/06 - 'flags S/SA keep state' implicite dans pf.conf(5)</a>
<li><a href="#20061011">2006/10/11 - disklabel pas dans les partitions FreeBSD ou NetBSD</a>
<li><a href="#20061012">2006/10/12 - ne démarre pas des partitions NetBSD</a>
<li><a href="#20061029">2006/10/29 - nouvel utilisateur pour ripd(8)</a>
<li><a href="#20061227">2006/12/27 - ARM (zaurus/armish) "Flag day"</a>
<li><a href="#20070131">2007/01/31 - nouvel utilisateur pour hoststated(8)</a>
<li><a href="#20070202">2007/02/02 - nouvelle façon d'activer/désactiver le système 
d'accounting au démarrage</a>
<li><a href="#20070226">2007/02/26 - spamd: greylisting on par défaut; fichiers de config
déplacés vers /etc/mail</a>
</ul>

<h2>Mettre à jour de la 3.9 à la 4.0</h2>
<ul>
<li><a href="#20060327">2006/03/27 - Nouveau firmware iwi(4)</a>
<li><a href="#20060518">2006/05/18 - spppcontrol(8) supprimé</a>
<li><a href="#20060526">2006/05/26 - ipsecadm(8) supprimé</a>
<li><a href="#20060621">2006/06/21 - dvmrpd(8) ajouté</a>
<li><a href="#20060625">2006/06/25 - wicontrol(8) supprimé</a>
<li><a href="#20060727">2006/07/27 - nouvelle option de compilation</a>
</ul>

<h2>Mettre à jour de la 3.8 à la 3.9</h2>
<ul>
<li><a href="#20050927">2005/09/27 - la compilation requiert une nouvelle fonctionnalité de xargs</a>
<li><a href="#20051006">2005/10/06 - Changements dans MAKEDEV(8) et ksh(1)</a>
<li><a href="#20051116">2005/11/16 - Nouvelle version de ftp-proxy(8)</a>
<li><a href="#20051216">2005/12/16 - libresolv supprimée</a>
<li><a href="#20060104">2006/01/04 - mac68k passe à wscons(4)</a>
<li><a href="#20060113">2006/01/13 - changements de types</a>
<li><a href="#20060131">2006/01/31 - mises à jour de la configuration de XKB</a>
<li><a href="#20060221">2006/02/21 - ipsec.conf(5) mis à jour</a>
</ul>

<h2>Mettre à jour de la 3.7 à la 3.8</h2>
<ul>
<li><a href="#20050329">2005/03/29 - Gestion des exceptions "flag day" (i386)</a>
<li><a href="#20050331">2005/03/31 - mmap(2) "flag day" (vax)</a>
<li><a href="#20050413">2005/04/13 - Nouvel utilisateur et groupe : _hostapd</a>
<li><a href="#20050527">2005/05/27 - pf <i>log-all</i> devient <i>log (all)</i></a>
<li><a href="#20050601">2005/06/01 - mmap maintenant compté dans les datasize rlimit</a>
<li><a href="#20050609">2005/06/09 - changement dans la configuration de bgpd</a>
<li><a href="#20050802">2005/08/02 - Nouvelles fonctionnalités dans crunchgen</a>
<li><a href="#20050806">2005/08/06 - construction des locales LC_CTYPE</a>
<li><a href="#20050927">2005/09/27 - la compilation requiert une nouvelle fonctionnalité de xargs</a>
<li><a href="#20051006">2005/10/06 - Changements dans MAKEDEV(8) et ksh(1)</a>
</ul>


<h2>Mettre à jour de la 3.6 à la 3.7</h2>
<a href="#20041027">2004/10/27 - Gestion des exceptions "flag day" (amd64, cats,
    hppa, sgi et sparc64)</a><br>
<a href="#20041029">2004/10/29 - Passage à gcc3 (macppc)</a><br>
<a href="#20041111">2004/11/11 - changement de comportement de bgpd</a><br>
<a href="#20041124">2004/11/24 - Nouvel utilisateur et groupe : _ftp</a><br>
<a href="#20041230">2004/12/30 - Passage à gcc3 (i386)</a><br>
<a href="#20050118">2005/01/18 - Nouvel utilisateur et groupe : _ospfd</a><br>
<a href="#20050124">2005/01/24 - pfsync prend en compte syncdev au lieu de syncif</a><br>
<a href="#20050202">2005/02/02 - Constantes POSIX hex et octales dans (k)sh</a><br>
<p>

    <h2>Mettre à jour de la 3.5 à la 3.6</h2>
    <p>
      <a href="#3.5.1">3.5.1: numéros de périphériques mineurs pty modifiés</a><br>
      <a href="#3.5.2">3.5.2: Nouvel utilisateur et groupe _dhcp</a><br>
      <a href="#3.5.3">3.5.3: Nouvel utilisateur et groupe _mopd</a><br>
      <a href="#3.5.4">3.5.4: Nouvel utilisateur et groupe _tftpd</a><br>
      <a href="#3.5.5">3.5.5: Nouvel utilisateur et groupe _rbootd</a><br>
      <a href="#3.5.6">3.5.6: cksum déplacé vers /bin</a><br>
      <a href="#3.5.7">3.5.7: Nouvel utilisateur et groupe _afs</a><br>
      <a href="#3.5.8">3.5.8: Nouvel utilisateur et groupe _ppp</a><br>
      <a href="#3.5.9">3.5.9: Nouvel utilisateur et groupe _ntp</a><br>
      <a href="#3.5.10">3.5.10: Saut de librairie "flag day"</a><br>
      <a href="#3.5.11">3.5.11: Changements dans les ancres de pf</a><br>
    </p>

    <h2>Mettre à jour de la 3.4 à la 3.5</h2>
    <p>
      <a href="#3.4.1">3.4.1: numéros de périphériques mineurs svnd modifiés</a><br>
      <a href="#3.4.2">3.4.2: Nouvel utilisateur et groupe _pflogd</a><br>
      <a href="#3.4.3">3.4.3: Clonage d'interface</a><br>
      <a href="#3.4.4">3.4.4: Nouvel utilisateur et groupe _bgpd</a><br>
      <a href="#3.4.5">3.4.5: Nouvelle version de join(1)</a><br>
      <a href="#3.4.6">3.4.6: changement dans la construction de sudo</a><br>
      <a href="#3.4.7">3.4.7: Nouvel utilisateur et groupe _tcpdump</a><br>
      <a href="#3.4.8">3.4.8: changement dans machdep.c (i386)</a><br>
      <a href="#3.4.9">3.4.9: Mise à jour de bsd.own.mk</a><br>
      <a href="#3.4.10">3.4.10: Passage à gcc3 (sparc64)</a><br>
    </p>
  
    <h2>Mettre à jour de la 3.3 à la 3.4</h2>

    <p>
      <a href="#3.3.1">3.3.1: support i386 W^X </a><br>
      <a href="#3.3.2">3.3.2: changement syscall mquery</a><br>
      <a href="#3.3.3">3.3.3: i386 "flag day", changement exe addr/MAXDSIZ</a><br>
      <a href="#3.3.4">3.3.4: Suppression de l'authentification KerberosIV</a><br>
      <a href="#3.3.5">3.3.5: changement de config</a><br>
      <a href="#3.3.6">3.3.6: Utilisation de __attribute__((bounded)) sur 
				certaines fonctions</a><br>
      <a href="#3.3.7">3.3.7: Nouvel utilisateur et groupe _syslogd</a><br>
      <a href="#3.3.8">3.3.8: Nouveau format d'attribut __kprintf__ dans les
		en-têtes noyau</a><br>
    </p>
    
    <h2>Mettre à jour de la 3.2 à la 3.3</h2>
    
    <p>
      <a href="#3.2.1">3.2.1: Nouveau Perl</a><br>
      <a href="#3.2.2">3.2.2: Nouveaux groupes _radius, _token et _shadow</a><br>
      <a href="#3.2.3">3.2.3: Importants changements du compilateur</a><br>
      <a href="#3.2.4">3.2.4: Nouvel utilisateur et groupe _spamd</a><br>
      <a href="#3.2.5">3.2.5: Alias pour ipv6-icmp</a><br>
      <a href="#3.2.6">3.2.6: Nouveau groupe _lkm</a><br>
      <a href="#3.2.7">3.2.7: Nouvelle libpthread</a><br>
      <a href="#3.2.8">3.2.8: Changements de Linker pour l'architecture ELF </a><br>
      <a href="#3.2.9">3.2.9: Suppression de /var/at et changements crontab </a><br>
    </p>

<h2>Mettre à jour la 3.1</h2>

    <p>
      <a href="#3.1.1">3.1.1: Nouveaux utilisateurs/groupes</a><br>
      <a href="#3.1.2">3.1.2: Nouveau groupe pour crontab(1) et at(1)</a><br>
      <a href="#3.1.3">3.1.3: Nouveau Binutils</a><br>
      <a href="#3.1.4">3.1.4: Nouvel configuration S/Key</a><br>
      <a href="#3.1.5">3.1.5: Nouvelles permissions pour lp*</a><br>
      <a href="#3.1.6">3.1.6: atrun(8) n'est plus nécessaire</a><br>
      <a href="#3.1.7">3.1.7: nat.conf fusionné avec pf.conf</a><br>
      <a href="#3.1.8">3.1.8: Nouvelle entrée fbtab nécessaire à xdm</a><br>
      <a href="#3.1.9">3.1.9: Utilisation de __attribute__((sentinel)) sur 
				certaines fonctions</a><br>
    </p>

<h2>Mettre à jour la 3.0</h2>

    <p>
      <a href="#3.0.1">3.0.1: Nouveau mot clé supporté par mtree(8)</a><br>
      <a href="#3.0.2">3.0.2: Suppression de libdl sur les plateformes ELF</a><br>
      <a href="#3.0.3">3.0.3: Nouveau framework de régression</a><br>
      <a href="#3.0.4">3.0.4: fichiers de configuration ssh déplacés vers /etc/ssh/</a><br>
    </p>

<h2>Mettre à jour la 2.9</h2>

    <p>
      <a href="#2.9.1">2.9.1: Nouveaux utilisateurs/groupes - <em>proxy</em>,
        <em>smmsp</em> et <em>popa3d</em></a><br>
      <a href="#2.9.2">2.9.2: Nouveau filtre de paquets : <em>pf</em></a><br>
      <a href="#2.9.3">2.9.3: Changements à <em>make</em></a><br>
      <a href="#2.9.4">2.9.4: La compilation échoue à cause d'erreurs de 
	    KerberosV</a><br>
      <a href="#2.9.5">2.9.5: Nouvelle version de <em>sendmail</em></a><br>
      <a href="#2.9.6">2.9.6: <tt>/etc/primes</tt> déplacé</a>
    </p>

<h2>Mettre à jour la 2.8</h2>
    
    <p>
      <a href="#2.8.1">2.8.1: Nouveau groupe <em>auth</em></a><br
      />

      <a href="#2.8.2">2.8.2: Nouvelle console système <em>wscons</em></a><br />

      <a href="#2.8.3">2.8.3: Compilation du noyau ne fonctionnant pas avec
		des symboles indéfinis</a>
    </p>

<h2>Mettre à jour la 2.7</h2>

<p>
<a href="#2.7.1">
2.7.1: Quels sont les problèmes majeurs de mise à jour de la 2.7 à 2.8?
</a>
</p>

<h2>Mettre à jour la 2.6</h2>

<p>
<a href="#2.6.1">
2.6.1: Les entrées Termcap sont trop longues.
</a> <br />

<a href="#2.6.2">
2.6.2: Mon périphérique <em>pn</em> (ou <em>mx</em>, <em>al</em>, <em>ax</em>)
n'est plus reconnu par le noyau.
</a> <br />

<a href="#2.6.3">
2.6.3: Mettre à jour gcc 2.95.1 vers 2.95.2
</a> <br />

<a href="#2.6.4">
2.6.4: Mettre à jour Kerberos.
</a> <br />

<a href="#2.6.5">
2.6.5: Mettre à jour M4.
</a> <br />

<a href="#2.6.6">
2.6.6: Mettre à jour Sendmail.
</a> <br />

<a href="#2.6.7">
2.6.7: Après la mise à jour, les noyaux qui possèdent le support 
<em>apm(8)</em> ne démarrent plus.
</a> <br />

<a href="#2.6.8">
2.6.8: Le groupe par défaut de l'utilisateur <em>daemon</em> a changé.

</a>
</p>


<h2>Mettre à jour la 2.5</h2>

<p>
<a href="#2.5.1">
2.5.1: Quels sont les problèmes majeurs de mise à jour de la 2.5 à 2.6?
</a> <br />
<a href="#2.5.2">
2.5.2: Comment mettre à jour <em>gcc</em> vers <em>egcs</em>
</a>
</p>

<blockquote>
<p>
<a href="#2.5.2.1">2.5.2.1 - i386 et sparc ne sont plus #define </a><br />
<a href="#2.5.2.2">2.5.2.2 - La compilation s'arrête sur xlint </a><br />
<a href="#2.5.2.3">2.5.2.3 - Core Dump sur uthread_autoinit.c </a><br />
<a href="#2.5.2.4">2.5.2.4 - egcs semble beaucoup plus lent que gcc </a><br />
<a href="#2.5.2.5">2.5.2.5 - egcs génère du code plus gros que gcc </a><br />
<a href="#2.5.2.6">2.5.2.6 - Après l'installation de egcs je n'ai plus que très peu
d'espace disque </a><br />
<a href="#2.5.2.7">2.5.2.7 - Ma compilation s'arrête sur libcurses</a><br />
<a href="#2.5.2.8">2.5.2.8 - Je n'arrive pas à faire un make obj</a>
</p>
</blockquote>

<p>
<a href="#2.5.3">
2.5.3: Mon <em>make build</em> meurt avec des erreurs <em>unimplemented syscall</em>.
</a> <br />

<a href="#2.5.4">
2.5.4: Lien vers le nouveau répertoire 2.6.
</a> <br />

<a href="#2.5.5">
2.5.5: Après une <strong>(U)</strong>pgrade, l'extraction de <em>base26.tar.gz</em>
s'arrête avec un message.
</a>
</p>

<h2>Mettre à jour la 2.4</h2>

<p>
<a href="#2.4.1">
2.4.1: Changements de pages Man
</a> <br />

<a href="#2.4.2">
2.4.2: Syntaxe de <em>cap_mkdb</em> modifiée
</a> <br />

<a href="#2.4.3">
2.4.3: Snake
</a>
</p>

<h2>Mettre à jour la 2.3</h2>

<p>
<a href="#2.3.1">
2.3.1: Nouvel utilisateur : <em>named</em>
</a> <br />

<a href="#2.3.2">
2.3.2: J'ai essayé la compilation, mais elle s'arrête en essayant de compiler
<em>ssleay</em>.
</a> <br />

<a href="#2.3.3">
2.3.3: J'ai essayé la compilation, mais elle s'arrête en essayant de faire 
quelque chose sur PowerPC.
</a>
</p>


&nbsp;<hr width="30%">

<a name="1.0"></a>

<a name="4.5"></a>
<h2>Mettre à jour de la 4.5 à la 4.6</h2>
<a name="20090304"></a>
<h3>2009/03/04 - nouvel utilisateur et groupe pour smtpd</h3>
La commande suivante doit être exécutée :
<pre>
useradd -u 95 -g =uid -c "SMTP Daemon" -d /var/empty -s /sbin/nologin _smtpd
</pre>

<p>
<a name="20090316"></a>
<h3>2009/03/16 - makemap(8) now run through mailwrapper(8)</h3>
Depuis l'ajout de smtpd(8) à la compilation, makemap(8) fonctionne à travers
mailwrapper(8) pour supprimer les conflits entre les versions binaires de
sendmail et smtpd. Pour que cela fonctionne, on doit ajouter manuellement
la ligne suivante dans /etc/mailer.conf :
<pre>
makemap         /usr/libexec/sendmail/makemap
</pre>

<p>
<a name="20090324"></a>
<h3>2009/03/24 - Changement du comportement de "redistribute default" dans
ospfd(8) et ripd(8)</h3>
"redistribute default", configuré dans les fichier ospfd.conf(5) et
ripd.conf(5), nécessite maintenant la présence d'une route par défaut dans
le table de routage du noyau sinon aucune route ne sera annoncée par
ospfd(8)
et ripd(8).

<p>
<a name="20090406"></a>
<h3>2009/04/06 - changements incompatibles sur pf(4)</h3>
La normalisation de paquet ("scrubbing") a été intégrée dans les règles
principales. C'est maintenant spécifié en ajoutant le paramétre "scrub
(options)" aux règles. Par exemple :

<pre>
        scrub in all no-df max-mss 1440
</pre>
        
peut-être maintenant remplacé avec une règle utilisant la nouvelle
action "match":

<pre>
        match in all scrub (no-df max-mss 1440)
</pre>
        
Depuis que l'ordre du jeu de règles est appliqué par défaut, elles devront
être déplacées dans les règles principales (avant les règles "pass quick"),
ou la validation de l'ordre des règles devra être désactivée :
        
<pre>
	set require-order no
</pre>
                
Le réassemblage de paquet a été simplifié. "Crop" et "drop-ovl" ont été
supprimés; seulement le réassemblage complet reste. Il est activé ainsi :
                
<pre>
	set reassemble yes|no [no-df]
</pre>
                        
Si "no-df" est utilisé, les fragments (et seulement les fragments !) avec le
bit df activé seront reinitialisés avec d'entrer dans le cache fragment, et
donc le paquet réassemblé n'aura pas le df activé. Les paquets
non-fragmentés ne sont pas affectés par no-df.

<p>
<a name="20090407"></a>
<h3>2009/04/07 - réassemblage de fragment activé par
défaut dans pf(4)</h3>
Comme il n'y a pas de raison de ne pas utiliser le réassemblage de fragment,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&sektion=4">pf(4)</a>
a été modifié pour l'activer par défaut.

<p>
<a name="20090426"></a>
<h3>2009/04/26 - require-order off par défaut dans pfctl(8)</h3>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&sektion=8">pfctl(8)</a>
a été modifié pour que "set require-order" soit maintenant désactivé par
défaut.
Ceci est uniquement consultatif, aucun changement de configuration est
nécessaire.

<p>
<a name="20090520"></a>
<h3>2009/05/20 - nouvel utilisateur et groupe pour rpc.rwalld</h3>
La commande suivante doit être exécutée :
<pre>
useradd -u 96 -g =uid -c "rpc.rwalld" -d /var/empty -s /sbin/nologin _rwalld
</pre>
                        
<p>
<a name="20090525"></a>
<h3>2009/05/25 - mise à jour de daily(8), weekly, monthly et security(8)</h3>
Quand vous mettrez à jour vos scripts de maintenance périodique à la
dernière version, faite attention aux changements suivants :
<ul>
<li>Les scripts daily, weekly, et monthly utilisent maintenant tous la
variable PATH du crontab(5) root, qui est /bin:/sbin:/usr/bin:/usr/sbin par
défaut.
Le PATH daily(8) n'inclut plus /usr/local/bin, le PATH weekly(8)
n'inclut plus /usr/libexec.  Dans daily.local, weekly.local et
monthly.local, vous pouvez ajouter des répertoires additionnels à PATH.
<li>Les quatre scripts suppriment maintenant l'entête de section quand il
n'y pas de contenu à la suite. Quand un script ne génére rien en sortie, il
n'envoie plus de message à root. Cela requiert peut-être des ajustements à
vos scripts de parseur.
<li>Le script security(8) utilise maintenant certaines fonctions shell de
daily(8), donc il ne peut fonctionner seul. Utilisez "sudo /bin/sh /etc/daily"
dans le cas ou vous avez besoin de le faire fonctionner manuellement.
</ul>

<p>
<a name="20090531"></a>
<h3>2009/05/31 - pf activé par défaut</h3>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&sektion=4">pf(4)</a>
est maintenant activé par défaut dans rc.conf.

<p>
<a name="20090602"></a>
<h3>2009/06/02 - tmux(1) déplacé de ports vers base</h3>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tmux&amp;sektion=1">tmux(1)</a>
a été déplacé des ports vers la base. Si vous l'aviez installé des ports,
merci de le supprimer avec with pkg_delete.

<p>
<a name="20090603"></a>
<h3>2009/06/03 - changement ABI httpd</h3>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=httpd&amp;sektion=8">httpd(8)</a>
a été corrigé pour reporter la taille correcte des fichiers de grandes
tailles, cela a introduit un changement de l'ABI. A cause de cela les
modules tiers devront être recompilés ou les paquetages mis à jour.

<p>
<a name="20090626"></a>
<h3>2009/06/26 - mise à jour de lynx(1)</h3>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lynx&amp;sektion=1">lynx(1)</a>
a été mis à jour en 2.8.6rel.5.  Certaines directives du fichier de
configuration /etc/lynx.cfg ont été modifiées, vous devez donc le mettre à
jour :
<blockquote><pre>
# cd /tmp
# ftp ftp://mirror/path/to/snapshots/arch/etc46.tgz
# tar xzpf etc46.tgz ./etc/lynx.cfg
# mv etc/lynx.cfg /etc
</pre></blockquote>
Fusionnez vos changements locaux après cela.
                        
<p>
<a name="20090703"></a>
<h3>2009/07/03 - mise à jour du pilote bnx(4)</h3>
<!-- this shouldn't be needed in the 4.6 notes -->
Le pilote
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bnx&amp;sektion=4">bnx(4)</a>
a été mis à jour pour supporter de nouveaux controleurs.
Cela inclus un changement dans la façon de gérer le firmware.
Les utilisateurs avec un bnx doivent créer le nouveau firmware avant de
démarrer un nouveau noyau :
<blockquote><pre>
# cd /sys/dev/microcode/bnx
# make obj clean
# make
# make install
</pre></blockquote>
Alternativement, si vous mettez à jour via un snapshot binaire sur un
système actif (au lieu d'utiliser l'installation standard), soyez sûr
d'extraire base46.tgz avant de redémarrer avec le nouveau noyau.



<a name="4.4"></a>
<h2>Mettre à jour de la 4.4 à la 4.5</h2>
<a name="20080907"></a>
<h3>2008/09/07 - syntaxe de ifconfig(8) modifiée</h3>
Certaines options de <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>
ont été modifiées. Pour afficher la liste des types de média supportés, vous
devez maintenant utiliser :
<pre>
    <b>ifconfig &lt;interface&gt; media</b>
</pre>
L'option pour scanner les réseaux sans-fil a aussi été modifiée, mais a été
<a href="#20090215">revisée ultérieurement</a>.

<p>
<a name="20080913"></a>
<h3>2008/09/13 - xcompmgr(1) a été déplacé de ports vers xbase</h3>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=xcompmgr&amp;sektion=1">xcompmgr(1)</a>
a été déplacé de ports vers xbase. Si vous l'avez installé via les ports,
merci de le supprimer avec pkg_delete.

<p>
<a name="20080929"></a>
<h3>2008/09/29 - mise à jour de Perl 5.10.0</h3>
A cause de changement dans la distribution Perl, vous devez supprimer
manuellement l'ancien répertoire perl obj avant de le compiler.
<pre>
     # rm -rf /usr/obj/gnu/usr.bin/perl
</pre>
Vous pouvez recréer le répertoire obj :
<pre>
     # cd /usr/src/gnu/usr.bin/perl
     # make -f Makefile.bsd-wrapper obj
</pre>
             
Il est à remarquer qu'a cause de cette mise à jour majeure de Perl,
vous devez recompiler/reinstaller tous les modules Perl XS. Il y
a des modules qui incluent un objet partagé qui est chargé dans le
processus Perl executé. Pour voir la liste des modules XS installés
via le sous-système des paquetages, executez :
<pre>
     # cd /var/db/pkg
     # fgrep .so p5-*/+CONTENTS | sed 's/+CONTENTS.*//' | sort -u
</pre>
Mettre à jour à la derniére version du snapshot des paquetages avec
"pkg_add -ui" prendra soin de ces mises à jour. Aprés la mise à jour,
vous devez desinstaller plusieurs modules qui sont maintenant fournis
dans Perl par défaut :
<pre>
     # pkg_delete p5-Archive-Tar p5-Compress-Raw-Zlib p5-Compress-Zlib \
       p5-IO-Compress-Base p5-IO-Compress-Zlib p5-IO-Zlib p5-Module-Build \
       p5-Module-CoreList p5-Module-Load p5-version p5-Digest-SHA
</pre>

<p>
<a name="20081003"></a>
<h3>2008/10/03 - sm-client.st a été déplacé</h3>
Le fichier (optionnel) des statuts de sendmail pour les messages soumis a
été deplacé de <tt>/var/spool/clientmqueue/sm-client.st</tt> vers
<tt>/var/log/sm-client.st</tt> pour être cohérent avec l'endroit ou se
situe le fichier <tt>/var/log/sendmail.st</tt>.

<p>
<a name="20081102"></a>
<h3>2008/11/02 - mise à jour de Xserver 1.5.2</h3>
<tt>RgbPath</tt> n'est plus un mot clé valide dans la section <b>Files</b>
du fichier de configuration
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=xorg.conf">xorg.conf(5)</a>.
L'entrée correspondante doit être supprimée des fichiers de configuration
existants. Cette directive était déjà ignorée depuis plusieurs versions.
<p>
Le pilote pour les composants Intel
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=i810">i810(4)</a>
a été complétement remplacé par le pilote
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=intel">intel(4)</a>.
Le fichier de configuration
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=xorg.conf">xorg.conf(5)</a>
doit être mis à jour.

<a name="20081103"></a>
<h3>2008/11/03 - mise à jour de Perl 5.10.0</h3>
Un autre module maintenant installé dans le Perl de base a été trouvé,
merci de le supprimer.
<pre>
     # pkg_delete p5-Locale-Maketext-Simple
</pre>
     
<a name="20081105"></a>
<h3>2008/11/05 - mise à jour de Perl 5.10.0</h3>
Il y a deux modules installés dans le Perl de base a supprimer.
<pre>
     # pkg_delete p5-Pod-Escapes p5-Pod-Simple
</pre>
          
<a name="20081106"></a>
<h3>2008/11/06 - mise à jour de Xserver 1.5.2</h3>
Plusieurs modules xserver et pilotes sont obsolètes. Pour être sur que
<tt>X -configure</tt> n'essaye pas de configurer ces pilotes obsolètes,
il est recommandé de supprimer l'ancien contenu de
<tt>/usr/X11R6/lib/modules</tt> avant d'installer un nouveau snapshot.
           
<a name="20081107"></a>
<h3>2008/11/07 - mise à jour de Perl 5.10.0</h3>
Plus de modules migrés vers la base, comme précedemment.
<pre>
     # pkg_delete p5-ExtUtils-ParseXS p5-ExtUtils-CBuilder \
       p5-Module-Pluggable p5-Time-Piece
</pre>

<p>
<a name="20081111"></a>
<h3>2008/11/11 - support PIE ajouté à gcc 3.3.5 & csu</h3>
Le support des executables en position indépendante (PIE) a été ajouté à
gcc 3.3.5 et csu.  Pour mettre à jour suivez ces étapes :
<ul>
<li>Compilation et installation de gcc:
<pre>
     # cd /usr/src/gnu/usr.bin/gcc
     # make -f Makefile.bsd-wrapper obj
     # make -f Makefile.bsd-wrapper depend
     # make -f Makefile.bsd-wrapper
     # make -f Makefile.bsd-wrapper install
     # make -f Makefile.bsd-wrapper clean
</pre>
<li><a href="faq5.html#BldUserland">Compilation et installation userland</a>
</ul>          

<p>
<a name="20081116"></a>
<h3>2008/11/16 - mixerctl(1) a été renommé</h3>
Le nom des objets du mixer comme <tt>headphones</tt> a été raccourci à
<tt>hp</tt>, et <tt>speaker</tt> a été raccourci à <tt>spkr</tt>.
Cela nécessite des changements dans mixerctl.conf(5).

<p>
<a name="20081126"></a>
<h3>2008/11/26 - btd nécessite un utilisateur et un groupe</h3>
Le nouveau daemon ajouté <tt>btd</tt> révoque ces privilèges a un nouvel
utilisateur et groupe _btd.
Comme <i>root</i>, ajoutez le nouvel utilisateur et son groupe correspondant
en utilisant
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=useradd&amp;sektion=8">useradd(8)</a> :
<blockquote><pre>
    # useradd -u94 -g=uid -c"Bluetooth Daemon" -d/var/empty -s/sbin/nologin _btd</b>
</blockquote></pre>

<p>
<a name="20090204"></a>
<h3>2009/02/04 - mise à jour de Perl 5.10.0</h3>
Un autre module qui a migré vers la base, merci de le supprimer.
<pre>
    # pkg_delete p5-Module-Loaded
</pre>
    
<p>
<a name="20090215"></a>
<h3>2009/02/15 - syntaxe de ifconfig(8) modifiée</h3>
L'option <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>
pour scanner les réseaux sans-fil a été modifiée.
Vous devez utiliser maintenant :
<pre>
    <b>ifconfig &lt;interface&gt; scan</b>
</pre>
    
<p>
<a name="20090218"></a>
<h3>2009/02/18 - numéro de version de pfsync(4) incrémentée</h3>
A cause de changements dans le protocole et l'implémentation de l'interface
pfsync(4), le numéro de protocole pfsync(4) a été incrementé. Les Firewalls
avec des versions différentes seront incapables de synchroniser la table des
états et les connexions existantes se termineront sur le failover.


    
<a name="4.3"></a>
<h2>Mettre à jour de la 4.3 à la 4.4</h2>
<p>
<a name="20080323"></a>
<h3>2008/03/23 - configuration de cwm et options de la ligne de commande 
modifiées</h3>
Le gestionnaire de fenêtre cwm(1) possède un nouveau parseur de config, donc
la configuration a besoin d'être modifiée en suivant
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cwmrc&amp;sektion=5">cwmrc(5)</a>.
L'option de ligne de commande "-f" (font) et "-s" (sticky) sont remplacées par
des directives de config.
Supprimez ces options de votre .xsession ou votre login xdm(1) ne fonctionnera
pas !

<p>
<a name="20080328"></a>
<h3>2008/03/28 - librairies partagées landisk activées</h3>
Pour passer de la compilation statique sur landisk à la partagée il est 
nécessaire en premier de compiler et installer gcc et ld.so avant de
compiler le reste du système :
<blockquote><pre>
# <b>cd /usr/src/gnu/usr.bin/gcc</b>
# <b>make -f Makefile.bsd-wrapper obj</b>
# <b>make -f Makefile.bsd-wrapper depend</b>
# <b>make -f Makefile.bsd-wrapper</b>
# <b>make -f Makefile.bsd-wrapper install</b>
# <b>cd /usr/src/share/mk</b>
# <b>make install</b>
# <b>cd /usr/src/libexec/ld.so</b>
# <b>make obj</b>
# <b>make depend</b>
# <b>make</b>
# <b>make install</b>
</pre></blockquote>
Puis suivez
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=release&amp;sektion=8">
release(8)</a>:
les indications pour compiler le système complet.

<p>
<a name="20080421"></a>
<h3>2008/04/21 - les options de la ligne de commande de rtadvd(8) modifiées</h3>
Le daemon de routage d'avertissement IPv6 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rtadvd">rtadvd(8)</a>
possède les options de ligne de commande 
<tt>"-f"</tt> (foreground), <tt>"-d"</tt> (debug) et <tt>"-D"</tt>
(encore plus de debug).
Ces options ont fusionné en <tt>-d</tt> qui fait la même chose maintenant
que la combinaison des trois anciennes options et c'est plus OpenBSD-like.

<p>
<a name="20080508"></a>
<h3>2008/05/08 - file(1) mis à jour, nécessite un nouveau /etc/magic</h3>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=file">file(1)</a>
a été mis à jour à une version plus récente qui requiert un nouveau fichier
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=magic">magic(5)</a>
a installer :
<blockquote><pre>
# <b>cd /tmp</b>
# <b>ftp ftp://mirror/path/to/snapshots/arch/etc43.tgz</b>
# <b>tar xzpf etc43.tgz ./etc/magic</b>
# <b>mv etc/magic /etc</b>
</pre></blockquote>

<p>
<a name="20080522"></a>
<h3>2008/05/22 - version de protocole du mode sync de spamd(8) changée</h3>
Le protocole que <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=spamd">spamd(8)</a> 
utilise quand il fonctionne en mode sync a été changé pour corriger un
grand nombre de bogues et la version de protocole a été incrémentée.
A cause de cela, les nouvelles versions de spamd ne peuvent être synchronisées
avec les anciennes (ils sauteront les paquets d'un autre).
Bien entendu toutes les instances dans un groupe de synchronisation spamd
doivent être mis à jour en même temps.

<p>
<a name="20080606"></a>
<h3>2008/06/06 - manuel httpd(8) déplacé</h3>
Le manuel d'Apache pour
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=httpd">httpd(8)</a> 
a été déplacé de <tt>/var/www/htdocs/manual/</tt> vers
<tt>/usr/share/doc/html/httpd/</tt>.
Il a aussi été déplacé de l'ensemble de fichiers <i>etcXX</i> vers 
<i>miscXX</i>.

<p>
<a name="20080607"></a>
<h3>2008/06/07 - support de dhcpd.interfaces supprimé<h3>
Le support de <tt>/etc/dhcpd.interfaces</tt> a été supprimé.
Le fichier est devenu obsolète en faveur de l'option de configuration
 <tt>dhcpd_flags</tt> dans <tt>/etc/rc.conf.local</tt>.

<p>
<a name="20080609"></a>
<h3>2008/06/09 - nmeaattach(8) supprimé</h3>
La commande
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nmeaattach">nmeaattach(8)</a>
et l'option nmeaattach_flags dans /etc/rc.conf ont été supprimées dans la
-current.
Utilisez
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ldattach">
ldattach(8)</a> à la place.
Il a une utilisation légèrement différente que nmeaattach(8): <tt>nmeaattach
cuaU0</tt> devient <tt>ldattach nmea cuaU0</tt>.

<p>
<a name="20080609b"></a>
<h3>2008/06/09 - Nouvel utilisateur et groupe _rtadvd</h3>
Le daemon <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rtadvd&amp;sektion=8">rtadvd(8)</a>
diminue ses privilèges après l'initialisation vers un nouvel utilisateur et 
_rtadvd.
Sous l'utilisateur <i>root</i>, ajoutez l'utilisateur et le groupe en utilisant
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=useradd&amp;sektion=8">useradd(8)</a>:
<blockquote><pre>
<b>useradd -u92 -g=uid -c"IPv6 Router Advertisement Daemon" -d/var/empty -s/sbin/nologin _rtadvd</b>
</pre></blockquote>

<p>
<a name="20080610"></a>
<h3>2008/06/10 - compteurs par adresse désactivés par défaut sur les tables pf(4)</h3>
Les tables <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf">pf(4)</a>
demandent maintenant l'option <tt>counters</tt> pour activer les compteurs
de paquets et d'octets par adresse, comme par exemple :
<br>
<blockquote><tt>
table &lt;webservers&gt; counters { 192.168.33.4, 192.168.33.16/29 }
</tt></blockquote>
Regardez <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf">pf.conf(5)</a>
pour les détails.

<p>
<a name="20080613"></a>
<h3>2008/06/13 - mailmode dans mg(1) supprimé</h3>
Parce que mail-mode dans
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mg">mg(1)</a>
était un réimplementation pleines de bogues de auto-fill-mode, elle a
été supprimée.
Si vous l'utilisez merci de changer vos commandes ainsi :<br>
<blockquote><tt>
mail-mode => auto-fill-mode<br>
mail-set-margin => set-fill-column
</tt></blockquote>
N'oubliez pas de modifier aussi votre fichier .mg bien évidemment.

<p>
<a name="20080616"></a>
<h3>2008/06/16 - numéro de version de pfsync(4) incrémenté</h3>
A cause de changements dans la table d'état de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf">pf(4)</a>, 
le numéro de version de protocole a été incrémenté; les pare-feu avec
des numéros de version différents de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfsync">pfsync(4)</a>
seront incapables de synchroniser les tables d'état et les connexions 
existantes seront finies sur le redondant.

<a name="20080627"></a>
<h3>2008/06/27 - Nouvel utilisateur et groupe _ypldap</h3>
Un nouveau daemon ypldap(8) a besoin d'un nouvel utilisateur et nouveau groupe.
Sous l'utilisateur <i>root</i>, ajoutez l'utilisateur et le groupe avec
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=useradd&amp;sektion=8">useradd(8)</a>:
<blockquote><pre>
useradd -u93 -g=uid -c"YP to LDAP Daemon" -d/var/empty -s/sbin/nologin _ypldap
</pre></blockquote>

<p>
<a name="20080709"></a>
<h3>2008/07/09 - yacc(1) mis à jour</h3>
Une recompilation et installation de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=yacc">yacc(1)</a>
est nécessaire avant de faire un make build avec un répertoire obj propre
pour être sur que tous les parseurs générés par yacc seront régénérés.

<p>
<a name="20080710"></a>
<h3>2008/07/10 - listes TCP/UDP baddynamic, sysctl(8), named(8) et /etc/rc</h3>
Les sysctl noyau 
<em>net.inet.tcp.baddynamic</em> et <em>net.inet.udp.baddynamic</em>
et l'utilitaire 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8">sysctl(8)</a>
ont été étendus pour couvrir l'ensemble complet des ports TCP/UDP. Ces listes
identifient les ports sources pour ne jamais allouer dynamiquement et donc
d'avoir des conflits avec les ports des services connus. Le script
<tt>/etc/rc</tt> remplit maintenant automatiquement ces listes à partir de
<tt>/etc/services</tt> au démarrage. 
<p>
La nouvelle version de 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=named&amp;sektion=8">named(8)</a>
(9.4.2-P1) a tout juste été importée utilisant les ports sources aléatoires 
pour les requêtes et cette fonction permet une utilisation plus robuste.

<p>
Pour éviter toute incompatibilité, le noyau,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8">sysctl(8)</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=named&amp;sektion=8">named(8)</a> et
<tt>/etc/rc</tt>
doivent être mis à jour en même temps (compilez et installez le noyau avant
"make build").

<p>
<a name="20080711-0"></a>
<h3>2008/07/11 - pilote openchrome(4) pour Xenocara</h3>
Le pilote <a href="http://www.openchrome.org">xf86-video-openchrome</a> a été
ajouté à Xenocara pour les composants VIA à la place du vieux et obsolète
xf86-video-via qui était présent précédemment.
<br>
Si vous utilisez un composant VIA avec un fichier de configuration, remplacez
<blockquote><tt>
  Driver "via"
</tt></blockquote>
par
<blockquote><tt>
  Driver "openchrome"
</tt></blockquote>
dans <tt>/etc/X11/xorg.conf</tt> pour utiliser le nouveau pilote. Voir la page
de manuel 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=openchrome&amp;sektion=4">openchrome(4)</a>
pour plus d'options de configuration.

<p>
<a name="20080711-1"></a>
<h3>2008/07/11 - pilote vidéo ati(4) mis à jour</h3>
Le pilote ati(4) a été mis à jour. Cette mise à jour de xf86-video-ati apporte
d'importants changements.
<br>
<p>
Plus de <a href="http://dri.freedesktop.org/wiki/MergedFB">MergedFB</a>:
<br>
<blockquote>
Le support du mode MergedFB a été supprimé en faveur de xrandr(1).
</blockquote>

<p>
Une option pour Macbooks a été modifiée :
<blockquote>
Les utilisateurs de Macs ou Macbooks qui utilisent l'option suivante
<blockquote>
<pre>
Option      "iBookHacks" "on"
</pre>
</blockquote>
doivent lire la page de manuel
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=radeon&amp;sektion=4">radeon(4)</a>
, plus spécialement la section <tt>"MacModel"</tt> si ils ont des problèmes.
<br>
Avec cette version, cette option a été supprimée.
</blockquote>

<p>
<a name="20080719"></a>
<h3>2008/07/19 - traitement des métadonnées dans softraid réécrit</h3>
Les métadonnées dans le traitement de 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=softraid&amp;sektion=4">softraid(4)</a>
ont été réécris de zéro. Le nouveau code n'est pas compatible avec l'ancien 
format des métadonnées et les utilisateurs doivent sauvegarder et recréer leurs
volumes softraid. Les anciens volumes softraid ne seront pas assemblés lors du
redémarrage avec un noyau possédant ce code.

<p>
<a name="20080724"></a>
<h3>2008/07/24 - changements dans libc et libm</h3>
A cause de changements dans libc et libm, les étapes suivantes doivent être
réalisées avant de recompiler le systéme.

<p>0. Soyez sur d'avoir obj.

<blockquote><pre>
# <b>cd /usr/src</b>
# <b>make obj</b>
</pre></blockquote>

<p>1. Installation des en-têtes, compilation et installation de libc.

<blockquote><pre>
# <b>cd /usr/src/include</b>
# <b>make prereq</b>
# <b>make includes</b>
# <b>cd /usr/src/lib/libc</b>
# <b>make cleandir</b>
# <b>make depend</b>
# <b>make</b>
# <b>make install</b>
</pre></blockquote>

<p>2. Compilation et installation de libm.

<blockquote><pre>
# <b>cd /usr/src/lib/libm</b>
# <b>make cleandir</b>
# <b>make depend</b>
# <b>make</b>
# <b>make install</b>
</pre></blockquote>

<p>3. Compilation et installation de libiberty.

<blockquote><pre>
# <b>cd /usr/src/gnu/lib/libiberty</b>
# <b>make -f Makefile.bsd-wrapper cleandir</b>
# <b>make -f Makefile.bsd-wrapper depend</b>
# <b>make -f Makefile.bsd-wrapper</b>
# <b>make -f Makefile.bsd-wrapper install</b>
</pre></blockquote>

<p>4. Compilation et installation de gcc.

<pre>
    <b>Si votre plateforme utilise gcc 2.95.3:</b>
       # <b>rm -r /usr/obj/gnu/egcs/gcc/*</b>
       # <b>cd /usr/src/gnu/egcs/gcc</b>
        <i>- or -</i>
    <b>Si votre plateforme utilise gcc 3.3.5:</b>

       # <b>rm -r /usr/obj/gnu/usr.bin/gcc/*</b>
       # <b>cd /usr/src/gnu/usr.bin/gcc</b>

    <b>Procédure commune de compilation pour v3.3.5 ou v2.95.3</b>
    # <b>make -f Makefile.bsd-wrapper clean</b>
    # <b>make -f Makefile.bsd-wrapper obj</b>
    # <b>make -f Makefile.bsd-wrapper depend</b>
    # <b>make -f Makefile.bsd-wrapper</b>
    # <b>make -f Makefile.bsd-wrapper install</b>
</pre>

Comme d'habitude, démarrer d'un snapshot est CONSIDERABLEMENT plus simple
et hautement recommandé.




<a name="4.2"></a>
<h2>Mettre à jour de la 4.2 à la 4.3</h2>

<p>
<a name="20070903"></a>
<h3>2007/09/03 - support de _cxa_atexit et en-têtes sys/net "flag day"</h3>
<p>
Le support de _cxa_atexit a été ajouté à csu, libc, gcc et libstdc++ et aussi
des changements dans les en-têtes sys/net qui requiert des précautions.
Pour mettre à jour suivez ces étapes :
<ul>
<li><a href="faq5.html#BldKernel">Compilation et installation d'un nouveau noyau</a>
<li>Redémarrez
<li>Compilation et installation de csu:
<pre>
     # cd /usr/src/lib/csu
     # make obj && make depend && make && make install && make clean
</pre>
<li>Compilation et installation de gcc:
<pre>
     # cd /usr/src/gnu/usr.bin/gcc
     # make -f Makefile.bsd-wrapper obj
     # make -f Makefile.bsd-wrapper depend
     # make -f Makefile.bsd-wrapper
     # make -f Makefile.bsd-wrapper install
     # make -f Makefile.bsd-wrapper clean
</pre>
<li><a href="faq5.html#BldUserland">Compilation et installation de userland</a>
</ul>

<a name="20071020"></a>
<h3>2007/10/20 - libexpat déplacé vers base</h3>
<p>
libexpat a été déplacé de xenocara (xbase) vers src (base);
si vous utilisez des snapshots et paquetages binaires, les choses
évolueront normalement, quand les nouveaux snapshots seront disponibles.
<p>
Si vous compilez des logiciels à partir des sources, il est vital de
nettoyer son système :
<pre>
	# mv /usr/X11R6/lib/libexpat.so.* /usr/lib
	# rm /usr/X11R6/lib/libexpat*
	# rm /usr/X11R6/include/expat*
</pre>

<a name="20071008"></a>
<h3>2007/10/08 - nouvel utilisateur pour ospf6d</h3>

<i>Un daemon ospf6d a été importé</i> et pour utiliser ce nouveau daemon un
nouvel utilisateur et groupe sont nécessaires.

Sous l'utilisateur <i>root</i>, ajoutez l'utilisateur et le groupe suivant en
utilisant
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=useradd&amp;sektion=8">useradd(8)</a>:

<blockquote><pre>
# useradd -u90 -g=uid -c"OSPF6 Daemon" -d/var/empty -s/sbin/nologin _ospf6d
</pre></blockquote>

Cette étape ajoutera aussi bien le nouvel utilisateur que son groupe
correspondant. Votre environnement doit vous permettre de faire un
copier/coller de ces commandes.

<a name="20071030"></a>
<h3>2007/10/30 - changements de httpd.conf pour la configuration des modules</h3>
<p>
Les paquetages pour les modules de <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=httpd">httpd(8)</a>
installent maintenant les fichiers de configuration dans 
<tt>/var/www/conf/modules.samples</tt>
et demandent de créer par l'utilisateur des liens symboliques dans <tt>/var/www/conf/modules</tt>.
Ajoutez la ligne suivante à <tt>/var/www/conf/httpd.conf</tt> après les 
directives <tt>LoadModule</tt> (à la fin de la section 1):
<pre>
	#
	# Include extra module configuration files
	#
	Include /var/www/conf/modules/*.conf
</pre>

<a name="20071125"></a>
<h3>2007/11/25 - config(8) "flag day"</h3>
<p>
Des capacitées étendues requièrent de recompiler
<a href=http://www.openbsd.org/cgi-bin/man.cgi?query=config>config(8)</a> sur
votre système :
<pre>
	# cd /usr/src/usr.sbin/config
	# make clean
	# make obj
	# make depend
	# make
	# make install
</pre>
Puis <a href="faq5.html#BldKernel">compilez et installez un nouveau noyau</a>
comme d'habitude.

<a name="20071128"></a>
<h3>2007/11/28 - nouveau pilote AGP</h3>
<p>
Le nouveau pilote <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=agp">agp(4)</a>
requiert une mise à jour du serveur X après l'installation d'un nouveau
noyau si votre machine demande le support AGP pour X ou XVideo.
<p>
Après l'installation d'un nouveau noyau, installez les nouveaux en-têtes noyau,
recompilez le serveur X (ou installez un nouveau snapshot) et vérifiez que
<tt>/dev/agp0</tt> est créé.
<pre>
	# cd /usr/src/include
	# make includes
	# cd /usr/src/xenocara/xserver
	# make -f Makefile.bsd-wrapper build
	# cd /usr/src/etc/etc.`uname -m`
	# install -c MAKEDEV /dev
	# cd /dev
	# ./MAKEDEV agp0
</pre>

<a name="20071207"></a>
<h3>2007/12/07 - utilisateur _hoststated renommé _relayd</h3>
Le daemon hoststated(8) a été renommé 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=relayd&amp;sektion=8">relayd(8)</a>,
donc l'utilisateur et le groupe correspondant doivent être changés.

<p>
Utilisez
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>,
éditez les fichiers de mot de passe et avec votre éditeur favori éditez le
fichier <tt>/etc/group</tt>, changez "<tt>_hoststated</tt>" en
"<tt>_relayd</tt>" dans ceux-ci.
Laissez le reste de la ligne intacte dans tous les cas.

<a name="20080131"></a>
<h3>2008/01/31 - nouvel utilisateur pour snmpd</h3>

<i>Un daemon SNMP a été importé</i>, pour l'utiliser un nouvel utilisateur
et groupe sont requis.

Sous l'utilisateur <i>root</i>, ajoutez l'utilisateur et groupe suivant en
utilisant 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=useradd&amp;sektion=8">useradd(8)</a>:

<blockquote><pre>
# useradd -u91 -g=uid -c"SNMP Daemon" -d/var/empty -s/sbin/nologin _snmpd
</pre></blockquote>

Cette étape ajoutera le nouvel utilisateur et son groupe correspondant.
Votre environnement doit vous permettre de faire un copier/coller de ces 
commandes.

<a name="20080205"></a>
<h3>2008/02/05 - carp(4) "flag day"</h3>
carp(4) a été modifié pour être plus facilement configurable.
Si vous utilisez carp avec la redondance ARP ou IP votre configuration aura
besoin d'être modifiée ainsi :
<ul>
<li> Plusieurs interfaces carp(4) partageant une IP ont été remplacées par 
l'option <tt>carpnodes</tt>.
<li> Le sysctl <tt>net.inet.carp.arpbalance</tt> a été remplacé avec le mode d'équilibrage <tt>arp</tt>.
<li> Les drapeaux <tt>LINK0,1,2</tt> utilisés pour l'équilibrage d'IP ont été
 remplacés par les modes d'équilibrage <tt>ip</tt>, <tt>ip-stealth</tt> 
 et <tt>ip-unicast</tt>. 
</ul>

<a name="20080303"></a>
<h3>2008/03/03 -  l'emplacement par défaut de xenocara a changé</h3>
L'emplacement par défaut de l'arborescence des sources de xenocara est 
maintenant <tt>/usr/xenocara</tt>.
C'est important pour les personnes qui <a href="faq5.html#Xbld">compilent X
à partir des sources</a>.
Il faut juste déplacer son arborescence xenocara :

<blockquote><pre>
# mv /usr/src/xenocara /usr
</pre></blockquote>

et le mettre à jour en -current.

<p>

<a name="4.1"></a>

<p>
<h2>Mettre à jour de la 4.1 à la 4.2</h2>

<a name="20070326"></a>
<h3>2007/03/26 - Xenocara remplace XF4 dans <i>-current</i></h3>
L'arborescence de <a href="http://www.xenocara.org/">xenocara</a> doit
maintenant être utilisée à la place de l'arborescence XF4 pour compiler
X pour OpenBSD.
Plus de détails peuvent être trouvés sur
<a href="http://undeadly.org/cgi?action=article&sid=20070328153001">undeadly.org</a>.
<p>
Si vous avez toujours <tt>Option "xkbrules" "xfree86"</tt> dans votre fichier
de configuration <tt>/etc/X11/xorg.conf</tt>, vous devez maintenant le changer 
en <tt>Option "xkbrules" "xorg"</tt>.
<p>
Si vous voulez réellement compiler xenocara des sources (ne le faites pas,
utilisez les snapshots !)
<a href="http://www.openbsd.org/cgi-bin/cvsweb.cgi/xenocara/README?rev=HEAD&content-type=text/x-cvsweb-markup"
>xenocara/README</a> et
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=release&amp;sektion=8">release(8)</a>


<a name="20070327"></a>
<h3>2007/03/27 - la mise à jour de ahci(4) peut entraîner des 
changements de noms de périphériques disques SATA</h3>
<p>
Des changements récents du sous-système <tt>ahci(4)</tt> peut entraîner que
des disques SATA qui étaient reconnus comme périphérique wd* (par exemple 
<tt>wd0</tt>) deviennent des périphériques sd* (par exemple <tt>sd0</tt>) à
la place.

<p>
C'est un problème potentiel si vous mettez à jour d'un ancien snapshot.
Regardez la sortie <tt>dmesg</tt> au démarrage.
Un disque qui était reconnu avant comme :

<p>
<blockquote><tt>
pciide1 at pci0 dev 31 function 2 "Intel 82801GBM AHCI SATA" rev 0x02: DMA, channel 0 wired to native-PCI, channel 1 wired to native-PCI<br>
pciide1: using apic 2 int 11 (irq 11) for native-PCI interrupt<br>
wd0 at pciide1 channel 0 drive 0: &lt;FUJITSU MHV2080BH&gt;<br>
wd0: 16-sector PIO, LBA48, 76319MB, 156301488 sectors<br>
wd0(pciide1:0:0): using PIO mode 4, Ultra-DMA mode 5
</tt></blockquote>

deviendra

<p>
<blockquote><tt>
ahci0 at pci0 dev 31 function 2 "Intel 82801GBM AHCI SATA" rev 0x02: AHCI 1.1: apic 2 int 16 (irq 11)<br>
scsibus1 at ahci0: 32 targets<br>
sd0 at scsibus1 targ 0 lun 0: &lt;ATA, FUJITSU MHV2080B, 0084&gt; SCSI2 0/direct fixed<br>
sd0: 76319MB, 76319 cyl, 64 head, 32 sec, 512 bytes/sec, 156301488 sec total
</tt></blockquote>

<p>
Il est donc recommandé d'éditer votre fichier <tt>/etc/fstab</tt>,
changer les entrées <tt>/dev/wd</tt> en périphériques et partitions
<tt>/dev/sd</tt> à la place.

<p>
L'autre option est de désactiver <tt>ahci</tt> en utilisant <tt>config(8)</tt> 
ou <tt>boot -c</tt>.

<p>
Lisez la page de manuel 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ahci&amp;sektion=4">ahci(4)</a>
et
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;sektion=8">config(8)</a>
pour tous les détails.

<a name="20070331"></a>
<h3>2007/03/31 - langage de filtrage bgpd modifié</h3>
<p>
Les filtres bgpd utilisant seulement <tt>prefixlen</tt> comme paramètre de
filtrage doivent maintenant inclure un identifiant de famille d'adresse 
comme <tt>inet</tt> ou <tt>inet6</tt>:

<p>
<blockquote><tt>
allow from any inet prefixlen 8 - 24<br>
deny from any inet6 prefixlen &gt; 64<br>
</tt></blockquote>

<a name="20070510"></a>
<h3>2007/05/10 - les paquetages utiliseront le libexpat livré avec xenocara</h3>
Le port libexpat a été supprimé.
Les paquetages utilisent maintenant libexpat qui est fourni avec xenocara.

<p>
Beaucoup de paquetages dépendent de libexpat à travers d'autres dépendances.
Pour exemple, les paquetages qui utilisent gettext dépendent aussi de
libexpat.

<p>
Cela signifie qu'avant d'installer de nouveaux paquetages ou de mettre à jour
votre système vers une version plus récentes des snapshots de paquetages, vous
devez avoir installé <tt>xbase42.tgz</tt>, même si les paquetages installés
ne possèdent pas d'opérations graphiques.
Lisez la 
<a href="faq4.html#AddFileSet">FAQ</a> sur l'ajout de
<tt>xbase42.tgz</tt> sur un système installé.
Si vous ne le faites pas et essayez d'installer un paquetage qui a besoin de
libexpat, pkg_add(1) affichera un message d'erreur.

<p>
Si c'est la première fois que les groupes de fichiers X sont installés sur
votre système, le cache des librairies partagées doit être mis à jour après
l'installation en utilisant 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ldconfig&amp;sektion=8"
>ldconfig(8)</a>.
Pour ajouter toutes les librairies X au cache :

<blockquote><pre>
# <b>ldconfig -m /usr/X11R6/lib</b>
</pre></blockquote>

Alternativement, vous pouvez juste redémarrer votre système et cela se
fera automatiquement.

<p>
Finalement, après avoir mis à jour tous vos paquetages vers un snapshot plus
récent, nettoyer votre système en supprimant l'ancien paquetage expat :

<blockquote><pre>
# <b>pkg_delete expat</b>
</pre></blockquote>


<a name="20070529"></a>
<h3>2007/05/29 - [i386] apm(4) l'emporte sur acpi(4)</h3>
<p>
La détection de périphérique sur i386 a été modifiée pour que
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=apm&amp;sektion=4&amp;arch=i386">
apm(4)</a> l'emporte sur 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=acpi&amp;sektion=4">
acpi(4)</a>.
Cela signifie que si votre matériel possède des périphériques apm et acpi,
seulement l'apm sera attaché.
SI pour une raison quelconque vous préférez utiliser acpi, désactivez
<tt>apm</tt> sur votre noyau acpi-actif en utilisant <tt>config(8)</tt> 
ou <tt>boot -c</tt>.


<a name="20070710"></a>
<h3>2007/07/10 - la mise à jour de wpi(4) nécessite un nouveau firmware</h3>
<p>
Des changements récents dans le pilote <tt>wpi(4)</tt> requièrent que le 
paquetage <tt>wpi-firmware</tt> soit mis à jour à la version 2.14.4.

<p>
Comme d'habitude, vous pouvez trouver un version prépackagée du firmware sur 
:<br>
<a href="http://damien.bergamini.free.fr/packages/openbsd/wpi-firmware-2.14.4.tgz">http://damien.bergamini.free.fr/packages/openbsd/wpi-firmware-2.14.4.tgz</a>

<a name="20070726"></a>
<h3>2007/07/10 - changements dans la façon dont sudo(8) passe l'environment</h3>
Pour 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sudo&amp;sektion=8#SECURITY+NOTES"
>des raisons de sécurité</a> 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sudo&amp;sektion=8">sudo(8)</a>
mettra à zéro l'ensemble des variables d'environnement et seulement quelques une
seront préservées de l'environnement précédent.

<p>
Pour que les choses continuent à fonctionner comme prévu, ajoutez la ligne 
suivante à votre fichier <tt>/etc/sudoers</tt> en utilisant
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=visudo&amp;sektion=8">visudo(8)</a> :
<blockquote><pre>
# Defaults specification
Defaults env_keep +="DESTDIR FETCH_CMD FLAVOR FTPMODE MAKE MULTI_PACKAGES OKAY_FILES PKG_DBDIR PKG_DESTDIR PKG_CACHE PKG_PATH PKG_TMPDIR PORTSDIR RELEASEDIR SUBPACKAGE"
</pre></blockquote>

<a name="20070801"></a>
<h3>2007/08/01 - [alpha] quelques NICs de(4) deviennent dc(4)</h3>
Sur la plateforme <a href="../../fr/alpha.html">alpha</a>, quelques cartes réseau qui
étaient supportées par le pilote
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=de&amp;sektion=4">de(4)</a>
sont maintenant supportées par
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dc&amp;sektion=4">dc(4)</a>.

<p>
SI votre NIC est l'une d'elle, vous avez besoin au minimum de modifier
votre <tt>/etc/hostname.deX</tt> (astuce: lien en dur) et vos fichiers 
pf.conf comme il faut.

<p>
Encore une fois, c'est <i>uniquement</i> sur la plateforme Alpha.

<a name="4.0"></a>

<h2>Mettre à jour de la 4.0 à la 4.1</h2>
<a name="20060926"></a>
<h3>2006/09/26 - Passage à gcc3 (alpha)</h3>
OpenBSD/alpha a été converti vers gcc3.
Pour mettre à jour,
<pre>
    # rm -rf /usr/include/g++
    # cp /usr/src/share/mk/bsd.own.mk /usr/share/mk/
</pre>
Maintenant, <a href="faq5.html#NewCompiler">compilez gcc3</a>, (en utilisant
le répertoire gcc3) et compilez le nouveau ld.so :
<pre>
    cd /usr/src/libexec/ld.so
    make clean
    make obj
    make depend
    make
    make install
</pre>

Maintenant, compilez le noyau et le système comme <a href="faq5.html#Bld">d'habitude</a>.
<p>

<a name="20061006"></a>
<h3>2006/10/06 - 'flags S/SA keep state' implicite dans pf.conf(5)</h3>
<i>flags S/SA keep state</i> est maintenant par défaut pour les règles pass 
dans <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5">pf.conf(5)</a>,
et les nouvelles options <i>no state</i> et <i>flags any</i> ont été ajoutées
pour écraser celles par défaut. Les règles actuelles continueront de se 
charger, mais le comportement est légèrement modifié car ces valeurs par défaut
sont plus restrictives.
Les règles avec filtrage sans état (<i>no state</i>) ou qui requiérent de créer
des états sur des paquets intermédiaires (<i>flags any</i>) devront être mises 
à jour pour demander explicitement le comportement désiré.
<p>
En particulier il faudra être prudent avec l'interface
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=enc&amp;sektion=4">enc0</a>,
car les états flottants sont des problèmes potentiels pour le filtrage du 
trafic IPsec : les états ont besoin d'être tenus par l'interface pour éviter
de permettre à du trafic non chiffré de sortir de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd&amp;sektion=8">isakmpd(8)</a>.
Par conséquent, toutes les règles sur l'interface enc0 devraient explicitement
être <i>keep state (if-bound)</i>.
<p>

<a name="20061011"></a>
<h3>2006/10/11 - disklabel pas dans les partitions FreeBSD ou NetBSD</h3>
<i>Les partitions MBR DOS FreeBSD et NetBSD</i> ne sont plus utilisées pour
stocker les disklabels, et ne sont plus recherchées pour un disklabel. Il
en résulte que les disques avec uniquement des partitions MBR DOS FreeBSD ou
NetBSD n'auront plus de partitions 'a' créées dans le disklabel trompé. Sur ces
disques le disklabel sera stocké et chargé au secteur 1, et il pourrait donc 
trouver un ancien disklabel accidentellement. Utilisez fdisk(8) pour changer le
type de partition en OpenBSD ('A6') pour utiliser le disklabel existant.
<p>

<a name="20061012"></a>
<h3>2006/10/12 - ne démarre pas des partitions NetBSD</h3>
<i>amd64, i386, macppc et mvmeppc</i> n'essayent plus de démarrer de la
première partition NetBSD quand aucune partition OpenBSD n'est trouvée.
<p>

<a name="20061029"></a>
<h3>2006/10/29 - nouvel utilisateur pour ripd(8)</h3>
<i>Un nouveau daemon RIP a été importé</i> et pour utiliser ce daemon, un
nouvel utilisateur et groupe sont nécessaires.

Sous l'utilisateur <i>root</i>, ajoutez l'utilisateur et groupe suivant en
utilisant
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=useradd&amp;sektion=8">useradd(8)</a>:

<blockquote><pre>
# useradd -u88 -g=uid -c"RIP Daemon" -d/var/empty -s/sbin/nologin _ripd
</pre></blockquote>

Cette étape ajoutera aussi bien le nouvel utilisateur que son groupe 
correspondant. Votre environnement doit vous permettre de copier/coller ces
commandes.
<p>

<a name="20061227"></a>
<h3>2006/12/27 - ARM (zaurus/armish) "Flag day"</h3>
<i>Le mécanisme d'appel système pour arm a été modifié</i> ce qui entraîne que
les binaires et librairies partagées avant le 7 Nov ne fonctionnent plus. Il 
est nécessaire de mettre à jour d'un snapshot pour passer ce changement d'ABI.
<p>

<a name="20070131"></a>
<h3>2007/01/31 - nouvel utilisateur pour hoststated(8)</h3>
<i>Un daemon HostState a été importé</i> et pour utiliser ce daemon, un
nouvel utilisateur et un nouveau groupe sont nécessaires.

Sous l'utilisateur <i>root</i>, ajoutez l'utilisateur et groupe suivant en
utilisant
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=useradd&amp;sektion=8">useradd(8)</a>:

<blockquote><pre>
# useradd -u89 -g=uid -c"HostState Daemon" -d/var/empty -s/sbin/nologin _hoststated
</pre></blockquote>

Cette étape ajoutera aussi bien le nouvel utilisateur que son groupe 
correspondant. Votre environnement doit vous permettre de copier/coller ces
commandes.
<p>

<a name="20070202"></a>
<h3>2007/02/02 - nouvelle façon d'activer/désactiver le système d'accounting 
au démarrage</h3>
Pour activer l'accounting au démarrage vous devez ajouter la nouvelle variable
"accounting=YES" à rc.conf. La présence du fichier /var/account/acct n'entraîne
plus le démarrage automatique.
<p>


<a name="20070226"></a>
<h3>2007/02/26 - spamd: greylisting on par défaut; fichiers de config
déplacés vers /etc/mail</h3>
<p>
Greylisting est maintenant le mode de fonctionnement par défaut pour spamd(8); 
l'option <tt>-g</tt> est obsolète.
Pour désactiver le greylisting et utiliser le mode blacklist-only, utilisez
l'option <tt>-b</tt>.
Pour contrôler sur quelle adresse spamd se lie, utilisez la nouvelle option
<tt>-l</tt>.

<p>
On peut aussi dire à spamd-setup(8) de fonctionner en mode blacklist-only en 
lui passant la nouvelle option <tt>-b</tt>.

<p>
Le fichier spamd.conf(5) a été déplacé de <tt>/etc</tt> vers <tt>/etc/mail</tt>.

<p>
Regardez les pages man
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=spamd&amp;sektion=8">spamd(8)</a>
et
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=spamd-setup&amp;sektion=8">spamd-setup(8)</a>
pour tous les détails.




<a name="3.9"></a>
<h2>Mettre à jour de la 3.9 à la 4.0</h2>

<a name="20060327"></a>
<h3>2006/03/27 - Nouveau firmware iwi(4)</h3>
iwi(4) nécessite maintenant la version 3.0 du firmware pour fonctionner. A 
cause de problèmes de licences le firmware n'est plus distribué avec OpenBSD.
Le firmware peut être installé via les outils pkg avec le paquetage sur
<a href="http://damien.bergamini.free.fr/iwifw/OpenBSD/iwi-firmware-3.0.tgz">http://damien.bergamini.free.fr/iwifw/OpenBSD/iwi-firmware-3.0.tgz</a>.
<p>


<a name="20060518"></a>
<h3>2006/05/18 - spppcontrol(8) supprimé</h3>
La configuration PPP dans le noyau est maintenant entièrement supportée par
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>.
L'utilitaire obsolète
<em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=spppcontrol&amp;sektion=8&amp;manpath=OpenBSD+3.9">spppcontrol(8)</a></em>
a été supprimé de l'arborescence.
Regardez les pages de manual
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sppp&amp;sektion=4">sppp(4)</a>
et
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppoe&amp;sektion=4">pppoe(4)</a>
pour des exemples de configuration.
<p>
Précédemment, le fichier /etc/hostname.pppoe0 ressemblait à cela :
<pre>
pppoedev ne0
!/sbin/ifconfig ne0 up
!/usr/sbin/spppcontrol \$if myauthproto=pap myauthname=testcaller \
        myauthkey=donttell
!/sbin/ifconfig \$if inet 0.0.0.0 0.0.0.1 netmask 0xffffffff
!/sbin/route add default 0.0.0.1
up
</pre>
Il doit être mis à jour en suivant l'exemple suivant :
<pre>
inet 0.0.0.0 255.255.255.255 0.0.0.1 pppoedev ne0 \
	authproto pap authname testcaller authkey donttell up
!/sbin/route add default 0.0.0.1
</pre>
Et l'interface physique doit être marquée UP:
<pre>
# echo "up" > /etc/hostname.ne0
</pre>
<p>

<a name="20060526"></a>
<h3>2006/05/26 - ipsecadm(8) supprimé</h3>
La configuration IPsec est maintenant totalement supportée par
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipsecctl&amp;sektion=8">ipsecctl(8)</a>.
L'utilitaire obsolète 
<em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipsecadm&amp;sektion=8&amp;manpath=OpenBSD+3.9">ipsecadm(8)</a></em>
a été supprimé de l'arborescence.
Regardez la page de manuel 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec.conf&amp;sektion=5">ipsec.conf(5)</a>
pour des exemples de configuration.
<p>

<a name="20060621"></a>
<h3>2006/06/21 - dvmrpd(8) ajouté</h3>
Un remplaçant de mrouted(8) a été démarré et importé, pour utiliser ce nouveau
daemon (remarque : pas encore très utile), l'utilisateur _dvmrpd doit être 
ajouté :<p>
<pre>
# useradd -u87 -g=uid -c"DVMRP Daemon" -d/var/empty -s/sbin/nologin _dvmrpd
</pre>

<a name="20060625"></a>
<h3>2006/06/25 - wicontrol(8) supprimé</h3>
La configuration sans fil de 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=wi&amp;sektion=4">wi(4)</a>
est maintenant complètement supportée par
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>.
L'utilitaire obsolète 
<em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=wicontrol&amp;sektion=8&amp;manpath=OpenBSD+3.9">wicontrol(8)</a></em>
a été supprimé de l'arborescence.
<p>

<a name="20060727"></a>
<h3>2006/07/27 - nouvelle option de compilation</h3>
Le noyau sur toutes les plateformes est maintenant compilé avec l'option de
compilation récemment introduite <i>-Wstack-larger-than</i>. Avant de compiler
un noyau, le compilateur a besoin d'être compilé et installé.

<p>
Suivez les instructions dans 
<a href="faq5.html#NewCompiler">FAQ 5 - How do I bootstrap a newer version of
the compiler</a> pour des détails.
<p>

<a name="3.8"></a>
<h2>Mettre à jour de la 3.8 à la 3.9</h2>
<p>
<a name="20050927"></a>
<h3>2005/09/27 - la compilation requiert une nouvelle fonctionnalité de xargs</h3>

Compilez et installez xargs(1).
<pre>
     # cd /usr/src/usr.bin/xargs && make obj && make && make install
</pre>
Puis faite un make build.

<p>
<a name="20051006"></a>
<h3>2005/10/06 - Changements dans MAKEDEV(8)</h3>
    
Des changements ont été réalisés dans MAKEDEV pour améliorer sa vitesse.
Ces changements dépendent de changements fait sur ksh précédemment.
Par conséquent, les supports d'installation construits avant cette date 
ne peuvent pas être utilisés.
<br>

<p>
<a name="20051116"></a>
<h3>2005/11/16 - Nouvelle version de ftp-proxy(8)</h3>
    
ftp-proxy a été remplacé par ce qui était autrefois appelé pftpx.
Le nouveau ftp-proxy fonctionne en stand-alone et plus de inetd.conf comme 
avant.
<p>
Les instructions de mise à jour sont les suivantes :
<p>
Arrêtez l'ancien ftp-proxy en installant un nouveau /etc/inetd.conf ou juste
en désactivant sont entrée dans /etc/inetd.conf manuellement.

<pre>
cp /usr/src/etc/inetd.conf /etc/inetd.conf
</pre>

Puis envoyez à inetd un signal HUP via kill:
<p>
<pre>
kill -HUP `cat /var/run/inetd.pid`
</pre>

Démarrez le nouveau ftp-proxy en installant un nouveau
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&amp;sektion=8"><i>/etc/rc</i></a>
et
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&amp;sektion=8"><i>/etc/rc.conf</i></a>
puis en mettant ftpproxy_flags="" dans /etc/rc.conf.local.

<pre>
cp /usr/src/etc/{rc,rc.conf} /etc
echo 'ftpproxy_flags=""' >> /etc/rc.conf.local
</pre>

Alternativement, il peut-être démarré en l'appelant simplement 
/usr/sbin/ftp-proxy dans /etc/rc.local.
<p>

Le nouveau proxy utilise les <a href="../pf/fr/anchors.html"><i>ancres</i></a> pour
permettre les connexions de données ce qui signifie que
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5"><i>/etc/pf.conf</i></a>
doit être adapté. Dans la section NAT vous devez :
<p>

<pre>
nat-anchor "ftp-proxy/*"
rdr-anchor "ftp-proxy/*"
</pre>

Elles sont obligatoires, même si vous n'utilisez pas le NAT.
La règle suivante, qui était probablement la pour l'ancien ftp-proxy,
doit rester :
<pre>
rdr pass on $int_if proto tcp from $lan to any port 21 -> \
    127.0.0.1 port 8021
</pre>

Dans la section des règles c'est nécessaire :

<pre>
anchor "ftp-proxy/*"
</pre>

Les règles qui permettent au proxy de faire du contrôle de connexions FTP
(destination port 21/tcp) doivent rester.
Les règles qui permettent les connexions données FTP ne sont plus nécessaires.
Ces règles doivent contenir "user proxy" ou "to port &gt; 49151".

La prudence a été de mise pour garder les options de la ligne de commande 
similaire, mais certaines sont différentes.
Regardez la page de manuel
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8">ftp-proxy</a>.
<p>

Un cas mérite une mention spéciale : si vous possèdez d'anciens clients qui 
s'appuient sur le mode actif des connexions de données qui utilisent 20/tcp
comme port source, vous devez utilisez l'option '-r' (pour cela vous devez
exécuter l'ancien proxy avec "-u root").
<p>
Utilisez ftp-proxy avec "-d -D7" si vous avez des problèmes et voulez 
diagnostiquer ce qui arrive.

<p>
<a name="20051216"></a>
<h3>2005/12/16 - libresolv supprimée</h3>

Vous devez supprimer libresolv de votre machine comme il n'est plus
installé.
<pre>
     # rm /usr/lib/libresolv*
</pre>

<p>
<a name="20060104"></a>
<h3>2006/01/04 - mac68k passe à wscons(4)</h3>
Avant de redémarrer le nouveau noyau, les fichiers systèmes doivent être mis
à jour pour
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=wscons&amp;sektion=4">wscons(4)</a>.

<pre>
     # cp /usr/src/etc/etc.mac68k/MAKEDEV /dev
     # cd /dev &amp;&amp; sh ./MAKEDEV wscons
</pre>

<p>
Dans <tt>/etc/ttys</tt>, changez le getty sur <em>ttye0</em> vers <em>ttyC0</em>
et redémarrez avec le nouveau noyau.
</p>

<p>
<a name="20060113"></a>
<h3>2006/01/13 - changements de types</h3>
Avant de faire un "make build", le compilateur a besoin d'être compilé et
installé. Sinon vous serez incapable de compiler libstdc++.

<p>
Suivez les instructions dans <a href="faq5.html#NewCompiler">FAQ 5 -
How do I bootstrap a newer version of the compiler</a> pour les détails.

<a name="20060131"></a>
<h3>2006/01/31 - mises à jour de la configuration de XKB</h3>
Après la fusion de X.Org 6.9, la configuration de XKB a été modifiée,
demandant des changements dans /etc/X11/xorg.conf. Les changements les plus
visibles sont :
<ul>
<li>La disposition <b>us_intl</b> est remplacée par la variante <b>alt-intl</b>
de la disposition <b>us</b>.
Mettre à jour son fichier de configuration :
<pre>
      Option "XkbLayout" "us"
      Option "XkbVariant" "alt-intl"
</pre>
<li>Les dispositions <b>de_CH</b> et <b>fr_CH</b> sont remplacées par la 
disposition <b>ch</b> pour les variantes <b>de</b> et <b>fr</b> :
<pre>
      Option "XkbLayout" "ch"
      Option "XkbVariant" "de"
</pre>
</ul>
<p>

<a name="20060221"></a>
<h3>2006/02/21 - mises à jour de ipsec.conf(5)</h3>
Quand les <b>règles ike</b> n'incluent pas de paramètres de mode main,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipsecctl&amp;sektion=8">ipsecctl(8)</a>
choisira maintenant AES au lieu de 3DES pour le mode main de chiffrement.
Pour l'interopérabilité avec les peers utilisant stable, ajoutez ces valeurs
à leur fichiers 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec.conf&amp;sektion=5">ipsec.conf(5)</a>
pour passer aux nouveaux paramètres par défaut :
<pre>
        main auth hmac-sha1 enc aes
</pre>
<p>


<a name="3.7"></a>
<h2>Mettre à jour de la 3.7 à la 3.8</h2>


<p>
<a name="20050329"></a>
<h3>2005/03/29 - Gestion des exceptions "flag day" (i386)</h3>

OpenBSD/i386 a été convertit à la gestion des exceptions basée sur DWARF. Pour
mettre à jour, <a href="faq5.html#NewCompiler">compilez et installez ggc3</a> 
en premier puis compilez et installez la nouvelle version de libstdc++ :
<pre>
     # cd /usr/src/gnu/lib/libstdc++
     # make -f Makefile.bsd-wrapper cleandir
     # make -f Makefile.bsd-wrapper obj
     # make -f Makefile.bsd-wrapper
     # make -f Makefile.bsd-wrapper install
</pre>

<p>


<a name="20050331"></a>
<h3>2005/03/31 - mmap(2) "flag day" (vax)</h3>

Les limites de mémoire virtuelle ont changé sur OpenBSD/vax. La nature 
liée-statiquement de OpenBSD/vax demande des manipulations spéciales pour cela.
Les étapes suivantes doivent être suivies pour compiler un système utilisable.
<ul>
<li>Mettre à jour votre arborescence des sources
<li>Compilez et installez un nouveau noyau, ne pas encore redémarrer
<li>Compilez et installez une nouvelle libc :
<pre>
     # cd /usr/src/lib/libc && make depend && make && env NOMAN=1 make install
</pre>
<li><a href="faq5.html#NewCompiler">Compilez et installez gcc2</a>
<li>Compilez et installez un nouveau make:
<pre>
     # cd /usr/src/usr.bin/make && make depend && make && make install
</pre>
<li>Compilez et installez un nouveau binutils:
<pre>
    # cd /usr/src/gnu/usr.bin/binutils
    # make -f Makefile.bsd-wrapper depend
    # make -f Makefile.bsd-wrapper
    # make -f Makefile.bsd-wrapper install
</pre>
<li>Redémarrez.
<li>Compilez et installez le système comme d'habitude :
<pre>
    # cd /usr/src && make build
</pre>
</ul>

<p>
<a name="20050413"></a>
<h3>2005/04/13 - Nouvel utilisateur et groupe : _hostapd</h3> 
Le nouveau daemon avec séparation de privilège a besoin d'un nouvel
utilisateur et groupe "_hostapd".
Ajoutez l'utilisateur et le groupe en utilisant

<pre>
    useradd -u86 -g=uid -c"HostAP Daemon" -d/var/empty -s/sbin/nologin _hostapd
</pre>
en étant root.


<p>
<a name="20050527"></a>
<h3>2005/05/27 - pf <i>log-all</i> devient <i>log (all)</i></h3>

Le mot clé pf.conf(5) <i>log-all</i> a été supprimé. La nouvelle syntaxe
pour cette fonctionnalité est maintenant <i>log (all)</i>.


<p>
<a name="20050601"></a>
<h3>2005/06/01 - mmap maintenant compté dans les datasize rlimit</h3>

La mémoire anonyme allouée via mmap(2) est maintenant comptée vers
un process datasize de limite des ressources. En conséquence, les processus 
semblent prendre plus de mémoire que par le passé et les anciennes limites de 
ressources semblent être trop petites. Pour corriger le problème de limite des
ressources, mettre à jour <tt>/etc/login.conf</tt>:
<pre>
     # cd /usr/src/etc
     # cp login.conf /etc
</pre>
puis on se déconnecte et on se reconnecte. 


<p>
<a name="20050609"></a>
<h3>2005/06/09 - changement dans la configuration de bgpd</h3>

Les mots clés de bgpd.conf(5) <i>network connected [set ...]</i> et
<i>network static [set ...]</i> sont déconseillés. Ils vont être remplacés par
 <i>network inet connected [set ...]</i> et <i>network
inet static [set ...]</i>.


<p>
<a name="20050802"></a>
<h3>2005/08/02 - Nouvelles fonctionnalités dans crunchgen</h3>

crunchgen(1) a été mis à jour pour prendre en compte des répertoires 
supplémentaires de librairie. Soyez certain de recompiler et de réinstaller
crunchgen avant de faire une version ou de recréer n'importe quel média
d'installation.


<p>
<a name="20050806"></a>
<h3>2005/08/06 - Compilez les locales LC_CTYPE</h3>

Compilez et installez mklocale(1).
<pre>
     # cd /usr/src/usr.bin/mklocale && make obj && make depend && make && make install
</pre>
Puis faites un make build.


<a name="3.6"></a>
<h2>Mettre à jour de la 3.6 à la 3.7</h2>

<a name="20041029"></a>
<h3>2004/10/29 - Passage à gcc3 (macppc)</h3>
OpenBSD/macppc a été converti à gcc3.
Pour mettre à jour,
<pre>
    # rm -rf /usr/include/g++
</pre>

Maintenant, <a href="faq5.html#NewCompiler">compilez gcc3</a>, (en utilisant
le répertoire de gcc3) puis compilez le noyau et le système comme
<a href="faq5.html#Bld">d'habitude</a>.

<a name="20041111"></a>
<h3>2004/11/11 - changement de comportement de bgpd</h3>
Le nouveau <i>rde route-age [evaluate|ignore]</i> a changé le comportement
de bgpd.
Jusqu'à maintenant <i>evaluate</i> était par défaut implicite mais maintenant 
par défaut c'est <i>ignore</i>. L'évaluation du "route age" n'est pas spécifié
dans la RFC 1771 et les résultats non déterministe dans les décisions sont de 
préférence pour plus de liens stables.


<a name="20041124"></a>
<h3>2004/11/24 - Nouvel utilisateur et groupe : _ftp</h3> 
Le daemon FTP a été retravaillé pour utiliser la séparation de privilège.
Donc un nouvel utilisateur et groupe sont nécessaires.
Ajoutez l'utilisateur et le groupe en utilisant

<pre>
    useradd -u84 -g=uid -c"FTP Daemon" -d/var/empty -s/sbin/nologin _ftp
</pre>
sous l'utilisateur root.


<a name="20041230"></a>
<h3>2004/12/30 - Passage à gcc3 (i386)</h3>
OpenBSD/i386 a été converti à gcc3.
Pour mettre à jour,

<pre>
    # rm -rf /usr/include/g++
</pre>

Maintenant, <a href="faq5.html#NewCompiler">compilez gcc3</a>, (en utilisant
le répertoire de gcc3) puis compilez le noyau et le système comme
<a href="faq5.html#Bld">d'habitude</a>.

<p>

<a name="20050118"></a>
<h3>2005/01/18 - Nouvel utilisateur et groupe : _ospfd</h3> 
Le prochain daemon ospf a besoin de son propre utilisateur et groupe _ospfd.
Ajoutez les en utilisant

<pre>
    useradd -u85 -g=uid -c"OSPF Daemon" -d/var/empty -s/sbin/nologin _ospfd
</pre>
sous l'utilisateur root.


<a name="20050124"></a>
<h3>2005/01/24 - pfsync prend en compte syncdev au lieu de syncif</h3>
Lors de la configuration d'un périphérique
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfsync&amp;sektion=4">pfsync</a>,
utilisez 'syncdev' à la place du mot clé déconseillé 'syncif'. 


<a name="20050202"></a>
<h3>2005/02/02 - Constantes POSIX hex et octal dans (k)sh</h3>
Les deux,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sh&amp;sektion=1">sh(1)</a>
et
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ksh&amp;sektion=1">ksh(1)</a>
interprètent maintenant les constantes hex (0x...) et octales (0...) comme en c
dans des expressions arithmétiques.
Par conséquent, le script MAKEDEV doit être mis à jour :
<pre>
     # cp /usr/src/etc/etc.`machine`/MAKEDEV /dev
</pre>

<p>


<p>
    <a name="3.5"></a>
    <h2>
      Mettre à jour de la 3.5 à la 3.6
    </h2>

    <a name="3.5.1"></a>
    <h3>
      3.5.1: numéros de périphériques mineurs pty modifiés (2004/04/11)
    </h3>
    <p>
      Les numéros de périphériques mineurs de 
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pty&amp;sektion=4">pty</a>
      ont été modifiés pour augmenter le nombre maximum de pseudo-terminals de
      256 à 992, donc vous devez exécuter le <tt>/dev/MAKEDEV</tt> mis à jour 
	  avant de démarrer un nouveau noyau :
        <ul>
          <li>Mettre à jour votre arborescence des sources
          <li>Compilez et installez un nouveau noyau
          <li>Compilez le reste du système (<em>make build</em>)
          <li>Copiez le nouveau script MAKEDEV dans le répertoire <tt>/dev</tt> 
              et créez les nouveaux périphériques pty.
<pre>
     # cp /usr/src/etc/etc.`machine`/MAKEDEV /dev
     # cd /dev && ./MAKEDEV pty0
</pre>
          <li>Démarrez le nouveau noyau
	  <li>Supprimez les anciens périphériques pty qui ne sont plus utilisés :
<pre>
     # cd /dev && rm -f [pt]ty[rq]*
</pre>
	  <li> Ou, pour la plateforme vax :
<pre>
     # cd /dev && rm -f [pt]tyr*
</pre>
        </ul>

    <a name="3.5.2"></a>
    <h3>
      3.5.2: Nouvel utilisateur et groupe _dhcp (2004/04/12)
    </h3>
    <p>Les daemons relatifs à dhcp ont été retravaillés pour supprimer des 
	  privilèges ou utiliser la séparation de privilège. Donc un nouvel 
	  utilisateur et groupe _dhcp sont nécessaires.
      Ajoutez le groupe en exécutant
<pre>
  # groupadd -g 77 _dhcp
</pre>
      sous l'utilisateur root, et ajoutez l'utilisateur en utilisant
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
<pre>
  _dhcp:*:77:77::0:0:DHCP programs:/var/empty:/sbin/nologin
</pre>
    <p>

    <a name="3.5.3"></a>
    <h3>
      3.5.3: Nouvel utilisateur et groupe _mopd (2004/04/14)
    </h3>
    <p>Le daemon <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mopd&amp;sektion=8"
      >mopd(8)</a> supprime maintenant des privilèges après l'initialisation,
      et nécessite un nouvel utilisateur et groupe _mopd.
      Ajoutez le groupe en exécutant
<pre>
  # groupadd -g 78 _mopd
</pre>
      sous l'utilisateur root, et ajoutez l'utilisateur en utilisant
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
<pre>
  _mopd:*:78:78::0:0:MOP Daemon:/var/empty:/sbin/nologin
</pre>
    <p>

    <a name="3.5.4"></a>
    <h3>
      3.5.4: Nouvel utilisateur et groupe _tftpd (2004/04/17)
    </h3>
    <p>Le daemon <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftpd&amp;sektion=8"
      >tftpd(8)</a> daemon supprime maintenant des privilèges après 
	  l'initialisation, et nécessite un nouvel utilisateur et groupe _tftpd à 
	  la place de nobody.
      Ajoutez le groupe en exécutant
<pre>
  # groupadd -g 79 _tftpd
</pre>
      sous l'utilisateur root, et ajoutez l'utilisateur en utilisant
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
<pre>
  _tftpd:*:79:79::0:0:TFTP Daemon:/var/empty:/sbin/nologin
</pre>
    <p>

    <a name="3.5.5"></a>
    <h3>
      3.5.5: Nouvel utilisateur et groupe _rbootd (2004/04/30)
    </h3>
    <p>Le daemon <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rbootd&amp;sektion=8"
      >rbootd(8)</a> daemon supprime maintenant des privilèges après 
	  l'initialisation vers un nouvel utilisateur et groupe _rbootd.
      Ajoutez le groupe en exécutant
<pre>
  # groupadd -g 80 _rbootd
</pre>
      sous l'utilisateur root, et ajoutez l'utilisateur en utilisant
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
<pre>
  _rbootd:*:80:80::0:0:rbootd Daemon:/var/empty:/sbin/nologin
</pre>
    <p>

    <a name="3.5.6"></a>
    <h3>
      3.5.6: cksum déplacé (2004/05/02)
    </h3>
    <p>L'utilitaire <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cksum&amp;sektion=1">cksum(1)</a>
      a été déplacé de <tt>/usr/bin</tt> vers <tt>/bin</tt>.
      Après que vous avez finalisé un <em>make build</em>, exécutez sous 
	  l'utilisateur root :
<pre>
  # rm -f /usr/bin/cksum /usr/bin/sum
</pre>
    <p>

    <a name="3.5.7"></a>
    <h3>
      3.5.7: Nouvel utilisateur et groupe _afs (2004/05/06)
    </h3>
    <p>Le daemon <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=afsd&amp;sektion=8"
      >afsd(8)</a> utilise la séparation de privilège. Un nouvel utilisateur et
	  groupe _afs sont nécessaires pour cela. Ajoutez le groupe en exécutant
<pre>
  # groupadd -g 81 _afs
</pre>
      sous l'utilisateur root, et ajoutez l'utilisateur en utilisant
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
<pre>
  _afs:*:81:81::0:0:afs Daemon:/var/empty:/sbin/nologin
</pre>
    <p>Vous avez besoin de changer le propriétaire du cache en exécutant
<pre>
  # chown -R _afs:_afs /var/spool/afs
</pre>
    <p>

    <a name="3.5.8"></a>
    <h3>
      3.5.8: Nouvel utilisateur et groupe _ppp (2004/05/06)
    </h3>
    <p>Le programme <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppoe&amp;sektion=8"
      >pppoe(8)</a> supprime maintenant ces privilèges vers un nouvel utilisateur 
	  et groupe _ppp.
      Ajoutez le groupe en exécutant
<pre>
  # groupadd -g 82 _ppp
</pre>
      sous l'utilisateur root, et ajoutez l'utilisateur en utilisant
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
<pre>
  _ppp:*:82:82::0:0:PPP utilities:/var/empty:/sbin/nologin
</pre>
    <p>

    <a name="3.5.9"></a>
    <h3>
      3.5.9: Nouvel utilisateur et groupe _ntp (2004/05/30)
    </h3>
    <p>Le prochain programme
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ntpd&amp;sektion=8">ntpd(8)</a>
      a besoin d'un nouvel utilisateur et groupe _ntp.
      Ajoutez le groupe en exécutant
<pre>
  # groupadd -g 83 _ntp
</pre>
      sous l'utilisateur root, et ajoutez l'utilisateur en utilisant
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
<pre>
  _ntp:*:83:83::0:0:NTP Daemon:/var/empty:/sbin/nologin
</pre>
    <p>

    <a name="3.5.10"></a>
    <h3>
      3.5.10: Saut de librairie "flag day" (2004/07/13)
    </h3>
    <p>Des changements d'interface système et de librairie on été fait qui
	nécessite un saut du numéro de version majeur de toutes les librairies.
	Les étapes suivantes doivent être suivies pour compiler un système
	utilisable.
	 <ul>
          <li>Mettre à jour votre arborescence de code source
          <li>Compilez un nouveau noyau
	  <li>Installez le nouveau noyau et redémarrez
	  <li>installez les nouveaux fichiers d'en-têtes :
<pre>
     # cd /usr/src && make obj && make cleandir && make includes
</pre>
	  <li>compilez et installez une nouvelle version de la libc
<pre>
     # cd /usr/src/lib/libc && make depend && make && env NOMAN=1 make install
</pre>
	  <li>Compilez et installez le système comme d'habitude
<pre>
     # cd /usr/src && make build
</pre>
	 </ul>
    <p>

    <a name="3.5.11"></a>
    <h3>
      3.5.11: Changements dans les ancres de pf (2004/08/07)
    </h3>
    <p>Les utilisateurs de authpf doivent changer leurs règles d'ancrage de
    l'ensemble des règles principales de
<pre>
     anchor authpf
</pre>
	vers
<pre>
     anchor "authpf/*"
</pre>
    <p>

    <a name="3.4"></a>
    <h2>
      Mettre à jour de la 3.4 à la 3.5
    </h2>

    <a name="3.4.1"></a>
    <h3>
      3.4.1: numéros de périphériques mineurs svnd modifiés (2003/10/10)
    </h3>
    <p>
      Les numéros de périphériques mineurs du périphérique 
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=svnd&amp;sektion=4">svnd</a>
      ont été modifiés, il est donc nécessaire d'exécuter la mise à jour de
      <tt>/dev/MAKEDEV</tt> après l'installation d'un nouveau noyau :
        <ul>
          <li>mise à jour de votre arborescence de code source
          <li>Compilez un nouveau noyau
          <li>copiez le nouveau script MAKEDEV dans le répertoire dev, 
		  supprimez les périphériques svnd(4) et rsvnd existants, et créez
		  les nouveaux :
<pre>
     # cp /usr/src/etc/etc.`machine`/MAKEDEV /dev
     # cd /dev
     # rm svnd* rsvnd*
     # ./MAKEDEV vnd
</pre>
          <li>Continuez avec la compilation et le processus de version
        </ul>

	  Cela affecte toutes les personnes utilisant les périphériques svnd, ce
	  qui comprend ceux qui <tt>make release</tt>.
    <p>

    <a name="3.4.2"></a>
    <h3>
      3.4.2: Nouvel utilisateur et groupe _pflogd (2003/10/23)
    </h3>
    <p>Le daemon <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8"
      >pflogd(8)</a> fonctionne maintenant avec la séparation des privilèges, 
	  et nécessite donc un nouvel utilisateur et groupe _pflogd.
      Ajoutez le groupe en exécutant
<pre>
  # groupadd -g 74 _pflogd
</pre>
      sous l'utilisateur root, et ajoutez l'utilisateur en utilisant
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
<pre>
  _pflogd:*:74:74::0:0:pflogd privsep:/var/empty:/sbin/nologin
</pre>
    <p>

    <a name="3.4.3"></a>
    <h3>
      3.4.3: Clonage d'interface (2003/12/07)
    </h3>
    <p>Plusieurs pseudo pilotes réseaux (comme
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gif&amp;sektion=4">gif(4)</a>,
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lo&amp;sektion=4">lo(4)</a> et
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tun&amp;sektion=4">tun(4)</a>)
      ont été modifiés pour supporter le clonage, donc la création et 
	  destruction de périphériques à la volée. Si vous dépendez de ces 
	  interfaces, vous devez installer et mettre à jour
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>
      et
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=netstart&amp;sektion=8">netstart(8)</a>
      avant de redémarrer votre nouveau noyau.

    <p>En premier compilez et installez votre nouveau noyau comme d'habitude
      <pre>
  # cd /usr/src && make includes
  # cd sbin/ifconfig
  # make obj depend
  # make
  # make install
  # cp /usr/src/etc/netstart /etc
      </pre>
      Maintenant redémarrez votre machine et continuez avec la compilation d'un
	  nouveau userland.
    <p>

    <a name="3.4.4"></a>
    <h3>
       3.4.4: Nouvel utilisateur et groupe _bgpd (2003/12/17)
    </h3>
    <p>Le nouveau daemon <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bgpd&amp;sektion=8"
      >bgpd(8)</a> fonctionne maintenant avec la séparation des privilèges, 
	  et nécessite donc un nouvel utilisateur et groupe _bgpd.
      Ajoutez le groupe en exécutant
<pre>
  # groupadd -g 75 _bgpd
</pre>
      sous l'utilisateur root, et ajoutez l'utilisateur en utilisant
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
<pre>
  _bgpd:*:75:75::0:0:BGP Daemon:/var/empty:/sbin/nologin
</pre>
    <p>

    <a name="3.4.5"></a>
    <h3>
	3.4.5: Nouvelle version de join(1) (2003/12/28)
    </h3>
    <p>La commande 
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=join&amp;sektion=1">join(1)</a>
    a été mise à jour pour suivre le standard POSIX standard lors de l'écriture
	de lignes non-correspondantes.
    Comme conséquence
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=security&amp;sektion=8">security(8)</a>
    a été mis à jour :
     <pre>
  # cp /usr/src/etc/security /etc
     </pre>
    <p>

    <a name="3.4.6"></a>
    <h3>
	3.4.6: changement dans la construction de sudo (2004/01/15)
    </h3>
    <p>La façon dont la commande
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sudo&amp;sektion=8">sudo(8)</a>
    est compilée à changé. Comme effet secondaire suite à ce changement vous 
	devez exécuter :
     <pre>
  # rm -f /usr/obj/usr.bin/sudo/*
     </pre>
	avant d'obtenir un "make build" réussi. SI cela n'est pas fait, la 
	compilation s'arrêtera lors du make obj dirs.
    <p>

    <a name="3.4.7"></a>
    <h3>
      3.4.7: Nouvel utilisateur et groupe _tcpdump (2004/01/19)
    </h3>
    <p>La commande <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8"
      >tcpdump(8)</a> fonctionne maintenant avec la séparation des privilèges, 
	  et nécessite donc un nouvel utilisateur et groupe _tcpdump.
      Ajoutez le groupe en exécutant
<pre>
  # groupadd -g 76 _tcpdump
</pre>
      sous l'utilisateur root, et ajoutez l'utilisateur en utilisant
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
<pre>
  _tcpdump:*:76:76::0:0:tcpdump:/var/empty:/sbin/nologin
</pre>

    <p>
    <a name="3.4.8"></a>
    <h3>
      3.4.8: changement dans machdep.c (i386) (2004/02/01)
    </h3>

    <p>
    Un changement dans <tt>machdep.c</tt> rend nécessaire que binutils soit
	recompilé avant la recompilation du noyau.
    Cela affecte seulement le i386.

<pre>
  # cd /usr/src/gnu/usr.bin/binutils
  # make -f Makefile.bsd-wrapper cleandir
  # make -f Makefile.bsd-wrapper obj
  # make -f Makefile.bsd-wrapper depend
  # make -f Makefile.bsd-wrapper
  # make -f Makefile.bsd-wrapper install
</pre>

    <p> Maintenant vous pouvez recompiler le noyau et le reste du système comme
	expliqué dans la section <a href="#1.5">1.5</a>

    <p>
    <a name="3.4.9"></a>
    <h3>
      3.4.9: Mise à jour de bsd.own.mk (2004/02/20)
    </h3>

    <p>
    Vous devez mettre à jour <tt>/usr/share/mk/bsd.own.mk</tt> pour avoir la
	définition de USE_GCC3 :

<pre>
    # cd /usr/src/share/mk
    # make install
</pre>

    <p>
    <a name="3.4.10"></a>
    <h3>
      3.4.10: Passage à gcc3 (sparc64) (2004/02/20)
    </h3>

    <p>
    OpenBSD/sparc64 a été converti à gcc3.
    Pour mettre à jour,

<pre>
    # rm -rf /usr/include/g++
</pre>
    Maintenant <a href="#1.8">compilez gcc3</a>, (en utilisant le répertoire
	gcc3) puis compilez le noyau et le système comme 
	<a href="#1.5">d'habitude</a>.
	

    <a name="3.3"></a>
    <h2>
      Mettre à jour de la 3.3 à la 3.4
    </h2>
    
    <a name="3.3.1"></a>
    <h3>
      3.3.1: support i386 W^X (2003/04/16)
    </h3>

    <p>Pour activer le support i386 Writable xor exécute, OpenBSD/i386 a
      changé de format d'exécutable de a.out vers ELF. La flexibilité de 
      ELF permet un meilleure contrôle sur la couche exécutable qui permet le
      support W^X. La compatibilité a.out est seulement disponible sous une
      forme limitée. Les binaires statiques a.out fonctionneront comme avant,
	  les binaires a.out dynamiques NE SONT PLUS SUPPORTES.
    </p>
    <p>LES MISES A JOUR SOURCE DE a.out -&gt; ELF NE SERONT PAS SUPPORTEES.
      INSTALLEZ UN SNAPSHOT et vous pourrez recompiler des sources.
      C'est seulement pour i386, les autres architectures NE sont pas affectées
	  par ces changements.
    </p>

    <a name="3.3.2"></a>
    <h3>
      3.3.2: changement syscall mquery (2003/04/28)
    </h3>

    <p>Les paramètres de l'appel système mquery ont été modifiés pour suivre mmap().
      Il faut donc mettre à jour le système dans le bon ordre :

      <pre>
      1. Compilez un nouveau noyau et démarrez.
      2. (cd /usr/src && sudo make includes)
      3. (cd /usr/src/libexec/ld.so && make && sudo make install)
      4. 'make build'
      </pre>

      Il n'y a que i386 qui utilise mquery, donc les autres architectures n'ont 
	  pas besoin de suivre strictement cet ordre de compilation.

    <a name="3.3.3"></a>
    <h3>
      3.3.3: i386 "flag day", changement exe addr/MAXDSIZ (2003/05/05)
    </h3>

    <p>Pour permettre MAXDSIZ de retourner à 1G, l'adresse de base de tous
      les exécutables change de 0 à 0x1c000000. La combinaison de ces 
      changements demande de mettre à jour d'un snapshot.
      La mise à jour des sources n'est pas supportée. Cela n'affecte que i386.
    </p>
    
    <a name="3.3.4"></a>
    <h3>
      3.3.4: Suppression de l'authentification KerberosIV (2003/05/13)
    </h3>

    <p>L'authentification basée sur KerberosIV a été supprimée. Il en résulte 
	   que vous devez supprimer toutes références à <tt>krb4</tt> dans
       <tt>/etc/login.conf</tt>. 
    </p>

    <a name="3.3.5"></a>
    <h3>
      3.3.5: changement de <tt>config</tt> (2003/05/23)
    </h3>

    <p>Bouger swapgeneric.c nécessite un changement dans 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;sektion=8">config(8)</a>.
      Avant de compiler un nouveau noyau, vous devez en premier compiler et 
	  installer la mise à jour de config(8) :
<pre>
  # cd /usr/src/usr.sbin/config
  # make clean
  # make obj
  # make
  # make install
</pre>
      Maintenant, <tt>config</tt> votre configuration noyau et exécutez un 
      "<tt>make depend</tt>" dans votre répertoire de compilation noyau comme
      <a href="#1.5">au-dessus</a>. 

   <a name="3.3.6"></a>
   <h3>
    3.3.6: Utilisation de __attribute__((bounded)) sur certaines fonctions 
	 (2003/06/26)
   </h3>
      
   <p>
     __attribute__((bounded)) est maintenant utilisé pour détecter les 
	 arguments incorrectes de fonctions qui prennent la taille de buffer
	 comme l'un de leur paramètre.
     <br><br>Vous devez recompiler gcc comme dans la section
     <a href="#1.8">1.8</a>
     de la Mini-FAQ avant de faire un <tt>make build</tt>.
   </p>

    <a name="3.3.7"></a>
    <h3>
      3.3.7: Nouvel utilisateur et groupe _syslogd (2003/07/31)
    </h3>
    <p>Le daemon <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8"
      >syslogd(8)</a> fonctionne maintenant avec la séparation des privilèges, 
	  et nécessite donc un nouvel utilisateur et groupe _syslogd.
      Ajoutez le groupe en exécutant
<pre>
  # groupadd -g 73 _syslogd
</pre>
      sous l'utilisateur root, et ajoutez l'utilisateur en utilisant
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
<pre>
  _syslogd:*:73:73::0:0:Syslog Daemon:/var/empty:/sbin/nologin
</pre>
    <p>

    <a name="3.3.8"></a>
    <h3>
      3.3.8: Nouveau format d'attribut __kprintf__ dans les
		en-têtes noyau (2003/08/23)
    </h3>
    <p>
      Un nouveau format d'attribut __kprintf__ est maintenant utilisé dans les 
	  fichiers d'en-têtes du noyau pour que gcc soit conscient de l'extension de
	  format dans le noyau de 
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=printf&amp;sektion=9">printf(9)</a>.
      <br><br>Vous devez recompiler gcc en suivant la section <a href="#1.8">1.8</a>
      de la Mini-FAQ avant de faire un <tt>make build</tt>. Vous avez seulement 
	  besoin de recompiler gcc car les sources current supportent aussi 
	  l'attribut __bounded__ décrit dans la section <a href="#3.3.6">3.3.6</a>.
    </p>

    <a name="3.2"></a>
    <h2>
      Mettre à jour de la 3.2 à la 3.3
    </h2>

    <a name="3.2.1"></a>
    <h3>
      3.2.1: Nouveau Perl (2002/11/05)
    </h3>

    <p>Perl a été mis à jour à la version 5.8.0.<br>
      Dans Perl 5.8.0, l'API du module XS a été modifiée à cause du passage 
	  de stdio à PerlIO (regardez la page de manuel perldelta pour plus 
	  d'informations). Cela signifie que tous les modules XS (fichiers perl
	  .so) que vous avez installé <strong>doivent</strong> être recompilé. 
	  Si vous rencontrez une erreur comme 
	  <em>Undefined symbol "perl_get_sv"</em> c'est votre problème. Si les 
	  seuls modules que vous avez installé sont des paquetages ou via le 
	  système de ports, vous pouvez vérifier votre système en exécutant :
      <pre>
	# grep '\.so' /var/db/pkg/p5-*/+CONTENTS | cut -d: -f1 | sort -u
      </pre>
	  Vous devez supprimer les mauvais modules avec une <em>pkg_delete -f</em>
      et les recompiler/installer de l'arbre des ports.

    <a name="3.2.2"></a>
    <h3>
      3.2.2: Nouveaux groupes _radius, _token et _shadow (2002/11/21)
    </h3>
    <p>Plusieurs nouveaux groupes ont été ajoutés :
      <ul>
      <li>Le groupe <em>_radius</em> contrôle les accès en lecture seule du
	  fichier <tt>/etc/raddb/servers</tt>.
      <li>Le groupe <em>_token</em> contrôle les accès en lecture seule de la
	  base de données token utilisée par 
	  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tokeninit&amp;sektion=8">tokeninit(8)</a>,
	  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tokenadm&amp;sektion=8">tokenadm(8)</a> et
	  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=login_token&amp;sektion=8">login_token(8)</a>.
      <li>Le groupe <em>_shadow</em> contrôle les accès en lecture seule de la
	  base de données shadow password.
      </ul>

	  Vous devez ajouter ces groupes et ajuster les permissions sur certains
	  fichiers avant de faire un &quot;make build&quot;. Les commandes
	  suivantes, sous l'utilisateur root, le feront :
	<pre>
	  # groupadd -g 63 _radius
	  # chgrp _radius /etc/raddb /etc/raddb/servers
	  # chmod g+x /etc/raddb
	  # chmod g+r /etc/raddb/servers

	  # groupadd -g 64 _token
	  # chgrp _token /etc/activ.db /etc/crypto.db /etc/snk.db
	  # chmod 0640 /etc/activ.db /etc/crypto.db /etc/snk.db

	  # groupadd -g 65 _shadow
	  # chgrp _shadow /etc/spwd.db
	  # chmod 0640 /etc/spwd.db
	</pre>

	  Ne soyez pas inquiet des messages d'erreurs indiquant qu'un fichier n'a
	  pas été trouvé. Cela signifie simplement que vous n'avez pas configuré 
      l'authentification <em>token</em> ou <em>radius</em>.

    <a name="3.2.3"></a>
    <h3>
      3.2.3: Changements importants du compilateur (2002/12/02)
    </h3>
    <p>L'extension de protection de pile <a href="http://www.trl.ibm.com/projects/security/ssp">propolice</a>
      a été fusionnée dans
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gcc-local&amp;sektion=1"
      >gcc</a>. Cela nécessite un scénario de mise à jour légèrement différent :
      <ul>
      <li>Ne <b>pas</b> compiler maintenant un nouveau noyau.
      <li>Ne <b>pas</b> recompiler maintenant gcc.
      <li>Compilez et installez un nouveau chargeur dynamique ld.so si votre
	    système possède les librairies partagées.
        <pre>
	  # cd /usr/src
	  # make obj
          Pour les plateformes ELF (alpha, macppc, sparc, sparc64) :
          # cd /usr/src/libexec/ld.so
          # make depend &amp;&amp; make &amp;&amp; make install
	  Pour les plateformes a.out (amiga, hp300, i386, mac68k, mvme68k) :
          # cd /usr/src/gnu/usr.bin/ld/rtld
          # make depend &amp;&amp; make &amp;&amp; make install
	</pre>
      <li>Recompilez et installez une nouvelle libc, en suivant les premières
	    commandes d'un <i>make build</i>.
	<pre>
          # cd /usr/src/include
	  # make prereq &amp;&amp; make includes
	  # cd /usr/src/lib/libc
	  # make depend &amp;&amp; make NOMAN=1 &amp;&amp; make NOMAN=1 install
	</pre>
	A remarquer que, si votre compilateur est trop ancien, il ne sera pas 
	capable de compiler la libc. Dans ce cas, vous devez faire un mise à jour
	binaire d'un snapshot.
      <li>Recompilez et installez gcc, comme dans la section <a href="#1.8">1.8</a>.
      <li>Vous pouvez maintenant recompiler le noyau.
        Soyez sur d'exécuter 
        <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;sektion=8"
	>config</a> encore pour régénérer le Makefile du noyau.
      <li>Redémarrez sur le nouveau noyau et faite un <i>make build</i> pour
        bénéficier de la protection de pile.
      </ul>

    <a name="3.2.4"></a>
    <h3>
      3.2.4: Nouvel utilisateur et groupe _spamd (2002/12/24)
    </h3>
    <p>Un nouvel utilisateur et un nouveau groupe _spamd pour le daemon
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=spamd&amp;sektion=8"
      >spamd(8)</a> ont été ajoutés.
      Ajoutez le groupe en exécutant
<pre>
  # groupadd -g 62 _spamd
</pre>
      sous l'utilisateur root, et ajoutez l'utilisateur en utilisant
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
<pre>
  _spamd:*:62:62::0:0:Spam daemon:/var/empty:/sbin/nologin
</pre>

    <a name="3.2.5"></a>
    <h3>
      3.2.5: Alias pour ipv6-icmp (2002/12/30)
    </h3>

    <p>Un nouvel alias pour ipv6-icmp, <em>icmp6</em>, a été ajouté à
      <tt>/etc/protocols</tt>. Si vous souhaitez utiliser l'alias <em>icmp6</em>
      (utilisé dans les tests de régression
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8">pfctl(8)</a>)
      vous devez modifier la ligne <em>ipv6-icmp</em> dans
      <tt>/etc/protocols</tt>, ajouter le mot clé <em>icmp6</em> avant le #.
      Cette ligne peut-être comme cela :
    </p>
<pre>
  ipv6-icmp 58    IPv6-ICMP icmp6 # ICMP for IPv6
</pre>

    <a name="3.2.6"></a>
    <h3>
      3.2.6: Nouveau groupe _lkm (2003/01/05)
    </h3>

    <p>Le groupe <em>_lkm</em> contrôle les accès à
	  <tt>/dev/lkm</tt>.
	  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=modstat&amp;sektion=8">modstat(8)</a>
          est maintenant setgid _lkm.
    <p>
	  Vous devez ajouter ce groupe et ajuster les permissions sur 
	  <tt>/dev/lkm</tt> avant de faire un &quot;make build&quot;. Les commandes
	  suivantes, exécutées comme root, feront le nécessaire :
<pre>
  # groupadd -g 61 _lkm
  # chgrp _lkm /dev/lkm
</pre>

    <a name="3.2.7"></a>
    <h3>
      3.2.7: Nouvelle libpthread (2003/01/14)
    </h3>

    <p><em>libc_r</em> et <em>libnpthread</em> ont été supprimées et remplacées
	par <em>libpthread</em>. Les programmes "threadés" doivent toujours être
	compilables avec l'option <em>-pthread</em>; le compilateur fait les choses
	de la bonne manière.

    <p>Avant de supprimer les applications "threade" avec <em>libc_r</em> et 
	<em>libnpthread</em>, on doit les recompiler en utilisant 
	<em>libpthread</em>. La méthode à suivre :

    <ol>
      <li>
        <p>compilez gcc en suivant la section <a href="#1.8">1.8</a>.
      <li>
        <p>recompilez le système en suivant la section <a href="#1.5">1.5</a>.
      <li>
        <p>recompilez tous les ports "threade".
      <li>
        <p>supprimez le librairies maintenant inutiles :
<pre>
  # rm /usr/lib/libc_r* /usr/lib/libnpthread*
</pre>
    </ol>

    <a name="3.2.8"></a>
    <h3>
      3.2.8: Changements dans le linker pour les architectures ELF (2003/01/17)
    </h3>

    <p>Binutils/ld a été modifié pour introduire une nouvelle fonctionnalité de
	sécurité dans les exécutables ELF. A la place de permettre à la section
	data des exécutables et librairies partagées d'être marquées exécutable par
	le linker, la forme a été modifiée pour ne marquer exécutable que les
	sections appropriées de l'image du programme. Ce changement affecte 
	seulement les architectures ELF basées sur : alpha, sparc, sparc64 et 
	macppc.
    <p>
	Il est recommandé de recompiler binutils avant le reste du système.
    <p>
<pre>
  # cd /usr/src/gnu/usr.bin/binutils
  # make -f Makefile.bsd-wrapper cleandir
  # make -f Makefile.bsd-wrapper obj
  # make -f Makefile.bsd-wrapper depend
  # make -f Makefile.bsd-wrapper
  # make -f Makefile.bsd-wrapper install
</pre>
    <p>
	Puis de recompiler le système en suivant la section <a href="#1.5">1.5</a>

    <a name="3.2.9"></a>
    <h3>
      3.2.9: Suppression de /var/at et changements crontab (2003/02/19)
    </h3>

    <p>Le contenu de <tt>/var/at</tt> a été fusionné avec <tt>/var/cron</tt>
    maintenant que <em>at</em> a été intégré dans <em>cron</em>.  En outre,
    les fichiers <em>cron</em> de permission et refus ont été renommés 
	cron.allow et cron.deny pour être compatible POSIX et de la cohérence 
	avec at.allow et at.deny.
    <p>
    En premier, recompilation du système en suivant la section <a href="#1.5">1.5</a>
    Puis déplacer les fichiers existants et redémarrer cron comme ci-dessous :
    <p>
<pre>
  # mv /var/at/* /var/cron
  # mv /var/cron/jobs /var/cron/atjobs
  # mv /var/cron/allow /var/cron/cron.allow
  # mv /var/cron/deny /var/cron/cron.deny
  # rm -rf /var/at 
  # kill `cat /var/run/cron.pid`
  # /usr/sbin/cron
</pre>
    <p>
	Ne pas tenir compte des avertissements à propos de fichiers manquants
	de permission ou de refus. Tous ne font pas partie de l'installation 
	par défaut.
    <p>
	Si vous n'avez pas déjà un fichier cron.deny (il n'était pas installé
	avant OpenBSD 3.3) vous devrez en avoir un pour utiliser <em>crontab</em>
	pour un utilisateur autre que superuser.
<pre>
  # install -c -o root -g crontab -m 660 /dev/null /var/cron/cron.deny
</pre>


    <a name="3.2"></a>
    <h2>
      Mettre à jour de la 3.2
    </h2>

    <a name="3.2.1"></a>
    <h3>
      3.2.1: Nouveau Perl (2002/11/05)
    </h3>

    <p>Perl a été mis à jour à la version 5.8.0.<br>
      Dans Perl 5.8.0, l'API du module XS a été modifiée à cause du passage 
	  de stdio à PerlIO (regardez la page de manuel perldelta pour plus 
	  d'informations). Cela signifie que tous les modules XS (fichiers perl
	  .so) que vous avez installé <strong>doivent</strong> être recompilé. 
	  Si vous rencontrez une erreur comme 
	  <em>Undefined symbol "perl_get_sv"</em> c'est votre problème. Si les 
	  seuls modules que vous avez installé sont des paquetages ou via le 
	  système de ports, vous pouvez vérifier votre système en exécutant :
      <pre>
	# grep '\.so' /var/db/pkg/p5-*/+CONTENTS | cut -d: -f1 | sort -u
      </pre>
      Vous devez supprimer les mauvais modules avec une <em>pkg_delete -f</em>
      et les recompiler/installer de l'arbre des ports.

    <a name="3.2.2"></a>
    <h3>
      3.2.2: Nouveaux groupes _radius, _token et _shadow (2002/11/21)
    </h3>
    <p>Plusieurs nouveaux groupes ont été ajoutés :
      <ul>
      <li>Le groupe <em>_radius</em> contrôle les accès en lecture-seule du
	  fichier <tt>/etc/raddb/servers</tt>.
      <li>Le groupe <em>_token</em> contrôle les accès en lecture-seule des
	  bases de données token utilisées par 
	  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tokeninit&amp;sektion=8">tokeninit(8)</a>,
	  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tokenadm&amp;sektion=8">tokenadm(8)</a> et
	  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=login_token&amp;sektion=8">login_token(8)</a>.
      <li>Le groupe <em>_shadow</em> contrôle les accès en lecture-seule de la
	  base de données shadow password.
      </ul>

      Vous devez ajouter ces groupes et ajuster les permissions sur certains
	  fichiers avant de faire un &quot;make build&quot;. Les commandes
	  suivantes, sous l'utilisateur root, le feront :
	<pre>
	  # groupadd -g 63 _radius
	  # chgrp _radius /etc/raddb /etc/raddb/servers
	  # chmod g+x /etc/raddb
	  # chmod g+r /etc/raddb/servers

	  # groupadd -g 64 _token
	  # chgrp _token /etc/activ.db /etc/crypto.db /etc/snk.db
	  # chmod 0640 /etc/activ.db /etc/crypto.db /etc/snk.db

	  # groupadd -g 65 _shadow
	  # chgrp _shadow /etc/spwd.db
	  # chmod 0640 /etc/spwd.db
	</pre>

      Ne soyez pas inquiet des messages d'erreurs indiquant qu'un fichier n'a
	  pas été trouvé. Cela signifie simplement que vous n'avez pas configuré 
      l'authentification <em>token</em> ou <em>radius</em>.

    <a name="3.2.3"></a>
    <h3>
      3.2.3: Changements importants du compilateur (2002/12/02)
    </h3>
    <p>L'extension de protection de pile <a href="http://www.trl.ibm.com/projects/security/ssp">propolice</a>
      a été fusionnée dans
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gcc-local&amp;sektion=1">gcc</a>.
	  Cela nécessite un scénario de mise à jour légèrement différent :
      <ul>
      <li>Ne <b>pas</b> compiler maintenant un nouveau noyau.
      <li>Ne <b>pas</b> recompiler maintenant gcc.
      <li>Compilez et installez un nouveau chargeur dynamique ld.so si votre
	    système possède les librairies partagées.
        <pre>
	  # cd /usr/src
	  # make obj
          Pour les plateformes ELF (alpha, macppc, sparc, sparc64) :
          # cd /usr/src/libexec/ld.so
          # make depend &amp;&amp; make &amp;&amp; make install
	  Pour les plateformes a.out (amiga, hp300, i386, mac68k, mvme68k) :
          # cd /usr/src/gnu/usr.bin/ld/rtld
          # make depend &amp;&amp; make &amp;&amp; make install
	</pre>
      <li>Recompilez et installez une nouvelle libc, en suivant les premières
	    commandes d'un <i>make build</i>.
	<pre>
          # cd /usr/src/include
	  # make prereq &amp;&amp; make includes
	  # cd /usr/src/lib/libc
	  # make depend &amp;&amp; make NOMAN=1 &amp;&amp; make NOMAN=1 install
	</pre>
	A remarquer que, si votre compilateur est trop ancien, il ne sera pas 
	capable de compiler la libc. Dans ce cas, vous devez faire un mise à jour
	binaire d'un snapshot.
      <li>Recompilez et installez gcc, comme dans la section <a href="#1.8">1.8</a>.
      <li>Vous pouvez maintenant recompiler le noyau.
        Soyez sur d'exécuter 
        <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;sektion=8">config</a> 
		encore pour régénérer le Makefile du noyau.
      <li>Redémarrez sur le nouveau noyau et faite un <i>make build</i> pour
        bénéficier de la protection de pile.
    </ul>

    <a name="3.2.4"></a>
    <h3>
      3.2.4: Nouvel utilisateur et groupe _spamd (2002/12/24)
    </h3>
    <p>Un nouvel utilisateur et un nouveau groupe _spamd pour le daemon
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=spamd&amp;sektion=8">spamd(8)</a> 
	  ont été ajoutés.
      Ajoutez le groupe en exécutant
<pre>
  # groupadd -g 62 _spamd
</pre>
      sous l'utilisateur root, et ajoutez l'utilisateur en utilisant
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
<pre>
  _spamd:*:62:62::0:0:Spam daemon:/var/empty:/sbin/nologin
</pre>

    <a name="3.2.5"></a>
    <h3>
      3.2.5: Alias for ipv6-icmp (2002/12/30)
    </h3>

    <p>Un nouvel alias pour ipv6-icmp, <em>icmp6</em>, a été ajouté à
      <tt>/etc/protocols</tt>. Si vous souhaitez utiliser l'alias <em>icmp6</em>
      (utilisé dans les tests de régression
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8">pfctl(8)</a>)
      vous devez modifier la ligne <em>ipv6-icmp</em> dans
      <tt>/etc/protocols</tt>, ajouter le mot clé <em>icmp6</em> avant le #.
      Cette ligne peut-être comme cela :
    </p>
<pre>
  ipv6-icmp 58    IPv6-ICMP icmp6 # ICMP for IPv6
</pre>

    <a name="3.2.6"></a>
    <h3>
      3.2.6: Nouveau groupe _lkm (2003/01/05)
    </h3>

    <p>Le groupe <em>_lkm</em> contrôle les accès à
	  <tt>/dev/lkm</tt>.
	  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=modstat&amp;sektion=8">modstat(8)</a>
          est maintenant setgid _lkm.
    <p>
	  Vous devez ajouter ce groupe et ajuster les permissions sur 
	  <tt>/dev/lkm</tt> avant de faire un &quot;make build&quot;. Les commandes
	  suivantes, exécutées comme root, feront le nécessaire :
<pre>
  # groupadd -g 61 _lkm
  # chgrp _lkm /dev/lkm
</pre>

    <a name="3.2.7"></a>
    <h3>
      3.2.7: Nouvelle libpthread (2003/01/14)
    </h3>

    <p><em>libc_r</em> et <em>libnpthread</em> ont été supprimées et remplacées
	par <em>libpthread</em>. Les programmes "threadés" doivent toujours être
	compilables avec l'option <em>-pthread</em>; le compilateur fait les choses
	de la bonne manière.

    <p>Avant de supprimer les applications "threade" avec <em>libc_r</em> et 
	<em>libnpthread</em>, on doit les recompiler en utilisant 
	<em>libpthread</em>. La méthode à suivre :

    <ol>
      <li>
        <p>compilez gcc en suivant la section <a href="#1.8">1.8</a>.
      <li>
        <p>recompilez le système en suivant la section <a href="#1.5">1.5</a>.
      <li>
        <p>recompilez tous les ports "threade".
      <li>
        <p>supprimez le librairies maintenant inutiles :
<pre>
  # rm /usr/lib/libc_r* /usr/lib/libnpthread*
</pre>
    </ol>

    <a name="3.2.8"></a>
    <h3>
      3.2.8: Changements dans le linker pour les architectures ELF (2003/01/17)
    </h3>

    <p>Binutils/ld a été modifié pour introduire une nouvelle fonctionnalité de
	sécurité dans les exécutables ELF. A la place de permettre à la section
	data des exécutables et librairies partagées d'être marquées exécutable par
	le linker, la forme a été modifiée pour ne marquer exécutable que les
	sections appropriées de l'image du programme. Ce changement affecte 
	seulement les architectures ELF basées sur : alpha, sparc, sparc64 et 
	macppc.
    <p>
	Il est recommandé de recompiler binutils avant le reste du système.
    <p>
<pre>
  # cd /usr/src/gnu/usr.bin/binutils
  # make -f Makefile.bsd-wrapper cleandir
  # make -f Makefile.bsd-wrapper obj
  # make -f Makefile.bsd-wrapper depend
  # make -f Makefile.bsd-wrapper
  # make -f Makefile.bsd-wrapper install
</pre>
    <p>
	Puis de recompiler le système en suivant la section <a href="#1.5">1.5</a>

    <a name="3.2.9"></a>
    <h3>
      3.2.9: Suppression de /var/at et changements crontab (2003/02/19)
    </h3>

    <p>Le contenu de <tt>/var/at</tt> a été fusionné avec <tt>/var/cron</tt>
    maintenant que <em>at</em> a été intégré dans <em>cron</em>.  En outre,
    les fichiers <em>cron</em> de permission et refus ont été renommés 
	cron.allow et cron.deny pour être compatible POSIX et de la cohérence 
	avec at.allow et at.deny.
    <p>
    En premier, recompilation du système en suivant la section <a href="#1.5">1.5</a>
    Puis déplacer les fichiers existants et redémarrer cron comme ci-dessous :
    <p>
<pre>
  # mv /var/at/* /var/cron
  # mv /var/cron/jobs /var/cron/atjobs
  # mv /var/cron/allow /var/cron/cron.allow
  # mv /var/cron/deny /var/cron/cron.deny
  # rm -rf /var/at 
  # kill `cat /var/run/cron.pid`
  # /usr/sbin/cron
</pre>
    <p>
	Ne pas tenir compte des avertissements à propos de fichiers manquants
	de permission ou de refus. Tous ne font pas partie de l'installation 
	par défaut.
    <p>
	Si vous n'avez pas déjà un fichier cron.deny (il n'était pas installé
	avant OpenBSD 3.3) vous devrez en avoir un pour utiliser <em>crontab</em>
	pour un utilisateur autre que superuser.
<pre>
  # install -c -o root -g crontab -m 660 /dev/null /var/cron/cron.deny
</pre>

    <a name="3.1"></a>
    <h2>
      Mettre à jour de la 3.1
    </h2>
    
    <a name="3.1.1"></a>
    <h3>
      3.1.1: Nouveaux utilisateurs/groupes
    </h3>

    <p>Plusieurs nouveaux utilisateurs/groupes ont été ajoutés. 
      Pour supporter 
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=authpf&amp;sektion=8"
      >authpf(8)</a>, un nouveau groupe est nécessaire. Aussi, pour supporter 
	  les fonctionnalités de séparation de privilèges de 
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sshd&amp;sektion=8">sshd(8)</a>,
      un nouveau groupe et utilisateur <em>sshd</em> ont été ajoutés au 
	  système.
      Plusieurs nouveaux utilisateurs pour les services système ont été 
	  ajoutés, ils sont préfixés avec &quot;_&quot;.
      Ajoutez les entrées utilisateur suivantes avec  
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
    </p>
<pre>
  sshd:*:27:27::0:0:sshd privsep:/var/empty:/sbin/nologin
  _portmap:*:28:28::0:0:portmap:/var/empty:/sbin/nologin
  _identd:*:29:29::0:0:identd:/var/empty:/sbin/nologin
  _rstatd:*:30:30::0:0:rpc.rstatd:/var/empty:/sbin/nologin
  _rusersd:*:32:32::0:0:rpc.rusersd:/var/empty:/sbin/nologin
  _fingerd:*:33:33::0:0:fingerd:/var/empty:/sbin/nologin
  _x11:*:35:35::0:0:X server:/var/empty:/sbin/nologin
</pre>
    
    <p>Ajoutez les groupes suivants dans <tt>/etc/group</tt>:</p>
       
<pre>
  sshd:*:27:
  _portmap:*:28:
  _identd:*:29:
  _rstatd:*:30:
  _rusersd:*:32:
  _fingerd:*:33:
  _sshagnt:*:34:
  _x11:*:35:
  authpf:*:72:
</pre>

    <a name="3.1.2"></a>
    <h3>
      3.1.2: Nouveau groupe pour crontab(1) et at(1)
    </h3>

    <p>
      Les commandes 
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=crontab&amp;sektion=1">
      crontab(1)</a> et
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=at&amp;sektion=1">
      at(1)</a> ne sont plus setuid root, elles sont maintenant setgid
      <em>crontab</em>.

    <p>
      Avant de faire un &quot;make build&quot;, vous devrez ajouter le groupe
      <em>crontab</em>.
      Ajoutez une ligne comme la suivante dans votre fichier <tt>/etc/group</tt> :</p>

<pre>
  crontab:*:66:
</pre>

<p>
      Le &quot;make build&quot; mettra à jour certaines, mais pas toutes, 
	  permissions pour vous. Après la fin du &quot;make build&quot;, vous 
	  devrez exécuter à la main (via <tt>/bin/csh</tt>):
</p>

<pre>
  # chgrp crontab /var/at/at.{allow,deny} /var/cron/{allow,deny}
  # chmod 0640 /var/at/at.{allow,deny} /var/cron/{allow,deny}
  # foreach f ( /var/cron/tabs/* )
	  set u=`basename $f`
 	  chown $u:crontab $f
    end
</pre>

<p>
      Il faut remarquer que vous n'avez probablement pas tous les fichiers
	  de permission/refus; ce n'est pas un problème.
</p>

    <a name="3.1.3"></a>
    <h3>
      3.1.3: Nouveau Binutils
    </h3>

<p>
Un nouveau binutils (2.11.2) est arrive dans l'arborescence, ce qui nécessite 
une mise à jour de <em>libiberty</em>. Pour compiler cette librairie, suivez
les étapes suivantes :
</p>
  
<pre>
  # cd /usr/src/gnu/egcs/libiberty
  # make -f Makefile.bsd-wrapper cleandir
  # make -f Makefile.bsd-wrapper obj
  # make -f Makefile.bsd-wrapper depend
  # make -f Makefile.bsd-wrapper
  # make -f Makefile.bsd-wrapper install
</pre>

    <a name="3.1.4"></a>
    <h3>
      3.1.4: Nouvelle configuration S/Key
    </h3>

    <p>
      L'ancien fichier de base de données S/Key, <tt>/etc/skeykeys</tt>, a été
	  remplacé par un répertoire <tt>/etc/skey</tt>, ou chaque enregistrement
	  est un fichier individuel propriété de l'utilisateur qu'il décrit. Vous
      pouvez convertir <tt>/etc/skeykeys</tt> vers le nouveau format en 
	  faisant (sous root) :
    </p>
<pre>
  # skeyinit -C
  # mv /etc/skeykeys /etc/skeykeys.OLD
</pre>

<p>
      Il faut remarquer que chaque programme tiers qui utilisait directement 
	  S/Key devra être recompilé.
</p>

    <a name="3.1.5"></a>
    <h3>
      3.1.5: Nouvelles permissions pour lp*
    </h3>

    <p>
	  Les répertoires de spool utilisés par lpd doivent maintenant être en
	  écriture pour le groupe daemon pour que lpr soit capable de spool
	  les fichiers. En outre, les fichiers à l'intérieur des répertoires de
	  spool doivent être détenues par l'utilisateur et le groupe daemon.
	  Cela peut être accompli comme suit :
    </p>
<pre>
 # find /var/spool/output /var/spool/lpd -type d \
	-execdir chgrp daemon {} \; -execdir chmod g+rwx {} \;
 # find /var/spool/output /var/spool/lpd -type f \
	-execdir chown daemon:daemon {} \;
</pre>

    <a name="3.1.6"></a>
    <h3>
      3.1.6: atrun(8) n'est plus nécessaire
    </h3>

    <p>
      La commande <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=atrun&amp;sektion=8">atrun(8)</a>
      n'est plus nécessaire. Ces fonctionnalités ont été intégrées dans
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cron&amp;sektion=8">cron(8)</a>.
      Vous devez supprimer le job <tt>/usr/libexec/atrun</tt> de la crontab du 
	  root en exécutant sous root :
    </p>
    <pre>
      # crontab -e
    </pre>

    <p>
      Vous pourrez aussi supprimer <tt>/usr/libexec/atrun</tt>,
      <tt>/usr/share/man/cat8/atrun.0</tt> et le répertoire
      <tt>/var/at/spool</tt>.
    </p>

    <a name="3.1.7"></a>
    <h3>
      3.1.7: nat.conf fusionné avec pf.conf
    </h3>

    <p>
	<tt>/etc/nat.conf</tt> est maintenant fusionné avec <tt>/etc/pf.conf</tt>.
	Vous devez insérer vos règles NAT dans pf.conf après les règles scrub et
	avant les règles de filtrage.
    </p>
    <p>
	<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8">pfctl(8)</a>
	possède une nouvelle option pour charger un ensemble de règles, -f, et les
	options -R et -N ont une nouvelle signification maintenant. Soyez sur de 
	vérifier le manpage et de mettre à jour votre <tt>/etc/rc</tt>.
    </p>

    <a name="3.1.8"></a>
    <h3>
     3.1.8: Nouvelle entrée fbtab nécessaire à xdm
    </h3>

    <p>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=login&amp;sektion=1">
login(1)</a> a besoin de chown /dev/wsmouse vers le nouvel utilisateur _x11
qui est utilisé pour les besoins de révocation de privilèges de xdm sur
plusieurs architectures. La modification de
<tt>/etc/fbtab</tt> nécessaire est dépendante de l'architecture. Le fichier
est créé via ce processus (en s'assurant que les sources sont dans /usr/src) :
    </p>
<pre>
  # cat /usr/src/etc/fbtab.head > /etc/fbtab
  # cat /usr/src/etc/etc.`uname -m`/fbtab >> /etc/fbtab
  # cat /usr/src/etc/fbtab.tail >> /etc/fbtab
</pre>
<p>
SI vous avez des changements personnels sur <tt>/etc/fbtab</tt>, vous devrez 
les fusionner dans le nouveau fichier manuellement.
</p>
   <a name="3.1.9"></a>
   <h3>
    3.1.9: Utiliser __attribute__((sentinel)) sur certaines fonctions
   </h3>

   <p>
     __attribute__((sentinel)) est maintenant utilisé pour avertir quand
	 certaines fonctions
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=exec&amp;sektion=3">
exec(3)</a>
     sont utilisées sans un pointeur NULL terminal.
     <br><br>Vous devez recompiler gcc en suivant la section
     <a href="#1.8">1.8</a>
     de la Mini-FAQ avant de faire un <tt>make build</tt>.
   </p>

    <a name="3.0"></a>
    <h2>
      Mettre à jour de la 3.0
    </h2>
    
    <a name="3.0.1"></a>
    <h3>
      3.0.1: Nouveau mot clé supporté par mtree(8)
    </h3>

    <p>
      Vous devez compiler et installer une nouvelle version de l'utilitaire
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mtree&amp;sektion=8">
      mtree(8)</a> avant qu'un &quot;make build&quot; soit un succès.
    </p>
<pre>
  # cd /usr/src/usr.sbin/mtree
  # make cleandir
  # make obj
  # make depend
  # make
  # make install
</pre>

    <a name="3.0.2"></a>
    <h3>
      3.0.2: Suppression de libdl sur les plateformes ELF
    </h3>
    
    <p>
      Les plateformes basées sur ELF (alpha, macppc et sparc64) n'utilise 
	  plus libdl. La mise à jour à partir d'un système libdl vers non-libdl
	  peut-être réalisé en suivant ces étapes :
    </p>

    <ul>
      <li>
	<p>Recompilez votre système :</p>
<pre>
  # cd /usr/src
  # make build
</pre>
      </li>

      <li>
	<p>
	  Si votre &quot;make build&quot; est un succès, vous pouvez passer
	  à l'étape suivante et supprimer libdl. Il faut remarquer que les
	  paquetages qui sont liés avec libdl doivent être réinstallés. Si vous
	  n'êtes pas prés pour cela, vous pouvez sauter cette étape à présent. 
	  Des snapshots avec les paquetages corrects seront disponibles.
	</p>
<pre>
  # rm -f /usr/lib/libdl.* /usr/lib/libdl_pic.a
</pre>
	</li>
      <li>
	<p>
	  Avec la libdl supprimée, régénérez votre cache de librairies partagées :
	</p>
	
<pre>
  # ldconfig -R
</pre>
      </li>
    </ul>

    <a name="3.0.3"></a>
    <h3>
      3.0.3: Nouveau framework de régression
    </h3>
    
    <p>
      Une nouvelle infrastructure pour les tests de régression a été introduite
	  et <tt>bsd.regress.mk</tt> a été ajouté.  Vous devez installer ce fichier
	  avant de faire un <em>make obj</em>.
    </p>

<pre>
  # cd /usr/src/share/mk
  # make install
</pre>

    <a name="3.0.4"></a>
    <h3>
      3.0.4: fichiers de configuration ssh déplacés dans /etc/ssh/
    </h3>

    <p>
      Vous devez créer /etc/ssh/ en premier, voir la section
      <a href="#1.13">1.13</a>
    </p>

    <p>
      Recompilez votre système :
    </p>
<pre>
  # cd /usr/src
  # make build
</pre>

    <p>
      Déplacez les fichiers /etc/ssh*_* dans le nouvau répertoire crée 
	  /etc/ssh/ :
    </p>
<pre>
  # cd /etc
  # mv ssh*_* ssh/
</pre>

    <p>
      Vous devez aussi 
      <a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/rc.diff?r1=1.188&amp;r2=1.189">
	modifier vos scripts <tt>rc</tt></a> pour refléter ces changements 
	évidemment.
    </p>

    <p>
      Mettre à jour toutes les lignes <tt>HostKey</tt> dans votre sshd_config 
	  pour refléter le nouvel emplacement. Par exemple :
    </p>
<pre>
  HostKey /etc/ssh_host_key
</pre>

    <p>doit être modifié en :</p>

<pre>
  HostKey /etc/ssh/ssh_host_key
</pre>

    <p>
      Après cela, vous pouvez redémarrer le daemon sshd.
    </p>

    <a name="2.9"></a> 
    <h2>Mettre à jour de la 2.9</h2>

    <a name="2.9.1"></a> 
    <h3>2.9.1: Nouveaux utilisateurs/groupes - <em>proxy</em>, <em>smmsp</em>
      et <em>popa3d</em>.</h3>

    <p>
      En premier, avec l'ajout du paquetage pare-feu  
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4">
	pf(4)</a> et sa suite 
      <a href=
	 "http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8"
	 >ftp-proxy(8)</a>, un nouvel utilisateur et groupe nommés
      <em>proxy</em> ont été ajoutés au système. Pour supporter cet ajout,
      ajoutez l'entrée utilisateur suivante en utilisant 
      <a href=
	 "http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">
	vipw(8)</a>:</p>
    
<pre>
proxy:*:71:71::0:0:Proxy Services:/nonexistent:/sbin/nologin
</pre>

    <p>Ajoutez aussi le groupe <em>proxy</em> à /etc/group:</p>

<pre>
proxy:*:71:
</pre>

    <p>En second, inclus dans la mise à jour de Sendmail 8.12, sendmail ne
      fonctionne plus setuid root. Donc un nouvel utilisateur et groupe, nommés
      <em>smmsp</em>, ont été ajoutés au système. Ajoutez la ligne suivante
	  dans votre <tt>/etc/group</tt>:</p>

<pre>
smmsp:*:25:
</pre>

    <p>Maintenant, utilisez 
      <a href=
	 "http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">
	vipw(8)</a> et ajoutez la ligne suivante pour l'utilisateur 
	<em>smmsp</em> :

<pre>
smmsp:*:25:25::0:0:Sendmail Message Submission Program:/nonexistent:/sbin/nologin
</pre>

    <p>Soyez sure que la ligne apparaît avant toute ligne de configuration<a href=
      "http://www.openbsd.org/cgi-bin/man.cgi?query=yp&amp;sektion=8">
      yp(8)</a>.</p>

    <p>Finalement, un nouvel utilisateur et groupe ont été ajoutés au serveur
	  popa3d de Solar Designer, maintenant intégré au coeur du système. Ajoutez
      dans <tt>/etc/group</tt> :</p>

<pre>
popa3d:*:26:
</pre>

    <p>Et utilisant <a href=
      "http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">
      vipw(8)</a>, ajoutez</p>
<pre>
popa3d:*:26:26::0:0:POP3 server:/var/empty:/sbin/nologin
</pre>

    <a name="2.9.2"></a> 
    <h3>2.9.2: Nouveau filtre de paquets : <em>pf</em></h3>

    <p>Le paquetage pare-feu IPF qui faisait parti des versions précédentes
	  de OpenBSD a été remplacé par la toute nouvelle suite de pare-feu appelée
	  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4">
	  pf(4)</a>. Il en résulte un nombre de changements à réaliser.</p>

    <p>En premier, <em>pf</em> dépend d'un nouveau périphérique de fichier. 
	  Pour être sur que ce nouveau périphérique spécial est créé, faite : </p>

<pre>
  # cd /dev
  # cp /usr/src/etc/etc.`machine`/MAKEDEV ./
  # ./MAKEDEV all
</pre>

    <p>En second, il y a un nombre important de changements dans le système
	  de fichiers. Pour référence, les binaires suivants ont été remplacés 
	  :</p>
	  
<pre>
ANCIEN:
/sbin/ipf /sbin/ipfstat /sbin/ipnat /usr/sbin/ipfs
/usr/sbin/ipftest /usr/sbin/ipmon /usr/sbin/ipresend
/usr/sbin/ipsend /usr/sbin/iptest
NOUVEAU:
/sbin/pfctl
/usr/libexec/ftp-proxy
</pre>

    <p>De façon similaire, pour les périphériques :</p>

<pre>
ANCIEN: /dev/ipl /dev/ipnat /dev/ipstate /dev/ipauth
NOUVEAU: /dev/pf
</pre>

    <p>Et finalement, les fichiers de configuration du filtre :</p>

<pre>
ANCIEN: /etc/ipf.rules /etc/ipnat.rules
NOUVEAU: /etc/pf.conf /etc/nat.conf
</pre>
    <p>Les anciens fichiers de configuration d'exemples doivent être supprimés :
    </p>
<pre>
  # rm -rf /usr/share/ipf
</pre>

    <p>Un mécanisme pour activer prudemment <em>pf</em> a été ajouté aux
      fichiers <tt>/etc/rc</tt> et <tt>/etc/rc.conf</tt>. Vous devez mettre à
      jour ces fichiers pour inclure le nouveau mécanisme. Si vous désirez
	  activer <em>pf</em>, ajouter PF=YES dans
      <tt>/etc/rc.conf</tt>.</p>

    <a name="2.9.3"></a> 
    <h3>2.9.3: Changements dans <em>make</em></h3>

    <p>Il y a eu des changements dans <a href=
      "http://www.openbsd.org/cgi-bin/man.cgi?query=make&amp;sektion=1">
	make(1)</a> et ces fichiers de données qui peuvent causer des problèmes
	  dans le processus de compilation. Cela se manifeste habituellement comme
	  des erreurs de <em>bsd.own.mk</em> durant le compilation. Pour les éviter,
      mettez à jour en premier les fichiers de données :</p>
<pre>
  # cd /usr/src/share/mk
  # make install
</pre>

    <p>Puis compilez et installez le nouveau make.</p>

<pre>
  # cd /usr/src/usr.bin/make
  # make clean &amp;&amp; make obj &amp;&amp; make depend &amp;&amp; make
  # make install
</pre>

    <p>Maintenant procédez à la mise à jour.</p>
    
    <a name="2.9.4"></a>
    <h3>2.9.4: La compilation échoue à cause d'erreurs KerberosV</h3>

    <p>Avant d'essayer de compiler le système complet, vous devez en premier
	  compiler KerberosV.</p>

    <p>Premièrement, il y a un nouveau répertoire de configuration KerberosV 
      dans <em>/etc</em>. Si vous ne l'avez pas déjà fait, utilisez la 
	  procédure 
	  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mtree&amp;sektion=8">
	mtree(8)</a> décrite dans la <a href="#1.13">section
	1.13</a> pour le créer :</p>

    <p>Maintenant compilez KerberosV</p>

<pre>
  # cd /usr/src/kerberosV
  # make obj
  # cd lib/roken
  # make 
  # cd ../../usr.bin/asn1_compile
  # make
  # make install
</pre>

    <p>Vous pouvez aussi avoir besoin de mettre à jour votre 
	  <tt>/etc/login.conf</tt>, pour refléter que le fichier
      <tt>/usr/libexec/auth/login_krb-or-pwd</tt> a été renommé en
      <tt>login_krb<strong>4</strong>-or-pwd</tt>.</p>

    <a name="2.9.5"></a> 
    <h3>2.9.5: Nouvelle version de <em>sendmail</em> </h3>

    <p><a href=
      "http://www.openbsd.org/cgi-bin/man.cgi?query=sendmail&amp;sektion=8">
	sendmail(8)</a> a été mis à jour à la version 8.12. Comme cette
      version de <em>sendmail</em> ne fonctionne plus en setuid root,
      des changements significatifs en résultent.</p>

    <ol>
      <li>Un nouvel utilisateur et un nouveau groupe (<em>smmsp</em>) ont été
	ajouté. Si vous ne l'avez pas déjà fait, suivez la procédure dans la
	<a href="#2.9.1">section 2.9.1</a> pour les créer.</li>

      <li>Plusieurs changements dans la hiérarchie des fichiers ont été fait,
	comme un nouveau répertoire <tt>/var/spool/clientmqueue</tt> et de 
	nouvelles permissions pour <tt>/var/spool/mqueue</tt>. Ces changements
	peuvent être réalisés en utilisant la procédure <a href=
        "http://www.openbsd.org/cgi-bin/man.cgi?query=mtree&amp;sektion=8">
	  mtree(8)</a> décrite dans la <a href="#1.13">section
	  1.13</a>.</li>

      <li>
        <p>Ajoutez ce qui suit dans la <a href=
          "http://www.openbsd.org/cgi-bin/man.cgi?query=crontab&amp;sektion=1">
	    crontab(1)</a> du root. C'est nécessaire depuis que <em>sendmail</em>
	  n'est plus setuid root, et nécessite cette entrée pour faire une partie
	  du travail :</p>

<pre>
# sendmail clientmqueue runner
*/30    *       *       *       *       /usr/sbin/sendmail -L sm-msp-queue -Ac -q
</pre>

      </li>
      
      <li>
        <p>Mise à jour de sendmail:</p>

<pre>
  # cd /usr/src/gnu/usr.sbin/sendmail
  # make clean &amp;&amp; make obj &amp;&amp; make depend &amp;&amp; make &amp;&amp; make install
</pre>

        <p><strong>Remarque :</strong> Les fichiers <tt>submit.cf</tt> et
	  <tt>localhost.cf</tt> ont été installés dans votre répertoire
	  <tt>/etc/mail</tt>. Le premier, <tt>submit.cf</tt> (qui se réfère
	  au fichier de configuration "client" dans la documentation de sendmail)
	  est utilisé par les agents utilisateur mail qui veulent délivrer des
	  messages localement via sendmail. A cause des changements de permissions
	  décris ci-dessus, cela ne nécessite pas les droits root; le binaire de
	  sendmail est set-groupid au groupe smmsp. Le second fichier,
	  <tt>localhost.cf</tt>, est un OpenBSD-ism qui exécute sendmail
	  uniquement en écoute sur l'interface localhost pour accepter les messages
	  de l'hôte local mais n'accepte pas les connexions du réseau (vous voudrez
	  sûrement cela si vous utilisez aussi <a href=
          "http://www.openbsd.org/cgi-bin/man.cgi?query=smtpd&amp;sektion=8">
	    smtpd(8)</a> écoutant sur le port SMTP de votre interface externe).
	  Pour plus de détails, regardez le fichier <tt>SECURITY</tt> dans
	  <tt>/usr/src/gnu/usr.sbin/sendmail/sendmail</tt>.</p>

        <p>Il est hautement recommandé de régénérer et mettre à jour vos
	  fichiers de configuration sendmail dans <tt>/etc/mail</tt>.
	  Vous pouvez trouver des fichiers de configuration qui fonctionnent dans
	  <tt>/usr/share/sendmail/cf</tt>. Il faut remarquer que localhost.cf est
	  généré de openbsd-localhost.mc.</p>
      </li>

      <li>
        <p>Si vous utilisez sendmail sans l'option <tt>-bd</tt>
	  dans <tt>/etc/rc.conf</tt>, comme configuration par défaut à
	  l'installation, vous devrez utiliser <tt>localhost.cf</tt>. 
	  Editez <tt>rc.conf</tt> pour l'utiliser en suivant :</p>
<pre>
# For normal use: "-L sm-mta -bd -q30m"
sendmail_flags="-L sm-mta -C/etc/mail/localhost.cf -bd -q30m"
</pre>
      </li>

      <li>
        <p>Des que votre fichier de configuration est prés, <a href=
         "http://www.openbsd.org/cgi-bin/man.cgi?query=kill&amp;sektion=1">
	    kill(1)</a> le sendmail existant :</p>
<pre>
  kill `sed 1q /var/run/sendmail.pid`
</pre>

        <p>Redémarrez le nouveau sendmail avec les options appropriées,
	  par exemple :</p>
<pre>
  /usr/sbin/sendmail -L sm-mta -bd -q30m
</pre>

        <p>pour une configuration acceptant les messages de l'extérieur, ou</p>

<pre>
  /usr/sbin/sendmail -L sm-mta -C/etc/mail/localhost.cf -bd -q30m
</pre>

        <p>pour une configuration locale de message uniquement.</p>
	
        <p><strong>Remarque :</strong> l'option <tt>-bd</tt> est maintenant
	  nécessaire dans tous les cas.</p>
      </li>
    </ol>

    <p>Le nouveau <em>sendmail</em> doit maintenant fonctionner.</p>

    <a name="2.9.6"></a> 
    <h3>2.9.6: <tt>/etc/primes</tt> déplacé</h3>

    <p><tt>/etc/primes</tt> a été renommé en
      <tt>/etc/moduli</tt>. Copiez simplement ce fichier de son ancien
	  emplacement ou de <tt>/usr/src/etc</tt>.</p>


<a name="2.8"></a> 
<h2>Mettre à jour de la 2.8</h2>


<a name="2.8.1"></a> 
<h3>2.8.1: Nouveau groupe <em>auth</em> </h3>

<p>Un nouveau groupe, <em>auth</em>, gid 11, a été ajouté au système. Ajoutez
la ligne suivante dans <tt>/etc/group</tt>:</p>

<pre>
  auth:*:11:
</pre>

<a name="2.8.2"></a> 
<h3>2.8.2: Nouvelle console système <em>wscons</em> </h3>

<p>Le pilote de console <em>pcvt</em> a été remplacé par le pilote de console
système <em>wscons</em>. Avant d'utiliser wscons, vous devez créer les nouveaux
périphériques relatifs à wscons. Assurez vous que vous avez le dernier 
MAKEDEV installé, puis créez tous les périphériques :</p>

<pre>
 # cp /usr/src/etc/etc.i386/MAKEDEV /dev/MAKEDEV
 # cd /dev
 # ./MAKEDEV all
</pre>

<p>Si vous utilisez X, changez la section Pointer de votre fichier
<em>XF86Config</em> contenant :</p>

<pre>
    Protocol    "wsmouse"
    Device      "/dev/wsmouse"
</pre>

<a name="2.8.3"></a> 
<h3>2.8.3: Compilation du noyau ne fonctionnant pas avec
		des symboles indéfinis</h3>

<p><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;sektion=8">config(8)</a> 
a été mis à jour. Compiler avec l'ancien <em>config</em> donnera des 
résultats erronés comme :</p>
<pre>
  Undefined symbol `_pdevnames_size' referenced
  Undefined symbol `_pdevnames' referenced
</pre>

<p>Pour corriger cela, compilez et installez le nouveau <em>config</em>:</p>
<pre>
  # cd /usr/src/usr.sbin/config
  # make clean &amp;&amp; make depend &amp;&amp; make
  # make install
</pre>

<p>Maintenant, recompilez un nouveau noyau comme précédemment.</p>


<a name="2.7"></a>
<h2>
Mettre à jour de la 2.7
</h2>

<a name="2.7.1"></a>
<h3>
2.7.1: Quels sont les problèmes majeurs de la mise à jour de la 2.7 à la 2.8 ?
</h3>

<p>
Un changement significatif dans gcc a été introduit qui lui permet de générer
facilement des librairies <em>libc</em> auto-reférencées. Pour cette raison,
la mise à jour doit suivre cette procédure exactement :
</p>

<ol>
<li> <a href="faq5.html#ProbObj">Nettoyez</a> votre arborescence de sources, 
et récupérez le code de la 2.8.</li>

<li>
<p>
 Compilez et installez un nouveau linker. Cela <strong>doit</strong> être fait
avant une compilation complète de <em>gcc</em>.
</p>
<pre>
  $ cd /usr/src/gnu/usr.bin/ld
  $ make clean &amp;&amp; make obj &amp;&amp; make
  $ sudo make install
</pre>
</li>
<li> Compilez et installez le nouveau <em>gcc</em>. Utilisez la procédure de
     <a href="faq5.html#NewCompiler">BOOTSTRAP</a> pour accélérer les
     choses.
</li>

<li>
<p> Compilez un nouveau noyau. Ne l'installez pas encore </p>
<pre>
  $ cd /usr/src/sys/arch/`machine`/conf
  $ config GENERIC
  $ cd ../compile/GENERIC
  $ make clean &amp;&amp; make depend &amp;&amp; make
</pre>
</li>

<li><p> A cause des changements dans la libc, votre machine se bloquera au
   démarrage tant que votre <tt>/etc/resolv.conf</tt> ne contiendra pas 
   <em>lookup file bind</em>.
   Ajoutez la ligne suivante si nécessaire </p>
<pre>
  # echo &quot;lookup file bind&quot; &gt;&gt; /etc/resolv.conf
</pre>
</li>
<li> Installez le nouveau noyau et redémarrez
<pre>
  # cd /usr/src/sys/arch/`machine`/compile/GENERIC
  # mv /bsd /bsd.old
  # mv bsd /bsd
  # chown root.wheel /bsd
  # shutdown -r now
</pre>
<p>
(Si cette étape ne réussi pas, vous pouvez redémarrer avec l'ancien noyau - 
bsd.old - au prompt <tt>boot&gt;</tt> prompt.)</p>
</li>
<li> 
<p>Compilez et installez le nouveau make (et ces fichiers associés). 
     Ne sautez pas l'étape <tt>make depend</tt>.
</p>
<pre>
  $ cd /usr/src/usr.bin/make
  $ make clean &amp;&amp; make obj &amp;&amp; make depend &amp;&amp; make
  $ sudo make install
  $ cd /usr/src/share/mk
  $ sudo make install
</pre>
</li>

<li>
<p>Installez le dernier <em>mtree</em>, et assurez vous que les répertoires
     nécessaires sont présent.</p>
<pre>
  $ cd /usr/src/etc/mtree
  $ sudo install -c -o root -g wheel -m 444 4.4BSD.dist /etc/mtree
  $ sudo mtree -qdef /etc/mtree/
</pre>
</li>

<li> Faite un make build
<pre>
  # cd /usr/src &amp;&amp; make build
</pre>
</li>

<li> <a href="faq5.html#UpdateEtc">Mettez à jour <tt>/etc</tt> <tt>/var</tt> et 
     <tt>/dev/MAKEDEV</tt></a> à la main.

</li>
</ol>

<a name="2.6"></a>
<h2>
Mettre à jour de la 2.6
</h2>

<a name="2.6.1"></a>
<h3>
2.6.1: Les entrées Termcap sont trop longues.
</h3>

<p>
Il y a un nouveau fichier <tt>termcaps.master</tt>. Vous devez régénérer les
fichiers <tt>terminfo</tt> et <tt>termcaps</tt> avec la version courante de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tic&amp;sektion=1">tic(1)</a>.
Si vous mettez à jour via <em>make build</em>, la version correcte de tic(1) 
sera utilisée et le nécessaire sera fait pour vous. Sinon, vous obtiendrez
l'erreur suivante :
</p>

<pre>
    terminfo.src is corrupt! You need to update /usr/bin/tic
</pre>

<p>
Dans ce cas, vous devez recompiler et installer tic(1) (en étant sur
d'utiliser la version courante de <tt>libcurses</tt>) ou en compilant
simplement la version de tic(1) de votre arborescence des sources.
</p>

<a name="2.6.2"></a>
<h3>
2.6.2: Mon périphérique <em>pn</em> (ou <em>mx</em>, <em>al</em>, <em>ax</em>)
n'est plus reconnu par le noyau.
</h3>

<p> (Remarque: <em>pn</em> est utilisé ici pour sa simplicité. Il faudra lire
<em>pn</em>, <em>mx</em>, <em>al</em> ou <em>ax</em> de manière appropriée).
</p>

<p>
Ces quatre pilotes ont été remplacés par un pilote unifié <em>dc</em>.
Vous devez remplacer toutes les occurrences de <em>pn*</em>, <em>mx</em>,
<em>al</em> ou <em>ax</em> dans vos fichiers de configuration. Cela inclut :
</p>

<ul>
<li>Mettre à jour vos fichier(s) de configuration noyau. (Astuce : commencez
    avec un noyau GENERIC, et modifiez le)
</li>
<li>Renommez <tt>/etc/hostname.pn*</tt> en <tt>/etc/hostname.dc*</tt>
</li>
<li>Mettre à jour le fichier <tt>/etc/ifaliases</tt>.
</li>
<li>Modifiez votre <tt>/etc/ipnat.rules</tt> et <tt>/etc/ipf.rules</tt> pour
    prendre en compte le nouveau nom de l'interface.</li>
</ul>

<p>
Si vous modifiez un noyau personnalisé, soyez sur d'inclure le périphérique
<em>dcphy</em> dans votre configuration noyau, comme :
</p>

<pre>
dcphy*  at mii? phy ?                           # Digital Clone PHYs
</pre>

<p>tant que vous y êtes, vous voudrez aussi ajouter :</p>

<pre>
ukphy*  at mii? phy ?                           # "unknown" PHYs
</pre>

<a name="2.6.3"></a>
<h3>
2.6.3: Mettre à jour gcc 2.95.1 vers 2.95.2
</h3>

<p><em>gcc</em> 2.95.2 a fusionné dans l'arborescence des sources de OpenBSD
vers le 19 Janvier 2000. Dans l'ordre, pour que <em>gcc</em> compile 
proprement, une version plus récente de <em>libiberty</em> (après 2.6) est
nécessaire. Pour compiler cette librairie, faire :</p>

<pre>
	cd /usr/src/gnu/egcs/libiberty
	make -f Makefile.bsd-wrapper clean
	make -f Makefile.bsd-wrapper obj
	make -f Makefile.bsd-wrapper
	make -f Makefile.bsd-wrapper install
</pre>

<p>
REMARQUE: Sur les architectures basées sur mips, comme le pmax, vous devez
faire explicitement un <em>ldconfig</em> après que les nouvelles librairies
seront compilées.
</p>

<p>Des que <em>libiberty</em> est compilé, vous devez réaliser un bootstrap
<em>gcc</em> standard :</p>

<pre>
   cd /usr/src/gnu/egcs/gcc
   make -f Makefile.bsd-wrapper clean
   make -f Makefile.bsd-wrapper obj
   make -f Makefile.bsd-wrapper -DBOOTSTRAP
   make -f Makefile.bsd-wrapper -DBOOTSTRAP install
   make -f Makefile.bsd-wrapper clean
   make -f Makefile.bsd-wrapper 
   make -f Makefile.bsd-wrapper install
</pre>

<a name="2.6.4"></a>
<h3>
2.6.4: Mettre à jour Kerberos.
</h3>

<p>
Pour que Kerberos IV se compile correctement, vous devez suivre les étapes
suivantes :
</p>

<ul>
<li>
<p> Récupérez et compilez le dernier <tt>usr.bin/compile_et</tt>. </p>
<pre>
   # cd /usr/src/usr.bin/compile_et
   # make clean &amp;&amp; make depend &amp;&amp; make &amp;&amp; make install
</pre>
</li>

<li>
<p> Récupérez et compilez la dernière <tt>lib/libcom_err</tt>. </p>
<pre>
   # cd /usr/src/lib/libcom_err
   # make clean &amp;&amp; make depend &amp;&amp; make &amp;&amp; make install
</pre>
</li>

<li>
<p> Nettoyez et réinstallez les fichiers d'en-têtes Kerberos : </p>
<pre>
  # rm -r /usr/include/kerberosIV/*
  # cd /usr/src/kerberosIV
  # make includes
</pre>
</li>
<li>
<p> Maintenant, recompilez les fichiers de librairie Kerberos :</p>
<pre>
   # cd /usr/src/kerberosIV/lib
   # make clean &amp;&amp; make depend &amp;&amp; make &amp;&amp; make install
</pre>
</li>
<li>
<p> Si vous ne faite pas un make build complet, recompilez Kerberos:</p>
<pre>
   # cd /usr/src/kerberosIV
   # make cleandir &amp;&amp; make depend &amp;&amp; make &amp;&amp; make install
</pre>
</li>
<li> Sinon, refaire un <em>make build</em>. </li>
</ul>


<a name="2.6.5"></a>
<h3>
2.6.5: Mettre à jour M4.
</h3>

<p>
La version de m4 qui est fournie avec OpenBSD 2.6 partira dans une boucle
infinie quand elle traitera les fichiers sendmail .mc en fichiers .cf. A cause
de cela vous devez installer une nouvelle version de m4 <strong>avant</strong>
de tenter un <em>make build</em>. En d'autres mots :
</p>

<pre>
    # cd /usr/src/usr.bin/m4
    # make &amp;&amp; make install &amp;&amp; make cleandir
</pre>

<a name="2.6.6"></a>
<h3>
2.6.6: Mettre à jour Sendmail.
</h3>

<p>
Dans sendmail 8.10.X, les emplacements (et noms) des fichiers de configuration
de sendmail ont changé. Tout sauf le fichier de pid se trouve maintenant dans
/etc/mail. De plus, plusieurs fichiers ont changé de noms.
</p>

<table border="0">
<tr>
  <td><strong>ANCIEN</strong></td>
  <td><strong>NOUVEAU</strong></td>
</tr>
<tr>
  <td><tt>/etc/sendmail.cf</tt></td>
  <td><tt>/etc/mail/sendmail.cf</tt></td>
</tr>
<tr>
  <td><tt>/etc/sendmail.cw</tt></td>
  <td><tt>/etc/mail/local-host-names</tt></td>
</tr>
<tr>
  <td><tt>/etc/sendmail.ct</tt></td>
  <td><tt>/etc/mail/trusted-users</tt></td>
</tr>
<tr>
  <td><tt>/etc/sendmail.oE</tt></td>
  <td><tt>/etc/mail/error-header</tt></td>
</tr>
<tr>
  <td><tt>/etc/aliases</tt></td>
  <td><tt>/etc/mail/aliases</tt></td>
</tr>
<tr>
  <td><tt>/etc/service.switch</tt></td>
  <td><tt>/etc/mail/service.switch</tt></td>
</tr>
<tr>
  <td><tt>/etc/userdb</tt></td>
  <td><tt>/etc/mail/userdb</tt></td>
</tr>
<tr>
  <td><tt>/usr/share/misc/sendmail.hf</tt></td>
  <td><tt>/etc/mail/helpfile</tt></td>
</tr>
</table>

<p>
Il y a différentes façons de convertir de l'ancienne vers la nouvelle
configuration de sendmail, mais la premiére étape est toujours la même.
</p>

<ol>
<li> Mettre à jour <tt>/etc/rc</tt> pour qu'il utilise
     <tt>/etc/mail/sendmail.cf</tt> à la place de <tt>/etc/sendmail.cf</tt>
</li>
<li> <tt>mv /etc/sendmail.cf /etc/mail/sendmail.cf</tt> <br />
     C'est la façon la plus simple et vous n'aurez pas à changer l'emplacement
	 des autres fichiers.
</li>
<li> Ou, compilez un nouveau fichier .cf à partir de votre fichier .mc. Il faut
     remarquer que vous vous n'avez plus besoin de spécifier la ligne : 
     <pre>include(`../m4/cf.m4')</pre>
     depuis qu'elle est incluse pour vous par make.  A remarquer aussi que 
	 lorsque vous ajoutez des machines de class w (via "Cw nomdemachine"), vous
	 avez maintenant besoin de faire cela dans la section LOCAL_CONFIG (voir 
	 <tt>openbsd-lists.mc</tt> pour un exemple).
</li>
</ol>

<a name="2.6.7"></a>
<h3>
2.6.7: Après la mise à jour, les noyaux qui incluent le support 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=apm&amp;sektion=8&amp;arch=i386">apm(8)</a>
ne démarreront plus.
</h3>

<p>
Vous devez mettre à jour vos bootblocks. Voir la
<a href="faq14.html#14.8">Section 14.8</a>
de la FAQ OpenBSD pour des détails.
</p>

<a name="2.6.8"></a>
<h3>
2.6.8: Groupe par défaut pour l'utilisateur <em>daemon</em> a été modifié
</h3>

<p>Le groupe par défaut pour l'utilisateur <em>daemon</em> a été modifié de
31 à 1. Utilisez vipw pour effectuer ce changement et que le daemon ressemble à :
<p><tt>daemon:*:1:1::0:0:The devil himself:/root:/sbin/nologin</tt>
</p>

<a name="2.5"></a>
<h2>Mettre à jour de la 2.5</h2>

<a name="2.5.1"></a>
<h3>
2.5.1: Quels sont les problèmes majeurs pour la mise à jour de la 2.5 à la 2.6 ?
</h3>

<h5><em>perl</em> et <em>make</em></h5>
<p>
La dernière version de Perl (5.005_03) nécessite une nouvelle version de
<em>make</em> pour compiler proprement. Vous devez recompiler make avant de
compiler le nouveau Perl. Faire un :
</p>

<pre>
# cd /usr/src/usr.bin/make
# make clean &amp;&amp; make &amp;&amp; make install
</pre>

<p>
Maintenant recompilez le nouveau Perl. Vous devrez nettoyer le répertoire
<code>obj</code> Perl à la main avant la compilation.
</p>

<p>
Les développeurs Perl doivent lire les remarques des derniers changements. De 
millert@openbsd.org:
</p>

<pre>
The version of perl in the OpenBSD source tree (post 2.5) has been
upgraded to 5.005_03.  The build method has changed somewhat but
most of that should be invisible.  The important changes that affect
people are as follows:

1) Perl lib files have moved from /usr/lib/perl5 to the more correct
/usr/libdata/perl5
2) The default site_perl directories now live in /usr/local.  Ie:
if you install a perl module, it will place itself in
/usr/local/libdata/perl5/site_lib.  This makes it easy to
see what non-stock modules you have.  It also means that we
can have perl modules in the ports system easily.
3) The perl library man pages are now install in /usr/share/man/cat3p
You'll need to update your man.conf based on the src/etc/man.conf
to take advantage of them.  This means you can now do
"man 3p less" and get info on the less pragma but "man less"
will still get you the less pager manpage.

If you have modules or other non-stock perl files the simplest thing
to do is to move /usr/lib/perl5 to /usr/libdata/perl5 and add a link
from /usr/lib/perl5 to /usr/libdata/perl5.  Alternately, you could
just edit the installed Config.pm file and fix up the paths there.

</pre>

<h5>Changement de compilateur : <em>egcs</em> remplace <em>gcc</em></h5>
<p>
Ce changement est le changement le plus significatif que vous rencontrerez.
Pour des instructions détaillées, voir la section <a href="#2.5.2">2.5.2</a>.
</p>

<h5>Structure du Noyau - <em>statfs</em> - modifiée</h5>
<p>
La structure <tt>statfs</tt> a été modifiée le 31 Mai. Vous devez recompiler
votre noyau avant de faire un <em>make build</em>.
Voir <a href="#2.5.3">2.5.3</a> pour les détails.
</p>

<a name="2.5.2"></a>
<h3>
2.5.2: Comment je mets à jour <em>gcc</em> vers <em>egcs</em>
</h3>

<p>
La façon la plus sure est de mettre à jour avec un snapshot récent, quand il
sera disponible. <strong>Regardez pour un snapshot en premier !</strong>. 
Démarrer le nouveau compilateur à partir de l'ancien doit être en  
<em>dernier recours</em>.
</p>

<p>
Premièrement, il faut remarquer que certaines plateformes n'ont pas été
"bootstrapped" avec succès. A ce jour, les plateformes suivantes doivent 
fonctionner si vous faites attention :
</p>

<ul>
<li><strong>i386</strong>
<li><strong>sparc</strong>
<li><strong>m68k</strong>
<li><strong>alpha</strong>
</ul>

<p>
<strong>mips</strong> et <strong>rs6000</strong> ont des problèmes.
</p>

<p>
Pour tester si votre plateforme peut être "bootstrapped", récupérez et
installez le egcs-snapshot, disponible dans la 
<a href="../../fr/ports.html">ports collection</a>.
Si cela fonctionne, la version dans l'arborescence fonctionnera aussi.
C'est la méthode la plus <em>sure</em> de procéder.
</p>

<p>
Maintenant, avant d'aller plus loin, assurez-vous que votre copie de
<em>binutils</em>, <em>gas</em> et <em>ld</em> sont à jour. Il faut remarquer
qu'il y a deux versions de <em>gas</em> et <em>ld</em> dans l'arborescence.
Sur <strong>i386</strong> et <strong>sparc</strong>, les versions de binutils
ne sont pas utilisées. Vérifiez <tt>/usr/src/gnu/usr.bin/gas</tt> et
<tt>/usr/src/gnu/usr.bin/ld</tt> à la place.
</p>

<p>
Les instructions suivantes se réfèrent au snapshot original de egcs
(egcs-990517). Depuis cette date, un second snapshot (egcs-990608) a été 
importé dans l'arborescence. Si vous avez une vanilla 2.5, il ne sera
pas possible de compiler directement la dernière version. Dans cette 
éventualité, vous devrez faire un "bootstrap" d'une version intermédiaire en
suivant ces instructions.
</p>

<p>
De espie@openbsd.org:
</p>

<blockquote>
<pre>
Today, the compiler changes.

Exit gcc 2.8.1, enter egcs... or more precisely, gcc 2.95 prerelease.

This is probably going to be a rough ride, but I can't work out all
the kinks on every architecture by myself.

I'm going to start importing stuff *now*. There will be a second message
to tech@ once things are settled...

Thanks to everyone who helped me sorting stuff out, most especially
niklas, turan, and millert.

Why the switch
--------------
as most of you already know, egcs is now the *official* compiler supported
by the FSF.  The upcoming july release as been re-christened gcc 2.95.

Just looking at the log messages will show you many improvements:
support for newer processors is better, C++ is more accurately matching
the ANSI/ISO standards, Fortran 77 is more closely integrated.
There are also countless bug-fixes and code generation improvements.

Also the development is more open. There is a cvs tree, there are several
mailing-lists available, and we are cooperating closely with the egcs
team. More precisely, I've been feeding patches back to the egcs team
so that OpenBSD configurations are officially supported.
Also, the development team is highly responsive to bug-reports, and problems
get fixed.

There also is a band-wagon phenomenon: everyone is switching to egcs,
which means lots of code to test the compiler on, and that we can benefit
from related projects.

Why now
-------
egcs-1.1 was unfit for some purposes. Specifically, code size on i386
was larger than gcc 2.8.1, which yielded floppy-disks problems. 
At 2.5 freeze, the only code fit to include was a somewhat unstable
snapshot.  In the interest of stability, after much pondering, egcs was
not put into 2.5.

Right now, the egcs project is going through a release cycle which will
yield egcs 1.2.  Judging from their time schedule, there is ample margin
between egcs 1.2 and the next release of OpenBSD.  Also, we want to get
in now, so that we get a chance to report problems on less frequently 
used architectures, and get everything fixed for 1.2.

egcs `feature freeze' is supposed to occur on may 7th, and the current
snapshot 19990502 looks solid.

What works and what doesn't
---------------------------
egcs runs an i386 OpenBSD system without problems.  m68k works as well,
with a few work-arounds linked to obscure bugs that will get fixed.
sparc seems to be running as well.  There is some linker trouble on some 
other arches that needs to be fixed before our next release.

Right now, constructors across dynamic libraries are not quite ready.

egcs now features a stand-alone cpp which is going to be better than
the current hackish solution we use. This means a few interface changes
and possibly weird warnings.

Keeping gcc 2.8.1 ?
-------------------
due to size constraints, as soon as egcs is imported, gcc is going
to move to cvs Attic.  If you don't want to deal with egcs now, you'll
have to be careful through your cvs updates.
Some Makefiles are bound to change: includes, gnu/usr.bin, and gnu/lib.
xlint and cpp.sh are going to change as well.

How to bootstrap the compiler
-----------------------------
the simplest way is probably to trust the various arch maintainers
and download a snapshot.

If you want to do stuff the hard way, you must first remake proper
obj dirs:
cd /usr/src
make obj

If you run i386, gas must be up-to-date.
If you run sparc, ld must be up-to-date.

then build libiberty:
cd /usr/src/gnu/egcs/libiberty
make -f Makefile.bsd-wrapper clean
make -f Makefile.bsd-wrapper depend
make -f Makefile.bsd-wrapper 
make -f Makefile.bsd-wrapper install

then the C compiler:
cd /usr/src/gnu/egcs/gcc
make -f Makefile.bsd-wrapper clean
make -f Makefile.bsd-wrapper depend
make -f Makefile.bsd-wrapper 
make -f Makefile.bsd-wrapper install

rebuild the C compiler with the new version:
cd /usr/src/gnu/egcs/gcc
make -f Makefile.bsd-wrapper clean
make -f Makefile.bsd-wrapper depend
make -f Makefile.bsd-wrapper 
make -f Makefile.bsd-wrapper install

rebuild the includes
cd /usr/src/include
make includes

build all egcs libraries and install them
cd /usr/src/gnu/egcs
make -f Makefile.bsd-wrapper clean
make -f Makefile.bsd-wrapper depend
make -f Makefile.bsd-wrapper 
make -f Makefile.bsd-wrapper install

install the new cpp driver
cd /usr/src/usr.bin/cpp
make install

then you're all set, and a standard make build should work...
</pre>


<p>
[Remarque de l'auteur : Actuellement, cela ne fonctionne pas. xlint ne se 
compilera pas. Le correctif est simple heureusement. Faire simplement un
<code> make &amp;&amp; make install </code>
dans le répertoire <code>/usr/src/usr.bin/xlint/xlint</code> avant d'essayer 
un <em>make build</em>. Voir <a href="#2.5.2.2">2.5.2.2</a>.]
</p>

<pre>
If it doesn't, you're using an arch that didn't go through make build yet.
The most probably occurrence is an Internal Compiler Error, as known as an
ICE.

First try to see if the ICE will go away with -O1 or -O0. In that case, you
can put a work-around in the Makefile until it's fixed 
(see /usr/src/lib/libm/Makefile for an example of how to put in such
work-arounds for m68k).

Then the error needs to be reported to the egcs-bugs mailing list.

At a minimum, you must run the source through the same compiler invocation,
with an addition of -v -save-temps to the options.

-v yields the precise sequence of commands invoked by gcc. -save-temps
will give you a pre-processed C file (.i) or C++ (.ii) that the egcs people
can make sense of... you can't ask them to run OpenBSD on their boxes.

If you have more time, you can try to trim down the pre-processed C file to
the bare minimum that triggers the bug. Dichotomy works nicely.
</pre>
</blockquote>

<p>
Si vous avez suivi cette procédure et que tout fonctionne, félicitations.
Sinon, regardez les sections suivantes pour avis. Les problèmes non affichés
ici doivent être postés sur tech@openbsd.org.
</p>

<a name="2.5.2.1"></a>
<h5>
2.5.2.1 - <tt>i386</tt> et <tt>sparc</tt> ne sont plus 
<tt>#define</tt>
</h5>

<p>
c'est vrai. <em>egcs</em> utilise <tt>__i386__</tt> et
<tt>__sparc__</tt>. Si vous devez compiler du code qui dépend des anciens
defines, ajoutez un <tt>-Dsparc</tt> ou <tt>-Di386</tt> 
dans les emplacements appropriés de votre Makefile.
</p>

<a name="2.5.2.2"></a>
<h5>
2.5.2.2 - La compilation s'arrête sur xlint
</h5>

<p>
C'est du à une différence sémantique dans. Le contournement est simple,
et similaire à la résolution de <em>cap_mkdb</em> décrite dans <a href="#2.4.2">2.4.2</a>.
</p>

<p>
Faire un :
</p>

<pre>
# cd /usr/src/usr.bin/xlint/xlint
# make &amp;&amp; make install
</pre>

<p>
maintenant refaire un make, et la compilation continue.
</p>

<a name="2.5.2.3"></a>
<h5>
2.5.2.3 - Core Dump sur <tt>uthread_autoinit.c</tt>
</h5>

<p>
Vous êtes victime d'un bogue du linker. Voici le message l'expliquant :
</p>

<pre>
From: Marc Espie &lt;Marc.Espie@liafa.jussieu.fr&gt;
Subject: egcs core-dumping on uthread_autoinit.c

If this happens to you, this is a known linker problem... the cc1 you have
was linked in a weird way.

Initially, I made cc1 link against static /usr/lib/libiberty.a to avoid this
problem, but this was cutting things too close, and the bug reappeared,
probably thanks to unrelated changes in libc or elsewhere...

The tree has been patched with a work-around in

src/gnu/egcs/f/lang-options.h

make sure you have the kludged version of that file (at least rev 1.2),
recompile and reinstall cc1, the problem should go away.

What's going on is that the 386 linker gets something wrong because of
the huge strings array in toplev.c, and something gets mislinked, so
that
void f(void) __attribute((constructor)) {}
kills cc1.

As a work-around, I've killed Fortran options help texts, until someone finds
where the linker errs.
</pre>

<a name="2.5.2.4"></a>
<h5>
2.5.2.4 - <em>egcs</em> semble plus lent que <em>gcc</em>
</h5>

<p>
Il l'est, mais il y a une raison. <em>egcs</em> fait plus de passes 
d'optimisation. Les alignements de données et d'autres fonctionnalités seront
meilleures avec le code généré par <em>egcs</em>.
</p>

<a name="2.5.2.5"></a>
<h5>
2.5.2.5 - <em>egcs</em> génère du code plus gros que <em>gcc</em>
</h5>

<p>
Oui c'est le cas. C'est visible spécialement avec l'ancienne option de gcc
<tt>-O2</tt>. <em>egcs</em> a introduit une nouvelle option, <tt>-Os</tt> 
qui optimise la taille.  C'est assez comparable avec l'ancienne option
<tt>-O2</tt> .
</p>

<a name="2.5.2.6"></a>
<h5>
2.5.2.6 - Après l'installation de <em>egcs</em> Il me reste peu d'espace disque
</h5>

<p>
<em>egcs</em> s'installe dans un sous-répertoire différent que gcc 2.8.1. Vous 
pouvez supprimer <em>gcc</em> des que egcs fonctionne correctement.
</p>

<p>
Sur une remarque liée, les changements dans perl mentionnés dans 
<a href="#2.5.1">2.5.1</a> signifie que vous pouvez supprimer le répertoire
<tt>/usr/lib/perl5</tt>. Le nouvel emplacement pour ces données est 
<tt>/usr/libdata/perl5</tt>.
</p>

<a name="2.5.2.7"></a>
<h5>
2.5.2.7 - Ma compilation s'arrête sur libcurses
</h5>

<p>
<em>libcurses</em> est maintenant relié à la dernière version de <em>cpp</em>.
Récupérez la dernière version, recompilez <em>cpp</em> et continuez. Donc :
</p>
<pre>
# cd /usr/src/usr.bin/cpp &amp;&amp; make install
</pre>

<p>Et réessayez le make build.</p>

<a name="2.5.2.8"></a>
<h5>
2.5.2.8 - Je n'arrive pas à faire un make obj
</h5>

<p>
Si votre <em>make obj</em> s'arrête, citant des erreurs dans le Makefile, vos
includes makefile sont obsolètes. Par exemple :
</p>

<pre>
===&gt; lib/libkvm
"Makefile", line 30: Malformed conditional ((${UVM} == "yes"))
"Makefile", line 30: Missing dependency operator
"Makefile", line 32: if-less endif
"Makefile", line 32: Need an operator
Fatal errors encountered -- cannot continue

</pre>

<p>
Cela peut-être résolu en recompilant les includes makefile. Faire un :
</p>

<pre>
cd /usr/src/share/mk &amp;&amp; make install
</pre>

<p>
Et réessayez de compiler.
</p>

<a name="2.5.3"></a>
<h3>
2.5.3: Mon <em>make build</em> meurt avec des erreurs <em>unimplemented syscall</em>.
</h3>

<p><strong>Réponse courte :</strong> </p>

<p>
La structure du noyau <tt>statfs</tt> a été modifiée. Vous devez recompiler le 
noyau avant de faire un <em>make build</em>.
</p>

<p><strong>Réponse longue :</strong> </p>

<p>
La structure du noyau <tt>statfs</tt> a été modifiée. 
La nouvelle <tt>struct statfs</tt> possède les fonctionnalités suivantes :
</p>

<ul>
<li> Possède un champ flags <tt>u_int32_t</tt> --maintenant softdep peut avoir
un vrai flag.
</li>

<li> Utilisation de <tt>u_int32_t</tt> à la place de longs (mieux sur alpha).  
Remarque : la page man utilisée ment sur les champs invalid/unused à -1.  
SunOS le fait mais notre code ne l'a jamais fait.
</li>

<li> Suppression complète de <tt>f_type</tt>. Il n'a pas été utilisé depuis
NetBSD 0.9, et l'avoir ici à 0 ne sert à rien. Il est possible que du vieux
code ne compilera plus, mais c'est mieux que de n'avoir aucune information.
</li>

<li> Ajout d'une union <tt>mount_info</tt> qui contient la struct 
<tt>FSTYPE_args</tt>.  Cela signifie que <em>mount</em> peut maintenant vous 
donner toutes les options d'un système de fichier monté. C'est parfait pour 
NFS spécialement.
</li>
</ul>

<p>
Autres changements :
</p>

<ul>
<li> L'émulation linux statfs ne fait pas de conversion entre les noms fs BSD 
et les numéros linux <tt>f_type</tt>.  Maintenant ça le fait, depuis que les 
numéros BSD <tt>f_type</tt> sont inutiles dans les apps linux (et ont été 
supprimés).
</li>

<li> La struct statfs de FreeBSD est différente de la notre (aussi bien
l'ancienne que la nouvelle) et cela nécessite une conversion. Avant, les
appels système de OpenBSD étaient utilisés sans réels translation.
</li>

<li> <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount&amp;sektion=8">mount(8)</a>
affichera maintenant des informations supplémentaires quand il sera appelé sans
arguments. Cependant, pour voir <em>tout</em> vous devrez utiliser l'option -v (verbose). 
</li>
</ul>

<a name="2.5.4"></a>
<h3>
2.5.4: Lien vers le nouveau répertoire 2.6.
</h3>

<p>
Quand vous mettrez à jour en 2.6 vous devrez créer un lien simple pour gcc.
</p>

<pre>
   cd /usr/lib/gcc-lib
   ln -s ${ARCH}-unknown-openbsd2.5 ${ARCH}-unknown-openbsd2.6
</pre>

<a name="2.5.5"></a>
<h3>
2.5.5: Après un <strong>(U)</strong>pgrade, l'extraction de <em>base26.tar.gz</em>
s'arrête avec un message :
</h3>

<p>
<em>tar: Unable to remove directory ./usr/include/machine &lt;Directory
not empty&gt;
</em>
</p>

<p>En 2.5, <tt>/usr/include/machine</tt> était un répertoire, et
<tt>/usr/include/i386</tt> un lien vers lui. Eb 2.6, cette situation est
inversée.
</p>

<p>
Pour corriger le problème, sortez sur le shell, supprimez le répertoire
<tt>/usr/include/machine</tt> et réessayez la mise à jour.
</p>


<a name="2.4"></a>
<h2>Mettre à jour de la 2.4</h2>

<a name="2.4.1"></a>
<h3>2.4.1: Changements dans les pages Man</h3>
<p>
Plusieurs pages de man ont été déplacées de la section 1 vers la dernière
section. Malheureusement, si d'anciennes pages de man restent dans la section 
1, des utilisateurs ne verront jamais les dernières versions de ces pages.
</p>

<p>
Les pages suivantes doivent être supprimées :
</p>
<pre>
/usr/share/man/cat1/ipf.0
/usr/share/man/cat1/ipnat.0
/usr/share/man/cat1/ipsecadm.0
</pre>

<a name="2.4.2"></a>
<h3>2.4.2: <em>cap_mkdb</em> syntax changed</h3>

<p>
<strong>Symptôme :</strong>
</p>

<p>
Un <em>make build</em> donne une erreur comme celle-ci :
</p>

<pre>
cap_mkdb -i -f terminfo terminfo.src
cap_mkdb: illegal option -- i
usage: cap_mkdb [-v] [-f outfile] file1 [file2 ...]
*** Error code 1
</pre>

<p>
<strong>Correctif :</strong>
</p>

<p>
La syntaxe pour invoquer <em>cap_mkdb</em> a été légèrement modifiée.
Avant de faire un <em>make build</em>, recompilez cap_mkdb à partir des
dernières sources :
</p>

<pre>
# cd /usr/src/usr.bin/cap_mkdb
# make clean &amp;&amp; make &amp;&amp; make install
</pre>

<p>
Le make build doit maintenant aller jusqu'au bout.
</p>


<a name="2.4.3"></a>
<h3>2.4.3: Snake</h3>
<p>
Vous devez supprimer le contenu du répertoire obj avant de mettre à jour 
<code>/usr/src/games/snake</code>.
</p>
 
<a name="2.3"></a>
<h2>Mettre à jour de la 2.3</h2>

<a name="2.3.1"></a>
<h3>
2.3.1: Nouvel utilisateur : <em>named</em>
</h3>

<p>
Après la 2.3, le daemon DNS <em>named</em> a été déplacé dans un prison chroot.
Pour obtenir ce résultat, vous devez créer cet utilisateur pour être sûr que
tous les répertoires seront créés lors du processus de compilation.
</p>

<p>
Ajoutez l'entrée suivante à /etc/passwd en utilisant 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a> :
</p>

<pre>
named:*:70:70::0:0:BIND Daemon:/var/named:/sbin/nologin
</pre>

<p>
Ajoutez le groupe suivant à /etc/group :
</p>

<pre>
named:*:70:
</pre>


<a name="2.3.2"></a>
<h3>
2.3.2: J'essaye de compiler, mais cela s'arrête sur la compilation de 
<em>ssleay</em>.
</h3>

<p>
Vous avez oublié l'entrée de l'utilisateur <em>named</em> dans votre fichier 
password.
</p>

<p>
<strong>Réponse courte :</strong>
</p>

<p>
Créez l'utilisateur avant la compilation.
</p>

<p>
<strong>Réponse longue :</strong>
</p>

<p>
L'utilisateur <em>named</em> est indispensable pour avoir des permissions
correctes. Si l'utilisateur est manquant, une partie du processus de 
compilation s'arrête.
Si vous capturez la compilation dans un fichier (avec un <em>make build
&amp;&gt;/tmp/build.log</em> par exemple) vous remarquerez le message suivant :
</p>

<pre>
(cd /usr/src/etc &amp;&amp; make DESTDIR=/ distrib-dirs)
install -d -o root -g wheel -m 755 /
mtree -def mtree/4.4BSD.dist -p // -u

mtree: unknown user named
mtree: failed at line 1632 of the specification
*** Error code 1 (ignored)
</pre>

<p>
Malheureusement pour nous, la compilation continue sur son chemin, ignorant
totalement cette erreur.
</p>

<p>
Si l'utilisateur <em>named</em> existe, mtree fonctionnera normalement :
</p>

<pre>
missing: ./var/named (created)
missing: ./var/named/dev (created)
missing: ./var/named/etc (created)
missing: ./etc/afs (created)
missing: ./etc/ssl (created)
missing: ./etc/ssl/private (created)
missing: ./usr/obj (not created: File exists)
missing: ./usr/share/doc/html (created)
missing: ./usr/share/doc/html/lynx_help (created)
missing: ./usr/share/doc/html/lynx_help/keystrokes (created)
missing: ./usr/share/doc/usd/13.viref (created)
missing: ./usr/share/man/cat4/powerpc (created)
missing: ./usr/share/man/man4/alpha (created)
missing: ./usr/share/man/man4/pmax (created)
missing: ./usr/share/man/man4/powerpc (created)
missing: ./usr/share/tmac/mdoc (created)
missing: ./var/www/htdocs/manual/vhosts (created)
missing: ./usr/include/ssl (created)
</pre>

<p>
La raison de cet échec, ici, est que le répertoire <em>/usr/include/ssl</em>
n'est jamais créé. Sans les fichiers d'en-têtes, la compilation de 
<em>ssleay</em> sera un échec.
</p>

<p>
<strong>Correctif :</strong>
</p>

<p>
Créez le groupe et utilisateur <em>named</em>. Supprimez <em>/usr/include/ssl</em>,
<em>/var/named</em> et tous les répertoires de la liste ci-dessus qui ont été
créés par erreur comme des fichiers normaux par le <em>make build</em>.
</p>


<a name="2.3.3"></a>
<h3>
2.3.3: J'essaye de compiler, mais cela s'arrête quand il essaye de faire 
quelque chose sur PowerPC.
</h3>

<p>
Votre arborescence de répertoire est incomplète. Plus spécialement, le 
répertoire <tt>/usr/share/man/cat4/powerpc</tt> est manquant. 
</p>

<p>
<strong>Correctif rapide :</strong>
</p>

<p>
Créez le répertoire et compilez.
</p>

<p>
<strong>Correctif complet :</strong>
</p>

<p>
Créez l'arborescence complète des répertoires. Faire un :
</p>

<pre>
# cd /usr/src/etc &amp;&amp; make DESTDIR=/ distrib-dirs
</pre>

<p>
Vous pourrez voir s'afficher :
</p>

<pre>
install -d -o root -g wheel -m 755 /
mtree -def mtree/4.4BSD.dist -p // -u

missing: ./var/named (created)
missing: ./var/named/dev (created)
missing: ./var/named/etc (created)
missing: ./etc/afs (created)
missing: ./etc/ssl (created)
missing: ./etc/ssl/private (created)
missing: ./usr/obj (not created: File exists)
missing: ./usr/share/doc/html (created)
missing: ./usr/share/doc/html/lynx_help (created)
missing: ./usr/share/doc/html/lynx_help/keystrokes (created)
missing: ./usr/share/doc/usd/13.viref (created)
missing: ./usr/share/man/cat4/powerpc (created)
missing: ./usr/share/man/man4/alpha (created)
missing: ./usr/share/man/man4/pmax (created)
missing: ./usr/share/man/man4/powerpc (created)
missing: ./usr/share/tmac/mdoc (created)
missing: ./var/www/htdocs/manual/vhosts (created)
missing: ./usr/include/ssl (created)
</pre>

<p>
Il faut remarquer que /usr/share/man/cat4/powerpc est l'un des répertoires
créés lors de ce processus.
</p>



<p>
--
</p>
<address>
<p>
<!--
Originally [OpenBSD: upgrade-old.html,v 1.27 ]<br>
$Translation: upgrade-old.html,v 1.6 2009/10/26 08:03:47 benoit Exp $<br>
-->
$OpenBSD: upgrade-old.html,v 1.4 2009/10/26 20:27:01 ajacoutot Exp $
<br />
Copyright &copy; 1998-2008, OpenBSD.
<br />
</address>

</body>
</html>

