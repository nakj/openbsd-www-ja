<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>5 - Construire le Système à partir des
Sources</title>
<link rev= "made" href= "mailto:www@openbsd.org">
<meta name= "resource-type" content= "document">
<meta name= "description"   content= "the OpenBSD FAQ page">
<meta name= "keywords"      content= "openbsd,faq">
<meta name= "distribution"  content= "global">
<meta name= "copyright"     content= "This document copyright 1998-2007 by OpenBSD.">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
</head>

<body bgcolor= "#ffffff" text= "#000000">
<!-- Passes validator.w3.org.  Please keep it this way -->

<a href="../../fr/index.html">
<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif" border="0">    
</a>
<p>
<font color= "#0000e0">
<a href= "index.html">[Index de La FAQ]</a>
<a href= "faq4.html">[Section 4 - Guide d'Installation]</a>
<a href= "faq6.html">[Section 6 - Mise en place du réseau]</a>
</font>

<h1><font color="#e00000">5 - Construire le Système à
    partir des Sources</font></h1>
<!-- UNCOMMENT ONLY WHEN THE FILE IS OUT OF SYNC

<hr>
<p>
<b><font color="#e00000">Remarque Importante :</font></b> Le contenu de
   ce fichier est obsolète. Consultez la version anglaise
   <a href="../faq5.html">ici</a> pour des informations à jour.

<p>
Si vous souhaitez contribuer à l'effort de traduction,
prière de consulter
<a href="../../fr/translation.html">la page de traduction</a>.

-->
<hr>

<p>
<h3>Table des matières</h3>
<ul>
<li><a href="#Flavors">5.1 - Les Saveurs ("Flavors") OpenBSD</a>
<li><a href="#WhySrc">5.2 - Pourquoi devrais-je compiler mon système
 depuis les sources ?</a>
<li><a href="#Bld">5.3 - Compilation d'OpenBSD depuis les sources</a>
<ul>
  <li><a href="#BldOverview">5.3.1 - Aperçu du processus de compilation</a>
  <li><a href="#BldBinary">5.3.2 - Installer ou mettre à niveau depuis
   les binaires les plus récents</a>
  <li><a href="#BldGetSrc">5.3.3 - Téléchargement des sources
   appropriées</a>
  <li><a href="#BldKernel">5.3.4 - Compilation du noyau</a>
  <li><a href="#BldUserland">5.3.5 - Compilation du "userland"</a>
</ul>
<li><a href="#Release">5.4 - Compilation d'une Révision</a>
<li><a href="#Xbld">5.5 - Compilation de X</a>
<li><a href="#Why">5.6 - Pourquoi aurais-je besoin d'un noyau
 sur mesure ?</a>
<li><a href="#Options">5.7 - Options de configuration du noyau</a>
<li><a href="#BootConfig">5.8 - Configuration au démarrage</a>
<li><a href="#config">5.9 - Utilisation de config(8) pour changer le
 binaire du noyau</a>
<li><a href="#VerboseBoot">5.10 - Obtention d'une sortie plus verbeuse
 lors du démarrage</a>
<li><a href="#buildprobs">5.11 - Problèmes courants, astuces et
 questions lors de la compilation et de la construction</a>
   <ul>
   <li><a href="#sig11">5.11.1 - La compilation s'est arrêtée avec une
    erreur "Signal 11"</a>
   <li><a href="#snake">5.11.2 - "make build" échoue en générant un
    message "cannot open output file snake: is a directory"</a>
   <li><a href="#ProbIPv6">5.11.3 - Mon système sans IPv6 ne fonctionne
    pas !</a>
   <li><a href="#ProbObj">5.11.4 - Oops ! J'ai oublié de créer le
    répertoire <tt>/usr/obj</tt> avant de commencer !</a>
   <li><a href="#ProbObjPt">5.11.5 - Placer <tt>/usr/obj</tt> sur sa
    propre partition</a>
   <li><a href="#ProbSKIPDIR">5.11.6 - Comment ne pas compiler certaines
    parties de l'arbre ?</a>
   <li><a href="#ProbMoreInfo">5.11.7 - Où puis-je avoir plus
    d'informations sur le processus de compilation ?</a>
   <li><a href="#NoSnaps">5.11.8 - Je ne vois aucun snapshot sur le site
    FTP. Où sont t'ils passés ?</a>
   <li><a href="#NewCompiler">5.11.9 - Comment puis-je amorcer sur une
    nouvelle version du compilateur (<i>gcc</i>)?</a>
   <li><a href="#UpdateEtc">5.11.10 - Quel est le meilleur moyen de
    mettre à jour <tt>/etc</tt>, <tt>/var</tt>, et
   <tt>/dev</tt> ?</a>
   <li><a href="#Hierarchy">5.11.11 - Y a t'il un moyen facile de faire
    des changements sur tous les fichiers de la hiérarchie ?</a>
   <li><a href="#ProbXComp">5.11.12 - Puis-je cross-compiler ?
	Pourquoi pas ?</a>
   </ul>
</ul>
<hr>
<br>


<a name="Flavors"></a>
<h2>5.1 - Les Saveurs ("Flavors") OpenBSD</h2>
<!-- XXXversion - revise doodle -->
Il existe trois "saveurs" OpenBSD :
<ul>
<li><b>-release:</b> La version d'OpenBSD livrée tous les six mois sur
    CD.
<li><b>-stable:</b> "release", plus les correctifs considérés comme
    critiques pour la sécurité et la fiabilité.
<li><b>-current:</b> La version courante pour laquelle le développement
    est réalisé, et qui deviendra la prochaine "release".
</ul>

Schématiquement, le développement de ces versions ressemble à ceci :

<blockquote>
<pre>
       ,------o-----------o----X                    4.3 Stable
       |      .           .
       |      .    ,------o---------o----X          4.4 Stable
       |      .    |      .         .
       |      .    |      .    ,----o----------o--&gt; 4.5 Stable
       |      .    |      .    |    .          .
       |      .    |      .    |    .    ,-----o--&gt; 4.6 Stable
       |      .    |      .    |    .    |     .
       |      .    |      .    |    .    |     .
 --&gt;4.3Rel-----&gt;4.4Rel-----&gt;4.5Rel-----&gt;4.6Rel----&gt; Current

          Time ---&gt;
</pre>
</blockquote>

<p>
<i>-Current:</i> La version courante pour laquelle le développement
est réalisé, et qui deviendra la prochaine <i>-release</i> d'OpenBSD.
Tous les six mois, lorsqu'une version d'OpenBSD est révisée,
<i>-current</i> est tagguée, et devient <i>-release</i> : un point gelé
dans l'histoire de l'arbre des sources.
Chaque <i>-release</i> demeure inchangée; c'est pour cela qu'on la
trouve sur les <a href="../../orders.html">CDs</a> et <a
href="../../fr/ftp.html">serveurs FTP</a>.

<p>
<i>-Stable</i> est basée sur <i>-release</i>, et est une branche du
chemin de développement principal d'OpenBSD. Quand des corrections très
importantes sont faites sur <i>-current</i>, elles sont "backportées"
(intégrées) aux branches <i>-stable</i>; à cause de cela, <i>-stable</i> est
aussi connue sous le nom de <i>branche patch</i>.
Dans l'illustration ci-dessus, la ligne verticale en pointillés symbolise
les corrections de bogues incorporées aux branches <i>-stable</i>. Vous
remarquerez aussi dans l'exemple ci-dessus que la branche
<i>4.3-stable</i> a été supprimée à la sortie de <i>4.5-release</i>, et
que la branche <i>4.4-stable</i> a été supprimée à la sortie de
<i>4.6-release</i> -- les anciennes versions sont typiquement supportées
durant deux "releases" au maximum. Le support d'anciennes versions
nécessite des ressources et du temps, et alors que nous pourrions
vouloir plutôt fournir un support continu pour les anciennes versions,
nous préférerons nous concentrer sur les nouvelles fonctionnalités. La
branche <i>-stable</i> est, par conception, très facile à construire à
partir de <i>-release</i> de la même version (c'est à dire en allant de
<i>4.6-release</i> vers <i>4.6-stable</i>).

<p>
La branche <i>-stable</i> est <i>-release</i> à laquelle on a ajouté les
correctifs listés dans la <a href="../../fr/errata.html">page des
errata</a>.
Habituellement, le fonctionnement de <i>-stable</i> est le même que
celui de <i>-release</i> sur laquelle elle est basée. 
Si les <a href="http://www.openbsd.org/cgi-bin/man.cgi">pages de
manuel</a> doivent être modifiées, il est très probable que ces
modifications ne fassent pas partie de <i>-stable</i>. En d'autres
termes, le support de nouveaux périphériques NE sera pas ajouté à <i>-
stable</i>.

<p>
Il est utile de préciser que le nom "<i>-stable</i>" ne signifie pas
pour autant que <i>-current</i> est instable.
<i>-current</i> change et évolue, alors que <i>-stable</i> ne change que
très peu (tant aux niveau des APIs qu'au niveau opérationnel), et vous
n'aurez pas à apprendre à nouveau votre système, à changer des
fichiers de configuration ou à ajouter de nouvelles applications à votre
système.

<p>
En fait, notre préoccupation étant de faire continuellement évoluer
OpenBSD, le but avoue est de rendre <i>-current</i> plus fiable, 
plus securise, et bien sur offrant de meilleurs outils que <i>-stable</i>.
Tout simplement, la "meilleure" version d'OpenBSD est <i>-current</i>.

<p>
La plupart des utilisateurs devraient utiliser <i>-stable</i> ou
<i>-release</i>. Cela dit, plusieurs personnes utilisent <i>-current</i>
sur des systèmes en production, et il est important que les
personnes fassent cela pour identifier des bogues et tester les
nouvelles fonctionnalités. Cependant, si vous ne savez pas comment
décrire, diagnostiquer et gérer proprement un problème, ne vous dites
pas (ou à quelqu'un d'autre) que vous être entrain d'"aider le projet"
en utilisant <i>-current</i>. "Ça ne marche pas !" n'est pas un <a
href="../../fr/report.html#bugtypes">rapport de bogue utile</a>. "Les
changements récents dans le pilote pciide ont brisé la compatibilité avec
mon interface IDE basée sur Slugchip, ci-joint le dmesg d'un système
fonctionnel et un système ne fonctionnant pas..." peut être un rapport
utile.

<p>
Des fois, les utilisateurs "normaux" veulent disposer des derniers
développements et utiliser <i>-current</i>. La raison la plus commune de
faire cela est que l'utilisateur possède un périphérique qui n'est pas
supporté par <i>-release</i> (et donc, par <i>-stable</i> non plus), ou
qu'il souhaite utiliser une nouvelle fonctionnalité de <i>-current</i>.
Dans ce cas, soit l'utilisateur utilise <i>-current</i> soit il n'utilise
pas le périphérique, et utiliser <i>-current</i> est peut-être l'option la
plus logique. Cependant, il ne faut pas espérer que les développeurs
vous tiennent la main.

<h3>Snapshots</h3>
Entre les versions formelles d'OpenBSD, des <i>snapshots</i> sont mis à
disposition sur les <a href="../../fr/ftp.html">sites FTP </a>. Comme le
nom l'indique, ce sont des images du code dans l'arborescence à
l'instant où le créateur de l'image a pris une copie du code pour une
plate-forme donnée. Il est à noter que, pour certaines plates-formes, il
peut s'écouler des jours entiers avant que l'image ne soit complètement
construite et mise à disposition. Aucune garantie n'est donnée quant au
bon fonctionnement ou à la possibilité d'installer des snapshots.
Souvent, une modification qui a besoin d'être testée peut enclencher le
processus de création des snapshots. Quelques plates-formes ont des
snapshots construits pratiquement tous les jours, d'autres en ont
beaucoup moins fréquemment. Si vous souhaitez utiliser <i>-current</i>,
un snapshot récent est tout ce dont vous aurez besoin, et mettre à jour
un snapshot est un point de départ nécessaire avant de tenter de
compiler <i>-current</i> depuis les sources.

<p>
Parfois, on demande s'il y a un moyen d'obtenir une copie exacte du code
qui a servi à construire un snapshot. La réponse est non. Primo, il n'y
a aucun intérêt. Secundo, les snapshots sont construits selon le souhait
des développeurs, lorsque le planning le permet, et lorsque des
ressources sont disponibles. Sur les plates-formes rapides, il est
possible de créer plusieurs snapshots en un jour. Sur les plates-formes
lentes, la création d'un snapshot peut durer une semaine ou plus.
Fournir des balises ou des marques dans l'arborescence des sources pour
chaque snapshot peut s'avérer peu pratique.
Tertio, les snapshots contiennent souvent du code expérimental
non encore soumis dans l'arborescence

<h3>Mise à jour majeure vs. mise à jour mineure</h3>
Il existe deux types de mises à jour sous OpenBSD : des mises à jour
majeures et des mises à jour mineures. Il existe des différences
notables entre ces deux types de mises à jour que nous allons tâcher
d'expliquer ci-après.

<p>
Une <b>mise à jour majeure</b> consiste à installer une nouvelle version
d'OpenBSD, qui inclut généralement de nouvelles fonctionnalités.
Par exemple, le passage d'une version 4.5 à une version 4.6 ou la mise à
jour d'un snapshot du 12 juin avec un snapshot du 24 juin sont
considérés comme mises à jour majeures.
Lors d'une mise à jour majeure, vous devez typiquement consulter <a
href="current.html">Suivre la version de développement "-current"</a> ou
le <a href="../upgrade46.html">Guide de Mise à niveau d'OpenBSD</a> (lors
du passage d'une version à une plus récente) pour effectuer les
modifications nécessaires au bon fonctionnement de la nouvelle version
d'OpenBSD.

<br>
Une <b>mise à jour mineure</b> consiste à appliquer des correctifs à un
système afin d'améliorer son fonctionnement SANS modification des
fonctionnalités de base ou de la compatibilité binaire.
Ceci est généralement effectué en suivant le processus
d'<a href="faq10.html#Patches">Application des correctifs sous
OpenBSD</a> ou en suivant la procédure décrite dans le document intitulé
<a href="../../fr/stable.html">Maintenir son système à niveau par
rapport à -stable</a>.
Quand vous effectuez une mise à jour mineure, votre système passe d'un
état <i>-release</i> à un état <i>-stable</i> (ou <i>-release</i>
corrigé) de la même version. Par exemple, de 4.6-release à 4.6-stable.
Vous pouvez ensuite effectuer une nouvelle mise à jour mineure vers un
<i>-stable</i> plus récent de la même version.
Le processus de mise à jour est généralement sans conséquence étant
donné que les fichiers <tt>/etc</tt> ou d'autres configurations système
n'ont pas besoin d'être modifiés.

<p>
Ainsi, vous pouvez installer un système (tel que 4.4-release) à partir
du CD, puis vous pourrez le mettre à jour un certain nombre de fois en
4.4-stable et par la suite effectuer une mise à jour majeure vers
4.5-release et ainsi de suite.

<h3>Garder les Composants Synchronisés</h3>
Il est important de comprendre qu'OpenBSD est un Système d'Exploitation,
et il faut le prendre en tant que tel et non pas comme un noyau entouré
d'un ensemble d'outils. Vous devez vous assurer que votre noyau, le
"userland" (les utilitaires et fichiers complétant le noyau) et
l'arborescence des <a href="faq15.html#Ports"><tt>ports</tt></a> sont
synchronisés, autrement des choses désagréables peuvent arriver. Dit
autrement (vu que les gens continuent à commettre les mêmes erreurs),
vous ne pouvez pas utiliser des <tt>ports</tt> tout neufs sur un système
datant d'il y a un mois, ou reconstruire un noyau à partir de
<i>-current</i> et espérer qu'il fonctionne avec un "userland"
<i>-release</i>. Oui, cela veut dire que vous aurez besoin d'effectuer
une mise à jour majeure de votre système si vous voulez utiliser un
nouveau programme qui a été rajouté aujourd'hui à l'arborescence des
ports. OpenBSD n'a malheureusement que des ressources limitées.

<p>
Il faut aussi comprendre que le processus de mise à jour majeure est
uniquement supporté <b>dans une seule direction uniquement : de l'ancien
au nouveau</b>, et de <i>-stable</i> vers <i>-current</i>. Vous ne
pouvez pas utiliser <i>4.6-current</i> (ou un snapshot), puis décider
que c'est trop dangereux, et revenir vers <i>4.6-stable</i>. Vous ne
pouvez compter que sur vous-même si vous choisissez un autre chemin que
celui, supporté, consistant à réinstaller votre système proprement. Vous
ne devez espérer aucune aide de la part de l'équipe de développement
OpenBSD.

<p>
Oui, cela veut dire que vous devez prendre le temps de réfléchir avant
d'utiliser <i>-current</i>.

<a name="WhySrc"></a>
<h2>5.2 - Pourquoi devrais-je compiler mon système
    depuis les sources ?</h2>
Actuellement, il y a de fortes chances pour que vous n'en ayez pas
besoin.

<p>
Voici quelques raisons pour NE PAS compiler votre systèmes depuis les
sources :
<ul>
<li>La compilation de votre propre système à des fins de mise à niveau
n'est pas supportée.
<li>Vous n'obtiendrez pas de meilleurs performances en compilant votre
système.
<li>Le changement des options de compilation est plus enclin à briser
votre système qu'à l'améliorer.
</ul>

Voici quelques raisons d'avoir besoin de compiler depuis les sources :
<ul>
<li>Tester ou développer de nouvelles fonctionnalités.
<li>La compilation du système est éprouvante pour l'ordinateur, ceci
peut être un bon moyen de s'assurer du bon fonctionnement de ce dernier.
<li>Vous souhaitez suivre la branche 
<a href="../../fr/stable.html">stable</a>.
<li>Vous souhaitez construire un système OpenBSD hautement personnalisé
pour des utilisations spécifiques.
</ul>

<p>
L'équipe OpenBSD réalise fréquemment des instantanés basés sur le code de
<i>-current</i> pour toutes les plates-formes.
Dans la plupart des cas, cela vous suffira pour utiliser <i>-current</i>.

<p>
La raison la plus courante de compiler depuis les sources est de suivre
la branche <i>-stable</i>, pour laquelle la compilation depuis les
sources est la seule issue supportée.

<a name="Bld"></a>
<h2>5.3 - Compilation d'OpenBSD depuis les sources</h2>

<a name="BldOverview"></a>
<h3>5.3.1 - Aperçu du processus de compilation</h3>

La compilation d'un système OpenBSD depuis les sources implique un
certain nombre d'étapes :
<ul>
<li><a href="#BldBinary">5.3.2 - Installer ou mettre à niveau depuis les
binaires les plus récents</a>
<li><a href="#BldGetSrc">5.3.3 - Téléchargement des sources appropriées</a>
<li><a href="#BldKernel">5.3.4 - Compilation du noyau</a>
<li><a href="#BldUserland">Compilation du "userland" ("make build").</a>
</ul>

Il y a deux étapes supplémentaires que certains utilisateurs pourraient
vouloir réaliser, ceci dépend de la raison de la compilation et de la
présence ou non de X :
<ul>
<li><a href="#Release">Compilation d'une Release.</a>
<li><a href="#Xbld">Compilation de X.</a>
</ul>


<a name="BldBinary"></a>
<h3>5.3.2 - Installer ou mettre à niveau depuis les binaires les plus
    récents</h3>

La première étape dans la compilation depuis les sources est de
s'assurer d'avoir le binaire le plus récent installé.

Utilisez ce tableau afin de savoir ou vous en êtes, ou vous voulez
aller, et avec quel binaire commencer :

<p>
<table border="1" style="empty-cells: show;">
<tr>
  <td><b>Vous êtes au</b></td> <td><b>But</b></td>
  <td><b>Mise à niveau binaire vers</b></td> <td><b>ensuite ...</b></td>
</tr>
<tr>
  <td> Ancienne -release </td> <td> Nouvelle release </td> <td>
       Dernière release
</td>
  <td> C'est fait ! </td>
</tr>
<tr>
  <td> -release </td> <td> -stable </td> <td> Dernière release </td>
  <td>Récupérer &amp; compiler <i>-stable</i></td>
</tr>
<tr>
  <td> Ancienne -stable</td> <td> -stable </td> <td> Nouvelle release </td>
  <td>Récupérer &amp; compiler <i>-stable</i></td>
</tr>
<tr>
  <td> -release </td> <td> -current </td> <td> Dernier instantané </td>
  <td> Récupérer (optionnel) &amp; compiler <i>-current</i>
</tr>
<tr>
  <td> Ancienne -current </td> <td> -current </td> <td> Dernier
        instantané
</td>
  <td> Récupérer (optionnel) &amp; compiler <i>-current</i>
</tr>
</table>

<p>
Il est recommandé d'installer le binaire via l'option "Upgrade" du média
d'installation.
Si ce n'est pas possible, vous pouvez aussi décompacter les binaires
comme décris <a href="../upgrade46.html">ici</a>.
Vous pouvez faire le processus complet de mise à niveau sans soucis,
incluant la création d'utilisateurs ou d'autres changements de
répertoires de <tt>/etc</tt>.


<a name="BldGetSrc"></a>
<h3>5.3.3 - Téléchargement des sources appropriées</h3>
Le source d'OpenBSD est géré en utilisant le système de contrôle de
versions
<a href="http://ximbiot.com/cvs/cvshome/">CVS</a>, et <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=cvs&amp;sektion=1">cvs(1)</a>
est utilisé pour récupérer les sources désirées sur votre machine
locale, à des fins de compilation.
Ceci peut être réalisé en utilisant le serveur <a
href="../../fr/anoncvs.html">AnonCVS</a> (une machine proposant une copie
du dépôt CVS utilisé par le projet OpenBSD) et ce publiquement, ou
depuis une archive locale que vous maintenez en utilisant les programmes
<a href="../../fr/cvsup.html">CVSup</a>, ou
<a href="../../fr/cvsync.html">CVSync</a>, disponibles dans les
<a href="faq15.html#PkgMgmt">paquetages</a>.
CVSup peut aussi être utilisé en mode "checkout", mais cela n'est pas
couvert par le présent document.
Si vous avez plusieurs machines sur lesquelles vous désirez maintenir le
code source, vous devriez trouver utile d'avoir un dépôt CVS local, créé
et maintenu en utilisant CVSup ou CVSync.

<p>
Après avoir décidé quel <a href="../../fr/anoncvs.html">Serveur AnonCVS</a>
vous allez utiliser, vous devez effectuer un "checkout" (récupération) de
l'arbre des sources, que vous maintiendrez par la suite en lançant des
"updates" (mises à jour), afin de récupérer les fichiers les plus récents
dans votre arbre local.

<p>
La commande
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cvs&amp;sektion=1">CVS(1)</a>
dispose de nombreuses options, certaines d'entre elles sont
<i><b>requises</b></i> afin de récupérer et de mettre à jour un arbre.
Les autres commandes peuvent résulter en un arbre cassé.
Le fait de comprendre et de suivre les directions est ici important.

<p>
<b>Suivis de <i>-current</i></b><br>
<blockquote>
Dans ce cas, nous supposons que vous utilisez un serveur AnonCVS
publique, <b>anoncvs@anoncvs.example.org:/cvs</b>.
Nous supposons également que vous utilisez le shell
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sh&amp;sektion=1">sh(1)</a>,
vous devrez dans le cas contraire ajuster certaines commandes.

<p>
Pour récupérer un arbre des sources CVS de <i>-current</i>, vous pouvez
utiliser la commande suivante :
<pre>
    # <b>cd /usr</b>
    # <b>export CVSROOT=anoncvs@anoncvs.example.org:/cvs</b>
    # <b>cvs -d$CVSROOT checkout -P src</b>
</pre>

<p>
Une fois l'arbre récupéré, vous pourrez plus tard le mettre à jour avec :
<pre>
    # <b>cd /usr</b>
    # <b>export CVSROOT=anoncvs@anoncvs.example.org:/cvs</b>
    # <b>cvs -d$CVSROOT up -Pd</b>
</pre>
</blockquote>

<!-- XXXrelease -->
<b>Suivis de <i>-stable</i></b><br>
<blockquote>
Si vous souhaitez récupérer une "branche" alternative de l'arbre, comme
la branche <i>-stable</i>, vous devez utiliser le modificateur
"<tt>-r</tt>" :
<pre>
    # <b>cd /usr</b>
    # <b>export CVSROOT=anoncvs@anoncvs.example.org:/cvs</b>
    # <b>cvs -d$CVSROOT checkout -rOPENBSD_4_6 -P src</b>
</pre>

Ceci aura pour effet de récupérer les fichiers sources de la branche
OPENBSD_4_6, aussi connue sous le nom de "Branche patchée" ou 
"<a href="../../fr/stable.html">-stable</a>". Vous pourrez mettre à jour le
code de façon similaire :
<pre>
    # <b>cd /usr/src</b>
    # <b>export CVSROOT=anoncvs@anoncvs.example.org:/cvs</b>
    # <b>cvs -d$CVSROOT up -rOPENBSD_4_6 -Pd</b>
</pre>

CVS est vraiment agréable car il permet de suivre une balise dans les
fichiers récupérés, vous n'avez ainsi pas à vous rappeler de la partie
"<tt>-rOPENBSD_4_6</tt>" de la ligne de commande, ceci sera mémorisé
jusqu'à ce que vous l'effaciez ou en spécifiez un autre via l'option
"<tt>-A</tt>" de "<tt>update</tt>".
Cependant, il est probablement plus correct de fournir trop d'infos que pas
assez sur vos lignes de commande CVS.
</blockquote>

<p>
L'arbre "<tt>src</tt>" ayant le seul à avoir été montré jusqu'à présent,
vous pouvez faire les mêmes étapes pour "<tt>xenocara</tt>" et
"<tt>ports</tt>".
Toutes les parties d'OpenBSD devant être en synchronisation, tous les
arbres utilisés devraient être mis à jour en même temps.
Vous pouvez allier plusieurs récupérations sur une seule ligne
(<i>-stable</i> est montré) avec :
<pre>
    # <b>export CVSROOT=anoncvs@anoncvs.example.org:/cvs</b>
    # <b>cd /usr</b>
    # <b>cvs -d$CVSROOT checkout -rOPENBSD_4_6 -P src ports xenocara</b>
</pre>

Cependant, les mises à jour doivent être faites répertoire par
répertoire.

<p>
A ce niveau, que vous ayez suivi <i>-stable</i> ou <i>-current</i> vous
devriez avoir un arbre des sources correct.
Soyez attentif à ce que vous récupérez -- vous pourriez compiler
<i>-current</i> en pensant compiler <i>-stable</i>.

<h4>Pré-chargement de l'arbre des sources : <tt>src.tar.gz, sys.tar.gz</tt></h4>
Au lieu de télécharger l'arbre des sources dans sa totalité à partir
d'un serveur AnonCVS, vous pouvez le "pré-charger" à partir des fichiers
des sources se trouvant sur le CD d'OpenBSD ou sur les serveurs FTP.
Vous économiseriez ainsi beaucoup de temps et de bande passante.
Ceci est particulièrement vrai si utilisez
<a href="../../fr/stable.html"><i>-stable</i></a>, étant donné le peu de
différences entre cette version et <i>-release</i>.

<p>
Pour extraire l'arbre des sources à partir du CD vers <i>/usr/src</i> (en
supposant que le CD est monté dans /mnt) :
<pre>
    # <b>cd /usr/src; tar xzf /mnt/src.tar.gz</b>
    # <b>cd /usr; tar xzf /mnt/xenocara.tar.gz</b>
    # <b>cd /usr; tar xzf /mnt/ports.tar.gz</b>
</pre>

Les fichiers sources téléchargeables depuis les serveurs FTP sont
séparés en deux fichiers pour minimiser le temps nécessaire à leur
téléchargement pour les personnes souhaitant travailler avec telle ou
telle partie de l'arbre uniquement.
Ces deux fichiers sont <tt>sys.tar.gz</tt>, qui contient les fichiers
utilisés pour créer le noyau, et <tt>src.tar.gz</tt> qui contient toutes
les autres applications "userland", hormis l'arbre des ports et les
sources X11.
Cependant, et de manière générale, vous aurez besoin des deux.
En supposant que vous les ayez téléchargé <tt>src.tar.gz</tt> et
<tt>sys.tar.gz</tt> dans <tt>/usr</tt> :

<pre>
    # <b>cd /usr/src</b>
    # <b>tar xzf ../sys.tar.gz</b>
    # <b>tar xzf ../src.tar.gz</b>
    # <b>cd /usr</b>
    # <b>tar xzf xenocara.tar.gz</b>
    # <b>tar xzf ports.tar.gz</b>
</pre>

<p>
L'extraction de toutes les parties de l'arbre source n'est pas
obligatoire mais si on souhaite garder un système cohérent, il est
conseillé de les extraire toutes.


<a name="CVSTips"></a>
<h4>Astuces CVS courantes</h4>

Comme indiqué précédemment, certaines options sont obligatoires afin
d'obtenir un arbre <tt>src</tt> d'OpenBSD valide.
L'option "<tt>-P</tt>" ci-dessus est l'une d'entre elle : elle "prune"
(efface) les répertoires vides.
Avec les années, des répertoires ont été créés puis supprimés, et les
noms de ces répertoires sont parfois utilisés actuellement pour des
fichiers.
Sans l'option "<tt>-P</tt>", votre arbre fraîchement récupéré
NE compilera PAS.

<p>
Même chose pour l'option <tt>-d</tt> sur une commande 'update' -- elle
crée les nouveaux répertoires ayant pu être ajoutés au dépôt depuis
votre dernier "checkout".
Pour réussir une mise à jour, il faut absolument utiliser les options
<tt>-Pd</tt>

<p>
Les utilisateurs de CVS expérimentés auront pu se demander pourquoi le
CVSROOT est précisé et utilisé dans cet exemple, alors que cvs(1)
enregistre la situation du serveur dans l'arbre ainsi obtenu.
Ceci est correct, cependant, un utilisateur devra souvent outrepasser le
serveur enregistré, et de nombreuses personnes recommandent de
<i>toujours</i> spécifier le dépôt à utiliser.
Il est aussi à noter que si la variable d'environnement CVSROOT peut être
utilisée directement par cvs(1), elle est utilisée uniquement si rien ne
viens la remplacer, et la spécification de la ligne de commande est
prépondérante.

<p>
Il est souvent utile d'utiliser un <tt>.cvsrc</tt> dans votre
répertoire home afin de spécifier les options par défaut.
Un fichier <tt>.cvsrc</tt> d'exemple :
<pre>
    $ <b>more ~/.cvsrc</b>
    cvs -q -danoncvs@anoncvs.example.org:/cvs
    diff -up
    update -Pd
    checkout -P
</pre>

Ce fichier ordonnera à cvs(1) d'utiliser le serveur
<tt>anoncvs@anoncvs.example.org:/cvs</tt>, supprimant les sorties
souvent inutiles ("<tt>-q</tt>" pour "quiet", tranquille) pour toutes
les opérations, la commande "cvs up" utilisant par défaut <tt>-Pd</tt>,
la commande "cvs diff" réalisant par défaut des "diffs unifiés" suite à
l'option "<tt>-u</tt>", et un "cvs checkout" utilisera l'option
"<tt>-P</tt>".
Tandis que cela est confortable, si vous oubliez que ce fichier existe, ou si
vous essayez de lancer ces commandes auxquelles vous êtes habitué sans
ce fichier, vous rencontrerez des problèmes.

<p>
L'arbre des sources est constitué d'un grand nombre de petits fichiers.
Il est donc conseillé d'activer <a href="faq14.html#SoftUpdates">soft
updates</a> sur la partition où se trouve cet arbre afin d'améliorer
significativement les performances.


<a name="BldKernel"></a>
<a name="Building"></a>  <!-- Old tag -->
<h3>5.3.4 - Compilation du noyau</h3>
Nous supposerons que vous désirez construire un noyau standard (GENERIC
ou GENERIC.MP).
Normalement, c'est ce que vous devriez faire.
<i>N'</i>essayez pas de construire un noyau personnalisé si vous ne
maîtrisez pas le processus de compilation standard.

<p>
Evidemment, le noyau est un composant TRES dépendant du matériel du
système.
Les sources du noyau sont dans le répertoire <tt>/usr/src/sys</tt>.
Certaines parties du code du noyau d'OpenBSD sont utilisées sans
distinction de plate-forme, alors que d'autres sont très spécifiques à un
processeur ou une architecture.
Si vous regardez dans le répertoire <tt>/usr/src/sys/arch/</tt>, vous
verrez certaines choses quelque peu intrigantes -- par exemple, il y a
des répertoires <tt>mac68k</tt>, <tt>m68k</tt> et <tt>mvme68k</tt>.
Dans ce cas, les systèmes mvme68k et mac68k utiliseront tous deux le
même processeur, mais les machines sur lesquelles ils sont basés sont
très différentes, et elles demandent ainsi un noyau très différent (il y
a bien plus de choses qu'un processeur dans un ordinateur !).
Cependant, certaines parties du noyau sont communes, elles demeurent
dans le répertoire m68k.
Si vous compilez simplement un noyau, les répertoires de l'architecture
de base comme <tt>m68k</tt> ne sont pas un soucis, vous devriez
travailler uniquement avec les répertoires de "l'architecture
composant", comme <tt>mvme68k</tt>.

<p>
Les noyaux compilés sont basés sur les <a href="#Options">fichiers de
configuration du noyau</a>, qui se trouvent dans le répertoire 
<tt>/usr/src/sys/arch/&lt;<i>votre plate-forme</i>&gt;/conf</tt>.
La compilation du noyau consiste à l'utilisation du programme
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;sektion=8">config(8)</a>
pour créer et peupler un répertoire compile, qui se terminera dans
<tt>/usr/src/sys/arch/&lt;<i>votre plate-forme</i>&gt;/compile/&lt;<i>nom
du noyau</i>&gt;</tt>.
Pour cet exemple, nous supposerons que vous utilisez la plate-forme i386
:

<blockquote><pre>
# <b>cd /usr/src/sys/arch/i386/conf</b>
# <b>config GENERIC</b>
# <b>cd ../compile/GENERIC</b>
# <b>make clean && make depend && make</b>
    <i>[...beaucoup de sortie...]</i>
# <b>make install</b>
</pre></blockquote>

Remplacez "<tt>i386</tt>" sur la première ligne par le nom de votre
plate-forme.
La commande
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=machine&amp;sektion=1">machine(1)</a>
peut vous donner le nom de la plate-forme sur laquelle vous êtes afin de
pouvoir utiliser "<tt>cd /usr/src/sys/arch/`machine`/conf</tt>" à la
place de la première ligne.

<p>
A ce stade, redémarrez votre machine afin d'activer le nouveau noyau.
Notez que le nouveau noyau devrait être lancé avant l'étape suivante, ce
que vous savez si vous avez suivis les explications
<a href="#BldBinary">ci-dessus</a> sur la mise à niveau vers les
instantanés les plus récents.
Parfois, les APIs changent cependant, et l'ancien noyau sera dans
l'incapacité de lancer de nouvelles applications, mais les nouveaux
noyaux supportent en général les applications plus anciennes.

<h4>Variation du processus ci-dessus : arbre des sources en lecture
seule</h4>
Parfois, vous voudrez peut-être vous assurez que <tt>/usr/src/sys</tt>
reste intacte.
Ceci peut être fait en utilisant les procédés suivants :

<blockquote><pre>
$ <b>cd <i>/somewhere</i></b>
$ <b>cp /usr/src/sys/arch/i386/conf/GENERIC .</b>
$ <b>config -s /usr/src/sys -b . GENERIC</b>
$ <b>make clean && make depend && make</b>
   ... beaucoup de messages affichés ...
</pre></blockquote>

Remarquez que vous pouvez compiler un noyau sans accès root, mais vous
devez être root pour pouvoir l'installer.


<a name="BldUserland"></a>
<h3>5.3.5 - Compilation du "userland"</h3>

Il y a une marche à suivre spécifique afin que cela fonctionne, sans
quoi vous vous amuserez à trouver d'où les problèmes viennent.

<p>
<ul>
<li>Nettoyez votre répertoire <tt>/usr/obj</tt> et reconstruisez les
liens symboliques :
<blockquote><pre>
# <b>rm -rf /usr/obj/*</b>
# <b>cd /usr/src</b>
# <b>make obj</b>
</pre></blockquote>

Remarquez que l'utilisation du répertoire <tt>/usr/obj</tt> est
obligatoire. Echouer à cette étape avant la compilation laissera votre
arbre <tt>src</tt> dans un mauvais état.

<p>
<li>Soyez sûr que tous les répertoires nécessaires sont présents.
<blockquote><pre>
# <b>cd /usr/src/etc && env DESTDIR=/ make distrib-dirs</b>
</pre></blockquote>

<p>
<li>Compilez le système :
<blockquote><pre>
# <b>cd /usr/src</b>
# <b>make build</b>
</pre></blockquote>
Ceci compile et installe tous les outils du "userland" dans un ordre
approprié.
Cette étape est très coûteuse en temps -- une machine très rapide
devrait la réaliser sous une heure, une machine très lente pourrait
mettre plusieurs jours.
Lorsque cette étape est terminée, vous avez donc de nouveaux binaires à
leurs places sur votre système.

<p>
<li><b>Si vous compilez <i>-current</i> :</b> Mettez à jour
<tt>/dev</tt> et <tt>/etc</tt>, avec les changements listés dans
<a href="current.html">current.html</a>.
Si vous suivez -stable d'après le <a href="../upgrade46.html">processus de
mise à niveau</a> ou via une installation du <a
href="#BldBinary">binaire correspondant</a>, cette étape n'est ni
désirée ni nécessaire.

</ul>

<a name="Release"></a>
<a name="BldRelease"></a> <!-- old tag -->
<h2>5.4 - Compilation d'une Révision</h2>
<h3>Qu'est ce qu'une "release" (révision), et pourquoi voudrais-je en
créer une ?</h3>
Une "release" est le jeu de fichiers complet pouvant être utilisé pour
installer OpenBSD sur un ordinateur.
Si vous n'avez qu'une seule machine sous OpenBSD, vous n'avez pas de
réelle motivation à construire une release, le processus <a
href="#Bld">ci-dessus</a> vous apportant tout ce dont vous avez besoin.
Un exemple d'utilisation du processus de release pourrait être de
compiler une <i>-stable</i> sur une machine puissante, et de faire une
release installable sur tous vos ordinateurs.

<p>
Le processus de release utilise les binaires créés dans le répertoire
<tt>/usr/obj</tt> lors du processus ci-dessus, vous devez donc accomplir
celui-ci au préalable, et rien ne doit perturber le répertoire
<tt>/usr/obj</tt>.
Ceci peut être un problème si vous utilisez un 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount_mfs&amp;sektion=8">disque
mémoire</a> pour <tt>/usr/obj</tt> avec de petites performances lors du
processus de compilation, vous ne voudrez pas redémarrer l'ordinateur
entre les étapes de compilations et de "release" !

<p>
Le processus de release requiert deux répertoires de travail, appelés
DESTDIR et RELEASEDIR.
Tous les fichiers faisant partie d'une installation OpenBSD "propre"
seront copiés à l'endroit correct au sein de DESTDIR.
Ils seront tar(1)és puis placés dans RELEASEDIR.
A la fin du processus, RELEASEDIR arborera la release OpenBSD
intégralement.
Le processus de release utilisera aussi <tt>/mnt</tt>, ce point ne doit
donc pas être utilisé par autre chose pendant le processus de release.
A titre d'exemple, nous utiliserons DESTDIR à <tt>/usr/dest</tt> et
RELEASEDIR à <tt>/usr/rel</tt>.


<p>
Le processus de release utilisera un utilitaite,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=crunchgen&amp;sektion=8">crunchgen(8)</a>,
qui est utilisé pour créer un exécutable unique composé de plusieurs binaires.
Le nom qui l'invoque détermine quel composant binaire est utilisé.
C'est un peu comme si plusieurs fichiers de programmes individuels
étaient concentrés sur un ramdisk noyau qui existe sur les disquettes et
autres médias d'installation.

<p>
Vous devez avoir les privilèges root pour créer une release.

<p>
<h3>Faire une release</h3>

Définissons nos variables d'environnement DESTDIR et RELEASEDIR :
<blockquote><pre>
# <b>export DESTDIR=/usr/dest</b>
# <b>export RELEASEDIR=/usr/rel</b>
</pre></blockquote>

Nettoyons DESTDIR et créons le répertoire :
<blockquote><pre>
# <b>test -d ${DESTDIR} && mv ${DESTDIR} ${DESTDIR}.old && rm -rf ${DESTDIR}.old &</b>
# <b>mkdir -p ${DESTDIR} ${RELEASEDIR}</b>
</pre></blockquote>

RELEASEDIR ne doit pas forcément être vide lors du lancement du
processus mais, cependant, s'il y a des changement dans les fichiers de
la release ou dans leurs noms, les anciens fichiers seront conservés.
Vous voudrez ainsi certainement effacer ce répertoire.

<p>
Passons à présent à la release elle-même :
<blockquote><pre>
# <b>cd /usr/src/etc</b>
# <b>make release</b>
</pre></blockquote>

Une fois la release construite, il peut être bon de la vérifier afin d'être
sûr que les fichiers tar reflètent bien le contenu de DESTDIR.
La sortie de cette étape devrait être très courte :
<blockquote><pre>
# <b>cd /usr/src/distrib/sets</b>
# <b>sh checkflist</b>
</pre></blockquote>

Vous avez à présent un jeu de fichiers complet et fonctionnel dans
RELEASEDIR. Ces fichiers peuvent être utilisés afin d'installer ou de
mettre à jour OpenBSD sur d'autres machines.

<p>
Les instructions faisant foi sur la création d'une release sont dans
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=release&amp;sektion=8">release(8)</a>.

<p>
Remarque : Si vous souhaitez distribuer les fichiers résultants par HTTP
pour être utilisables par les scripts de mise à jour ou d'installation,
vous aurez besoin d'ajouter un fichier "index.txt". Ce fichier contient
la liste de tous les fichiers constituant votre release fraîchement
créée.
<blockquote><pre>
# <b>/bin/ls -1 >index.txt</b>
</pre></blockquote>

Dés que vous avez une release compléte créée, vous pouvez utiliser ces
fichiers pour une <a href="faq4.html">installation</a> standard ou une
<a href="../upgrade46.html">mise à jour</a> sur une autre machine, ou si vous 
mettez à jour une autre machine pour une nouvelle <i>-stable</i>, 
<a href="faq4.html#AddFileSet">décompressez</a> simplement les fichiers tar
dans le répertoire racine de la machine cible.

<a name="Xbld"></a>
<h2>5.5 - Compilation de X (Xenocara)</h2>
Commençons par <a href="http://x.org/">X.org v7,</a> X est devenu un système
à "compilation modulaire", découpant l'arborescence des sources de x.org
en plus de trois cents packages plus ou moins indépendants.

<p>
Pour simplifier la vie des utilisateurs d'OpenBSD, un procédé de "meta-compilation" 
nommée <a href="http://xenocara.org">Xenocara</a> a été développé.
Ce système "reconvertie" X en une seule grosse arborescence pour permettre
la compilation en une seule étape.
Comme point positif supplémentaire, ce processus de compilation se rapproche
bien plus du processus utilise pour le reste d'OpenBSD que la version précédente.

<p>
Les instructions officielles pour compiler X se trouvent dans le fichier
<tt>/usr/xenocara/README</tt> ainsi que dans
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=release&amp;sektion=8">release(8)</a>.

<h3>Obtenir le code source</h3>
L'arborescence des sources de xenocara se trouve "habituellement" dans
<tt>/usr/src/xenocara</tt>. Les sources sont stockes dans le module
<tt>xenocara</tt> du CVS.
Le checkout se fera donc ainsi :
<blockquote><pre>
$ <b>cd /usr</b>
$ <b>cvs -qdanoncvs@anoncvs.example.org:/cvs checkout -P xenocara</b>
</pre></blockquote>

<h3>Compiler Xenocara</h3>
Aucun outil externe n'est nécessaire pour compiler l'arbre standard de xenocara
telle que prévue par OpenBSD.

<blockquote><pre>
# <b>cd /usr/xenocara</b>
# <b>rm -rf /usr/xobj/*</b>
# <b>make bootstrap</b>
# <b>make obj</b>
# <b>make build</b>
</pre></blockquote>

Si vous voulez faire des modifications dans le code source, vous aurez
probablement besoin d'ajouter plusieurs <a href="faq15.html">packages</a>.
Les détails sont dans le fichier <tt>/usr/xenocara/README</tt>.

<h3>Création d'une release X</h3>
Ceci est similaire au processus de release principal. Après avoir
compilé X avec succès, vous définirez DESTDIR et RELEASEDIR, de la même
manière qu'évoqué précédemment.
RELEASEDIR peut être le même répertoire que la principale RELEASEDIR
système, mais DESTDIR sera effacé et reconstruit lors de ce processus.
Si cela est fait avec attention, ce n'est pas un problème, mais
l'utilisation d'une DESTDIR séparée est plus sûr.

<p>
Pour cet exemple, nous utiliserons les DESTDIR et RELEASEDIR comme
/usr/dest et /usr/rel, respectivement.
Ceci doit être fait après le processus de compilation ci-dessous.

<blockquote><pre>
# <b>export DESTDIR=/usr/dest</b>
# <b>export RELEASEDIR=/usr/rel</b>
# <b>test -d ${DESTDIR} && mv ${DESTDIR} ${DESTDIR}- && \</b>
  <b>   rm -rf ${DESTDIR}- &</b>
# <b>mkdir -p ${DESTDIR} ${RELEASEDIR}</b>
# <b>make release</b>
</pre></blockquote>

Une fois le processus complété, vous aurez un ensemble de fichiers release
dans le $RELEASEDIR

<p>
<a name="Why"></a>
<h2>5.6 - Pourquoi aurais-je besoin d'un noyau sur mesure ?</h2>

<p>
En réalité, vous n'en avez très probablement pas besoin.

<p>
Un noyau sur mesure est un noyau construit à partir d'un fichier de
configuration autre que <tt>GENERIC</tt>, le fichier de configuration
fourni de base. Un noyau sur mesure peut se baser sur du code source <a
href="#Flavors"><i>-release, -stable</i> ou <i>-current</i></a> comme
c'est le cas pour le noyau <tt>GENERIC</tt>. Alors que la compilation de
votre propre noyau <tt>GENERIC</tt> est supportée par l'équipe OpenBSD,
la compilation de votre propre noyau sur mesure
<i>ne</i> l'est pas.

<p>
Le fichier de configuration noyau OpenBSD standard (<tt>GENERIC</tt>)
est conçu pour convenir à la plupart des utilisateurs. Bon nombre de
personnes ont rendu leur système inopérant en essayant d'optimiser le
noyau au lieu d'améliorer son fonctionnement. Il existe certaines
personnes qui pensent qu'un noyau et un système d'exploitation doivent
être taillés sur mesure pour obtenir des performances optimales. Ceci
n'est pas vrai dans le cas d'OpenBSD. Seules les personnes très
compétentes avec des applications très particulières doivent penser à
faire un noyau et un système sur mesure.

<p>
Voici quelques raisons pour lesquelles vous devriez créer un noyau sur
mesure :
<ul>
  <li>Vous savez vraiment ce que vous faites, et vous souhaitez utiliser
      OpenBSD sur une machine disposant de peu de ressources mémoire en
      supprimant tous les pilotes de périphériques dont vous n'avez pas
      besoin.
  <li>Vous savez vraiment ce que vous faites, et vous souhaitez
      supprimer des options par défaut ou ajouter des options qui ne
      sont pas activées par défaut (et vous avez vraiment une bonne
      raison pour le faire).
  <li>Vous savez vraiment ce que vous faites, et vous souhaitez activer
      des options expérimentales.
  <li>Vous savez vraiment ce que vous faites, et vous avez un besoin
      spécifique auquel le noyau <tt>GENERIC</tt> ne répond pas. Si
      quelque chose ne marche pas comme prévu, vous n'allez pas demander
      à autrui le pourquoi du comment.
</ul>

<p>
Voici quelques raisons pour lesquelles vous ne devez pas compiler un
noyau sur mesure :
<ul>
  <li>Vous n'en avez pas besoin en temps normal.
  <li>Votre système n'en sera pas plus rapide.
  <li>Vous rendrez probablement votre machine moins fiable.
  <li>Vous n'obtiendrez aucune aide de la part des développeurs.
  <li>Tout problème rencontré devra être obligatoirement reproduit avec
      un noyau <tt>GENERIC</tt> avant que les développeurs ne le
      prennent au sérieux.
  <li>Les autres utilisateurs et les développeurs vous riront au nez si
      vous cassez votre système.
  <li>D'habitude, des options de compilation sur mesure exposent les
      problèmes de compilateur au lieu d'améliorer les performances du
      système.
</ul>

<p>
La suppression de pilotes pourrait rendre plus rapide la phase de
démarrage système. Cependant, elle peut compliquer la récupération suite
à problème matériel. La suppression de pilotes est une tâche très
souvent mal réalisée. La suppression de pilotes <i>ne rendra pas</i>
votre système plus rapide de manière perceptible même si elle peut
produire un noyau plus petit. La suppression des parties liées au
déboguage et à la vérification d'erreurs peut améliorer les
performances, mais rendra impossible l'analyse du système si quelque
chose ne fonctionne plus ou pas.


<p>
Encore une fois, les développeurs ignorent d'habitude les rapports de
bogue relatifs à des noyaux personnalisés, sauf si le problème peut être
reproduit avec un noyau <tt>GENERIC</tt>. Vous aurez été prévenu.

<p>
<a name="Options"></a>
<h2>5.7 - Options de configuration du noyau</h2>
Nous partons du fait que vous avez lu <a href="#Why">ci-dessus</a>, et
que vous aimez la douleur.
Il est aussi supposé que vous avez un but ne pouvant être atteint ni
avec <a href="#BootConfig">Configuration au démarrage (UKC>)</a>, ni
avec <a href="#config">config(8)urer un noyau GENERIC</a>.
Si les deux possibilités sont fausses, vous devriez vous en tenir à
utiliser GENERIC. Vraiment.

<p>
La création d'un noyau OpenBSD est contrôlée par le biais de fichiers de
configuration, se trouvant dans le répertoire
<tt>/usr/src/sys/arch/<i>&lt;arch&gt;</i>/conf/</tt> par défaut. Toutes
les architectures possèdent un fichier, <tt>GENERIC</tt>, qui peut être
utilisé pour générer un noyau OpenBSD standard pour une plate-forme
donnée. Il peut aussi y avoir d'autres fichiers de configuration qui
peuvent être utilisés pour créer des noyaux avec des objectifs
différents tels que la minimisation de l'utilisation de la RAM, les
stations de travail "diskless", etc.

<p>
Le fichier de configuration est traité par
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;sektion=8">config(8)</a>,
qui crée et peuple un répertoire de compilation situé sous
<tt>../compile</tt>. Pour une installation typique, le chemin absolu du
répertoire serait situé sous
<tt>/usr/src/sys/arch/&lt;<i>arch</i>&gt;/compile/</tt>. config(8) peut
aussi créer un fichier
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=make&amp;sektion=1">Makefile</a>,
et d'autres fichiers requis pour créer avec succès un noyau.

<p>
Les options de configuration du noyau sont des options que vous ajoutez
à la configuration de votre noyau pour activer certaines
caractéristiques dans celui-ci. Ceci vous permet d'avoir exactement le
support que vous voulez sans vous encombrer des pilotes inutiles. Il y a
une multitude d'options qui vous permettront de personnaliser votre
noyau. Veuillez consulter la page de manuel
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=options&amp;sektion=4">options(4)</a>
pour une liste complète des options. Vous pouvez aussi consulter les
fichiers d'exemples de configurations qui sont disponibles pour votre
architecture.

<p>
<b>L'ajout, la suppression, ou la modification d'options dans votre
noyau ne doivent être effectués que si vous avez une bonne raison pour
le faire ! N'éditez pas le fichier de configuration <tt>GENERIC</tt>
 !!</b>
La seule configuration du noyau supportée par l'équipe
OpenBSD est le noyau GENERIC, la combinaison d'options figurant dans les
fichiers <tt>/usr/src/sys/arch/&lt;<i>arch</i>&gt;/conf/GENERIC</tt> et
<tt>/usr/src/sys/conf/GENERIC</tt> <i>tels que livrés par l'équipe
OpenBSD</i> (i.e. non édités). Emettre un rapport de bogue concernant
un noyau personnalisé va dans la plupart des cas se résumer à une réponse
vous demandant d'essayer de reproduire le problème avec un noyau
GENERIC. Les options ne sont pas toutes compatibles entre elles, et
plusieurs options sont nécessaires au bon fonctionnement du système. Il
n'y a aucune garantie quant au fonctionnement d'un noyau personnalisé
que vous avez réussi à compiler.
Il n'y a aucune garantie sur le fait qu'un noyau pouvant être
"config(8)uré" puisse être compilé.

<p>
Vous pouvez voir les fichiers de configuration spécifiques à une
plate-forme donnée ici :

<ul>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/alpha/conf/">Fichiers de Configuration du Noyau alpha </a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/i386/conf/">Fichiers de Configuration du Noyau i386</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/macppc/conf/">Fichiers de Configuration du Noyau macppc</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/sparc/conf/">Fichiers de Configuration du Noyau sparc</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/sparc64/conf/">Fichiers de Configuration du Noyau sparc64</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/vax/conf/">Fichiers de Configuration du Noyau vax</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/hppa/conf/">Fichiers de Configuration du Noyau hppa</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/arch/">Autres architectures</a>
</ul>

<p>
Si vous lisez attentivement ces fichiers, vous verrez une ligne comme :
<pre>
     include "../../../conf/GENERIC"
</pre>
Cela signifie que l'on fait référence à un autre fichier de
configuration. Ce fichier comprend toutes les options qui ne sont pas
dépendantes de l'architecture. Donc quand vous créez votre fichier de
configuration, soyez sûr de regarder
<a href="http://www.openbsd.org/cgi-bin/cvsweb/src/sys/conf/GENERIC">
/sys/conf/GENERIC</a> pour voir ce que vous voulez.

<p>
Toutes les options ci-dessous doivent être placées dans le fichier de
configuration du noyau avec le format :
<blockquote>
<tt>option&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tt><i>nom</i>
</blockquote>
ou
<blockquote><pre>
<tt>option&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tt><i>nom=valeur</i> 
</pre></blockquote>

Par exemple, pour utiliser l'option "DEBUG" dans le noyau, il faut
mettre la ligne suivante :

<blockquote><pre>
option      DEBUG
</pre></blockquote>

Les options dans le noyau OpenBSD sont traduites en tant qu'options du
préprocesseur, donc une option telle que DEBUG compilerait les sources
avec l'option -DDEBUG. Ce qui est équivalent à placer un <tt>#define
DEBUG</tt> à travers les sources du noyau.

<p>
Vous aurez peut-être parfois besoin de désactiver une option
précédemment définie dans le fichier "<tt>src/sys/conf/GENERIC</tt>"
typiquement. Bien entendu, vous pouvez modifier une copie de ce fichier,
mais une meilleure méthode consiste à utiliser la clause
<i>rmoption</i>. Par exemple, si vous souhaitiez vraiment désactiver le
débogueur intégré au noyau (<i>non recommandé !</i>), vous ajouteriez la
ligne suivante : <pre> rmoption DDB </pre> à votre fichier de
configuration du noyau. <tt>option DDB</tt> est définie dans
<tt>src/sys/conf/GENERIC</tt>, mais la ligne <tt>rmoption</tt> ci-dessus
la désactive.

<p>
Encore une fois, veuillez consulter 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=options&amp;sektion=4">options(4)</a>
pour plus d'informations concernant les spécificités de ces options. Il
est à noter que plusieurs options possèdent leurs propres pages de
manuel -- il faut toujours lire toutes les informations disponibles au
sujet d'une option avant de l'ajouter ou la supprimer de votre noyau.

<p> 
<h3>Compiler un noyau sur mesure</h3>

Dans ce cas, nous compilerons un noyau supportant les cartes série ISA
multi-port
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=boca&amp;sektion=4">boca(4)</a>.
Cette carte n'est pas dans le noyau GENERIC, du fait qu'elle entre en
conflit avec d'autres drivers.

Une autre raison courante de construire un noyau personnalisé est
d'utiliser RAIDframe, trop gros pour être dans le noyau par défaut.
Il y a deux moyens courants de faire un noyau personnalisé : copier le
fichier de configuration GENERIC vers un autre nom et l'éditer, ou créer
un fichier "wrapper" qui inclut le noyau standard GENERIC ainsi que
toutes les options dont vous avez besoin, et qui ne sont pas dans
GENERIC.
Dans ce cas, votre fichier "wrapper" pourrait ressembler à :
<blockquote><pre>
include "arch/i386/conf/GENERIC"

boca0  at       isa? port 0x100 irq 10     # BOCA 8-port serial cards
com*   at       boca? slave ?
</pre></blockquote>

Les deux lignes au regard des cartes boca(4) sont copiées depuis les
lignes commentées dans <tt>GENERIC</tt>, avec l'IRQ ajusté comme requis.
L'avantage d'utiliser ce fichier "wrapper" est que les changements
imprévus dans GENERIC sont automatiquement mis à jour comme lors de
toute mise à jour du code. L'inconvénient est qu'on ne peut supprimer un
périphérique (cependant, c'est en général une mauvaise idée). 

<p>
Un autre moyen de générer un noyau personnalisé est de faire une copie
du <tt>GENERIC</tt> standard, en lui donnant un autre nom, et en
l'éditant selon les besoins.
L'inconvénient est que les futures mises à jour du fichier de
configuration GENERIC devront être fusionnés dans votre copie, ou vous
devrez refaire votre fichier de configuration.

<p>
Dans un autre événement, après avoir fait votre fichier de configuration
personnalisé, utilisez config(8) et construisez le noyau comme documenté
<a href="#BldKernel">ci-dessus</a>.

<p>
Les instructions complètes pour la création de votre propre noyau sont
dans la page de manuel 
<a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;sektion=8#EXAMPLES+(kernel">
config(8)</a>.

<a name="BootConfig"></a>
<h2>5.8 - Configuration au démarrage</h2>

<p>
Lorsque vous démarrez votre système il est possible que vous remarquiez
que votre noyau trouve vos périphériques mais à la mauvaise IRQ. Et que
vous aillez immédiatement besoin de ce périphérique. Sans recompiler
votre noyau vous pouvez utiliser la configuration au démarrage de celui-ci.
Cela vous permettra de corriger votre problème pour cette fois et uniquement
pour cette fois. Si vous redémarrez le système il faudra recommencer la
procédure. Il s'agit donc d'une méthode temporaire. Le problème devra
être corrigé en utilisant <a href="#config">config(8)</a>. De plus votre
noyau à besoin de l'<strong>option BOOT_CONFIG</strong> dans la
configuration du noyau. Le noyau GENERIC possède cette option.

<p>
Une grande partie de ce document peut-être trouvée dans la page de manuel
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=boot_config&amp;sektion=8">boot_config(8)</a>.

<p>
Pour démarrer avec UKC (User Kernel Config), il faut spécifier l'option
-c au démarrage.

<blockquote><pre>
boot&gt; <strong>boot hd0a:/bsd -c</strong>
</pre></blockquote>

ou n'importe quel autre noyau que vous voulez démarrer. L'invite de
commandes UKC apparaîtra, et vous pourrez spécifier au noyau les
périphériques que vous désirez modifier, ceux que vous voulez activer ou
désactiver.

<p>
Voici un liste des commandes les plus utilisées dans UKC.

<ul>
<li><tt>add <strong>device</strong></tt> - Ajoute un périphérique en en
    copiant un autre
<li><tt>change <strong>devno | device </strong></tt> - Modifie un ou
    plusieurs périphériques
<li><tt>disable <strong>devno | device </strong></tt> - Désactive un ou
    plusieurs périphériques
<li><tt>enable <strong>devno | device </strong></tt> - Active un ou
    plusieurs périphériques
<li><tt>find <strong>devno | device </strong></tt> - Trouver un ou
    plusieurs périphériques
<li><tt>help</tt> - Rapide sommaire de ces commandes
<li><tt>list</tt> - Liste TOUS les périphériques connus
<li><tt>exit/quit</tt> - Continue le démarrage
<li><tt>show <strong>[attr [val]]</strong></tt> - Montre les
    périphériques avec un attribut et une valeur spécifiée optionnelle
</ul>

<p>
Une fois votre noyau configuré, utilisez <tt>quit</tt> ou <tt>exit</tt>
et continuez le démarrage.
Une fois votre système démarré, vous devriez rendre la modification
permanente au niveau de votre binaire du noyau, tel que c'est décrit
dans <a href="#config">utilisation de config(8) pour changer le binaire
du noyau</a>

<p>
<a name="config"></a>
<h2>5.9 - Utilisation de config(8) pour changer le binaire du noyau</h2>

<p>
Les options <b>-e</b> et <b>-u</b> de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;sektion=8">config(8)</a>
peuvent être très utiles et vous évitent de perdre du temps à recompiler
votre noyau. Le drapeau <b>-e</b> vous permet de rentrer en
configuration UKC alors que le système fonctionne. Les changements
prendront effets au prochain redémarrage. Le drapeau <b>-u</b> permet de
voir si des changements ont été effectués au noyau pendant le démarrage,
signifiant que vous avez utilisé <b>boot -c</b> pour entrer en
configuration UKC.

<p>
Les exemples suivants montrent la désactivation des périphériques ep*
dans le noyau. Pour plus de sécurité, il est préférable d'utiliser
l'option <b>-o</b> qui écrira les changements dans un fichier spécifié.
Par exemple : <strong>config -e -o bsd.new /bsd</strong> écrira les
changements dans bsd.new. Les exemples n'utilisent pas l'option <b>-o</b>,
mais les changements sont ignorés et ne sont pas écrits dans le binaire du
noyau. Pour plus d'informations sur les messages d'erreur et autres
avertissements, lisez la page de manuel
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;sektion=8">config(8)</a>
.

<!--XXXver -->
<blockquote><pre>
$ <strong>sudo config -e /bsd</strong>
OpenBSD 4.6 (GENERIC) #58: Thu Jul  9 21:24:42 MDT 2009
    deraadt@i386.openbsd.org:/usr/src/sys/arch/i386/compile/GENERIC
warning: no output file specified
Enter 'help' for information
ukc&gt; <strong>?</strong>
        help                                Command help list
        add             dev                 Add a device
        base            8|10|16             Base on large numbers
        change          devno|dev           Change device
        disable         attr val|devno|dev  Disable device
        enable          attr val|devno|dev  Enable device
        find            devno|dev           Find device
        list                                List configuration
        lines           count               # of lines per page
        show            [attr [val]]        Show attribute
        exit                                Exit, without saving changes
        quit                                Quit, saving current changes
        timezone        [mins [dst]]        Show/change timezone
        bufcachepercent [number]            Show/change BUFCACHEPERCENT
        nkmempg         [number]            Show/change NKMEMPAGES
        shmseg          [number]            Show/change SHMSEG
        shmmaxpgs       [number]            Show/change SHMMAXPGS
ukc&gt; <strong>list</strong>
  0 video* at uvideo* flags 0x0
  1 audio* at uaudio*|btsco*|sb0|sb*|gus0|pas0|sp0|ess*|wss0|wss*|ym*|eap*|envy*
|eso*|sv*|neo*|cmpci*|clcs*|clct*|auacer*|auglx*|auich*|auixp*|autri*|auvia*|aza
lia*|fms*|maestro*|esa*|yds*|emu* flags 0x0
  2 midi* at umidi*|sb0|sb*|opl*|opl*|opl*|opl*|opl*|ym*|mpu*|mpu*|autri*|eap* f
lags 0x0
  3 midi* at pcppi0 flags 0x0
  4 drm* at inteldrm*|radeondrm* flags 0x0
  5 inteldrm* at vga0|vga* flags 0x0
  6 radeondrm* at vga0|vga* flags 0x0
  7 radio* at udsbr*|bktr0|fms* flags 0x0
  8 softraid0 at root flags 0x0
  9 nsphy* at url*|udav*|mos*|axe*|aue*|xe*|ef*|hme*|lii*|bce*|ale*|age*|jme*|et
*|nfe*|stge*|vge*|bnx*|bge*|lge*|nge*|msk*|sk*|ste*|sis*|wb*|tl*|vr*|pcn*|sf*|ge
m*|ne0|ne1|ne2|ne*|ne*|ne*|epic*|sm0|sm*|dc*|dc*|re*|re*|rl*|rl*|mtd*|fxp*|fxp*|
xl*|xl*|ep0|ep0|ep0|ep*|ep*|ep*|ep*|ep* phy -1 flags 0x0
 10 nsphyter* at url*|udav*|mos*|axe*|aue*|xe*|ef*|hme*|lii*|bce*|ale*|age*|jme*
|et*|nfe*|stge*|vge*|bnx*|bge*|lge*|nge*|msk*|sk*|ste*|sis*|wb*|tl*|vr*|pcn*|sf*
|gem*|ne0|ne1|ne2|ne*|ne*|ne*|epic*|sm0|sm*|dc*|dc*|re*|re*|rl*|rl*|mtd*|fxp*|fx
p*|xl*|xl*|ep0|ep0|ep0|ep*|ep*|ep*|ep*|ep* phy -1 flags 0x0
[...snip...]
ukc&gt; <strong>disable ep</strong>
 98 ep0 disabled
 99 ep* disabled
100 ep* disabled
278 ep0 disabled
279 ep0 disabled
280 ep* disabled
281 ep* disabled
344 ep* disabled
ukc&gt; <strong>quit</strong>
not forced
</pre></blockquote>

<p>
Dans l'exemple ci-dessus, tous les périphériques ep* sont désactivés du
noyau et ne seront donc pas testés. Dans certaines situations où vous
aurez effectué ces changements au démarrage avec UKC et <b>boot -c</b>,
il vous faudra les rendre définitifs. Pour ce faire, il faudra utiliser
l'option <b>-u</b>. Dans l'exemple suivant, l'ordinateur a été démarré
avec UKC et les périphériques 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=wi&amp;sektion=4">wi(4)</a>
sont désactivés. Étant donné que les
changements fait par boot -c ne sont pas permanents, ceux-ci doivent
être écrits sur le disque. Cet exemple montre comment écrire les
changements effectués par boot -c dans un nouveau noyau binaire bsd.new.

<blockquote><pre>
$ <strong>sudo config -e -u -o bsd.new /bsd</strong>
OpenBSD 4.6 (GENERIC) #58: Thu Jul  9 21:24:42 MDT 2009
    deraadt@i386.openbsd.org:/usr/src/sys/arch/i386/compile/GENERIC
Processing history...
162 wi* disabled
163 wi* disabled
416 wi* disabled
Enter 'help' for information
ukc&gt; <strong>quit</strong>
</pre></blockquote>

<a name="VerboseBoot"></a>
<h2>5.10 - Obtention d'une sortie plus verbeuse lors du démarrage</h2>
L'obtention d'une sortie plus verbeuse peut s'avérer être très utile
lors des tentatives de résolution de problème au boot. Si vous avez un
problème inhérent à votre disquette de boot et désirez obtenir plus
d'informations, redémarrez. A l'arrivée au prompt &quot;boot&gt;&quot;,
bootez avec l'option -c. Ceci vous permettra d'être dans UKC&gt;, puis
de faire :

<blockquote><pre>
UKC&gt; <strong>verbose</strong>
autoconf verbose enabled
UKC&gt; <strong>quit</strong>
</pre></blockquote>

<p>
Vous aurez à présent une sortie très verbeuse au démarrage.

<p>
<a name="buildprobs"></a>
<h2>5.11 - Problèmes courants, astuces et questions lors de la
        compilation et de la construction</h2>

La plupart du temps, les problèmes lors de la compilation sont causés
par le fait de ne pas suivre précisément les indications précédentes.
Cependant, il peut exister occasionnellement de véritables problèmes
lors de la compilation de <i>-current</i> à partir du snapshot le plus
récent mais les erreurs lors de la compilation de <i>-release</i> ou
<i>-stable</i> sont presque toujours dues à une erreur de l'utilisateur.

<p>
Les problèmes les plus courants sont :
<ul>
<li>Ne pas démarrer à partir du <a href="#BldBinary">binaire
approprié</a>, essayer de mettre à jour à partir des sources ou penser
qu'un snapshot vieux d'une semaine est "suffisamment proche".
<li><a href="#BldGetSrc">Récupérer</a> la mauvaise branche de l'arbre
CVS.
<li>Ne pas suivre la <a href="faq5.html">procédure</a>.
<li>Tenter d'<a href="#Why">adapter</a> ou d'"optimiser" votre
système.
</ul>

Voici tout de même certains problèmes auxquels vous pourriez être
confronté :

<a name="sig11"></a>
<h3>5.11.1 - La compilation s'est arrêtée avec une erreur "Signal
    11"</h3>

<p>
La compilation d'OpenBSD et d'autres programmes à partir des sources est
une tâche qui sollicite le matériel plus que la plupart des autres
opérations, faisant un usage intensif du CPU, du disque et de la
mémoire. Par conséquence, si votre matériel a des problèmes, ces
derniers apparaîtront plus facilement durant une compilation. Les
défaillances "Signal 11" sont <i>typiquement</i> causées par des
problèmes matériel, et la plupart du temps à cause de problèmes de
mémoire. Mais ces défaillances peuvent aussi causées par le CPU, la
carte mère, ou des problèmes de surchauffe. Votre système peut
d'ailleurs être stable la plupart du temps et connaître des défaillances
lors de la compilation de programmes.

<p>
Il est recommandé de réparer ou remplacer les composants à l'origine des
défaillances; les problèmes pouvant se manifester sous d'autres formes
plus tard. Si vous avez du matériel que vous souhaitez utiliser et qui
ne vous pose aucun problème, installez simplement un snapshot ou une
"révision".

<p>
Pour plus d'informations, consultez la 
<a href="http://www.bitwizard.nl/sig11/">Faq Sig11</a>.

<a name="snake"></a>
<h3>5.11.2 - "make build" échoue en générant un
        message "cannot open output file snake: is a directory"</h3>

Ceci est le résultat de deux erreurs séparées :
<ul>
<li><b>Vous n'avez pas proprement récupéré ou mis à jour votre
    arborescence CVS.</b> Lorsque vous effectuez une opération "CVS
    checkout", vous devez utiliser l'option "<tt>-P</tt>", et lorsque
    vous mettez à jour votre arborescence des sources à partir de CVS,
    vous devez utiliser les options "<tt>-Pd</tt>" de
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cvs&amp;sektion=1">cvs(1)</a>,
    comme documenté <a href="#BldGetSrc">ci-dessus</a>.
 Ces options s'assurent que les nouveaux répertoires sont ajoutés ou
 supprimés au fur et à mesure qu'OpenBSD évolue.

<li><b>Vous n'avez pas correctement crée le répertoire <tt>obj</tt>
    avant de commencer la compilation.</b> La compilation de
    l'arborescence sans répertoire <tt>/usr/obj</tt> n'est pas
    supportée.

</ul>
Il est important de suivre soigneusement les instructions lors de la
<a href="#BldGetSrc">récupération</a> et de la <a
href="#Bld">compilation</a> de votre arbre.

<a name="ProbIPv6"></a>
<h3>5.11.3 Mon système sans IPv6 ne fonctionne pas !</h3>
Oui.
Nous vous prions de ne pas faire de modifications au système de base
pour lesquelles vous ne comprenez pas toutes les conséquences.
Un "petit" changement dans le noyau peut avoir un impact très large sur
le reste entier du système.
Relisez s'il vous plaît <a href="#Why">ceci</a>.


<a name="ProbObj"></a>
<h3>5.11.4 - Oops ! J'ai oublié de créer le répertoire <tt>/usr/obj</tt>
    avant de commencer !</h3>

En faisant un "make build" avant de faire un "make obj", vous devrez en
terminer avec les fichiers objets accumulés dans votre répertoire
<tt>/usr/src</tt>.
C'est une mauvaise chose. Si vous désirez essayer d'avoir à
télécharger l'arbre des sources une nouvelle fois, vous pouvez essayer
les manipulations suivantes afin de nettoyer les fichiers objets :
<pre>
    # <b>cd /usr/src</b>
    # <b>find . -type l -name obj | xargs rm</b>
    # <b>make cleandir</b>
    # <b>rm -rf /usr/obj/*</b>
    # <b>make obj</b>
</pre>

<a name="ProbObjPt"></a>
<h3>5.11.5 - Conseil : Placer <tt>/usr/obj</tt> sur sa
     propre partition</h3>
Si vous compilez souvent, vous trouverez plus rapide de mettre
<tt>/usr/obj</tt> sur sa propre partition.
Le bénéfice est simple, il est typiquement plus rapide de :
<pre>
    # <b>umount /usr/obj</b>
    # <b>newfs <i>VotrePartitionObj</i></b>
    # <b>mount /usr/obj</b>
</pre>
que de faire "rm -rf /usr/obj".

<a name="ProbSKIPDIR"></a>
<h3>5.11.6 - Comment ne pas compiler certaines parties de l'arbre
         ?</h3>
Vous souhaiterez peut-être de pas compiler certaines parties de
l'arbre, typiquement parce que vous l'avez remplacé par une application
incluse dans un paquetage, ou parce que vous voulez créer une installation
"plus petite" pour diverses raisons.
La solution est d'utiliser l'option SKIPDIR de 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mk.conf&amp;sektion=5">/etc/mk.conf</a>.

<p>
Note : il est de ce fait possible de compiler des systèmes cassés.
Les résultats de cette option ne sont pas supportés par le projet
OpenBSD.

<a name="ProbMoreInfo"></a>
<h3>5.11.7 - Ou puis-je avoir plus d'informations sur le processus de
         compilation ?</h3>
<ul>
<li><a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=release&amp;sektion=8">release(8)</a>
<li><a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=afterboot&amp;sektion=8#COMPILING+A">afterboot(8)</a>
<li><a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=mk.conf&amp;sektion=5">mk.conf(5)</a>
<li><a
href="http://www.openbsd.org/cgi-bin/cvsweb/src/Makefile"><tt>/usr/src/Makefile</tt></a>
<li><a href="../../fr/stable.html">Branches Patchées</a> (<i>-stable</i>)
<li>(pour X) <tt>/usr/X11R6/README</tt> sur votre système

</ul>

<a name="NoSnaps"></a>
<h3>5.11.8 - Je ne vois aucun snapshot sur le site
       FTP. Ou sont-ils passés ?</h3>

<p>
Les snapshots peuvent être retirés lorsqu'ils deviennent anciens (ou
obsolètes) ou lorsque la sortie d'une <i>-release</i> approche.

<a name="NewCompiler"></a>
<h3>5.11.9 - Comment puis-je amorcer sur une
        nouvelle version du compilateur (<i>gcc</i>)?</h3>

Vous devriez vraiment <a href="#BldBinary">installer le dernier
snapshot</a>.

<p>
OpenBSD supporte désormais deux compilateurs dans l'arbre, gcc v3.3.5
par la plupart des plates-formes, et également gcc v2.95.3 utilisé par des
plates-formes qui n'ont pas encore été converties, ou qui ne seront pas
converties à cause des manques du support de gcc3 ou de ses performances
pauvres.

<p>
Les deux compilateurs sont dans des parties différentes de l'arbre :
<ul>
<li>gcc3: <tt>/usr/src/gnu/usr.bin/gcc</tt>
<li>gcc2: <tt>/usr/src/gnu/egcs/gcc</tt>
</ul>

<p>
Parce que la mise à niveau du compilateur est un peu comme le problème
du poulet et de l'oeuf, les changements sur le compilateur intégré à
l'arbre demandent une attention toute particulière.
Vous devez construire le compilateur deux fois -- la première
construction produit un compilateur qui génère un nouveau code mais
utilise l'ancien code pour fonctionner, la deuxième construction
construit un nouveau compilateur intégralement.
En général, vous voudrez réaliser la procédure suivante :

<pre>
    <b>Si votre plate-forme utilise gcc 2.95.3 :</b>
       # rm -r /usr/obj/gnu/egcs/gcc/*
       # cd /usr/src/gnu/egcs/gcc
        <i>- ou -</i>
    <b>Si votre plate-forme utilise gcc 3.3.5 :</b>
       # rm -r /usr/obj/gnu/usr.bin/gcc/*
       # cd /usr/src/gnu/usr.bin/gcc

    <b>Procédure commune de compilation pour v3.3.5 ou v2.95.3</b>
    # make -f Makefile.bsd-wrapper clean
    # make -f Makefile.bsd-wrapper obj
    # make -f Makefile.bsd-wrapper depend
    # make -f Makefile.bsd-wrapper
    # make -f Makefile.bsd-wrapper install
    # make -f Makefile.bsd-wrapper clean
    # make -f Makefile.bsd-wrapper depend
    # make -f Makefile.bsd-wrapper
    # make -f Makefile.bsd-wrapper install
</pre>

<p>
Puis lancer un <a href="#BldUserland">make build</a> classique.

<a name="UpdateEtc"></a>
<h3>5.11.10 - Quel est le meilleur moyen de
       mettre à jour <tt>/etc</tt>, <tt>/var</tt>, et
      <tt>/dev</tt> ?</h3>

<p>En tant que politique, les logiciels dans l'arbre OpenBSD ne modifient
pas de fichiers dans <tt>/etc</tt> automatiquement.
Cela signifie que les modifications à réaliser incombent <i>toujours</i>
à l'administrateur.
Les mises à niveau n'y font pas exception.
Pour mettre à jour les fichiers dans ces répertoires, déterminez tout
d'abord les changements qui ont été opérés sur les fichiers de la base
(distribution) et répétez manuellement ces changements.

<p>
Par exemple, pour voir les fichiers dans l'arbre qui ont changé
récemment, faîtes un :

<pre>
    # cd /usr/src/etc
    # ls -lt |more
</pre>

<!-- XXXversion -->
<p>Pour voir tous les changements dans le répertoire <tt>/etc</tt> entre
des versions arbitraires d'OpenBSD, vous pouvez utiliser <a
href="../../fr/anoncvs.html">CVS</a>.
Par exemple, pour voir les changements entre 4.5 et 4.6, faîtes un :

<pre>
    # cd /usr/src/etc
    # cvs diff -u -rOPENBSD_4_5 -rOPENBSD_4_6
</pre>

Pour voir les changements entre 4.6 et <i>-current</i> ("HEAD"),
utilisez :
<pre>
    # cd /usr/src/etc
    # cvs diff -u -rOPENBSD_4_6 -rHEAD
</pre>

Le script
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=MAKEDEV&amp;sektion=8&amp;arch=i386">/dev/MAKEDEV</a>
n'est pas mis à jour automatiquement lors du processus de compilation,
mais il est cependant installé comme partie de la <a
href="#BldBinary">mise à jour binaire</a>.
En règle générale, c'est une bonne idée que de copier (si besoin est) et
de lancer ce script depuis votre arbre des sources lors de la mise à
niveau :

<pre>
    # cd /dev
    # cp /usr/src/etc/etc.`machine`/MAKEDEV ./
    # ./MAKEDEV all
</pre>

<p>
Une fois que vous avez identifié les changements, appliquez à nouveau
ceci à votre arbre local, en préservant toute configuration que vous
auriez pu faire.

<p>
Les changements typiques de <tt>/etc</tt> à considérer, entre les
release concernent :

<ul>
<li>Additions à <tt>/etc/protocols</tt> et
<tt>/etc/services</tt></li>
<li>Nouveaux sysctls (regardez <tt>/etc/sysctl.conf</tt>)</li>
<li>Changements aux travaux de cron par défaut. Regardez <tt>/etc/daily</tt>,
  <tt>/etc/weekly</tt>, <tt>/etc/monthly</tt>, et
  <tt>/etc/security</tt>
<li>Tous les scripts rc, incluant netstart</li>
<li>Les changements de périphériques, regardez ci-dessus
<li>Les changements de la hiérarchie des fichiers dans
<tt>/etc/mtree</tt>, voyez <a href="#Hierarchy">ci-dessus</a>
<li>Les nouveaux utilisateurs (<tt>/etc/passwd</tt>) et groupes (<tt>/etc/group</tt>)
</ul>

<!-- XXXversion -->
Ces changements sont résumés dans
<a href="../upgrade46.html">upgrade46.html</a> (pour aller vers 4.6-release)
ou <a href="current.html">current.html</a> (pour aller vers
<i>-current</i>).


<a name="Hierarchy"></a>
<h3>5.11.11 -  Y a t'il un moyen facile de faire
      des changements sur tous les fichiers de la hiérarchie ?</h3>

<p>
De temps en temps, des fichiers et répertoires sont ajoutés, ou
supprimés dans le fichier
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hier&amp;sektion=7">hierarchy</a>.
Aussi, le possesseur de l'information pour les portions du système de
fichiers peut changer.
Un moyen facile de s'assurer que votre hiérarchie est à jour est
d'utiliser l'outil
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mtree&amp;sektion=8">mtree(8)</a>.

<p>
Tout d'abord, procurez vous les dernières sources, en faisant :

<pre>
    # cd /usr/src/etc/mtree
    # install -c -o root -g wheel -m 600 special /etc/mtree
    # install -c -o root -g wheel -m 444 4.4BSD.dist /etc/mtree
    # mtree -qdef /etc/mtree/4.4BSD.dist -p / -u
</pre>

<p>
Votre hiérarchie de fichiers devrait à présent être à jour.

<a name="ProbXComp"></a>
<h3>5.11.12 - Puis-je cross-compiler ? Pourquoi pas ?</h3>
Les outils de cross-compilation sont présent dans le système, et sont
utilisés par les développeurs lors de la création d'un nouveau port.
Cependant, ils ne sont pas maintenus pour une utilisation généralisée.

<p>
Lorsque les développeurs créent le support d'une nouvelle plate-forme,
l'un des premiers gros tests est la compilation native.
Compiler le système depuis les sources augmente très fortement la charge
de l'OS et de la machine, et permet de voir à quel point le système
fonctionne correctement.
Pour cette raison, OpenBSD réalise les compilations sur les plates-formes
que la compilation concerne, ceci est appelé le "native building".
Sans compilation native, il serait bien plus difficile de s'assurer que
les différentes plates-formes sont stables et qu'elles ne font pas que
booter.

<p>
<font color= "#0000e0">
<a href= "index.html">[Index de La FAQ]</a>
<a href= "faq4.html">[Section 4 - Guide d'Installation]</a>
<a href= "faq6.html">[Section 6 - Le réseau]</a>
</font>

<p>
<hr>
<a href= "index.html"><img height= "24" width= "24" src= "../../images/back.gif" border= "0" alt= "[back]"></a>
<a href= "mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: faq5.html,v 1.177 ]<br>
$Translation: faq5.html,v 1.115 2009/11/30 10:59:51 benoit Exp $<br>
-->
$OpenBSD: faq5.html,v 1.93 2009/11/30 13:23:49 ajacoutot Exp $ 
</small> 

</body>
</html>
