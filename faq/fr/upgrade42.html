<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>Guide de mise à niveau d'OpenBSD 4.2</title>
<link rev="made" href="mailto:www@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="resource-type" content="document">
<meta name="description"   content="OpenBSD Upgrade Process for 4.1 -> 4.2">
<meta name="keywords"      content="openbsd,faq,upgrade,4.2"> 
<meta name="distribution"  content="global">
<meta name="copyright"     content="This document copyright 2007 by OpenBSD">
</head>

<body bgcolor="#ffffff" text="#000000">
<a href="../../fr/index.html">
<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif" border="0">    
</a>
<p>
<font color="#0000e0">
<a href="upgrade35.html">[3.4 -> 3.5]</a> |
<a href="upgrade36.html">[3.5 -> 3.6]</a> |
<a href="upgrade37.html">[3.6 -> 3.7]</a> |
<a href="upgrade38.html">[3.7 -> 3.8]</a> |
<a href="upgrade39.html">[3.8 -> 3.9]</a> |
<a href="upgrade40.html">[3.9 -> 4.0]</a> |
<a href="upgrade41.html">[4.0 -> 4.1]</a> |
<a href="upgrade43.html">[4.2 -> 4.3]</a> |
<a href="index.html">[FAQ Index]</a>
</font>

<h1><font color="#e00000">Guide de Mise à niveau : 4.1 vers 4.2</font></h1>
<hr>

<i>Remarque : Les mises à niveau ne sont supportées que d'une release à
la suivante.
Ne sautez pas les releases.</i>

<p><i>
Il est hautement recommandé de lire entièrement la présente page et de
bien comprendre la procédure de mise à jour avant de l'appliquer.
Si vous comptez mettre à jour une machine critique ou physiquement
distante, il est recommandé d'essayer la procédure ci-après sur un
système local d'abord afin d'en vérifier le succès.
</i>

<p>
La mise à niveau est un moyen commode afin d'avoir votre système à jour
avec la version la plus récente.
Cependant, les résultats escomptés ne sont pas censés être précisément
ceux d'une installation de zéro.
Les fichiers d'anciennes bibliothèques en particulier ne sont pas
supprimés lors du processus de mise à niveau, car ils pourraient être
requis par de plus anciennes applications pouvant être ou non mises à
jour à ce moment précis.
Si vous voulez VRAIMENT vous débarrasser de ces anciens fichiers, vous
feriez probablement mieux de réinstaller complètement votre système.

<p>
Table des matières :
<ul>
<li><a href="#before">Avant de mettre à jour</a>
  <ul>
  <li><a href="#libexpat">Les paquetages utilisent désormais libexpat
      fournie avec X. xbase42.tgz est votre amie</a>
  <li><a href="#X7.2XF3">X.org v7.2 entre en scène, XF3 la quitte</a>
  <li><a href="#ahci">La mise à jour du pilote ahci peut potentiellement
      modifier la gestion des disques</a>
  <li><a href="#bgpd">Modification du langage de filtrage de bgpd</a>
  <li><a href="#ssh1">SSH protocol 1 déconseillé sur les nouvelles
      installations</a>
  <li><a href="#sudo">Modification du fonctionnement de la gestion
      d'environnement de sudo(8)</a>
  <li><a href="#dedc">[alpha uniquement] Certaines cartes réseau de(4)
      deviennent dc(4)</a>
  <li><a href="#acpi">[i386 uniquement] apm(4) est prioritaire par
      rapport à acpi(4)</a>
  <li><a href="#rc.conf">rc.conf</a>
  <li><a href="#kern">Noyau modifié</a>
  </ul>
<li><a href="#upgrade">Procédure de mise à jour</a>
<li><a href="#final">Etapes finales</a>
  <ul>
  <li><a href="#etcUpgrade">Mise à jour de <tt>/etc</tt></a>
  <li><a href="#Kernchk">Vérification du noyau</a>
  <li><a href="#Xup">Fichiers de configuration de X</a>
  <li><a href="#Pkgup">Mise à jour des paquetages</a>
  </ul> 
</ul>

<hr>
<p>
<a name="before"></a>
<h2>Avant de mettre à jour : Les éléments à savoir et dont il faut être
    conscient</h2>
Ceci n'est <i>pas</i> une liste complète des modifications qui ont été
effectuées depuis la version 4.1 jusqu'à la version 4.2, mais plutôt un
ensemble des éléments importants qui devraient impacter un grand nombre
d'utilisateurs durant le processus de mise à jour.
Pour une liste plus exhaustive de ces modifications, veuillez prendre
connaissance de <a href="../../plus42.html">plus42.html</a> et les
journaux des modifications CVS.

<!-- XXX add new stuff -->

<a name="libexpat"></a>
<ul>
<li><b>Les paquetages utilisent désormais libexpat fournie avec X.
       xbase42.tgz est votre amie :</b><br>
Le port libexpat a été supprimé. Les paquetages nécessitant cette
librairie utilisent désormais la version incluse avec X. Plusieurs
paquetages requièrent libexpat à travers d'autres dépendances. Par
exemple, la multitude de paquetages qui dépendent de gettext dépendent
aussi de libexpat.

<p>
Ceci veut dire que la plupart des systèmes qui n'utilisaient pas
auparavant X nécessitent désormais <tt>xbase42.tgz</tt>.
Si vous ne faites pas cela et essayez d'installer un paquetage nécessitant
libexpat, pkg_add(1) émettra un message d'erreur.

<p>
Veuillez aussi noter que la compilation des ports est uniquement
supportée si l'installation de votre système est complète incluant
<i>tous</i> les ensembles de fichiers X.

<p>
Enfin, une fois la mise à jour de tous les paquetages en versions
fournies avec OpenBSD 4.2, veuillez supprimer le paquetage libexpat devenu
obsolète :

<blockquote><pre>
# <b>pkg_delete expat</b>
</pre></blockquote>

<i>Ceci impactera un nombre important d'utilisateurs !</i>
Ceci fût une malheureuse décision dont les ramifications n'ont pas été
identifiées auparavant.
Pour la version 4.3, libexpat fera partie de <tt>base43.tgz</tt>, ce qui
résoudra ce problème.

<p>
<a name="X7.2XF3"></a>
<li><b>X.org v7.2 entre en scène, XF3 la quitte :</b><br>
Une nouvelle version de X a été fournie pour OpenBSD 4.2.
Votre ancienne configuration de X nécessitera éventuellement un
ajustement mais la plupart des utilisateurs se rendront compte qu'ils
n'ont même plus besoin d'un fichier de configuration X.

<p>
Au regard de l'adoption des versions plus récentes de X.org par OpenBSD,
le support de XF3 sur plate-forme i386 (seule plate-forme qui
l'utilisait encore) a été arrêté.
XF3 était uniquement nécessaire pour certaines puces vidéo très
anciennes qui n'étaient pas supportées par XF4 et X.org.
A priori, ceci n'impactera pas grand monde.

<p>
La nouvelle version de X.org change un nombre important de fichiers de
configuration. Par conséquence, une <a href="#Xup">section séparée</a> a
été dédiée pour le processus de mise à jour pour les utilisateurs X.

<p>
<a name="ahci"></a>
<li><b>La mise à jour du pilote
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ahci&amp;sektion=4">ahci</a>
      peut potentiellement modifier la gestion des disques :</b><br>
Les systèmes utilisant le pilote ahci(4) pourraient voir des disques
SATA précédemment reconnus et gérés par
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=wd&amp;sektion=4">wd(4)</a>
(i.e., wd0) devenir des périphériques
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sd&amp;sektion=4">sd(4)</a>
(i.e., sd0).
Veuillez observer la sortie <tt>dmesg</tt> au démarrage.
Un disque précédemment reconnu comme suit :

<p>
<blockquote><tt>
pciide1 at pci0 dev 31 function 2 "Intel 82801GBM AHCI SATA" rev 0x02: DMA, channel 0 wired to native-PCI, channel 1 wired to native-PCI<br>
pciide1: using apic 2 int 11 (irq 11) for native-PCI interrupt<br>
wd0 at pciide1 channel 0 drive 0: &lt;FUJITSU MHV2080BH&gt;<br>
wd0: 16-sector PIO, LBA48, 76319MB, 156301488 sectors<br>
wd0(pciide1:0:0): using PIO mode 4, Ultra-DMA mode 5
</tt></blockquote>

est maintenant reconnu de la façon suivante : 

<p>
<blockquote><tt>
ahci0 at pci0 dev 31 function 2 "Intel 82801GBM AHCI SATA" rev 0x02: AHCI 1.1: apic 2 int 16 (irq 11)<br>
scsibus1 at ahci0: 32 targets<br>
sd0 at scsibus1 targ 0 lun 0: &lt;ATA, FUJITSU MHV2080B, 0084&gt; SCSI2 0/direct fixed<br>
sd0: 76319MB, 76319 cyl, 64 head, 32 sec, 512 bytes/sec, 156301488 sec total
</tt></blockquote>

Ceci occasionnera des problèmes pour les personnes effectuant des mises
à jour à distance de ce type de machines. En effet, le fichier fstab
sera incorrect et le système ne démarrera pas.
Malheureusement, la manière dont le pilote gère le disque dépend de
beaucoup de paramètres tels que les configurations BIOS. Si quelqu'un a
une interface SATA AHCI, il devra au préalable expérimenter avec une
machine locale identique pour vérifier si le fichier <tt>/etc/fstab</tt>
n'a pas besoin d'être retravaillé.

<p>
Il semblerait que peu de personnes rencontreront un problème à la suite
de cette mise à jour étant donné que les composants ahci(4) sont assez
rares sur le matériel existant alors qu'ils ont tendance à devenir
beaucoup plus communs maintenant.

<p>
<a name="bgpd"></a>
<li><b>Modification du langage de filtrage de bgpd :</b><br>
Les filtres bgpd utilisant uniquement <tt>prefixlen</tt> comme paramètre
de filtrage devront inclure un identifiant de famille d'adresses tel que
<tt>inet</tt> ou <tt>inet6</tt> :

<p>
<blockquote><tt>
allow from any <b>inet</b> prefixlen 8 - 24<br>
deny from any <b>inet6</b> prefixlen &gt; 64<br>
</tt></blockquote>

<p>Veuillez noter que bgplg et les binaires associés sont désactivés
durant l'installation/mise à jour. Si vous les utilisez, vous devez les
réactiver suivant la procédure décrite dans la page du manuel de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bgplg&amp;sektion=8">bgplg(8)</a>.

<p>
<a name="ssh1"></a>
<li><b>SSH protocol 1 déconseillé sur les nouvelles
      installations :</b><br>
Les nouvelles installations d'OpenBSD n'accepteront pas les connexions
SSH v1 par défaut.
Le processus de mise à jour ne remplacera pas les fichiers de
configuration situés dans <tt>/etc/ssh</tt>
mais si vous souhaitez bénéficier de ce comportement, vous devez
remplacer manuellement les fichiers.
Le listing "diff" ci-après montre ce qui a été modifié :

<blockquote><pre>
--- ./etc/ssh/sshd_config       Sat Mar 10 20:31:32 2007
+++ ../42/etc/ssh/sshd_config   Tue Aug 28 11:59:52 2007
@@ -11,3 +11,2 @@
 #Port 22
-#Protocol 2,1
 #AddressFamily any
@@ -15,2 +14,7 @@  
 #ListenAddress :: 
+
+# Disable legacy (protocol version 1) support in the server for new
+# installations. In future the default will change to require explicit
+# activation of protocol 1
+Protocol 2
        
</pre></blockquote>

Encore une fois, nous vous signalons que cette modification n'est pas
prise en compte par le processus de mise à jour standard.

XXX
<p>
<a name="sudo"></a>
<li><b>Modification du fonctionnement de la gestion
      d'environnement de sudo(8) :</b><br>
Pour des 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sudo&amp;sektion=8#SECURITY+NOTES"
>raisons de sécurité</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sudo&amp;sektion=8">sudo(8)</a>
initialise désormais l'environnement à un petit ensemble de variables
par défaut dont uniquement quelques variables préservées à partir du
précédent environnement.

<p>
Afin qu'un nombre important d'éléments puisse continuer à fonctionner de
la façon attendue, le fichier correctif
<a href="#patchfile">ci-après</a> ajoutera une ligne "<tt>Defaults
env_keep</tt>" à votre fichier <tt>/etc/sudoers</tt> sinon il essaiera
de rendre ce fichier aussi proche que possible du fichier se trouvant
dans <tt>etc42.tgz</tt>. Il se pourrait cependant que le correctif ne
fonctionne pas.
Vous devriez vous assurer que votre fichier <tt>sudoers</tt> contient une
ligne ressemblant à la ligne suivante :
<blockquote><pre>
%wheel       ALL=(ALL) SETENV: ALL
  <i>-- ou --</i>
%wheel       ALL=(ALL) NOPASSWD: SETENV: ALL
</pre></blockquote>

ce qui suppose que vous souhaitez accorder aux membres du groupe "wheel"
les pouvoirs sudo absolus.
Après le passage du correctif, il serait plus prudent de tester sudo(8)
afin d'en valider le bon fonctionnement avant de se déconnecter du
système.

<p>
<a name="dedc"></a>
<li><b>[alpha uniquement] Certaines cartes réseau de(4)
      deviennent dc(4) :</b><br>
Sur la plate-forme <a href="../../fr/alpha.html">alpha</a>, certaines
cartes réseau précédemment supportées par le pilote
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=de&amp;sektion=4">de(4)</a>
sont désormais supportées par
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dc&amp;sektion=4">dc(4)</a>.

<p>
Si votre carte réseau en fait partie, vous devez modifier au moins vos
fichiers <tt>/etc/hostname.deX</tt> (astuce : lien en dur) et vos
fichiers pf.conf pour prendre en compte ce changement.

<p>
Nous vous rappellons que ceci est <i>uniquement</i> sur plate-forme
alpha.

<p>
<a name="acpi"></a>
<li><b>[i386 uniquement] apm(4) est prioritaire par
      rapport à acpi(4) :</b><br>
La détection de périphériques sur plate-forme i386 a été modifiée de
telle façon à ce que
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=apm&amp;sektion=4&amp;arch=i386">
apm(4)</a> soit prioritaire par rapport à
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=acpi&amp;sektion=4">
acpi(4)</a>.
Ce qui veut dire que si votre matériel contient aussi bien des
périphériques apm que acpi, seul apm sera pris en compte.
Si pour une raiso quelconque vous préférez utiliser acpi, désactivez
alors <tt>apm</tt> au niveau de votre noyau reconnaissant acpi à l'aide
de <tt>config(8)</tt> ou <tt>boot -c</tt>.

<p>
<a name="rc.conf"></a>
<li><b>rc.conf :</b><br>
Contrairement aux versions précédentes du processus, on considère depuis
la version <a href="upgrade41.html">4.1</a> d'OpenBSD que votre fichier
<tt>/etc/rc.conf</tt> n'a pas été altéré.
Si vous avez effectué des modifications dans <tt>/etc/rc.conf</tt>,
déplacez-les dans <tt>/etc/rc.conf.local</tt>.
Si vous n'avez PAS de fichier <tt>/etc/rc.conf.local</tt>, il suffit de
copier votre fichier <tt>/etc/rc.conf</tt> dans
<tt>/etc/rc.conf.local</tt> et <i>supprimez la dernière ligne du script
!</i>.
Autrement, reprenez votre <tt>rc.conf</tt> existant en haut de votre
<tt>rc.conf.local</tt> et <i>supprimez la dernière ligne</i> avant de
poursuivre le processus.

<p>
<a name="kern"></a>
<li><b>Noyau modifié :</b><br>
Vérifiez si vous avez apporté des modifications à votre noyau.
Par exemple, vous avez pu modifier votre périphérique réseau pour
utiliser un paramètrage différent du paramétrage par défaut à l'aide de
config(8).
Notez vos modifications afin que vous puissiez les reproduire avec le
nouveau noyau 4.2.

</ul>

<p>
<hr>
<a name="upgrade"></a>
<h2>Procédure de mise à jour</h2>

<h3>Mise à niveau avec un noyau d'installation</h3>
Si vous avez accès à la console système, la manière la plus facile et la
plus sûre pour effectuer une mise à jour à partir de fichiers binaires
consiste à démarrer depuis un média d'installation ou du noyau
<a href="faq4.html#bsd.rd">bsd.rd</a> et de suivre les étapes de mise à
jour; étapes fortement similaires à celles décrites dans la
<a href="faq4.html">procédure d'installation</a>. Ensuite, terminez la
mise à jour en suivant les <a href="#final">étapes finales</a>
ci-dessous.

<p>
Une solution simple pour démarrer sur le noyau d'installation est de
mettre le noyau <i>bsd.rd</i> de la version 4.2 à la racine de votre
lecteur de démarrage et de dire au chargeur de démarrage d'utiliser ce
nouveau fichier <i>bsd.rd</i>.
Sur amd64 et i386, vous pouvez entrer "<tt>boot bsd.rd</tt>" à l'invite
de commandes <tt>boot&gt;</tt>.

<h3>Mise à niveau sans noyau d'installation</h3>
<i>Ce n'est pas la solution recommandée. Utilisez le noyau
d'installation le plus souvent possible !</i>

<p>
De temps à autre, on pourrait avoir besoin de faire la mise à jour d'une
machine sans pouvoir utiliser le processus de mise à jour classique.
Le cas le plus courant est lorsque la machine est distante et que vous
n'avez pas accès à la console système.
On peut alors réaliser une mise à niveau depuis les sources :

<ul>
<li><b>Placez les fichiers d'installation dans un "bon" endroit</b>.
Assurez vous d'avoir la place suffisante !

<p>
<li><b>Stopper toutes les applications "insécurisées" de démarrage au
boot :</b>
Il y aura un moment ou PF ne sera pas le bienvenu pendant le processus
de mise à jour, mais vos applications continueront de démarrer et de
s'arrêter correctement.
Toute application dépendante de PF pour la sécurité devrait être
désactivée avant qu'un problème ne se produise, et ne devrait pas être
réactivée avant que le fonctionnement de PF après la mise à jour ait été
vérifié.
Il pourrait également y avoir d'autres applications que vous devriez
suspendre lors de la mise à jour, arrêtez et désactivez les de la même
manière.

<p>
<li><b>Vérification du noyau :</b>
Bien que <b>la plupart des gens peuvent sauter cette étape</b>, si vous
aviez un noyau modifié en 4.1 il est probable que vous devrez modifier
le noyau 4.2 de base. Surtout si vous effectuez une mise à jour à
distance, maintenant est le bon moment pour vérifier que le nouveau
noyau fonctionnera après le redémarrage de la machine. Si une
modification du noyau doit être effectuée, la façon la plus sûre est
de l'effectuer sur un système 4.2 local.
Cela peut être aussi simple que de modifier un périphérique spécifique
avec config(8) ou il peut être nécessaire de recompiler le noyau si
l'option que vous souhaitez n'est pas incluse dans le noyau GENERIC.
Consultez la section <a href="faq5.html">FAQ 5 - Construire le Système à
partir des Sources</a> avant d'envisager une recompilation de votre
noyau.

<p>
<li><b>Installez le(s) nouveau(x) noyau(x)</b>
<blockquote><pre>
<b>export RELEASEPATH=</b><i>/usr/rel</i>   <i># où mettre les fichiers</i>
<b>cd ${RELEASEPATH}</b>
<b>rm /obsd ; ln /bsd /obsd && cp bsd /nbsd && mv /nbsd /bsd</b>
<b>cp bsd.rd bsd.mp /</b>
</pre></blockquote>

Notez les étapes additionnelles pour copier par dessus un premier noyau
: celles-ci sont réalisées afin de s'assurer qu'il y ai toujours une
copie valide du noyau sur le disque et que le système puisse booter en
cas de coupure électrique ou de panne du système.

<p>
<li><b>Installez les nouveaux fichiers <tt>/etc/firmware</tt> :</b>
parce que certains "firmwares" aient pu être mis à jour, il est possible
que vous deviez mettre à jour le dossier <tt>/etc/firmware</tt>. Ceci
concerne les utilisateurs de certains périphériques, bien que tout
utilisateur devrait considérer cette étape.
Afin d'extraire les fichiers firmware de <tt>base42.tgz</tt>, tapez en
étant root les commandes suivantes :

<blockquote><pre>
<b>cd /</b>
<b>tar -C / -xzpf ${RELEASEPATH}/base42.tgz ./etc/firmware</b>
</pre></blockquote>

<p>
<li><b>Redémarrez votre système avec le nouveau noyau :</b>
Il peut être tentant de sauter cette étape, mais ceci devrait être fait
dès à présent, le nouveau noyau lancera d'anciennes applications
utilisateur (tel que la commande <tt>reboot</tt> ! qui sera importante
pour la suite) mais souvent un nouveau "userland" ne fonctionnera PAS
sur un ancien noyau.

<p>
<li><b>Installez les nouvelles applications du userland.</b>
<i>Ne PAS installer <tt>etc42.tgz</tt> ni <tt>xetc42.tgz</tt>
maintenant, car cela écrasera vos fichiers de configuration actuels
!</i>

<blockquote><pre>
<b>export RELEASEPATH=</b><i>/usr/rel</i>
<b>cd ${RELEASEPATH}</b>
<b>tar -C / -xzpf base42.tgz</b>
<b>tar -C / -xzpf comp42.tgz</b>
<b>tar -C / -xzpf game42.tgz</b>
<b>tar -C / -xzpf man42.tgz</b>
<b>tar -C / -xzpf misc42.tgz</b>
<b>tar -C / -xzpf xbase42.tgz</b>
<b>tar -C / -xzpf xfont42.tgz</b>
<b>tar -C / -xzpf xserv42.tgz</b>
<b>tar -C / -xzpf xshare42.tgz</b>
</pre></blockquote>

Remarque : tous les jeux de fichiers ne devront pas être installés pour
toutes les applications, cependant, si vous aviez installé originalement
un jeu de fichiers, vous devrez certainement le mettre à niveau avec le
nouveau jeu de fichiers.

<p>
Remarque : les fichiers appartenant à <tt>/etc</tt> sont gérés
séparément. C'est pourquoi les archives <tt>etc42.tgz</tt> et
<tt>xetc42.tgz</tt> ne sont PAS ouvertes à cette étape.

<p>
<li><b>Mettre à jour <tt>/dev</tt>.</b>
Le nouveau fichier
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=MAKEDEV&amp;sektion=8&amp;arch=i386">MAKEDEV</a>
sera copié dans /dev par l'installation de <tt>base42.tgz</tt>, vous
n'avez ainsi qu'à faire ce qui suit :
<blockquote><pre>
<b>cd /dev</b>
<b>./MAKEDEV all</b>
</pre></blockquote>

<p>
<li><b>Mise à niveau de <tt>/etc</tt> comme ci-dessous</b>.

<p>
<li><b>Redémarrez</b>
</ul>

Pendant ce processus,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sendmail&amp;sektion=8">sendmail(8)</a>
pourrait produire des messages d'erreur comme :
<pre>
        Nov 1 12:47:05 puffy sm-mta[16733]: filesys_update failed: No such
        file or directory, fs=., avail=-1, blocksize=380204
</pre>
Ces messages peuvent être ignorés sans risque, mais vous pourriez
vouloir arrêter sendmail(8) pendant la mise à niveau.

<p>

<hr>
<a name="final"></a>
<h2>Etapes finales</h2>

Que vous mettiez à jour à partir d'un noyau d'installation et en
utilisant le processus de mise à jour formel, ou en faisant une mise à
jour binaire "sur place", vous aurez besoin d'effectuer un certain nombre
d'étapes manuelles. 

<a name="etcUpgrade"></a>
<h3>1. Mise à jour de <tt>/etc</tt></h3>

<p>
Vous aurez besoin d'extraire les fichiers <tt>etc42.tgz</tt> dans un
endroit temporaire :
<blockquote><pre>
<b>tar -C /tmp -xzphf ${RELEASEPATH}/etc42.tgz</b>
</pre></blockquote>


Les fichiers suivants peuvent être probablement copiés "tels quels" à
partir de <tt>etc42.tgz</tt> :

<blockquote><pre>
etc/magic
etc/man.conf
etc/netstart
etc/rc
etc/rc.conf
etc/rpc
etc/services
etc/mail/helpfile
etc/mail/localhost.cf
etc/mail/sendmail.cf
etc/mail/submit.cf
etc/mtree/4.4BSD.dist
etc/mtree/BSD.local.dist
etc/mtree/special
</pre></blockquote>

Notez qu'il EST possible de modifier localement ces fichiers. Si vous
l'avez fait, une fusion manuelle est alors nécessaire.
Veuillez prêter une attention particulière à <tt>mail/*</tt> si vous
utilisez autre chose que la configuration Sendmail(8) par défaut.

Voici des lignes à copier/coller pour copier ces fichiers, en supposant
que vous avez extrait <tt>etc42.tgz</tt> à l'endroit précité :

<blockquote><pre>
<b>cd /tmp/etc
cp magic man.conf netstart rc rc.conf rpc services /etc
cp mtree/* /etc/mtree/
cp mail/helpfile mail/localhost.cf mail/submit.cf /etc/mail
cp mail/sendmail.cf /etc/mail     </b><i># Attention à cette commande !!</i>
</pre></blockquote>

<p>
<a name="patchfile"></a>
Les fichiers suivants doivent être fusionnés manuellement afin de
respecter tout changement local qui leur a été apporté par rapport à la
version par défaut. Autrement, ils peuvent être aussi copiés :

<blockquote><pre>
etc/ntpd.conf
etc/sensorsd.conf
etc/ssh/ssh_config
etc/ssl/x509v3.cnf
etc/sudoers
etc/sysctl.conf
etc/wsconsctl.conf
var/www/conf/httpd.conf
</pre></blockquote>

Les modifications apportées à ces fichiers se trouvent dans ce 
<a href="../upgrade42.patch">fichier correctif</a>.
Vous pouvez tenter de l'utiliser en exécutant les commandes suivantes
sous l'identité root :
<blockquote><pre>
<b>cd /</b>
<b>patch -C -p0 &lt; upgrade42.patch</b>
</pre></blockquote>

Ceci aura pour effet de tester le correctif afin de voir s'il va bien
s'appliquer à VOTRE système. Si vous voulez l'appliquer, il suffit
d'omettre l'option "<tt>-C</tt>".
Il est probable que si vous avez adapté ces fichiers à vos besoins ou si
vous ne l'avez pas maintenu à jour de manière stricte, ou si vous avez
mis à jour à partir d'un snapshot de 3.9, le correctif ne passera
peut-être pas de manière correcte.
Dans ces cas, vous devrez appliquer manuellement les modifications.
Veuillez tester ce processus avant de vous y fier pour mettre une
machine à laquelle vous n'avez pas un accès facile.

<p>
Les fichiers suivants comportent des modifications dont vous devez
prendre connaissance, mais il est peu probable qu'ils puissent être
directement copiés ou fusionnés (i.e. si vous utilisez bgpd.conf, prenez
connaissance de la stratégie de mise à jour suggérée, et décidez si oui
ou non elle est appropriée dans votre cas).

<blockquote><pre>
etc/bgpd.conf
etc/mail/spamd.conf
etc/ospfd.conf
etc/ssh/sshd_config
</pre></blockquote>

Enfin, utilisez
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=newaliases&amp;sektion=8">newaliases(8)</a>
pour mettre à jour la base de données des alias et
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mtree&amp;sektion=8">mtree(8)</a>
pour créer les éventuels nouveaux répertoires :
<blockquote><pre>
<b>newaliases</b>
<b>mtree -qdef /etc/mtree/4.4BSD.dist -p / -u</b>
</pre></blockquote>

<a name="Kernchk"></a>
<h3>2. Vérification du noyau</h3>
Remarque : <b>la plupart des gens peuvent sauter cette étape !</b>
<p>
Si vous avez suivi les instructions de mise à niveau sans noyau
d'installation vous aurez déjà accompli cette étape.
En revanche, si vous utilisez le média d'installation et si vous aviez
un noyau modifié en 4.1 il est probable que vous devriez modifier le
noyau 4.2 de base. Cela peut être aussi simple que de modifier un
périphérique spécifique avec config(8) ou il peut être nécessaire de
recompiler le noyau si l'option que vous souhaitez n'est pas incluse
dans le noyau GENERIC.
Consultez la section <a href="faq5.html">FAQ 5 - Construire le Système à
partir des Sources</a> avant d'envisager une recompilation de votre
noyau.

<a name="Xup"></a>
<h3>3. Fichiers de configuration X</h3>
Au regarde des modifications significatives apportées à X dans cette
version, la façon la plus aisée de mettre à jour X pour la version 4.2
consiste à sauvegarder vos fichiers de configuration X, extraire
xetc42.tgz, et fusionnez manuellement les modifications que vous avez
précédemment effectué.

<p>
Les fichiers qu'il faudrait probablement sauvegarder sont
<tt>/etc/X11/xorg.conf</tt> et <tt>/etc/X11/xinit/xinitrc</tt>.
Etant donné que désormais X marche souvent sans nécessiter de fichier
xorg.conf, vous devriez l'essayer avant de copier les fichiers dans les
sens contraire.

<p>
Extraire xetc42.tgz de la même façon que les autres ensembles de
fichiers :
<blockquote><pre>
<b>export RELEASEPATH=/usr/rel
cd ${RELEASEPATH}
tar -C / -xzphf xetc42.tgz
</b></pre></blockquote>

<p>

<a name="Pkgup"></a>
<h3>4. Mise à jour des paquetages</h3>
Si vous avez installé des paquetages sur votre machine vous devriez les
mettre à jour après la mise à niveau de votre système de base.
Attention cependant car de nombreux paquetages nécessiteront une
manipulation supplémentaire avant et/ou après avoir été mis à jour.
Référez-vous au guide de mise à niveau de l'application pour de plus
amples informations.

<p>
Les paquetages suivants sont connus pour avoir certains problèmes lors
de la mise à niveau pouvant impacter un grand nombre d'utilisateurs.
Le fait qu'un paquetage ne soit pas listé ne signifie en rien que sa
mise à jour sera aisée.
Vous devez vous renseigner sur les applications que VOUS utilisez.

<ul>
<li><b>xfce :</b> Le répertoire de configuration et les fichiers ont
complètement changé. Vous devriez probablement re-créer votre
configuration à partir de zéro.
</ul>

<p>
Avant de continuer, il y a certaines modifications majeures au niveau de
la version 4.2 dont vous devriez prendre connaissance :

<ul>
<li>Le port libexpat a été supprimé et les paquetages utilisent
désormais la librairie fournie avec X11.
Plusieurs paquetages dépendent de libexpat directement ou via d'autres
dépendances.
Par exemple, tous les paquetages qui nécessitent gettext dépendent aussi
de libexpat. Ceci signifie qu'avant de pouvoir ajouter ou mettre à jour
des paquetages, vous aurez très probablement besoin d'installer
<tt>xbase42.tgz</tt> au préalable même si les paquetages que vous
souhaitez installer n'ont aucune fonction graphique.
Veuillez prendre connaissance de la
<a href="faq4.html#AddFileSet">FAQ</a> pour ajouter
<tt>xbase42.tgz</tt> à un système installé.
Si vous ne faites pas cela et vous essayez d'installer un paquetage qui
requiert libexpat, pkg_add(1) émettra un message d'erreur.

<li>Si vous utilisez pkg_add(1) en combinaison avec sudo(8), vous devez
modifier votre <tt>/etc/sudoers</tt> de la même façon que <a
href="#patchfile">le fichier correctif</a> tente de le faire.
Veuillez prendre connaissance des <a href="#sudo">modifications
apportées à sudo(8)</a> pour plus d'informations.

</ul>
Les utilitaires de gestion des paquetages ("pkg tools") supportent la
mise à jour avec la commande <tt>pkg_add -u</tt>.
Par exemple, pour mettre à jour tous vos paquetages, soyez certains que
<tt>PKG_PATH</tt> pointe bien vers le répertoire contenant les paquetages
4.2 sur votre CD ou un miroir FTP proche et utilisez une commande du
type

<blockquote><pre>
<b># pkg_add -ui -F update -F updatedepends</b>
</pre></blockquote>

où <tt>-u</tt> indique le mode mise à jour et <tt>-i</tt> le mode
interactif, ainsi pkg_add vous demandera ce que vous souhaitez faire
lorsque celui-ci rencontrera une ambiguïté. Lisez le manuel de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pkg_add&amp;sektion=1&amp;manpath=OpenBSD+4.2">pkg_add(1)</a>
et le chapitre de la FAQ sur la <a href="faq15.html#PkgMgmt">gestion
des paquetages</a> pour de plus amples informations.

<p>
Vous verrez certainement quelque chose comme cela après avoir lancé la
commande précédente :
<blockquote><pre>
Looking for updates: complete
Cannot find updates for expat-2.0.0
Proceed? [y/N] 
</pre></blockquote>

Cela indique que vous être tombé sur le problème de libexpat et que
vous devez à présent installer <tt>xbase42.tgz</tt> comme indiqué
précédemment.
Si vous n'avez pas installé xbase42.tgz, il est recommandé d'arrêter la
mise à jour des paquetages, d'installer xbase42.tgz puis de relancer la
procédure de mise à jour des paquetages.

<p>
Enfin, après la mise à jour, supprimez l'ancien paquetage expat de votre
système :

<blockquote><pre>
# <b>pkg_delete expat</b>
</pre></blockquote>

<p>
<font color="#0000e0">
<a href="upgrade35.html">[3.4 -> 3.5]</a> |
<a href="upgrade36.html">[3.5 -> 3.6]</a> |
<a href="upgrade37.html">[3.6 -> 3.7]</a> |
<a href="upgrade38.html">[3.7 -> 3.8]</a> |
<a href="upgrade39.html">[3.8 -> 3.9]</a> |
<a href="upgrade40.html">[3.9 -> 4.0]</a> |
<a href="upgrade41.html">[4.0 -> 4.1]</a> |
<a href="upgrade43.html">[4.2 -> 4.3]</a> |
<a href="index.html">[FAQ Index]</a>
</font>

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../images/back.gif" border="0" alt="[back]"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: upgrade42.html,v 1.28 ]<br>
$Translation: upgrade42.html,v 1.7 2008/05/01 23:37:02 gapz Exp $<br>
-->
$OpenBSD: upgrade42.html,v 1.4 2008/05/02 07:47:40 tobias Exp $
</small>

</body>
</html>
