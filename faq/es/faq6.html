<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>6 - Redes</title>
<link rev="made" href="mailto:www@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta http-equiv="Content-Language" content="es">
<meta name="resource-type" content="documento">
<meta name="description"   content="Preguntas Frecuentes de OpenBSD">
<meta name="keywords"      content="openbsd,faq,documentación">
<meta name="distribution"  content="global">
<meta name="copyright"     content="Este documento es copyright 1998-2004 de OpenBSD.">
</head>

<body bgcolor="#ffffff" text="#000000">
<!-- máx. 72 caracteres por línea -->

<img alt="[OpenBSD]" height="30" width="141" src="../../images/smalltitle.gif">
<p>
<font color="#0000e0">
<a href="index.html">[&Iacute;ndice de documentos]</a>
<a href="faq5.html">[Secci&oacute;n 5 - Compilaci&oacute;n del sistema
con el c&oacute;digo fuente]</a>
<a href="faq7.html">[Secci&oacute;n 7 - Controles de teclado y
pantalla]</a>
</font>

<h1><font color="#e00000">6 - Redes</font></h1>

<hr>

<p>
<h3>&Iacute;ndice de contenidos</h3>
<ul>
<li><a href="#Intro">6.1 - Introducci&oacute;n</a>
<li><a href="#Setup">6.2 - Configuraci&oacute;n inicial de la red</a>
<li><a href="#PF">6.3 - C&oacute;mo montar un filtro de red y
cortafuegos con OpenBSD</a>
<li><a href="#DHCP">6.4 - El Protocolo de Configuraci&oacute;n para
Anfitriones Din&aacute;micos (DHCP)</a>
<li><a href="#PPP">6.5 - Protocolo Punto a Punto (PPP)</a>
<li><a href="#Tuning">6.6 - Ajuste de par&aacute;metros de red</a>
<li><a href="#NFS">6.7 - C&oacute;mo usar el Sistema de Archivos de Red
(NFS)</a>
<li><a href="#PPTP">6.8 - Configuraci&oacute;n de una conexi&oacute;n
PPTP en OpenBSD</a>
<li><a href="#Bridge">6.9 - C&acute;mo configurar un &laquo;puente de
red&raquo; (<i>bridge</i>) con OpenBSD</a>
</ul>

<hr>

<p>
<a name="Intro"></a>
<h2>6.1 - Introducci&oacute;n</h2>

<p>
Para la comprensi&oacute;n de la mayor parte de este documento
ser&aacute; de gran ayuda haber le&iacute;do antes, y por lo menos haber
asimilado en parte, el cap&iacute;tulo 5 sobre la
<a href="faq5.html">&laquo;Configuraci&oacute;n del
N&uacute;cleo&raquo;</a> de estos documentos, as&iacute; como las
p&aacute;ginas del manual de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>
y de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&amp;sektion=1">netstat(1)</a>.

<p>
Tanto si se es un administrador de redes que est&aacute; configurando
protocolos de enrutamiento, como si se est&aacute; usando el sistema
OpenBSD como un enrutador, como si se necesita conocer m&aacute;s a
fondo los protocolos de redes IP, es realmente necesario leer
<a href="http://www.3com.com/other/pdfs/infra/corpinfo/en_US/501302.pdf">
Understanding IP addressing</a>
&iexcl;Es un documento excelente que contiene conocimientos
b&aacute;sicos fundamentales sobre redes IP!

<p>
Si se est&aacute; trabajando con aplicaciones como servidores de http,
servidores de ftp y servidores de correo, ser&aacute; muy beneficioso
leer los <a href="http://the.rfc-editor.org/rfc.html">RFC</a>.

<p>
<i>(Nota: existe un proyecto de traducci&oacute;n de documentos RFC al
castellano, <a href="http://www.rfc-es.org/">RFC-ES</a>)</i>

<p>
Pero lo m&aacute;s seguro es que no se puedan leer todos, y por ello lo
m&aacute;s pr&aacute;ctico es seleccionar algunos temas de
inter&eacute;s o aquellos que se usen en el entorno de red del que se
disponga.  Es aconsejable leerlos al mismo tiempo que se intenta
averiguar su funcionamiento.  Los RFC definen much&iacute;simas (miles)
de las normas para protocolos en Internet y c&oacute;mo se supone que
deben funcionar estos protocolos.

<p>
<a name="Setup"></a>
<h2>6.2 - Configuraci&oacute;n inicial de la red</h2>

<p>
<a name="Setup.1"></a>
<h3>6.2.1 - Identificaci&oacute;n y configuraci&oacute;n de las
interfaces de red</h3>

<p>
Para empezar a configurar una red, lo primero que se debe hacer es
identificar la interfaz de red.  En OpenBSD las interfaces se designan
por el tipo de tarjeta, no por el tipo de conexi&oacute;n.  La tarjeta
de red se puede ver durante el arranque mientras se inicia el sistema, o
despu&eacute;s del arranque usando la orden
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dmesg&amp;sektion=8">dmesg(8)</a>.
Tambi&eacute;n es posible ver la interfaz de red usando la orden
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>.
Por ejemplo, v&eacute;ase a continuaci&oacute;n la salida originada por
dmesg para una tarjeta de red Intel Fast Ethernet, que usa el nombre de
dispositivo <i>fxp</i>.

<blockquote>
<pre>
fxp0 at pci0 dev 10 function 0 &quot;Intel 82557&quot; rev 0x0c: irq 5, address 00:02:b3:2b:10:f7
inphy0 at fxp0 phy 1: i82555 10/100 media interface, rev. 4
</pre>
</blockquote>

<p>
Si no se conoce el nombre del dispositivo, se puede buscar en la
<a href="../../es/plat.html">lista de hardware con soporte</a> de la
plataforma correspondiente.  En esa p&aacute;gina hay un listado con
muchos nombres de tarjetas comunes junto con los nombres de dispositivo
que les corresponde en OpenBSD.  Combinando el nombre alfab&eacute;tico
abreviado (como <i>fxp</i>) con un n&uacute;mero asignado por el
n&uacute;cleo del sistema se obtendr&aacute; el nombre de la interfaz
(como <i>fxp0</i>).

<p>
Se puede averiguar qu&eacute; interfaces de red han sido identificadas
por el sistema mediante la utilidad 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>.
La orden siguiente mostrar&aacute; todas las interfaces de red que
existan en un sistema.  En este ejemplo s&oacute;lo se ha encontrado una
interfaz f&iacute;sica de ethernet, la
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fxp&amp;sektion=4">
fxp(4)</a>.

<blockquote>
<pre>
$ <b>ifconfig -a</b>
lo0: flags=8049&lt;UP,LOOPBACK,RUNNING,MULTICAST&gt; mtu 33224
        inet 127.0.0.1 netmask 0xff000000
        inet6 ::1 prefixlen 128
        inet6 fe80::1%lo0 prefixlen 64 scopeid 0x5
lo1: flags=8008&lt;LOOPBACK,MULTICAST&gt; mtu 33224
fxp0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
        address: 00:04:ac:dd:39:6a
        media: Ethernet autoselect (100baseTX full-duplex)
        status: active
        inet 10.0.0.38 netmask 0xffffff00 broadcast 10.0.0.255
        inet6 fe80::204:acff:fedd:396a%fxp0 prefixlen 64 scopeid 0x1
pflog0: flags=0&lt;&gt; mtu 33224
pfsync0: flags=0&lt;&gt; mtu 2020
sl0: flags=c010&lt;POINTOPOINT,LINK2,MULTICAST&gt; mtu 296
sl1: flags=c010&lt;POINTOPOINT,LINK2,MULTICAST&gt; mtu 296
ppp0: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1500
ppp1: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1500
tun0: flags=10&lt;POINTOPOINT&gt; mtu 3000
tun1: flags=10&lt;POINTOPOINT&gt; mtu 3000
enc0: flags=0&lt;&gt; mtu 1536
bridge0: flags=0&lt;&gt; mtu 1500
bridge1: flags=0&lt;&gt; mtu 1500
vlan0: flags=0&lt;&gt; mtu 1500
        address: 00:00:00:00:00:00
vlan1: flags=0&lt;&gt; mtu 1500
        address: 00:00:00:00:00:00
gre0: flags=9010&lt;POINTOPOINT,LINK0,MULTICAST&gt; mtu 1450
gif0: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1280
gif1: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1280
gif2: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1280
gif3: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1280
</pre>
</blockquote>

<p>
Como se puede comprobar, 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>
muestra mucha m&aacute;s informaci&oacute;n de la que necesitamos en
este momento.  Pero aqu&iacute; lo importante es que nos permite ver
nuestra interfaz.  En el ejemplo, la tarjeta de la interfaz ya
est&aacute; configurada.  Esto es obvio porque ya hay una red IP
configurada en fxp0, y de aqu&iacute; los valores &quot;inet 10.0.0.38
netmask 0xffffff00 broadcast 10.0.0.255&quot;.  Adem&aacute;s, los
indicadores <b>UP</b> y <b>RUNNING</b> se encuentran activados.

<p>
Finalmente, n&oacute;tese que hay otras interfaces que tambi&eacute;n se
encuentran activadas de modo predeterminado.  &Eacute;stas son
interfaces virtuales que tienen varias funciones.  Las siguientes
p&aacute;ginas del manual las describen:

<ul>
<!-- XXXrelease -->
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lo&amp;sektion=4">lo</a> - Interfaz de circuito cerrado (<i>loopback</i>)
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+3.4">pflog</a> - Interfaz de registros del Filtro de Paquetes (<i>PF</i>)
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sl&amp;sektion=4">sl</a> - Interfaz de red SLIP
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&amp;sektion=4">ppp</a> - Protocolo punto a punto (PPP)
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tun&amp;sektion=4">tun</a> - Interfaz de red por t&uacute;nel
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=enc&amp;sektion=4">enc</a> - Interfaz de encapsulamiento
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridge&amp;sektion=4">bridge</a> - Interfaz de puente Ethernet
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vlan&amp;sektion=4">vlan</a> - Interfaz de encapsulaci&oacute;n IEEE 802.1Q
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gre&amp;sektion=4">gre</a> - Interfaz de encapsulaci&oacute;n GRE/MobileIP
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gif&amp;sektion=4">gif</a> - Interfaz de t&uacute;nel IPv4/IPv6 gen&eacute;rica
</ul>

<p>
Si a&uacute;n no se ha configurado la interfaz, el primer paso
ser&aacute; crear el fichero <tt>/etc/hostname.xxx</tt>, donde se debe
sustituir <tt>xxx</tt> por el nombre de la interfaz.  De acuerdo con la
informaci&oacute;n de los ejemplos anteriores, el nombre ser&iacute;a
<tt>/etc/hostname.fxp0</tt>.  La composici&oacute;n de este fichero es
as&iacute; de sencilla:<br>

<blockquote>
<pre>
address_family address netmask broadcast [other options]
</pre>
</blockquote>

<p>
(Se puede ver m&aacute;s informaci&oacute;n sobre el formato de este
fichero en la p&aacute;gina del manual de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&amp;sektion=5">hostname.if(5)</a>)

<p>
El fichero de configuraci&oacute;n de una interfaz t&iacute;pica,
configurada para una direcci&oacute;n de IPv4, debe ser algo como lo
siguiente:

<blockquote>
<pre>
$ <b>cat /etc/hostname.fxp0</b>
inet 10.0.0.38 255.255.255.0 NONE
</pre>
</blockquote>

<p>
Tambi&eacute;n se podr&iacute;a especificar tipos de medio para
Ethernet;  por ejemplo, si se quisiera forzar el modo 100baseTX
full-duplex:

<blockquote><pre>
inet 10.0.0.38 255.255.255.0 NONE media 100baseTX mediaopt full-duplex
</pre></blockquote>

<p>
Aunque nunca se debe forzar el modo <i>full duplex</i>, a menos que
ambas partes de la conexi&oacute;n est&eacute;n configuradas para ello.
A menos que sea necesario por alg&uacute;n motivo especial, la
configuraci&oacute;n del tipo de medio se debe excluir.

<p>
Para especificar una interfaz determinada se puede usar indicadores
especiales, en cuyo caso el formato del fichero <i>hostname</i> no
cambiar&iacute;a mucho:

<blockquote><pre>
$ <b>cat /etc/hostname.vlan0</b>
inet 172.21.0.0 255.255.255.0 NONE vlan 2 vlandev fxp1
</pre></blockquote>

<p>
El siguiente paso ser&aacute; la configuraci&oacute;n de la pasarela
(<i>gateway</i>) predeterminada.  Para ello basta con poner la
direcci&oacute;n IP de la pasarela en el fichero <tt>/etc/mygate</tt>.
Esto permitir&aacute; que la pasarela se active en el momento del
arranque.  A continuaci&oacute;n hay que configurar los nombres de
servidores (<i>nameservers</i>) y el fichero <tt>/etc/hosts</tt>
(v&eacute;ase la p&aacute;gina del manual de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5">hosts(5)</a>).
Para configurar los nombres de servidores, antes se debe crear un
fichero con el nombre <tt>/etc/resolv.conf</tt>.  Puede verse m&aacute;s
informaci&oacute;n sobre el formato de este fichero en la p&aacute;gina
del manual de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&amp;sektion=5">resolv.conf(5)</a>.
El siguiente ejemplo es para un uso t&iacute;pico.  En este ejemplo los
servidores de dominio son 125.2.3.4 y 125.2.3.5.  Y tambi&eacute;n se es
parte del dominio &laquo;example.com&raquo;:

<blockquote>
<pre>
$ <b>cat /etc/resolv.conf</b>
search example.com
nameserver 125.2.3.4
nameserver 125.2.3.5
lookup file bind
</pre>
</blockquote>

<p>
Desde este punto ya se puede reiniciar o bien ejecutar el gui&oacute;n
de configuraci&oacute;n (<i>script</i>) <b>/etc/netstart</b>.  Este
gui&oacute;n de configuraci&oacute;n se ejecuta como superusuario
(<i>root</i>) del siguiente modo:

<blockquote>
<pre>
# <b>sh /etc/netstart</b>
writing to routing socket: File exists
add net 127: gateway 127.0.0.1: File exists
writing to routing socket: File exists
add net 224.0.0.0: gateway 127.0.0.1: File exists
</pre>
</blockquote>

<p>
N&oacute;tese que se ha producido un peque&ntilde;o n&uacute;mero de
errores.  Pero al ejecutar este gui&oacute;n, se reconfingurar&aacute;n
cosas que ya se hab&iacute;an configurado anteriormente.  De hecho,
algunas rutas ya existen en la tabla de enrutamiento del n&uacute;cleo
del sistema.  Desde aqu&iacute;, el sistema deber&iacute;a funcionar con
normalidad.  Se puede realizar una comprobaci&oacute;n con
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>
para asegurarse de que la interfaz se ha configurado correctamente.
Tambi&eacute;n es posible comprobar las rutas con
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&amp;sektion=1">netstat(1)</a> o <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=route&amp;sektion=8">route(8)</a>.
Si tenemos problemas con el enrutamiento, podemos usar el indicador
<tt>-n</tt> para la orden route(8), que muestra las direcciones de IP en
lugar de realizar una b&uacute;squeda de DNS y mostrar el
<i>hostname</i>.  He aqu&iacute; un ejemplo en el que se muestran las
tablas de enrutamiento usando sendos programas:

<blockquote>
<pre>
$ <b>netstat -rn</b>
Routing tables

Internet:
Destination        Gateway            Flags     Refs     Use    Mtu  Interface
default            10.0.0.1           UGS         0       86      -  fxp0
127/8              127.0.0.1          UGRS        0        0      -  lo0
127.0.0.1          127.0.0.1          UH          0        0      -  lo0
10.0.0/24          link#1             UC          0        0      -  fxp0
10.0.0.1           aa:0:4:0:81:d      UHL         1        0      -  fxp0
10.0.0.38          127.0.0.1          UGHS        0        0      -  lo0
224/4              127.0.0.1          URS         0        0      -  lo0

Encap:
Source             Port  Destination        Port  Proto SA(Address/SPI/Proto)

$ <b>route show</b>
Routing tables

Internet:
Destination      Gateway            Flags
default          10.0.0.1           UG
127.0.0.0        LOCALHOST          UG
localhost        LOCALHOST          UH
10.0.0.0         link#1             U
10.0.0.1         aa:0:4:0:81:d      UH
10.0.0.38        LOCALHOST          UGH
BASE-ADDRESS.MCA LOCALHOST          U
</pre>
</blockquote>

<p>
<a name="Setup.2"></a>
<h3>6.2.2 - Configuraci&oacute;n del sistema OpenBSD como pasarela
(<i>gateway</i>)</h3>

<p>
Lo que sigue es la informaci&oacute;n b&aacute;sica necesaria para
configurar el sistema OpenBSD como una pasarela (tambi&eacute;n llamada
&laquo;enrutador&raquo; o &laquo;encaminador&raquo;).  Si se va a usar
OpenBSD como un enrutador en Internet, sugerimos la lectura de la
secci&oacute;n que contiene las instrucciones sobre la
configuraci&oacute;n del Filtro de Paquetes IP (PF), para poder bloquear
el tr&aacute;fico que sea potencialmente malicioso.  Adem&aacute;s,
debido a la escasa disponibilidad de direcciones de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ip&amp;sektion=4">
IPv4</a> en los proveedores de servicios de redes y registros
regionales, es conveniente leer la secci&oacute;n sobre la
Traducci&oacute;n de Direcciones de Red (NAT), que contiene
informaci&oacute;n sobre c&oacute;mo conservar el espacio de
direcci&oacute;n IP.

<p>
El n&uacute;cleo GENERIC posee la capacidad de permitir el
reenv&iacute;o de IP (<i>IP Forwarding</i>), pero antes debe ser
activado.  Para activarlo hay que usar la utilidad
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8">sysctl(8)</a>;
y para que los cambios sean permanentes hay que editar el fichero
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5">/etc/sysctl.conf(5)</a>
y activar <i>IP Forwarding</i> en &eacute;ste.  Esto se puede hacer
a&ntilde;adiendo la siguiente l&iacute;nea a ese fichero de
configuraci&oacute;n:

<blockquote>
<pre>
net.inet.ip.forwarding=1
</pre>
</blockquote>

<p>
Para que este cambio surja efecto sin que haya que reiniciar el sistema,
hay que usar directamente la utilidad
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8">sysctl(8)</a>.
Recu&eacute;rdese que este cambio ya no existir&aacute; inmediatamente
despu&eacute;s de reiniciar, y que es necesario ejecutarlo como
superusuario:

<blockquote>
<pre>
# <b>sysctl -w net.inet.ip.forwarding=1</b>
net.inet.ip.forwarding: 0 -&gt; 1
</pre>
</blockquote>

<p>
A continuaci&oacute;n se deben modificar las rutas en los otros
anfitriones, en ambos extremos.  OpenBSD ofrece muchas posibilidades de
utilizaci&oacute;n como enrutador, usando <i>software</i> como 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=routed&amp;sektion=8">routed(8)</a>,
<a href="http://www.gated.org">gated</a>, <a href="http://www.mrtd.net">mrtd</a> y <a href="http://www.zebra.org">zebra</a>.
OpenBSD dispone de soporte para zebra, gated y mrtd en la
colecci&oacute;n de portes, e incluye soporte para varias interfaces T1,
HSSI, ATM, FDDI, Ethernet, e interfaces de serie (PPP/SLIP).

<p>
<a name="Setup.3"></a>
<h3>6.2.3 - Configuraci&oacute;n de un alias en una interfaz</h3>

<p>
OpenBSD dispone de un sencillo mecanismo para la configuraci&oacute;n de
los alias de IP en una interfaz.  Lo &uacute;nico que hay que hacer para
configurar los alias es editar el fichero
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&amp;sektion=5"><tt>/etc/hostname.&lt;if&gt;</tt></a>.
El gui&oacute;n de ejecuci&oacute;n
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&amp;sektion=8">/etc/rc(8)</a>,
que forma parte de la <a href="faq10.html#rc">jerarqu&iacute;a de inicio
rc</a>, leer&aacute; este fichero durante el proceso de inicio del
sistema.  Por ejemplo, supongamos que el usuario tiene una interfaz
<b>dc0</b> y pertenece a la red 192.168.0.0.  Otra informaci&oacute;n de
importancia es:

<ul>
<li>IP para dc0 es 192.168.0.2
<li>NETMASK es 255.255.255.0
</ul>

<p>
Notas sobre los alias:  en OpenBSD s&oacute;lo se usa el nombre de la
interfaz y no existen diferencias entre el primer alias y el segundo;
por lo tanto, y a diferencia de otros sistemas operativos, en OpenBSD no
hay que referirse a ellos como dc0:0 y dc0:1.  Si hacemos referencia a
una direcci&oacute;n de IP alias espec&iacute;fica con ifconfig, o si
estamos a&ntilde;adiendo un alias, debemos asegurarnos de escribir
'<kbd>ifconfig int alias</kbd>', en lugar de '<kbd>ifconfig int</kbd>',
en la l&iacute;nea de &oacute;rdenes.  Los alias se pueden eliminar con
la orden '<kbd>ifconfig int delete</kbd>'.

<p>
Asumiendo que se est&eacute;n usando direcciones de IP m&uacute;ltiples
que se encuentran en la misma subred IP con alias, la
configuraci&oacute;n de la m&aacute;scara de red (<i>netmask</i>) para
cada alias pasa a ser 255.255.255.255.  No necesitan seguir la
m&aacute;scara de red del primer IP vinculado a la interfaz.  En el
siguiente fichero <tt>/etc/hostname.dc0</tt> de ejemplo, se han
a&ntilde;adido dos alias al dispositivo <b>dc0</b>, el cual, por cierto,
se ha configurado como 192.168.0.2 netmask 255.255.255.0:

<blockquote>
<pre>
# <b>cat /etc/hostname.dc0</b>
inet 192.168.0.2 255.255.255.0 media 100baseTX
inet alias 192.168.0.3 255.255.255.255
inet alias 192.168.0.4 255.255.255.255
</pre>
</blockquote>

<p>
Una vez que se haya configurado este fichero, ser&aacute; necesario
reiniciar para que los cambios funcionen.  Aunque tambi&eacute;n es
posible hacer efectivos los alias a mano, usando la utilidad
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>.
Para hacer efectivo el primer alias se usar&iacute;a la orden:

<blockquote>
<pre>
# <b>ifconfig dc0 inet alias 192.168.0.3 netmask 255.255.255.255</b>
</pre>
</blockquote>

<p>
Para ver estos alias se usar&iacute;a la orden:

<blockquote>
<pre>
$ <b>ifconfig -A</b>
dc0: flags=8863&lt;UP,BROADCAST,NOTRAILERS,RUNNING,SIMPLEX,MULTICAST&gt;
        media: Ethernet manual
        inet 192.168.0.2  netmask 0xffffff00 broadcast 192.168.0.255
        inet 192.168.0.3 netmask 0xffffffff broadcast 192.168.0.3
</pre>
</blockquote>


<p>
<a name="NAT"></a>
<a name="PF"></a>
<h2>6.3 - C&oacute;mo montar un filtro de red y un cortafuegos con
OpenBSD</h2>

<p>
El Filtro de Paquetes (a partir de aqu&iacute; PF) es el sistema de
OpenBSD para filtrar el tr&aacute;fico TCP/IP y realizar las tareas de
Traducci&oacute;n de Direcciones de Red (NAT).  PF tambi&eacute;n puede
normalizar y acondicionar el tr&aacute;fico TCP/IP y proveer control del
ancho de banda y priorizaci&oacute;n de paquetes, y se puede utilizar
para crear cortafuegos resistentes y flexibles.  Su configuraci&oacute;n
y funcionamiento se describen en la
<a href="../pf/es/index.html"><b>Gu&iacute;a del Usuario de PF</b></a>.


<p>
<a name="DHCP"></a>
<h2>6.4 - DHCP</h2>

<p>
<h3>6.4.1 Cliente DHCP</h3>

<p>
Para usar el cliente de DHCP que se incluye en OpenBSD, 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhclient&amp;sektion=8">dhclient(8)</a>,
hay que editar el fichero <tt>/etc/hostname.xl0</tt> (suponiendo que la
interfaz principal de ethernet sea xl0 ... la interfaz podr&iacute;a ser
ep0, fxp0, o cualquier otra) para modificarlo.  La &uacute;nica
modificaci&oacute;n necesaria en este fichero es a&ntilde;adir la
palabra clave '<tt>dhcp</tt>':

<pre>
# <b>echo dhcp &gt;/etc/hostname.xl0</b>
</pre>

<p>
Esto har&aacute; que OpenBSD inicie el cliente DHCP
autom&aacute;ticamente durante el arranque.  OpenBSD obtendr&aacute; la
informaci&oacute;n sobre nuestra direcci&oacute;n IP, pasarela, y
servidores de DNS desde el servidor de DHCP.

<p>
Si se desea iniciar un cliente dhcp desde la l&iacute;nea de
&oacute;rdenes, antes hay que asegurarse de que el fichero
<tt>/etc/dhclient</tt> exista y entonces usar la orden:

<pre>
# <b>dhclient fxp0</b>
</pre>

<p>
en donde fxp0 es la interfaz en la que se desea recibir dhcp.

<p>
Sea cual fuere el modo en que se inicie dhclient, se puede editar el
fichero <tt>/etc/dhclient</tt> para <b>evitar</b> que se actualice la
DNS de acuerdo con la idea que tenga el servidor de dhcp sobre la DNS,
comentando las l&iacute;neas precedidas por 'request' (son ejemplos de
la configuraci&oacute;n predefinida, pero es necesario activarlos para
anular la configuraci&oacute;n predefinida de dhclient):

<pre>
request subnet-mask, broadcast-address, time-offset, routers,
      domain-name, domain-name-servers, host-name, lpr-servers, ntp-servers;
</pre>

<p>
y a continuaci&oacute;n <b>eliminar</b> domain-name-servers.
Tambi&eacute;n, si se desea, es posible anular hostname u otras
configuraciones.

<p>
<h3>6.4.2 Servidor DHCP</h3>

<p>
Si se desea usar OpenBSD como servidor de DHCP con
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhcpd&amp;sektion=8">dhcpd(8)</a>,
hay que editar el fichero <tt>/etc/rc.conf</tt> y configurarlo
a&ntilde;adiendo <tt>dhcp_flags=&quot;-q&quot;</tt> en lugar de
<tt>dhcp_flags=NO</tt>.  Tambi&eacute;n hay que a&ntilde;adir en
<tt>/etc/dhcp.interfaces</tt> las interfaces en las que se desee que
dhcp permanezca <b>a la escucha</b>:

<pre>
# <b>echo xl1 xl2 xl3 &gt;/etc/dhcpd.interfaces</b>
</pre>

<p>
y editar <tt>/etc/dhcpd.conf</tt>.  Las opciones son bastante claras:

<pre>
        option  domain-name &quot;example.com&quot;;
        option  domain-name-servers 192.168.1.3, 192.168.1.5;

        subnet 192.168.1.0 netmask 255.255.255.0 {
                option routers 192.168.1.1;

                range 192.168.1.32 192.168.1.127;
        }
</pre>

<p>
Con esto indicaremos a los clientes de DHCP que el dominio que deben
a&ntilde;adir a sus requerimientos de DNS es example.com (as&iacute;, si
un usuario escribiera 'telnet joe', los enviar&iacute;a a
joe.example.com).  Les dirigir&aacute; a los servidores de DNS
192.168.1.3 y 192.168.1.5.  A los anfitriones que se encuentren en la
misma red que una interfaz de ethernet en la m&aacute;quina de OpenBSD
(que est&aacute; en el rango 192.168.1.0/24) les asignar&aacute; una
direcci&oacute;n de IP entre 192.168.1.32 y 192.168.1.127, con una
configuraci&oacute;n predeterminada de la pasarela de 192.168.1.1.

<p>
Si se quiere iniciar dhcpd(8) desde la l&iacute;nea de &oacute;rdenes,
hay que intentar lo siguiente despu&eacute;s de editar
<tt>/etc/dhcpd.conf</tt>:

<pre>
# <b>dhcpd -q fxp0</b>
</pre>

<p>
en donde <tt>fxp0</tt> es la interfaz que se desea que empiece a servir
requerimientos de dhcp.  El indicador <tt>-q</tt> fuerza una salida
silenciosa de dhcpd, ya que de otro modo es muy ruidoso.

<p>
Si se est&aacute; actuando como servidor de DHCP para una m&aacute;quina
Windows, se puede hacer que dhcpd(8) ofrezca al cliente una
direcci&oacute;n de servidor 'WINS'.  Para ello hay que a&ntilde;adir la
siguiente l&iacute;nea al fichero <tt>/etc/dhcpd.conf</tt>:

<pre>
     option    netbios-name-servers    192.168.92.55;
</pre>

<p>
En donde <tt>192.168.92.55</tt> es el IP del servidor de Windows o
Samba.  Para informaci&oacute;n sobre otras opciones que puedan aceptar
los clientes de DHCP, v&eacute;se
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhcp-options&amp;sektion=5">dhcp-options(5)</a>.

<p>
<a name="PPP"></a>
<h2>6.5 - PPP </h2>

<p>
El &laquo;Protocolo Punto a Punto&raquo; (PPP) es el que se suele usar
para crear una conexi&oacute;n con el ISP (el proveedor de Internet) a
trav&eacute;s de un m&oacute;dem.  OpenBSD puede hacer esto de dos
modos:

<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppd&amp;sektion=8">pppd(8)</a> - el d&aelig;mon ppp del n&uacute;cleo del sistema (<i>kernel</i>).
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&amp;sektion=8">ppp(8)</a> - el d&aelig;mon ppp del modo de usuario.
</ul>

<p>
Primero trataremos el d&aelig;mon del modo de usuario.  Para empezar
necesitaremos algo de informaci&oacute;n sobre nuestro proveedor.  He
aqu&iacute; una lista de la informaci&oacute;n que ser&aacute;
necesaria:

<ul>
   <li>El n&uacute;mero de tel&eacute;fono de conexi&oacute;n de.
   proveedor (ISP)
   <li>Nuestro <i>nameserver</i> (nombre del servidor) 
   <li>Nuestro nombre de usuario y contrase&ntilde;a
   <li>Nuestra pasarela (<i>gateway</i>)
</ul>

<p>
Parte de esta informaci&oacute;n no es estrictamente necesaria, pero
ser&aacute; de gran ayuda para configurar ppp.  El d&aelig;mon PPP del
modo de usuario utiliza el fichero
<a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.conf.sample">/etc/ppp/ppp.conf</a>
como fichero de configuraci&oacute;n.  Existen muchos ficheros en
<tt>/etc/ppp</tt> de gran utilidad, que pueden contener diferentes
ejemplos de configuraci&oacute;n para situaciones distintas.  Es
aconsejable mirar en ese directorio.

<p>
En caso de no estar usando un n&uacute;cleo GENERIC, debemos asegurarnos
de que tenemos la siguiente l&iacute;nea en nuestro fichero de
configuraci&oacute;n:

<blockquote><pre><strong>
pseudo-device   tun             2
</strong></pre></blockquote>

<p>
<h3>Configuraci&oacute;n inicial para PPP(8)</h3>

<p>
La configuraci&oacute;n inicial del d&aelig;mon PPP del modo de usuario
consiste en editar su fichero <tt>/etc/ppp/ppp.conf</tt>.  Este fichero
no existe y se debe crear, pero se puede tomar el fichero
<tt>/etc/ppp/ppp.conf.sample</tt>, editarlo, y crear un fichero
<tt>ppp.conf</tt> propio a partir de ah&iacute;.  Aqu&iacute;
empezaremos con la configuraci&oacute;n m&aacute;s simple, y
probablemente la m&aacute;s utilizada.  A continuaci&oacute;n puede
verse un peque&ntilde;o fichero <tt>ppp.conf</tt> que realizar&aacute;
la conexi&oacute;n con el ISP y usar&aacute; nuestras rutas predefinidas
y nuestro <i>nameserver</i>.  Para la creaci&oacute;n de este fichero,
toda la informaci&oacute;n que necesitaremos ser&aacute; el
n&uacute;mero de tel&eacute;fono de nuestro ISP, nuestro nombre de
usuario, y nuestra contrase&ntilde;a:

<blockquote><pre>
default:
set log Phase Chat LCP IPCP CCP tun command     
set device /dev/cua01                           
set speed 115200     
set dial "ABORT BUSY ABORT NO\\sCARRIER TIMEOUT 5 \"\" AT OK-AT-OK ATE1Q0 OK\\dATDT\\T TIMEOUT 40 CONNECT"
</pre></blockquote>

<p>
La secci&oacute;n bajo la opci&oacute;n <tt>default:</tt> se
ejecutar&aacute; cada vez que se realice un requerimiento para una
conexi&oacute;n.  En ella se configura toda la informaci&oacute;n
cr&iacute;tica.  Con &quot;set log&quot; se configuran los niveles de
ingreso.  Esto se puede cambiar; para m&aacute;s informaci&oacute;n
sobre c&oacute;mo configurar los niveles de ingreso v&eacute;ase la
p&aacute;gina del manual de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&amp;sektion=8">
ppp(8)</a>.  El dispositivo se configura con &quot;set device&quot;.
&Eacute;ste es el dispositivo en el que se encuentra el m&oacute;dem.
En este ejemplo el m&oacute;dem est&aacute; en el puerto de
comunicaciones 2 (COM2), mientras que el puerto de comunicaciones 1
corresponder&iacute;a a <tt>/dev/cua00</tt>.  Con &quot;set speed&quot;
se configura la velocidad de la conexi&oacute;n por llamada, y con
&quot;set dial&quot; se configuran los par&aacute;metros de la llamada.
Con esto se puede cambiar el tiempo muerto, etc...  Es conveniente dejar
esta l&iacute;nea m&aacute;s o menos como est&aacute;.

<p>
A continuaci&oacute;n podemos pasar a configurar la informaci&oacute;n
espec&iacute;fica para nuestro ISP.  Para ello debemos a&ntilde;adir
otra opci&oacute;n en la secci&oacute;n <b>default:</b>.  Se puede dar
cualquier nombre a esta etiqueta, pero lo m&aacute;s f&aacute;cil es
darle el nombre del ISP.  En el ejemplo usaremos <b>myisp:</b> para la
opci&oacute;n que har&aacute; referencia a nuestro ISP.  He aqu&iacute;
una configuraci&oacute;n simple que incorpora todo lo necesario para
conectar:

<blockquote><pre>
myisp:
set phone 1234567   
set login "ABORT NO\\sCARRIER TIMEOUT 5 ogin:--ogin: ppp word: ppp"
set timeout 120   
set ifaddr 10.0.0.1/0 10.0.0.2/0 255.255.255.0 0.0.0.0
add default HISADDR 
enable dns
</pre></blockquote>

<p>
Aqu&iacute; hemos configurado la informaci&oacute;n esencial para un ISP
espec&iacute;fico.  La primera opci&oacute;n, &quot;set phone&quot;, es
para configurar el n&uacute;mero de tel&eacute;fono para la
conexi&oacute;n con el ISP.  La opci&oacute;n &quot;set login&quot; es
para configurar nuestras opciones de ingreso.  En el ejemplo hemos
puesto un tiempo muerto de espera de 5, lo que significa que nuestro
intento de ingreso terminar&aacute; despu&eacute;s de 5 segundos si no
hay transportador.  De lo contrario esperar&aacute; hasta recibir un
&quot;login&quot; para enviar nuestro nombre de usuario y
contrase&ntilde;a.  En el ejemplo, tanto el nombre de usuario como la
contraseña son &quot;ppp&quot;.  Estos valores hay que sustituirlos por
otros reales.  La opci&oacute;n &quot;set timeout&quot; es para
configurar el tiempo de espera para todo el proceso de ingreso.  La
opci&oacute;n &quot;set ifaddr&quot; es algo complicada.  He aqu&iacute;
una explicaci&oacute;n m&aacute;s extensa sobre ella:

<blockquote><pre>
set ifaddr 10.0.0.1/0 10.0.0.2/0 255.255.255.0 0.0.0.0
</pre></blockquote>

<p>
Hemos configurado la l&iacute;nea anterior con el formato &quot;<b>set
ifaddr [myaddr[/nn] [hisaddr[/nn] [netmask [triggeradr]]]]</b>&quot;.
De este modo el primer IP que se especifique es el que querremos como
nuestro IP.  Si se tiene una direcci&oacute;n IP est&aacute;tica, se
debe a&ntilde;adir aqu&iacute;.  En el ejemplo hemos usado /0, que
indica que no es necesario que concuerde ning&uacute;n bit de esta
direcci&oacute;n ip, y que se puede sustituir todo.  El segundo IP que
se especifique es el que esperamos como el IP de nuestro ISP.  Si lo
conocemos lo podemos especificar aqu&iacute;, pero en la l&iacute;nea no
sabemos cu&aacute;l se asignar&aacute;, as&iacute; que dejaremos que nos
lo digan.  Esto es muy &uacute;til al negociar con algunas
implementaciones PPP que no asignan un n&uacute;mero IP a menos que la
conexi&oacute;n les requiera ``0.0.0.0''.

<p>
La siguiente opci&oacute;n &quot;add default HISADDR&quot; es para
configurar la ruta predefinida hasta nuestra IP.  Si nuestra IP
cambiara, la ruta se actualizar&iacute;a de forma autom&aacute;tica.
Con &quot;enable dns&quot; indicamos a nuestro ISP que autentifique
nuestras direcciones <i>nameservers</i>.  Esto no debe hacerse si se
est&aacute; usando una DNS local, ya que ppp circunvalar&aacute; su uso
introduciendo algunas l&iacute;neas en <tt>/etc/resolv.conf</tt>.

<p>
<h3>C&oacute;mo usar PPP(8)</h3>

<p>
Ahora que ya tenemos el fichero <i>ppp.conf</i> configurado, podemos
intentar una conexi&oacute;n con nuestro ISP.  A continuaci&oacute;n se
dar&aacute;n algunos detalles sobre argumentos de uso com&uacute;n con
ppp.

<ul>
   <li><tt>ppp -auto myisp</tt> - Inicia ppp, configura las interfaces,
   conecta con el ISP, y a continuaci&oacute;n pasa a un plano de fondo.
   <li><tt>ppp -ddial myisp</tt> - Parecido a -auto, pero si la
   conexi&oacute;n cayera volver&iacute;a a conectar.
</ul>

<p>
Si se usa <tt>/usr/sbin/ppp</tt> sin pasarle ninguna opci&oacute;n,
pasar&aacute; al modo interactivo, desde donde se podr&aacute;
interaccionar directamente con el m&oacute;dem.  De este modo se pueden
depurar problemas en el fichero <tt>ppp.conf</tt>.

<p>
<h3>Acciones adicionales con ppp(8)</h3>

<p>
Si se necesitara ejecutar &oacute;rdenes al tiempo que se conecta o
desconecta, puede hacerse creando dos ficheros adicionales,
<tt>/etc/ppp/ppp.linkup</tt> y <tt>/etc/ppp/ppp.linkdown</tt>.  Pueden
verse ejemplos de configuraci&oacute;n para estos ficheros en:

<ul>
   <li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.linkup.sample">ppp.linkup</a>
   <li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.linkdown.sample">ppp.linkdown</a>
</ul>

<p>
Se puede obtener m&aacute;s informaci&oacute;n en el
<a href="http://www.freebsd.org/doc/es_ES.ISO8859-1/books/handbook/userppp.html">cap&iacute;tulo sobre <i>userppp</i> de la Gu&iacute;a de FreeBSD</a>.

<p>
<a name="Tuning"></a>
<h2>6.6 - Ajuste de par&aacute;metros de red</h2>
<!-- XXXrelease -->
<p>
<h3>6.6.1 - &iquest;C&oacute;mo se puede forzar al n&uacute;cleo del
sistema para obtener un mayor n&uacute;mero de reintentos y tiempos de
espera mayores en las sesiones de TCP?</h3>

<p>
Para problemas de conexi&oacute;n o enrutamiento se puede usar lo
siguiente (hay que tener en cuenta que para que sea más efectivo, ambos
lados de la conexi&oacute;n deben usar valores similares):

<p>
Para forzarlo hay que usar <tt>sysctl</tt> e incrementar los valores de:

<pre>
net.inet.tcp.keepinittime
net.inet.tcp.keepidle
net.inet.tcp.keepintvl
</pre>

<p>
Si se usa sysctl -a se podr&aacute;n ver los valores actuales de estos y
muchos otros par&aacute;metros.  Para cambiar cualquiera de ellos, hay
que usar <tt>sysctl -w</tt>; como por ejemplo en
<tt>sysctl -w net.inet.tcp.keepidle=28800</tt>.

<p>
<h3>6.6.2 - &iquest;C&oacute;mo se pueden activar emisiones
dirigidas?</h3>

<p>
Por lo general, no es aconsejable hacerlo ya que, si el sistema OpenBSD
es un enrutador, permite que se pueda enviar tr&aacute;fico a la
direcci&oacute;n o direcciones de emisi&oacute;n de nuestras redes.

<p>
En algunos casos, como en el de las redes cerradas, puede tener cierta
utilidad, en particular cuando se est&eacute;n usando implementaciones
antiguas del protocolo NetBIOS.  Se puede activar con
<tt>sysctl -w net.inet.ip.directed-broadcast=1</tt>.  Es convienente
informarse sobre los <a href="http://www.netscan.org">ataques
<i>&quot;smurf&quot;</i></a> para saber por qu&eacute; se encuentra
desactivado por definici&oacute;n.

<p>
<h3>6.6.3 - No quiero que el n&uacute;cleo haga asignaciones
din&aacute;micas de ciertos puertos</h3>

<p>
Tambi&eacute;n existe un sysctl para esto.  De la p&aacute;gina del
manual de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8">sysctl(8)</a>:

<pre>
A&ntilde;ada la lista de puertos TCP que no deber&iacute;an ser
asignados de forma din&aacute;mica por el n&uacute;cleo.  Esto puede
utilizarse para evitar que algunos d&aelig;mons se apropien de un cierto
puerto que sea necesario para el funcionamiento de otro programa.  La
lista de elementos puede ir separada por comas y/o espacios en blanco.

 #  <b>sysctl -w  net.inet.tcp.baddynamic=749,750,751,760,761,871</b>

Tambi&eacute;n se pueden a&ntilde;adir o eliminar puertos de la lista
actual.

 #  <b>sysctl -w net.inet.tcp.baddynamic=+748</b>
 #  <b>sysctl -w net.inet.tcp.baddynamic=-871</b>
</pre>

<p>
<a name="NFS"></a>
<h2>6.7 - Uso simple de NFS</h2>

<p>
El &laquo;Sistema de Archivos de Red&raquo; (NFS, <i>Network File
System</i>) se usa para compartir un sistema de archivos en una red.
Algunas p&aacute;ginas del manual que se deber&iacute;an leer antes de
intentar configurar un servidor de NFS son:

<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nfsd&amp;sektion=8">nfsd(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mountd&amp;sektion=8">mountd(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=exports&amp;sektion=5">exports(5)</a>
</ul>

<p>
En esta secci&oacute;n se detallar&aacute;n los pasos para una
configuraci&oacute;n simple de NFS.  El ejemplo ofrece detalles sobre un
servidor en una LAN, con clientes que tengan acceso NFS en la LAN.  En
esta secci&oacute;n no se tratar&aacute; sobre la seguridad de NFS.
Asumiremos que ya se ha configurado el paquete de filtros, u otra
protecci&oacute;n como cortafuegos, para prevenir el acceso desde el
exterior.  Si nuestra configuraci&oacute;n permite el acceso desde el
exterior a nuestro servidor de NFS, y si tenemos alg&uacute;n tipo de
datos confidenciales o importantes, es muy recomendable usar IPsec.  De
otro modo existe la posibilidad de que extra&ntilde;os puedan ver
nuestro tr&aacute;fico de NFS.  Tambi&eacute;n ser&iacute;a posible que
alguien pretendiera estar en la direcci&oacute;n IP a la que hayamos
autorizado la entrada en el servidor de NFS.  Existen varios tipos de
ataques efectivos en este aspecto.  Cuando IPsec est&aacute;
correctamente configurado, protege contra todos estos tipos de ataques.

<p>
Otra nota importante sobre seguridad.  No se debe a&ntilde;adir un
sistema de archivos a <tt>/etc/exports</tt> sin alg&uacute;n tipo de
lista de anfitriones autorizados.  Sin una lista de anfitriones que
puedan montar un directorio particular, cualquiera que pueda llegar al
anfitri&oacute;n podr&aacute; montar los directorios de NFS en
<tt>exports</tt>.

<p>
NFS depende de que
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=portmap&amp;sektion=8">portmap(8)</a>
se encuentre en ejecuci&oacute;n antes de poder operar.  Portmap(8),
desde la versi&oacute;n 3.2 de OpenBSD, se encuentra desactivado en el
modo predeterminado, y por lo tanto hay que activarlo en el fichero
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&amp;sektion=8">rc.conf(8)</a>
cambiando la l&iacute;nea de <tt>portmap</tt> as&iacute;:

<blockquote><pre>
portmap=YES
</pre></blockquote>

<p>
y reiniciar para que el cambio sea efectivo.

<p>
La configuraci&oacute;n consiste en un servidor con el ip
<b>10.0.0.1</b>, que servir&aacute; NFS s&oacute;lo a clientes dentro de
esa red.  El primer paso para configurar NFS es configurar el fichero
<tt>/etc/exports</tt>.  Este fichero se compone de una lista con los
sistemas de archivos que se quiera que sean accesibles por medio de NFS,
y define qui&eacute;n puede acceder a cada uno de ellos.  Existen muchas
opciones que puede usar en su fichero <tt>/etc/exports</tt>, y es
conveniente leer la p&aacute;gina del manual de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=exports&amp;sektion=5">exports(5)</a>.
En este ejemplo empezaremos con un fichero <tt>/etc/exports</tt> como el
siguiente:

<blockquote><pre>
#
# Base de datos de NFS exports
# V&eacute;ase exports(5) para m&aacute;s informaci&oacute;n.  Vaya con
# cuidado, una mala configuraci&oacute;n puede hacer que
# sus sistemas de archivos sean legibles por todo el mundo.
/work -alldirs -ro -network 10.0.0 -mask 255.255.255.0
</pre></blockquote>

<p>
Esto quiere decir que el sistema de archivos local <tt>/work</tt>
estar&aacute; disponible a trav&eacute;s de NFS.  <tt>-alldirs</tt>
indica que los clientes podr&aacute;n montar en cualquier parte bajo el
punto de montaje <tt>/work</tt>.  <tt>-ro</tt> indica que
&uacute;nicamente se permitir&aacute; montarlo en modo de s&oacute;lo
lectura.  Los dos &uacute;ltimos argumentos indican que s&oacute;lo los
clientes dentro de la red 10.0.0.0 que usen una m&aacute;scara de red
255.255.255.0, estar&aacute;n autorizados a montar este sistema de
archivos.  Esto es importante en algunos servidores accesibles desde
diferentes redes.

<p>
Una vez que se haya configurado el fichero <tt>/etc/exports</tt>, se puede
continuar y pasar a configurar el servidor de NFS.  Primero hay que
asegurarse de que las opciones NFSSERVER y NFSCLIENT se encuentren en la
configuraci&oacute;n del n&uacute;cleo del sistema (el n&uacute;cleo
GENERIC incluye estas opciones).  A continuaci&oacute;n hay que
configurar <tt>nfs_server=YES</tt> en el fichero <tt>/etc/rc.conf</tt>.
De este modo, cuando se reinicie el sistema, se activar&aacute;n nfsd(8)
y mountd(8).  Ahora ya se pueden iniciar los d&aelig;mons.  Estos
d&aelig;mons deben ser iniciados por el superusuario, <i>root</i>, y es
necesario asegurarse de que portmap(8) est&eacute; en funcionamiento en
el sistema.  El ejemplo que sigue sobre c&oacute;mo iniciar nfsd(8)
sirve tanto para TCP como para UDP usando 4 d&aelig;mons.  Para
gestionar el m&aacute;ximo n&uacute;mero de requerimientos de clientes
concurrentes a los que se quiera dar servicio, hay que activar un
n&uacute;mero apropiado de d&aelig;mons del servidor de NFS.

<blockquote><pre>
# <b>/sbin/nfsd -tun 4</b>
</pre></blockquote>

<p>
No s&oacute;lo se debe iniciar el servidor de nfsd(8), sino que
tambi&eacute;n es necesario iniciar mountd(8).  &Eacute;ste es el
d&aelig;mon que da servicio a los requerimientos para montar en NFS.
Para iniciar mountd(8), hay que asegurarse de que existe un fichero
vac&iacute;o <tt>mountdtab</tt> e invocar el d&aelig;mon:

<blockquote><pre>
# <b>echo -n &gt;/var/db/mountdtab</b>
# <b>/sbin/mountd</b>
</pre></blockquote>

<p>
Si se hace alg&uacute;n cambio en el fichero <tt>/etc/exports</tt>
mientras NFS est&eacute; funcionando, se tendr&aacute; que avisar a
mountd sobre el cambio pas&aacute;ndole una se&ntilde;al
&quot;HUP&quot;:

<blockquote><pre>
# <b>kill -HUP `cat /var/run/mountd.pid`</b>
</pre></blockquote>

<p>
<h3>Comprobaci&oacute;n de estad&iacute;sticas en NFS</h3>

<p>
Se pueden realizar comprobaciones para asegurarse de que estos
d&aelig;mons est&eacute;n funcionando y registrados con RPC.  Para ello
se usa rcpinfo(8).

<blockquote><pre>
$ <b>rpcinfo -p 10.0.0.1</b>
   program vers proto   port
    100000    2   tcp    111  portmapper
    100000    2   udp    111  portmapper
    100005    1   udp    633  mountd
    100005    3   udp    633  mountd
    100005    1   tcp    916  mountd
    100005    3   tcp    916  mountd
    100003    2   udp   2049  nfs
    100003    3   udp   2049  nfs
    100003    2   tcp   2049  nfs
    100003    3   tcp   2049  nfs
</pre></blockquote>

<p>
Durante su uso normal, existen unas pocas utilidades más que nos
permitir&aacute;n ver lo que est&aacute; ocurriendo con NFS.  Una de
ellas es
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=showmount&amp;sektion=8">showmount(8)</a>
que nos permite ver qu&eacute; se encuentra montado y qui&eacute;n lo
est&aacute; montando.  Tambi&eacute;n est&aacute; nfsstat(8), que
muestra una informaci&oacute;n de las estad&iacute;sticas mucho
m&aacute;s amplia.  Para usar showmount(8), basta con escribir
<tt>/usr/bin/showmount -a host</tt>.  Por ejemplo:

<blockquote><pre>
$ <b>/usr/bin/showmount -a 10.0.0.1</b>
All mount points on 10.0.0.1:
10.0.0.37:/work
</pre></blockquote>

<p>
<h3>C&oacute;mo montar Sistemas de Archivos de Red (NFS)</h3>

<p>
Los sistemas de archivos NFS se deben montar mediante mount(8) o,
m&aacute;s exactamente, mediante
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount_nfs&amp;sektion=8">mount_nfs(8)</a>.
Para montar el sistema de archivos <tt>/work</tt> del anfitri&oacute;n
10.0.0.1 en un sistema de archivo local <tt>/mnt</tt>, se debe hacer lo
siguiente (no es necesario usar una direcci&oacute;n IP, mount se
encargar&aacute; de la resoluci&oacute;n de nombres):

<blockquote><pre>
# <b>mount -t nfs 10.0.0.1:/work /mnt</b>
</pre></blockquote>

<p>
Para que el sistema se monte al iniciar, hay que a&ntilde;adir algo como
lo que viene a continuaci&oacute;n en el fichero <tt>/etc/fstab</tt>:

<blockquote><pre>
10.0.0.1:/work /mnt nfs rw 0 0
</pre></blockquote>

<p>
&iexcl;&iexcl;Es importante usar <tt>0 0</tt> al final de esta
l&iacute;nea para que la m&aacute;quina no intente ejecutar fsck sobre
el sistema de archivo NFS durante el inicio del sistema!!  El resto de
opciones de seguridad t&iacute;picas, como noexec, nodev y nosuid,
tambi&eacute;n deber&iacute;an usarse donde sean posibles, como en:

<blockquote><pre>
10.0.0.1:/work /mnt nfs rw,nodev,nosuid 0 0
</pre></blockquote>

<p>
De este modo ning&uacute;n dispositivo o programa setuid en el servidor
de NFS podr&aacute; traspasar las medidas de seguridad en el cliente de
NFS.  Si los programas que se monten no deben ser ejecutados por el
cliente de NFS, se debe a&ntilde;adir noexec a esta lista.

<p>
<a name="PPTP"></a>
<h2>6.8 - Configuraci&oacute;n de una conexi&oacute;n PPTP en
OpenBSD</h2>

<p>
<strong>NOTA:</strong> Esta informaci&oacute;n no es v&aacute;lida para
<strong>TODOS</strong> los proveedores de conexiones ADSL, pero mucha de
la informaci&oacute;n que aqu&iacute; se encuentra se puede usar como
base.  Esta informaci&oacute;n s&oacute;lo se ha verificado con
<a href="http://www.inode.at">Inode</a>, un proveedor de ADSL en
Austria.

<p>
Antes que nada hay que instalar <i>pptp</i>.  El porte de <i>pptp</i> se
encuentra en <tt>/usr/ports/net/pptp</tt>.  Se puede encontrar
m&aacute;s informaci&oacute;n sobre el &aacute;rbol de portes de OpenBSD
en la secci&oacute;n sobre los
<a href="faq8.html#Ports"><tt>Portes</tt></a> del cap&iacute;tulo 8 de
estos documentos.

<p>
Debido a un conflicto entre el soporte integrado en el n&uacute;cleo de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gre&amp;sektion=4">gre(4)</a>
y pptp, es preciso recompilar el n&uacute;cleo del sistema, eliminando
el soporte para gre(4).

<blockquote>Parche para eliminar el soporte para GRE(4).
<pre>
Index: GENERIC
===================================================================
RCS file: /cvs/src/sys/conf/GENERIC,v
retrieving revision 1.86
diff -u -r1.86 GENERIC
--- GENERIC     14 Mar 2002 00:42:25 -0000      1.86
+++ GENERIC     17 May 2002 01:52:17 -0000
@@ -87,7 +87,7 @@
 pseudo-device  enc     1       # option IPSEC needs the encapsulation interface
 pseudo-device  bridge  2       # network bridging support
 pseudo-device  vlan    2       # IEEE 802.1Q VLAN
-pseudo-device  gre     1       # GRE encapsulation interface
+#pseudo-device gre     1       # GRE encapsulation interface
 #pseudo-device strip   1       # Starmode Radio IP interface

 pseudo-device  pty     64      # pseudo-terminals
</pre>
</blockquote>

<p>
Para recompilar el n&uacute;cleo, antes hay que obtener el c&oacute;digo
fuente de OpenBSD mediante cvs (v&eacute;ase la p&aacute;gina de
<a href="../../es/anoncvs.html">AnonCVS</a> para m&aacute;s
informaci&oacute;n), aplicar el parche anterior, y recompilar el
n&uacute;cleo tal y como se indica en la secci&oacute;n sobre la
<a href="faq5.html#Building"><tt>compilaci&oacute;n del
n&uacute;cleo</tt></a> del cap&iacute;tulo 5 de estos documentos.

<p>
Una vez que ya se haya instalado el paquete <b>pptp</b> y el nuevo
n&uacute;cleo, hay que editar unos cuantos ficheros para configurar la
conexi&oacute;n.  Este paquete utiliza el programa de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&amp;sektion=8">ppp(8)</a>
nativo de OpenBSD;  si se est&aacute; familiarizado con ppp(8), gran
parte de la configuraci&oacute;n es id&eacute;ntica.  V&eacute;se
tambi&eacute;n la secci&oacute;n sobre <a href="#PPP">PPP</a> de este
documento.

<ul>
<li>1 - /etc/ppp/options
<li>2 - /etc/ppp/pap-secrets
</ul>

<p>
Para el fichero <tt>/etc/ppp/options</tt>, una configuraci&oacute;n como
la siguiente ser&aacute; probablemente todo lo que se necesite:

<blockquote><pre>
# <b>cat /etc/ppp/options</b>
name &quot;LOGINNAME&quot;
noauth
noipdefault
defaultroute
debug
</pre></blockquote>

<p>
Se debe sustituir <tt>LOGINNAME</tt> con el identificador de usuario.

<p>
Para el fichero <tt>/etc/ppp/pap-secrets</tt> se necesitar&aacute; una
l&iacute;nea como &eacute;sta:

<blockquote><pre>
# <b>cat /etc/ppp/pap-secrets</b>
LOGINNAME 10.0.0.138 PASSWORD
</pre></blockquote>

<p>
en donde LOGINNAME es el identificador de usuario y PASSWORD la
contrase&ntilde;a.  10.0.0.138 es la direcci&oacute;n IP asignada al
m&oacute;dem en caso de que se use ADSL, etc.  Hay que asegurarse de que
este fichero s&oacute;lo pueda ser le&iacute;do por es superusuario
<i>root</i> (modo 600).

<p>
<h3>6.8.1 - Asignaci&oacute;n de una direcci&oacute;n a la interfaz de
red</h3>

<p>
En el ejemplo anterior, el m&oacute;dem ten&iacute;a una interfaz
10.0.0.38 preconfigurada.  Pero ahora necesitaremos asignar
una direcci&oacute;n a NUESTRA interfaz.  Lo mejor es escoger
una direcci&oacute;n de IP cercana a la asignada para el MODEM, o
usar la direcci&oacute;n de IP est&aacute;tica que nos hayan
asignado.  La secci&oacute;n sobre
<a href="#Setup"><tt>Configuraci&oacute;n inicial de la red</tt></a> de
este documento contiene m&aacute;s informaci&oacute;n sobre la
configuraci&oacute;n de interfaces.

<p>
Una vez que hayamos configurado la interfaz, deber&iacute;amos estar en
disposici&oacute;n de establecer una conexi&oacute;n pptp con la orden:

<blockquote><pre>
# <b>/usr/local/sbin/pptp 10.0.0.138 &amp;</b>
</pre></blockquote>

<p>
Como ya hemos dicho, se usar&aacute; el ppp(8) nativo de OpenBSD, y se
iniciar&aacute;n dos procesos;  en consecuencia, para matar pptp
ser&aacute; necesario matar estos dos procesos:

<blockquote><pre>
# <b>kill -9 [pid de pppd]</b>
$ <b>kill -9 [pid de pptp]</b>
</pre></blockquote>

<p>
Es recomendable abrir <tt>/var/log/messages</tt> en una ventana de
terminal aparte, para poder reconocer cualquier posible problema.

<blockquote><pre>
# <b>tail -f /var/log/messages</b>
</pre></blockquote>

<p>
Tambi&eacute;n es aconsejable poner la orden de inicio en
<tt>/etc/rc.local</tt> para que se conecte de forma autom&aacute;tica
cuando se reinicie el sistema.


<p>
<a name="Bridge"></a>
<h2>6.9 - C&oacute;mo configurar un &laquo;puente de red&raquo; en
OpenBSD</h2>

<p>
Un puente de red
(o <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridge&amp;sektion=4">bridge</a>)
es un enlace entre dos o m&aacute;s redes separadas entre s&iacute;.  A
diferencia de los enrutadores, la transferencia de paquetes a
trav&eacute;s de un puente de red es &laquo;invisible&raquo;;
l&oacute;gicamente, los dos segmentos de red aparecen como un solo
segmento a los nodos de cada extremo del puente.  El puente s&oacute;lo
reenv&iacute;a aquellos paquetes que deban pasar desde un segmento hacia
el otro, por lo que, entre otras cosas, ofrecen una forma f&aacute;cil
para reducir el tr&aacute;fico en una red compleja, y a&uacute;n
as&iacute;, permiten que cualquier nodo pueda acceder a otro nodo
cualquiera siempre que esto sea preciso.

<p>
N&oacute;tese que, debido a esta &laquo;naturaleza invisible&raquo;, una
interfaz en un puente puede o no tener una direcci&oacute;n IP propia.
Si la tiene, la interfaz tendr&aacute; dos modos de operaci&oacute;n,
uno que ser&aacute; parte de un puente y el otro un NIC normal
independiente.  Si ninguna de las interfaces tiene una direcci&oacute;n
IP, entonces el puente pasar&aacute; los datos de red, pero no se
podr&aacute; mantener externamente (esto se puede considerar una
funcionalidad).

<p>
<h3>Ejemplo de una aplicaci&oacute;n de puente de red</h3>

<p>
Uno de mis bastidores tiene unos cuantos sistemas ya viejos, y ninguno
de &eacute;stos tiene un NIC 10BASE-TX integrado.  Aunque todos tienen
un conector AUI o AAUI, mis transportadores se limitan al cable coaxial.
Una de las m&aacute;quinas en este bastidor es un servidor de OpenBSD
que siempre est&aacute; conectado a la red de alta velocidad.
A&ntilde;adi&eacute;ndole un segundo NIC con puerto coaxial puedo usar
esta m&aacute;quina como un puente de red hacia la red coaxial.

<p>
Ahora este sistema tiene dos NIC, una tarjeta Intel EtherExpress/100
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fxp&amp;sektion=4"><tt>fxp0</tt></a>)
y otra tarjeta 3c590-Combo
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ep&amp;sektion=4"><tt>ep0</tt></a>)
para el puerto coaxial.  <tt>fxp0</tt> es el enlace con el resto de mi
red, y por lo tanto tendr&aacute; una direcci&oacute;n IP;  <tt>ep0</tt>
s&oacute;lo se va a usar para el puente, y por lo tanto no tendr&aacute;
ninguna direcci&oacute;n IP.  Las m&aacute;quinas conectadas al segmento
coaxial se comunican como si estuvieran en el resto de la red...
&iquest;c&oacute;mo se hace esto?

<p>
El fichero <tt>hostname.fxp0</tt> contiene la informaci&oacute;n de
configuraci&oacute;n de la tarjeta <tt>fxp0</tt>.  Esta m&aacute;quina
est&aacute; configurada mediante DCHP, por lo que el fichero es como
sigue:

<blockquote><pre>
$ <b>cat /etc/hostname.fxp0</b>
dhcp NONE NONE NONE NONE
</pre></blockquote>

<p>
Hasta aqu&iacute; sin sorpresas.

<p>
La tarjeta <tt>ep0</tt> es, l&oacute;gicamente, algo diferente:

<blockquote><pre>
$ <b>cat /etc/hostname.ep0</b>
up media 10base2
</pre></blockquote>

<p>
Aqu&iacute; pasamos al sistema la instrucci&oacute;n de activar esta
interfaz usando
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>,
y de configurarla como 10BASE-2 (coaxial).  No es necesario especificar
ninguna direcci&oacute;n IP ni informaci&oacute;n parecida para esta
interfaz.  Las opciones que acepta la tarjeta <tt>ep</tt> se pueden
encontrar en la p&aacute;gina del manual de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ep&amp;sektion=4">
ep(4)</a>.

<p>
Ahora necesitamos configurar el puente de red.  Los puentes de red se
inician siempre que exista un fichero que se llame algo como
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridgename.if&amp;sektion=5"><tt>nombre_puente.bridge0</tt></a>.
He aqu&iacute; un ejemplo de mi situaci&oacute;n:

<blockquote><pre>
$ <b>cat /etc/bridgename.bridge0</b>
add fxp0
add ep0
up
</pre></blockquote>

<p>
Lo que dice es que se configure un puente de red que consista de dos
NIC, fxp0 y ep0, y que se active.  No importa el orden en que aparezcan
las tarjetas, recu&eacute;rdese que un puente de red es muy
sim&eacute;trico, los paquetes pasan en ambas direcciones.

<p>
&iexcl;Eso es todo!  Despu&eacute;s de reiniciar ya tendremos un puente
de red totalmente funcional.

<p>
<h3>Filtros de paquetes en un puente de red</h3>
<p>
Aunque existen varios usos para un puente de red simple como
&eacute;ste, es muy probable que quiera hacer algo con los paquetes
mientras pasan a trav&eacute;s del puente.  Se puede usar
<a href="#PF">PF</a> para restringir el tr&aacute;fico que pasar&aacute;
a trav&eacute;s del puente.

<p>
Hay que tener en cuenta que, por la naturaleza del puente, los mismos
datos pasar&aacute;n a trav&eacute;s de ambas interfaces, por lo que
s&oacute;lo ser&aacute; necesario filtrar en una sola interfaz.  Las
reglas &quot;Pass all&quot; pueden quedar as&iacute;:

<blockquote><pre>
pass in  on ep0  all
pass out on ep0  all
pass in  on fxp0 all
pass out on fxp0 all
</pre></blockquote>

<p>
Supongamos ahora que quiero filtrar el tr&aacute;fico que llegue a estas
viejas m&aacute;quinas, y que s&oacute;lo quiero que pase el
tr&aacute;fico de <i>web</i> y SSH por ellas.  En este caso dejaremos
salir y entrar todo el tr&aacute;fico de la interfaz ep0, y filtraremos
el de la interfaz fxp0, usando &quot;keep state&quot; para manejar la
respuesta de datos:

<blockquote><pre>
# Pass all traffic through ep0
pass in quick on ep0 all
pass out quick on ep0 all

# Block fxp0 traffic
block in  on fxp0 all
block out on fxp0 all

pass in quick on fxp0 proto tcp from any to any port {22, 80} \
     flags S/SA keep state
</pre></blockquote>

<p>
N&oacute;tese que este grupo de reglas evitar&aacute; que llegue
cualquier tr&aacute;fico a la m&aacute;quina que funciona como puente de
red o a cualquier otro nodo &laquo;detr&aacute;s&raquo; de ella, excepto
el tr&aacute;fico entrante de HTTP y SSH.  Es posible obtener otros
resultado filtrando la otra interfaz.

<p>
Para monitorizar y controlar el puente, se puede usar la orden
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=brconfig&amp;sektion=8">brconfig(8)</a>,
que tambi&eacute;n puede ser usada para crear un puente de red
despu&eacute;s del arranque.

<p>
<h3>Consejos</h3>

<ul>
<li>Es MUY recomendable filtrar en una sola interfaz.  Aunque se puede
filtrar en ambas, para ello hay que saber muy bien lo que se est&aacute;
haciendo.

<li>Usando la opci&oacute;n <i>blocknonip</i> de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=brconfig&amp;sektion=8">brconfig(8)</a>
o en
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridgename.if&amp;sektion=5">bridgename.bridge0</a>,
se puede evitar que se cuele tr&aacute;fico no IP (como IPX o NETBEUI)
por los filtros.  Hay que tener en cuenta que los puentes de red
funcionan para todo tipo de tr&aacute;fico, no s&oacute;lo para IP.

<li>Un puente de red requiere que los NIC est&eacute;n en &laquo;modo
prom&iacute;scuo&raquo; (que est&eacute;n a la escucha para TODO el
tr&aacute;fico de red, no s&oacute;lo para el de la interfaz
redireccionada).  Esto implica una mayor carga en el procesador y el bus
de la esperada.  Algunos NIC no funcionan correctamente en este modo; el
<i>chip</i> TI ThunderLAN
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tl&amp;sektion=4">tl(4)</a>)
es un ejemplo de un <i>chip</i> que no funciona como parte de un puente.
</ul>


<p>
<font color="#0000e0">
<a href="index.html">[&Iacute;ndice de documentos]</a>
<a href="faq5.html">[Secci&oacute;n 5 - Compilaci&oacute;n del sistema
con el c&oacute;digo fuente]</a>
<a href="faq7.html">[Secci&oacute;n 7 - Controles de teclado y
pantalla]</a>
</font>

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../back.gif" border="0" alt="[&iacute;ndice]"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
Originally [OpenBSD: faq6.html,v 1.182 ]<br>
$Translation: faq6.html,v 1.99 2004/01/04 19:59:59 horacio Exp $<br>
$OpenBSD: faq6.html,v 1.84 2004/01/04 22:23:57 horacio Exp $
</small>
</body>
</html>
