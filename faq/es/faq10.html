<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>10 - Gesti&oacute;n del sistema</title>
<link rev="made" href="mailto:www@openbsd.org">
<meta http-equiv="Content-Language" content="es">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="resource-type" content="documento">
<meta name="description"   content="Preguntas Frecuentes de OpenBSD">
<meta name="keywords"      content="openbsd,faq,documentación">
<meta name="distribution"  content="global">
<meta name="copyright"     content="Este documento es copyright 1998-2004 de OpenBSD.">
</head>

<body bgcolor="#ffffff" text="#000000">
<!-- máx. 72 caracteres por línea -->

<img alt="[OpenBSD]" height="30" width="141" src="../../images/smalltitle.gif">
<p>
<font color= "#0000e0">
<a href="index.html">[&Iacute;ndice de documentos]</a>
<a href="faq9.html">[Secci&oacute;n 9 - Migraci&oacute;n desde Linux]</a>
<a href="faq11.html">[Secci&oacute;n 11 - Mejora del rendimiento]</a>
</font>

<h1><font color="#e00000">10 - Gesti&oacute;n del sistema</font></h1>
<hr>

<p>
<h3>&Iacute;ndice de contenidos</h3>
<ul>
<li><a href="#wheel">10.1 - Cuando un usuario intenta convertirse en el
superusuario <em>root</em> con <kbd>su(1)</kbd>, le dice que est&aacute;
en el grupo err&oacute;neo.</a> (<em>wrong group</em>).
<li><a href="#DupFS">10.2 - &iquest;C&oacute;mo puedo duplicar un
sistema de archivos?</a>
<li><a href="#rc">10.3 - &iquest;C&oacute;mo inicio los d&aelig;mon con
el sistema?</a>
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&amp;sektion=8">rc(8)</a>).
<li><a href="#RelayingDenied">10.4 - &iquest;Por qu&eacute; cuando los
usuarios env&iacute;an correo a trav&eacute;s de mi sistema OpenBSD se
les niega el acceso de reenv&iacute;o?</a> (<em>relaying access
denied</em>).
<li><a href="#POP">10.5 - He configurado POP, pero obtengo errores
cuando accedo a mi correo a trav&eacute;s de POP.  &iquest;Qu&eacute;
puedo hacer?</a>
<li><a href="#SendmailDNS">10.6 - &iquest;Por qu&eacute; ignora Sendmail
el fichero <tt>/etc/hosts</tt>?</a>
<li><a href="#HTTPS">10.7 - C&oacute;mo se configura un servidor HTTP
seguro usando ssl(8).</a>
<li><a href="#vipw">10.8 - He hecho cambios a /etc/passwd con un editor,
pero los cambios no funcionan.  &iquest;Por qu&eacute;?</a>
<li><a href="#AddDelUser">10.9 - &iquest;C&oacute;mo a&ntilde;ado un
usuario?  &iquest;C&oacute;mo elimino un usuario?</a>
<li><a href="#FTPOnly">10.10 - &iquest;C&oacute;mo puedo crear una
cuenta s&oacute;lo FTP?</a>
<li><a href="#Quotas">10.11 - C&oacute;mo configurar cuotas para limitar
el uso del disco a los usuarios</a> 
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=quota&amp;sektion=1">quota(1)</a>).
<li><a href="#Kerberos">10.12 - C&oacute;mo se configura un
cliente/servidor Kerberos V.</a>
<li><a href="#AnonFTP">10.13 - C&oacute;mo se configura un servidor de
FTP an&oacute;nimo.</a>
<li><a href="#ftpchroot">10.14 - C&oacute;mo puedo confinar a los
usuarios a sus directorios de usuario (<em>/home</em>) en ftpd(8).</a>
<li><a href="#Patches">10.15 - C&oacute;mo se aplican los parches en
OpenBSD.</a>
<li><a href="#httpdchroot">10.16 - Acerca de chroot() Apache.</a>
<li><a href="#rootshell">10.17 - &iexcl;No me gusta el int&eacute;rprete
(<i>shell</i>) preasignado al usuario <i>root</i>!</a>
<li><a href="#ksh">10.18 - &iquest;Qu&eacute; m&aacute;s puedo hacer con
el int&eacute;rprete ksh?</a>
</ul>

<hr>

<p>
<a name="wheel"></a>
<h2>10.1 - &iquest;Por qu&eacute; me dice que estoy en el grupo
err&oacute;neo cuando intento ingresar como usuario <em>root</em> con
<kbd>su(1)</kbd>?</h2>

<p>
Para que un usuario normal se pueda convertir en el superusuario
<em>root</em>, antes hay que a&ntilde;adir al usuario al grupo
<kbd>wheel</kbd> a mano.  Esto se hace por motivos de seguridad, y se
recomienda tener cuidado con los usuarios a los que se otorgue este
acceso especial.  En OpenBSD, los usuarios que pertenezcan al grupo
<kbd>wheel</kbd> podr&aacute;n usar el programa
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=su&amp;sektion=1">
su(1)</a> en modo usuario (<em>userland program</em>) para tomar la
identidad del superusuario <em>root</em>.  Los usuarios que no
pertenezcan al grupo <kbd>wheel</kbd> no podr&aacute;n usar su(1).  A
continuaci&oacute;n puede verse una entrada de ejemplo en el fichero
<em>/etc/group</em> que asocia al usuario <strong>ericj</strong> al
grupo <kbd>wheel</kbd>.

<p>
Si se va a crear un usuario nuevo con
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8">adduser(8)</a>,
se puede asociar al grupo <kbd>wheel</kbd> desde el punto de
inserci&oacute;n &quot;<tt>Invite <i>user</i>&quot; into other
groups:</tt>, simplemente contestando <kbd>wheel</kbd>.  De este modo el
usuario quedar&aacute; a&ntilde;adido a la l&iacute;nea del grupo
<kbd>wheel</kbd> en el fichero <tt>/etc/group</tt>, que quedar&aacute;
del siguiente modo:

<blockquote><pre>
wheel:*:0:root,ericj
</pre></blockquote>

<p>
Si lo que se busca es un modo de permitir a los usuarios acceso limitado
a los privilegios del superusuario, sin tener que asociarlos al grupo
<kbd>wheel</kbd>, entonces se usar&aacute;
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sudo&amp;sektion=8">
sudo(8)</a>.

<p>
<a name="DupFS"></a>
<h2>10.2 - &iquest;C&oacute;mo puedo duplicar un sistema de
archivos?</h2>

<p>
Para duplicar un sistema de archivos se usa
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dump&amp;sektion=8">dump(8)</a> y
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=restore&amp;sektion=8">restore(8)</a>.
Por ejemplo, para duplicar todo el directorio <kbd>SRC</kbd> al
directorio <kbd>DST</kbd>, se har&iacute;a lo siguiente:

<blockquote><pre>
# <strong>cd /SRC; dump 0f - . | (cd /DST; restore -rf - )</strong>
</pre></blockquote>

<p>
<kbd>dump</kbd> est&aacute; dise&ntilde;ado para ofrecer una gran
variedad de posibilidades para copias de respaldo/seguridad, y puede
resultar excesivo si s&oacute;lo se quiere duplicar un &uacute;nico
sistema de archivos o parte de &eacute;ste.  La orden
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tar&amp;sektion=1">
tar(1)</a> puede resultar m&aacute;s r&aacute;pida para una
operaci&oacute;n de este tipo.  El formato es muy parecido:

<blockquote><pre>
# <strong>cd /SRC; tar cf -  . | (cd /DST; tar xpf - )</strong>
</pre></blockquote>

<p>
<a name="rc"></a>
<h2>10.3 - &iquest;C&oacute;mo inicio los d&aelig;mon con el sistema?
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&amp;sektion=8">
rc(8)</a>)</h2>

<p>
OpenBSD usa un inicio del estilo
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&amp;sektion=8">
rc(8)</a>, para lo que necesita unos cuantos ficheros claves para
iniciar.

<ul>
<li>/etc/rc - Fichero de configuraci&oacute;n principal.  No se debe
editar.
<li>/etc/rc.conf - Fichero de configuraci&oacute;n usado por
<em>/etc/rc</em> para saber qu&eacute; d&aelig;mon deben iniciarse con
el sistema.
<li>/etc/rc.conf.local - Fichero de configuraci&oacute;n que se puede
usar para anular configuraciones de /etc/rc.conf, sin que sea necesario
tocar el fichero /etc/rc.conf;  muy conveniente para los usuarios que
actualizan el sistema con frecuencia.
<li>/etc/netstart - Fichero de configuraci&oacute;n usado para iniciar
la red.  No se debe editar.
<li>/etc/rc.local - Fichero de configuraci&oacute;n usado para tareas de
administraci&oacute;n local.  Aqu&iacute; se debe almacenar
informaci&oacute;n espec&iacute;fica de la m&aacute;quina anfitriona o
de los d&aelig;mon.
<li>/etc/rc.securelevel - Fichero de configuraci&oacute;n para ejecutar
las &oacute;rdenes que deben ser invocadas antes de los cambios en el
nivel de seguridad.  V&eacute;ase
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=init&amp;sektion=8">
init(8)</a>.
<li>/etc/rc.shutdown - Fichero de configuraci&oacute;n invocado por 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=shutdown&amp;sektion=8">shutdown(8)</a>.
En este fichero se debe a&ntilde;adir cualquier cosa que se quiera hacer
antes de cerrar el sistema.  V&eacute;ase
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.shutdown&amp;sektion=8">rc.shutdown(8)</a>.
</ul>

<p>
<h3>&iquest;C&oacute;mo funciona rc(8)?</h3>

<p>
Los ficheros m&aacute;s importantes para un administrador de sitemas son
<em>/etc/rc.conf</em> (o <i>/etc/rc.conf.local</i>),
<i>/etc/rc.local</i> y <em>/etc/rc.shutdown</em>.  Para hacerse una idea
sobre c&oacute;mo funciona el procedimiento de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&amp;sektion=8">
rc(8)</a>, v&eacute;ase el siguiente flujo:

<p>
Despu&eacute;s de arrancar el n&uacute;cleo del sistema, se inicia
<em>/etc/rc</em>:
<ul>
<li>Se comprueban los sistemas de archivos (<em>filesystems</em>).  Este
paso se omitir&aacute; en caso de que exista el fichero
<em>/etc/fastboot</em>, pero no es conveniente hacerlo de este modo.
<li>Se leen las variables de configuraci&oacute;n de
<em>/etc/rc.conf</em> y, a continuaci&oacute;n, de
<em>/etc/rc.conf.local</em>.  Cualquier configuraci&oacute;n que
aparezca en <em>/etc/rc.conf.local</em> anular&aacute; la
correspondiente en <em>/etc/rc.conf</em>.
<li>Se montan los sistemas de archivos.
<li>Se limpia el sistema de archivos <em>/tmp</em> y se conserva
cualquier fichero creado por el editor.
<li>Se configura la red por medio de <em>/etc/netstart</em>:
   <ul>
   <li>Se configuran las interfaces.
   <li>Se configuran &quot;hostname&quot;, &quot;domainname&quot;, etc.
   </ul>
<li>Se inician los &quot;d&aelig;mon&quot;.
<li>Se realizan otras comprobaciones (<i>quota</i>, <i>savecore</i>,
etc...).
<li>Se invocan y ejecutan los d&aelig;mon locales a trav&eacute;s de
<em>/etc/rc.local</em>.
</ul>

<p>
<h3>Inicio de los d&aelig;mon y servicios predefinidos en OpenBSD</h3>

<p>
La mayor&iacute;a de d&aelig;mon y servicios que vienen predefinidos en
OpenBSD pueden iniciarse durante el arranque, editando el fichero de
configuraci&oacute;n <em>/etc/rc.conf</em>.  Se puede ver un ejemplo en
el fichero
<a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/rc.conf">
/etc/rc.conf</a> que viene incluido con el sistema, en donde se ven unas
l&iacute;neas parecidas a la siguiente:

<blockquote><pre>
ftpd_flags=NO           # for non-inetd use: ftpd_flags=&quot;-D&quot;
</pre></blockquote>

<p>
Una l&iacute;nea como &eacute;sta nos indica que ftpd no se est&aacute;
iniciando con el sistema (al menos no mediante
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&amp;sektion=8">
rc(8)</a>; v&eacute;se la <a href="#AnonFTP">secci&oacute;n sobre FTP
An&oacute;nimo</a> para m&aacute;s informaci&oacute;n al respecto).  En
cualquier caso, cada l&iacute;nea va acompa&ntilde;ada por un comentario
que mostrar&aacute; los indicadores para el uso <strong>NORMAL</strong>
de ese d&aelig;mon o servicio.  Esto no significa que se debe invocar el
d&aelig;mon o servicio en cuesti&oacute;n con esos indicadores.  Siempre
se puede usar la documentaci&oacute;n de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=man&amp;sektion=1">
man(1)</a> (las p&aacute;ginas del manual) para ver c&oacute;mo se puede
iniciar de cualquier otro modo que se prefiera ese d&aelig;mon o
servicio.  Como ejemplo, v&eacute;ase la l&iacute;nea predefinida para
la entrada de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=httpd&amp;sektion=8">httpd(8)</a>:

<blockquote><pre>
httpd_flags=NO          # for normal use: &quot;&quot; (or &quot;-DSSL&quot; after reading ssl(8))
</pre></blockquote>

<p>
Aqu&iacute; puede verse con claridad que no es necesario ning&uacute;n
indicador para iniciar httpd.  Por lo tanto, s&oacute;lo ser&aacute;
necesaria una l&iacute;nea como la siguiente:

<blockquote><pre>
<strong>httpd_flags=&quot;&quot;</strong>
</pre></blockquote>

Pero para iniciar httpd con ssl (v&eacute;ase la
<a href="#HTTPS">secci&oacute;n sobre SSL</a> o la p&aacute;gina del
manual de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssl&amp;sektion=8">
ssl(8)</a>), ser&aacute; necesaria una l&iacute;nea como la siguiente:

<blockquote><pre>
httpd_flags=&quot;-DSSL&quot;
</pre></blockquote>

<p>
Una buen m&eacute;todo es no tocar nunca el fichero
<em>/etc/rc.conf</em>, y en su lugar crear el fichero
<em>/etc/rc.conf.local</em>, copiando en &eacute;ste s&oacute;lo las
l&iacute;neas que se quieran cambiar de <em>/etc/rc.conf</em> y
ajustarlas seg&uacute;n se necesite.  De este modo las futuras
actualizaciones pueden ser m&aacute;s f&aacute;ciles, ya que todos los
cambios estar&aacute;n en este fichero.

<p>
<h3>Inicio y configuraci&oacute;n de d&aelig;mon locales</h3>

<p>
Para instalar otros d&aelig;mon en el sistema, por medio de los portes
o cualquier otro medio, se debe usar el fichero <em>/etc/rc.local</em>.
Por ejemplo, supongamos que se ha instalado un d&aelig;mon que se
encuentre en <em>/usr/local/sbin/daemonx</em>, y que se desea iniciar
durante el arranque del sistema.  Para ello pondr&iacute;amos una
entrada como la siguiente en <em>/etc/rc.local</em>:

<blockquote><pre>
if [ -x /usr/local/sbin/daemonx ]; then
             echo -n ' daemonx';       /usr/local/sbin/daemonx
fi
</pre></blockquote>

<p>
Nota:  Si el d&aelig;mon no se separa autom&aacute;ticamente durante el
inicio, hay que a&ntilde;adir un &quot;&amp;&quot; al final de la
l&iacute;nea de &oacute;rdenes.

<p>
Desde este momento, el d&aelig;mon ser&aacute; invocado durante el
arranque.  Tambi&eacute;n se podr&aacute; ver cualquier error durante el
arranque;  un arranque normal sin errores s&oacute;lo mostrar&iacute;a
una l&iacute;nea como &eacute;sta:

<blockquote><pre>
Starting local daemons: daemonx.
</pre></blockquote>

<p>
<h3><em>rc.shutdown</em></h3>

<p>
<em>/etc/rc.shutdown</em> es un gui&oacute;n de ejecuci&oacute;n
(<em>script</em>) que se invoca al cerrar el sistema.  Cualquier cosa
que quiera hacerse antes de que se cierre el sistema se debe
a&ntilde;adir a este fichero.  Si se tiene apm tambi&eacute;n puede
configurarse &quot;powerdown=YES&quot;, lo que dar&aacute; un resultado
equivalente a <kbd>shutdown -p</kbd>.


<p>
<a name="RelayingDenied"></a>
<h2>10.4 - &iquest;Por qu&eacute; cuando los usuarios env&iacute;an
correo a trav&eacute;s de mi sistema OpenBSD se les niega el acceso de
reenv&iacute;o?<br>
<i>Relaying Denied</i></h2>

<p>
Probando lo siguiente:

<blockquote><pre>
# <strong>cat /etc/mail/sendmail.cf | grep relay-domains</strong>
</pre></blockquote>

<p>
la salida ser&aacute; parecida a &eacute;sta:

<blockquote><pre>
FR-o /etc/mail/relay-domains
</pre></blockquote>

<p>
Si este fichero no existe, habr&aacute; que crearlo, introduciendo los
hu&eacute;spedes que est&eacute;n enviando correo remoto;  para ello se
utilizar&aacute; la siguiente sintaxis:

<blockquote><pre>
.dominio.com    #Permitir el reenv&iacute;o desde/hacia
                #cualquier hu&eacute;sped en dominio.com
sub.dominio.com #Permitir el reenv&iacute;o desde/hacia
		#sub.dominio.com y cualquier hu&eacute;sped en
		#ese dominio
10.2            #Permitir el reenv&iacute;o desde todos los
	        #hu&eacute;spedes en la red IP 10.2.*.*
</pre></blockquote>

<p>
No hay que olvidarse de enviar una se&ntilde;al 'HangUP' a sendmail (una
se&ntilde;al que hace que la mayor&iacute;a de d&aelig;mon vuelvan a
leer sus respectivos ficheros de configuraci&oacute;n):

<blockquote><pre>
# <strong>kill -HUP `head -1 /var/run/sendmail.pid`</strong>
</pre></blockquote>

<p>
<h3>M&aacute;s informaci&oacute;n</h3>

<ul>
<li><a href="http://www.sendmail.org/~ca/email/relayingdenied.html">
http://www.sendmail.org/~ca/email/relayingdenied.html</a>
<li><a href="http://www.sendmail.org/tips/relaying.html">
http://www.sendmail.org/tips/relaying.html</a>
<li><a href="http://www.sendmail.org/antispam.html">
http://www.sendmail.org/antispam.html</a>
</ul>

<p>
<a name="POP"></a>
<h2>10.5 - He configurado POP, pero obtengo errores cuando accedo a mi
correo a trav&eacute;s de POP.  &iquest;Qu&eacute; puedo hacer?</h2>

<p>
La mayor&iacute;a de problemas relacionados con POP tienen que ver con
ficheros temporales y ficheros de bloqueo.  Si el servidor pop
env&iacute;a un mensaje de error como el siguiente,

<blockquote><pre>
-ERR Couldn't open temporary file, do you own it?
</pre></blockquote>

<p>
habr&aacute; que configurar los permisos del siguiente modo:

<blockquote><pre>
permisos en /var
drwxrwxr-x   2 bin     mail     512 May 26 20:08 mail


permisos en /var/mail
-rw-------   1 username   username        0 May 26 20:08 username
</pre></blockquote>

<p>
Adem&aacute;s, tambi&eacute;n puede comprobar que el usuario sea
realmente el propietario de su propio fichero <em>/var/mail</em>.  Por
supuesto, esto deber&iacute;a ser as&iacute; (por ejemplo, el
propietario de <em>/var/mail/joe</em> deber&iacute;a ser el usuario
<em>joe</em>), pero si no estuviera correctamente configurado
podr&iacute;a ser la causa del problema.

<p>
Dejar <em>/var/mail</em> con permiso de escritura para el grupo
<em>mail</em> crea algunos problemas de seguridad.  Es probable que
nunca tenga problemas con eso...  &iexcl;pero podr&iacute;a tenerlos!
(especialmente si su sitio es de alto rendimiento, como un ISP, ...).
Hay varios servidores de POP que se pueden instalar directamente desde
la colecci&oacute;n de portes.  Si es posible, es recomendable usar
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=popa3d&amp;sektion=8">popa3d</a>,
que se encuentra en la instalaci&oacute;n base de OpenBSD.  O
podr&iacute;a darse el caso que tuviera seleccionadas las opciones
err&oacute;neas para su d&aelig;mon 'pop' (como &quot;<em>dot
locking</em>&quot;).  O tambi&eacute;n es posible que necesitara cambiar
el directorio que bloquea (aunque entonces, el bloqueo s&oacute;lo
ser&iacute;a de valor para el d&aelig;mon POP).

<p>
<strong>PD:</strong> N&oacute;tese que OpenBSD no tiene un grupo con el
nombre &quot;<em>mail</em>&quot;.  Debe ser a&ntilde;adido en el fichero
<em>/etc/group</em> con una entrada como &eacute;sta:

<blockquote><pre>
mail:*:6:
</pre></blockquote>

<p>
<a name="SendmailDNS"></a>
<h2>10.6 - &iquest;Por qu&eacute; ignora Sendmail el fichero
<tt>/etc/hosts</tt></h2>

<p>
En el modo predeterminado, Sendmail no usa el fichero
<tt>/etc/hosts</tt> para la resoluci&oacute;n de nombres, sino DNS.
Esto se puede cambiar a trav&eacute;s del fichero
<tt>/etc/mail/service.switch</tt>.

<p>
Si quiere enviar requerimientos al fichero <tt>/etc/hosts</tt> antes que
a los servidores de DNS, debe crear un fichero
<tt>/etc/mail/service.switch</tt> que contenga la siguiente
l&iacute;nea:

<pre>
     hosts       files dns
</pre>

<p>
Si quiere enviar requerimientos S&Oacute;LO al fichero
<tt>/etc/hosts</tt>, use la siguiente l&iacute;nea:

<pre>
     hosts       files
</pre>

<p>
Env&iacute;e a Sendmail una se&ntilde;al HUP:

<pre>
     # <b>kill -HUP `head -1 /var/run/sendmail.pid`</b>
</pre>

<p>
para que los cambios sean efectivos.


<p>
<a name="HTTPS"></a>
<h2>10.7 - C&oacute;mo se configura un servidor HTTP seguro usando
SSL(8)</h2>

<p>
La distribuci&oacute;n oficial de OpenBSD incluye un servidor
<em>httpd</em> con SSL (<em>Secure Sockets Layer</em>, la capa de
conectores de seguridad) y las bibliotecas de RSA.  Antes de poderlas
usar con
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=httpd&amp;sektion=8">httpd(8)</a>, 
debe crear un certificado.  Este certificado se almacenar&aacute; en el
directorio <tt>/etc/ssl/</tt> con la clave correspondiente en
<tt>/etc/ssl/private/</tt>.  Los pasos que mostraremos sobre la
creaci&oacute;n del certificado se han tomado en parte de la
p&aacute;gina del manual de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssl&amp;sektion=8">
ssl(8)</a>.  Puede ver una informaci&oacute;n m&aacute;s detallada en
esta p&aacute;gina del manual.  La informaci&oacute;n incluida en este
documento se limita a explicar c&oacute;mo crear un certificado RSA para
servidores de <em>web</em>, no un certifificado DSA para servidores.
Lea la p&aacute;gina del manual de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssl&amp;sektion=8">
ssl(8)</a> si necesita obtener m&aacute;s informaci&oacute;n.

<p>
Antes de empezar, necesita generar su clave de servidor y su certificado
usando OpenSSL:

<div style="margin-left: 2em">
<pre>
# <strong>openssl genrsa -out /etc/ssl/private/server.key 1024</strong>
</pre>
</div>

<p>
O, si lo desea, puede cifrar la clave con una contrase&ntilde;a que
tendr&aacute; que introducir cuando inicie los servidores:

<div style="margin-left: 2em">
<pre>
# <strong>openssl genrsa -des3 -out /etc/ssl/private/server.key 1024</strong>
</pre>
</div>

<p>
El pr&oacute;ximo paso es generar un <em>&quot;Certificate Signing
Request&quot;</em> (requerimiento para firmar el certificado), que se
usa para que una Autoridad Certificadora (CA) firme su certificado.
Para ello use la orden:

<div style="margin-left: 2em">
<pre>
# <strong>openssl req -new -key /etc/ssl/private/server.key -out /etc/ssl/private/server.csr</strong>
</pre>
</div>

<p>
El fichero <em>server.csr</em> se puede entregar a la Autoridad
Certificadora que firmar&aacute; la clave.  Una de estas CA es
<strong>Thawte Certification</strong>, y se puede localizar en
<a href="http://www.thawte.com/">http://www.thawte.com/</a>.

<p>
Si no se lo puede permitir, o si quiere firmar Vd. mismo el certificado,
puede usar lo siguiente:

<div style="margin-left: 2em">
<pre>
# <strong>openssl x509 -req -days 365 -in /etc/ssl/private/server.csr \
       -signkey /etc/ssl/private/server.key -out /etc/ssl/server.crt</strong>
</pre>
</div>

<p>
Con <em>/etc/ssl/server.crt</em> y <em>/etc/ssl/private/server.key</em>
en su sitio ya puede iniciar
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=httpd&amp;sektion=8">httpd(8)</a>
con el indicador <strong>-DSSL</strong> (v&eacute;ase la
<a href="#rc">secci&oacute;n sobre rc(8)</a> en este documento),
permitiendo transacciones https con su m&aacute;quina por el puerto 443.

<p>
<a name="vipw"></a>
<h2>10.8 - He hecho cambios a <em>/etc/passwd</em>, pero los cambios no
funcionan.  &iquest;Por qu&eacute;?</h2>

<p>
Si edita <em>/etc/passwd</em> directamente, cualquier cambio que haga se
perder&aacute;.  OpenBSD genera el fichero <em>/etc/passwd</em> de forma
din&aacute;mica con
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pwd_mkdb&amp;sektion=8">pwd_mkdb(8)</a>.
El fichero principal de las contrase&ntilde;as en OpenBSD es
<em>/etc/master.passwd</em>.  De acuerdo con la p&aacute;gina del manual
de pwd_mkdb(8):

<blockquote><pre>
FILES
     /etc/master.passwd  fichero de contrase&ntilde;a actual
     /etc/passwd         fichero de contrase&ntilde; en formato Version 7
     /etc/pwd.db         fichero de base de datos de la contrase&ntilde;a
                         no seguro
     /etc/pwd.db.tmp     fichero temporal
     /etc/spwd.db        fichero de base de datos de la contrase&ntilde;a
                         seguro
     /etc/spwd.db.tmp    fichero temporal
</pre></blockquote>

<p>
En un fichero de contrase&ntilde;as tradicional de Unix, como
<em>/etc/passwd</em>, toda la informaci&oacute;n, incluida la
contrase&ntilde;a cifrada del usuario, est&aacute; disponible para
cualquiera que pueda acceder al sistema (y es el primer objetivo para
programas como <code>crack</code>).  4.4BSD introdujo el fichero
<em>master.passwd</em>, que tiene un formato extendido (con opciones
adicionales que van m&aacute;s all&aacute; de las ofrecidas por
<em>/etc/passwd</em>), y s&oacute;lo puede ser le&iacute;do por el
superusuario <em>root</em>.  Para un acceso m&aacute;s r&aacute;pido a
los datos, las llamadas de las bibliotecas que acceden a estos datos
leen los ficheros <em>/etc/pwd.db</em> y <em>/etc/spwd.db</em>.

<p>
OpenBSD incluye una herramienta,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">
vipw(8)</a>, para la edici&oacute;n del fichero de contrase&ntilde;as.
<kbd>vipw</kbd> usa
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vi&amp;sektion=1">
vi(1)</a> (nuestro editor preferido, definido por $EDITOR) para editar
el fichero <em>/etc/master.passwd</em>.  Una vez que ha terminado de
editar, vuelve a crear los ficheros <em>/etc/passwd</em>,
<em>/etc/pwd.db</em>, y <em>/etc/spwd.db</em> conforme con los cambios
que haya llevado a cabo.  <kbd>vipw</kbd> tambi&eacute;n se encarga de
bloquear estos ficheros, de modo que si alguna otra persona intentara
cambiarlos al mismo tiempo, no le permitir&iacute;a el acceso.

<p>
<a name="AddDelUser"></a>
<h2>10.9 - &iquest;C&oacute;mo a&ntilde;ado un usuario?
&iquest;C&oacute;mo elimino un usuario?</h2>

<p>
OpenBSD dispone de dos &oacute;rdenes para a&ntilde;adir usuarios en el
sistema f&aacute;cilmente:

<ul>
<li><a href="#adduser">adduser(8)</a>
<li><a href="#user">user(8)</a>
</ul>

<p>
Tambi&eacute;n es posible a&ntilde;adir usuarios a mano, usando
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">
vipw(8)</a>, pero en la mayor&iacute;a de operaciones esto es m&aacute;s
dif&iacute;cil.

<p>
<a name="adduser"></a>
En OpenBSD, la manera m&aacute;s f&aacute;cil para a&ntilde;adir un
usuario es usando el gui&oacute;n
(<em>script</em>)
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8">adduser(8)</a>.
Se puede configurar adduser(8) editando el fichero
<i>/etc/adduser.conf</i>.  adduser(8) permite que se efect&uacute;en
pruebas de consistencia sobre <i>/etc/passwd</i>, <i>/etc/group</i>, y
las bases de datos del int&eacute;rprete.  Crea las entradas y
directorios $HOME.  Tambi&eacute;n puede enviar un mensaje de bienvenida
a los nuevos usuarios.  A continuaci&oacute;n se puede ver un ejemplo de
c&oacute;mo se a&ntilde;ade un nuevo usuario, <b>testuser</b>, a un
sistema.  El directorio $HOME del nuevo usuario ser&aacute;
<i>/home/testuser</i>, y tambi&eacute;n se le a&ntilde;adir&aacute; al
grupo <b>guest</b>, y se le asignar&aacute; el int&eacute;rprete
<i>/bin/ksh</i>.

<blockquote><pre>
# <strong>adduser</strong>
Use option ``-silent'' if you don't want to see all warnings and questions.

Reading /etc/shells
Reading /etc/login.conf
Check /etc/master.passwd
Check /etc/group

Ok, let's go.
Don't worry about mistakes. I will give you the chance later to correct any input.
Enter username []: <b>testuser</b>
Enter full name []: <b>Test FAQ User</b>
Enter shell csh ksh nologin sh [sh]: <b>ksh</b>
Uid [1002]: <b><i>Intro</i></b>
Login group testuser [testuser]: <b>guest</b>
Login group is ``guest''. Invite testuser into other groups: guest no 
[no]: <b>no</b>
Login class auth-defaults auth-ftp-defaults daemon default staff 
[default]: <b><i>Intro</i></b>
Enter password []: <b><i>Escribir la contrase&ntilde;a y pulsar intro</i></b>
Enter password again []: <b><i>Escribir la contrase&ntilde;a y pulsar intro</i></b>

Name:        testuser
Password:    ****
Fullname:    Test FAQ User
Uid:         1002
Gid:         31 (guest)
Groups:      guest
Login Class: default
HOME:        /home/testuser
Shell:i      /bin/ksh
OK? (y/n) [y]: <b>y</b>
Added user ``testuser''
Copy files from /etc/skel to /home/testuser
Add another user? (y/n) [y]: <b>n</b>
Goodbye!
</pre></blockquote>

<p>
Para eliminar usuarios debe usar la herramienta
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rmuser&amp;sektion=8">rmuser(8)</a>.
De esta forma se eliminar&aacute; todo vestigio de un usuario.  Se
eliminar&aacute; cualquier entrada en
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=crontab&amp;sektion=1">crontab(1)</a>
relacionada con el usuario, su directorio $HOME (siempre que el
propietario de &eacute;ste sea el usuario en cuesti&oacute;n), y su
correo.  Tambi&eacute;n se eliminar&aacute;n sus entradas en los
ficheros <em>/etc/passwd</em> y <em>/etc/group</em>.

<p>
A continuaci&oacute;n sigue un ejemplo sobre c&oacute;mo eliminar el
usuario que se ha a&ntilde;adido en el ejemplo anterior.  Ver&aacute;
que preguntar&aacute; por el nombre, y si debe o no eliminar el
directorio ra&iacute;z ($HOME) del usuario.

<blockquote><pre>
# <strong>rmuser</strong>
Enter login name for user to remove: <strong>testuser</strong>
Matching password entry: <strike>introduzca la contrase&ntilde;a</strike>

testuser:$2a$07$ZWnBOsbqMJ.ducQBfsTKUe3PL97Ve1AHWJ0A4uLamniLNXLeYrEie:1002
:31::0:0:Test FAQ User:/home/testuser:/bin/ksh

Is this the entry you wish to remove? <strong>y</strong>
Remove user's home directory (/home/testuser)? <strong>y</strong>
Updating password file, updating databases, done.
Updating group file: done.
Removing user's home directory (/home/testuser): done.
</pre></blockquote>

<p>
<a name="user"></a>
<h3>C&oacute;mo a&ntilde;adir usuarios con user(8)</h3>

<p>
Estas herramientas son menos interactivas que la orden
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8">adduser(8)</a>,
que hace que sea m&aacute;s f&aacute;cil usarlos en guiones de
ejecuci&oacute;n (<em>script</em>).

<p>
La lista completa de herramientas es:
<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=group&amp;sektion=8">group(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=groupadd&amp;sektion=8">groupadd(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=groupdel&amp;sektion=8">groupdel(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=groupinfo&amp;sektion=8">groupinfo(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=groupmod&amp;sektion=8">groupmod(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=user&amp;sektion=8">user(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=useradd&amp;sektion=8">useradd(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=userdel&amp;sektion=8">userdel(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=userinfo&amp;sektion=8">userinfo(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=usermod&amp;sektion=8">usermod(8)</a>
</ul>

<p>
<h4>C&oacute;mo a&ntilde;adir usuarios</h4>

<p>
Dado que user(8) no es interactivo, la forma m&aacute;s f&aacute;cil
para a&ntilde;adir usuarios de modo eficiente es usar la orden
adduser(8).  La orden <kbd>/usr/sbin/user</kbd> es simplemente una
interfaz para el resto de &oacute;rdenes <kbd>/usr/sbin/user*</kbd>.
Por lo tanto, las siguientes &oacute;rdenes pueden ser adheridas usando
<kbd>user add</kbd> o <kbd>useradd</kbd>;  el modo en que lo haga
s&oacute;lo depende de su elecci&oacute;n, y no altera en absoluto la
funci&oacute;n de la orden.

<p>
En este ejemplo estamos a&ntilde;adiendo el mismo usuario con las mismas
especificaciones que usamos para el nuevo usuario de los
<a href="#adduser">ejemplos anteriores</a>.  La orden useradd(8) es
m&aacute;s f&aacute;cil de usar si se sabe la configuraci&oacute;n
predeterminada antes de crear el usuario.  Estas configuraciones se
encuentran en el fichero <em>/etc/usermgmt.conf</em>, y se pueden ver
del siguiente modo:

<blockquote><pre>
$ <strong>user add -D</strong>
group           users
base_dir        /home
skel_dir        /etc/skel
shell           /bin/csh
inactive        0
expire          Null (unset)
range           1000..60000
</pre></blockquote>

<p>
Las configuraciones de arriba son las que se activar&aacute;n de modo
predeterminado a menos que se especifiquen otras mediante opciones en la
l&iacute;nea de &oacute;rdenes.  Por ejemplo, en nuestro caso, queremos
que el usuario pertenezca al grupo <strong>guest</strong>, no al grupo
<strong>users</strong>.  Un peque&ntilde;o obst&aacute;culo m&aacute;s
al crear usuarios, es que las contrase&ntilde;as se deben especificar
desde la l&iacute;nea de &oacute;rdenes.  Las contrase&ntilde;as
est&aacute;n cifradas, as&iacute; que ser&aacute; necesario usar la
utilidad
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=encrypt&amp;sektion=1">encrypt(1)</a>
para crearla.  OpenBSD usa, de modo predeterminado, 6 veces el algoritmo
Blowfish para crear la contrase&ntilde;a.

<p>
He aqu&iacute; una l&iacute;nea que muestra c&oacute;mo crear una
contrase&ntilde;a para espicificarla en useradd(8).

<blockquote><pre>
$ <strong>encrypt -p -b 6</strong>
Enter string:
$2a$06$YOdOZM3.4m6MObBXjeZtBOWArqC2.uRJZXUkOghbieIvSWXVJRzlq
</pre></blockquote>

<p>
Ahora que ya tenemos nuestra contrase&ntilde;a cifrada, estamos
preparados para a&ntilde;adirla al usuario:

<blockquote><pre>
# <strong>user add -p '$2a$06$YOdOZM3.4m6MObBXjeZtBOWArqC2.uRJZXUkOghbieIvSWXVJRzlq' -u 1002 \
-s /bin/ksh -c "Test FAQ User" -m -g guest testuser</strong>
</pre></blockquote>

<p>
<strong>Nota:</strong>  Aseg&uacute;rese de usar comillas simples
(<b>'&nbsp;'</b>) a ambos lados de la cadena de la contrase&ntilde;a, y
no comillas dobles (<b>&quot;&nbsp;&quot;</b>) ya que &eacute;stas
ser&iacute;an interpretadas por el int&eacute;rprete de &oacute;rdenes
(<em>shell</em>) antes de enviar la cadena a user(8).  Adem&aacute;s de
eso, aseg&uacute;rese de especificar la opci&oacute;n <b>-m</b> si
quiere que el directorio ra&iacute;z del usuario sea creado y que los
ficheros de <em>/etc/skel</em> se copien a este directorio.

<p>
Para verificar que se ha creado el usuario correctamente podemos usar
muchas utilidades diferentes.  A continuaci&oacute;n hay unas cuantas
&oacute;rdenes que puede usar para verificar r&aacute;pidamente que todo
ha sido creado correctamente.

<blockquote><pre>
$ <strong>ls -la /home</strong>
total 14
drwxr-xr-x   5 root      wheel   512 May 12 14:29 .
drwxr-xr-x  15 root      wheel   512 Apr 25 20:52 ..
drwxr-xr-x  24 ericj     wheel  2560 May 12 13:38 ericj
drwxr-xr-x   2 testuser  guest   512 May 12 14:28 testuser
$ <strong>id testuser</strong>
uid=1002(testuser) gid=31(guest) groups=31(guest)
$ <strong>finger testuser</strong>
Login: testuser                         Name: Nombre Completo del Usuario
Directory: /home/testuser               Shell: /bin/ksh
Last login Sat Apr 22 16:05 (EDT) on ttyC2
No Mail.
No Plan.
</pre></blockquote>

<p>
Aparte de estas &oacute;rdenes, user(8) dispone de, userinfo(8), su
propia utilidad para mostrar las caracter&iacute;sticas del usuario.

<blockquote><pre>
$ <strong>userinfo testuser</strong>
login   testuser
passwd  *
uid     1002
groups  guest
change  Wed Dec 31 19:00:00 1969
class
gecos   Test FAQ User
dir     /home/testuser
shell   /bin/ksh
expire  Wed Dec 31 19:00:00 1969
</pre></blockquote>

<p>
<h4>C&oacute;mo eliminar usuarios</h4>

<p>
Para eliminar usuarios con la jerarqu&iacute;a de &oacute;rdenes
user(8), se debe usar userdel(8).  &Eacute;sta es una orden muy simple,
pero muy &uacute;til.  Para eliminar el usuario creado en el ejemplo
anterior, basta con ejecutar

<blockquote><pre>
# <strong>userdel -r testuser</strong>
</pre></blockquote>

<p>
N&oacute;tese que la opci&oacute;n <strong>-r</strong> se debe
especificar si se desea que el directorio ra&iacute;z del usuario sea
tambi&eacute;n eliminado.  De forma alternativa puede especificar
<strong>-p</strong> y no <strong>-r</strong>, y as&iacute; se
bloquear&aacute; la cuenta del usuario pero no se eliminar&aacute;
ninguna informaci&oacute;n.

<p>
<a name="FTPOnly"></a>
<h2>10.10 - &iquest;C&oacute;mo puedo crear una cuenta s&oacute;lo FTP
(no FTP An&oacute;nimo)?</h2>

<p>
Existen varios modos de hacerlo, pero una manera muy com&uacute;n es
a&ntilde;adir <em>/usr/bin/false</em> en el fichero
<em>/etc/shells</em>.  As&iacute;, cuando se vincule un
int&eacute;rprete de usuario (<em>user shell</em>) a
<em>/usr/bin/false</em>, &eacute;ste no podr&aacute; ingresar de forma
interactiva pero podr&aacute; usar ftp.
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8">adduser(8)</a> 
les dar&aacute; un directorio $HOME que ser&aacute;, por
definici&oacute;n, <em>/home/&lt;usuario&gt;</em>.  Si le parece bien de
esta forma, no necesita cambiarlo;  sin embargo, puede configurarlo a
cualquier otro directorio que Vd. desee.  Puede forzar que el usuario
s&oacute;lo pueda ver los ficheros en su directorio $HOME,
a&ntilde;adiendo su nombre de usuario al fichero
<em>/etc/ftpchroot</em>.  Mediante el uso de la opci&oacute;n
<strong>-A</strong> para 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8">
ftpd(8)</a>, puede restringir los ingresos (<em>login</em>) para que
s&oacute;lo sean posibles por ftpchroot.

<p>
<a name="Quotas"></a>
<h2>10.11 - Configuraci&oacute;n de cuotas de disco</h2>

<p>
Las cuotas se usan para limitar el espacio del que disponen los usuarios
en sus discos.  Puede ser muy &uacute;til en situaciones en las que los
recursos disponibles sean limitados.  Existen dos configuraciones
posibles para las cuotas, cuotas de usuario y/o cuotas de grupo.

<p>
El primer paso para configurar cuotas es asegurarse de que la
opci&oacute;n <code>QUOTA</code> se encuentra activada en la
<a href="faq5.html#Options">configuraci&oacute;n del n&uacute;cleo</a>
del sistema.  Esta opci&oacute;n est&aacute; configurada en el
n&uacute;cleo GENERIC.  Despu&eacute;s se deben marcar los sistemas de
archivo para los que se vaya a configurar las cuotas en
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fstab&amp;sektion=5"><tt>/etc/fstab</tt></a>.
Esto se hace usando las palabras clave <code>userquota</code> y
<code>groupquota</code> para marcar cada uno de los sistemas de archivo
en el que se usarán las cuotas.  Por definici&oacute;n, los ficheros
<code>quota.user</code> y <code>quota.group</code> se crear&aacute;n en
la ra&iacute;z de ese sistema de archivos, que tendr&aacute; la
informaci&oacute;n sobre las cuotas.  Esto se puede anular especificando
el nombre del fichero con la opci&oacute;n quota en <tt>/etc/fstab</tt>,
v.g. &quot;<code>userquota=/var/quotas/quota.user</code>&quot;.
He aqu&iacute; un ejemplo de <tt>/etc/fstab</tt> con s&oacute;lo un
sistema de archivos con las cuotas de usuario activadas, y el fichero de
cuotas en una ubicaci&oacute;n at&iacute;pica:

<blockquote><pre>
/dev/wd0a / ffs rw,userquota=/var/quotas/quota.user 1 1
</pre></blockquote>

<p>
Ahora ya puede configurar las cuotas de usuario.  Para ello use la
utilidad
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=edquota&amp;sektion=8">edquota(8)</a>.
Una forma simple de usarlo es
&quot;<strong>edquota&nbsp;&lt;usuario&gt;</strong>&quot;.  La orden
edquota(8) usar&acute; vi(1) para editar las cuotas a menos que la
variable de entorno EDITOR indique un editor diferente.  Por ejemplo:

<blockquote><pre>
# <strong>edquota ericj</strong>
</pre></blockquote>

<p>
Esto dar&aacute; un resultado parecido al siguiente:

<blockquote><pre>
Quotas for user ericj:
/: blocks in use: 62, limits (soft = 0, hard = 0)
	inodes in use: 25, limits (soft = 0, hard = 0)
</pre></blockquote>

<p>
Para a&ntilde;adir l&iacute;mites, debe quedar algo como esto:

<blockquote><pre>
Quotas for user ericj:
/: blocks in use: 62, limits (soft = 1000, hard = 1050)
	inodes in use: 25, limits (soft = 0, hard = 0)
</pre></blockquote>

<p>
N&oacute;tese que las cuotas est&aacute;n repartidas en bloques de 1KB.
En este caso, el &quot;softlimit&quot; es de 1000KB bloques, y el
&quot;hardlimit&quot; de 1050KB.  <i>softlimit</i> es el l&iacute;mite
en el cual el usuario recibe un aviso cuando lo sobrepasa, y tiene hasta
su periodo de gracia para rebajar su uso del disco por debajo de su
l&iacute;mite.  Los periodos de gracia se pueden configurar usando la
opci&oacute;n <strong>-t</strong> con la orden edquota(8).
Despu&eacute;s de que el periodo de gracia haya pasado, el
&quot;softlimit&quot; se toma como &quot;hardlimit&quot;.  El resultado
es un fallo de ubicaci&oacute;n (<i>allocation failure</i>).

<p>
Una vez que las cuotas ya est&aacute;n configuradas, tiene que
activarlas.  Para ello use
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=quotaon&amp;sektion=8">quotaon(8)</a>.
Por ejemplo:

<blockquote><pre>
# <strong>quotaon -a</strong>
</pre></blockquote>

<p>
De este modo repasar&aacute; <tt>/etc/fstab</tt> para activar los
sistemas de archivo con opciones de cuota.  En cuanto las cuotas
est&eacute;n funcionando, puede verlas con
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=quota&amp;sektion=1">quota(1)</a>.
Si usa la orden &quot;<tt>quota &lt;usuario&gt;</tt>&quot;
obtendr&aacute; la informaci&oacute;n sobre el usuario que especifique.
Al ser invocada sin argumentos, la orden quota(8) le dar&aacute; sus
estad&iacute;sticas de cuotas.  Por ejemplo:

<blockquote><pre>
# <strong>quota ericj</strong>
</pre></blockquote>

<p>
Dar&aacute; como resultado algo como esto:

<blockquote><pre>
Disk quotas for user ericj (uid 1001): 
     Filesystem  blocks   quota   limit   grace   files   quota   limit   grace
              /      62    1000    1050              27       0       0        
</pre></blockquote>

<p>
Las cuotas que est&eacute;n configuradas en <tt>/etc/fstab</tt>
iniciar&eacute;n durante el arranque por definici&oacute;n.  Para
desactivarlo use:

<blockquote><pre>
# <strong>quotaoff -a</strong>
</pre></blockquote>

<p>
<a name="Kerberos"></a>
<h2>10.12 - C&oacute;mo se configuran los clientes y servidores
KerberosV en OpenBSD</h2>

<p>
Para m&aacute;s informaci&oacute;n sobre KerberosV, desde un sistema
OpenBSD, &uacute;sese la orden:

<pre>
     # <b>info heimdal</b>
</pre>


<p>
<a name="AnonFTP"></a>
<h2>10.13 - Configuraci&oacute;n de servicios de FTP An&oacute;nimo</h2>

<p>
FTP An&oacute;nimo permite a los usuarios que carecen de cuentas en el
sistema, acceder a ficheros en su m&aacute;quina mediante el
&laquo;Protocolo de Transferencia de Ficheros&raquo; (FTP, &quot;File
Transfer Protocol&quot;).  Esta secci&oacute;n ofrece un resumen sobre
c&oacute;mo configurar el servidor de ftp an&oacute;nimo, su ingreso,
etc...

<p>
<h3>Creaci&oacute;n de la cuenta de FTP</h3>

<p>
Para empezar, necesita tener una cuenta &quot;ftp&quot; en su sistema.
Esta cuenta no debe tener una contrase&ntilde;a utilizable.  Aqu&iacute;
configuraremos el directorio de ingreso como <em>/home/ftp</em>, pero
puede ponerlos donde quiera.  Cuando use ftp an&oacute;nimo, el
d&aelig;mon de ftp ejecutar&aacute; chroot sobre s&iacute; mismo para
cambiar la directorio del usuario de ftp.  Puede leer m&aacute;s sobre
esto en las p&aacute;ginas de manual de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8">
ftp(8)</a> y
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=chroot&amp;sektion=2">chroot(2)</a>.
He aqu&iacute; un ejemplo sobre c&oacute;mo a&ntilde;adir el usuario
<em>ftp</em>.  Para ello usaremos
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8">adduser(8)</a>.
Tambi&eacute;n necesitamos a&ntilde;adir /usr/bin/false a nuestro
fichero <em>/etc/shells</em>, que ser&aacute; la <em>shell</em> que
configuraremos para el usuario ftp.  As&iacute; no tendrán permiso para
ingresar, aunque les daremos una contrase&ntilde;a vac&iacute;a.  Para
ello puede hacer simplemente lo siguiente:

<pre>
echo /usr/bin/false &gt;&gt; /etc/shells
</pre>

Tambi&eacute;n, si quiere que esa shell se muestre durante las preguntas
de la orden adduser, necesita modificar <em>/etc/adduser.conf</em>.

<blockquote><pre>
# <strong>adduser</strong>
Use option ``-silent'' if you don't want to see all warnings and questions.

Reading /etc/shells
Reading /etc/login.conf
Check /etc/master.passwd
Check /etc/group

Ok, let's go.
Don't worry about mistakes. I will give you the chance later to correct any input.
Enter username []: <b>ftp</b>
Enter full name []: <b>anonymous ftp</b>
Enter shell csh false ksh nologin sh tcsh zsh [sh]: <b>false</b>
Uid [1002]: <b><i>Intro</i></b>
Login group ftp [ftp]: <b><i>Intro</i></b>
Login group is ``ftp''. Invite ftp into other groups: guest no 
[no]: <b>no</b>
Login class auth-defaults auth-ftp-defaults daemon default staff 
[default]: <b><i>Intro</i></b>
Enter password []: <b><i>Intro</i></b>
Set the password so that user cannot logon? (y/n) [n]: <b>y</b>

Name:        ftp
Password:    ****
Fullname:    anonymous ftp
Uid:         1002
Gid:         1002 (ftp)
Groups:      ftp
Login Class: default
HOME:        /home/ftp
Shell:       /usr/bin/false
OK? (y/n) [y]: <b>y</b>
Added user ``ftp''
Copy files from /etc/skel to /home/ftp
Add another user? (y/n) [y]: <b>n</b>
Goodbye!
</pre></blockquote>

<p>
<h3>Configuraci&oacute;n del directorio</h3>

<p>
Adem&aacute;s del usuario, ha creado el directorio <em>/home/ftp</em>.
Es lo que queremos, pero hay algunos cambios que tendremos que hacer
para tenerlo preparado para ftp an&oacute;nimo.  Estos cambios se
explican en la p&aacute;gina de manual de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8">
ftp(8)</a>.

<p>
<strong>No</strong> necesita crear un directorio <em>/home/ftp/usr</em>
o <em>/home/ftp/bin</em>.
<ul>
<li><em>/home/ftp</em> - Es el directorio principal.  Su propietario
debe ser root, y los permisos deben ser 555.
<li><em>/home/ftp/etc</em> - Es totalmente opcional y no se recomienda,
ya que s&oacute;lo sirve para dar informaci&oacute;n sobre los usuarios
existentes en un sistema.  Si quiere que parezca que su directorio de
ftp an&oacute;nimo contiene usuarios reales adjuntos a sus ficheros,
deber&iacute;a copiar <em>/etc/pwd.db</em> y <em>/etc/group</em> a este
directorio.  Este directorio deber&iacute;a estar en modo 511, y los dos
ficheros en modo 444.  &Eacute;stos se usan para dar al propietario
nombres en lugar de n&uacute;meros.  No existen contrase&ntilde;as
almacenadas en <em>pwd.db</em>, ya que est&aacute;n todas en
<em>spwd.db</em>, as&iacute; que no las copie ah&iacute;.
<li><em>/home/ftp/pub</em> - &Eacute;ste es el directorio t&iacute;pico
para ubicar los ficheros que quiera compartir.  Este directorio
tambi&eacute;n deber&iacute; estar en modo 555.
</ul>

<p> 
Note que el propietario de todos estos directorios deber&iacute;a ser
``root''.  He aqu&iacute; una lista de c&oacute;mo deber&iacute;an ser
los directorios despu&eacute;s de ser creados:

<blockquote><pre>
# pwd 
/home
# ls -laR ftp
total 5
dr-xr-xr-x  5 root  ftp    512 Jul  6 11:33 .
drwxr-xr-x  7 root  wheel  512 Jul  6 10:58 ..
dr-x--x--x  2 root  ftp    512 Jul  6 11:34 etc
dr-xr-xr-x  2 root  ftp    512 Jul  6 11:33 pub

ftp/etc:
total 43
dr-x--x--x  2 root  ftp    512 Jul  6 11:34 .
dr-xr-xr-x  5 root  ftp    512 Jul  6 11:33 ..
-r--r--r--  1 root  ftp    316 Jul  6 11:34 group
-r--r--r--  1 root  ftp  40960 Jul  6 11:34 pwd.db

ftp/pub:
total 2
dr-xr-xr-x  2 root  ftp  512 Jul  6 11:33 .
dr-xr-xr-x  5 root  ftp  512 Jul  6 11:33 ..
</pre></blockquote>

<p>
<h3>Inicio del servidor e ingreso</h3>

<p>
Con <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8">ftpd(8)</a> puede escoger entre invocarlo desde
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd&amp;sektion=8">inetd(8)</a> 
o lo pueden iniciar los guiones de configuraci&oacute;n de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&amp;ektion=8">
rc(8)</a>.  En estos ejemplos se ver&aacute; c&oacute;mo se inicia
nuestro d&aelig;mon desde
<a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/inetd.conf">
inetd.conf</a>.  Primero debemos familiarizarnos con algunas de las
opciones de ftpd.  La l&iacute;nea por definici&oacute;n de
<em>/etc/inetd.conf</em> es:

<blockquote><pre>
<strong>
ftp             stream  tcp     nowait  root    /usr/libexec/ftpd       ftpd -US
</strong>
</pre></blockquote>

<p>
En este caso ftpd se invoca con <em>-US</em>.  As&iacute; se
grabar&aacute;n las conexiones an&oacute;nimas a <em>/var/log/ftpd</em>,
y las sesiones concurrentes a <em>/var/run/utmp</em>.  De este modo,
podremos ver estas sesiones con la orden
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=who&amp;ektion=1">
who(1)</a>.  Es posible que algunos s&oacute;lo quisieran tener un
servidor an&oacute;nimo, y desactivar ftp para usuarios.  Para ello debe
invocar ftpd con la opci&oacute;n <em>-A</em>.  He aqu&iacute; una
l&iacute;nea que inicia ftpd para conexiones an&oacute;nimas
s&oacute;lo.  Tambi&eacute;n usa <em>-ll</em> para grabar cada
conexi&oacute;n a syslog, junto con las &oacute;rdenes de ftp 'get',
'retrieve', etc.

<blockquote><pre>
<strong>
ftp             stream  tcp     nowait  root    /usr/libexec/tcpd       ftpd -llUSA
</strong>
</pre></blockquote>

<p>
Nota:  Para aqu&eacute;llos que usen servidores de ftp de MUCHO
tr&aacute;fico, es conveniente que no invoquen ftpd desde
<em>inetd.conf</em>.  La mejor opci&oacute;n es comentar la l&iacute;nea
de ftpd de <em>inetd.conf</em> e iniciar ftpd desde <em>rc.conf</em>
junto con la opci&oacute;n <em>-D</em>.  De este modo iniciar&aacute;n
ftpd como un d&aelig;mon, y ser&aacute; m&aacute;s simple que iniciarlo
desde inetd.  A continuaci&oacute;n viene un ejemplo de c&oacute;mo
iniciarlo desde <em>rc.conf</em>:

<blockquote><pre>
ftpd_flags=&quot;-DllUSA&quot;           # for non-inetd use: ftpd_flags=&quot;-D&quot;
</pre></blockquote>

<p>
Esto s&oacute;lo funcionar&aacute; si se ha desactivado ftpd en
<em>/etc/inetd.conf</em> y se ha forzado a inetd a leer su fichero de
configuraci&oacute;n.

<p>
<h3>Otros ficheros de importancia</h3>

<p>
<ul>
   <li><em>/etc/ftpwelcome</em> - Contiene el mensaje de bienvenida que
   ver&aacute;n al conectar con su servidor ftp.
   <li><em>/etc/motd</em> - Contiene el mensaje que ver&aacute;n
   despu&eacute;s de haber ingresado en su servidor ftp.
   <li><em>.message</em> - Este fichero se puede ubicar en cualquier
   directorio, y cuando alguien entre en ese directorio, ver&aacute; el
   mensaje que contiene.
</ul>


<p>
<a name="ftpchroot"></a>
<h2>10.14 - C&oacute;mo se confina a los usuarios a sus directorios de
usuario (/home) en ftpd(8)</h2>

<p>
En OpenBSD,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8">
ftpd(8)</a> est&aacute; configurado por definici&oacute;n para poder
gestionar esto de modo muy f&aacute;cil.  Se hace por medio del fichero
<strong>/etc/ftpchroot</strong>.  Como los usuarios no son siempre
fiables, puede ser necesario restringir su entrada en otros directorios
que no sean el propio.  Esto NO est&aacute; activado por
definici&oacute;n.  He aqu&iacute; un ejemplo de c&oacute;mo responde
por definici&oacute;n:

<blockquote><pre>
$ <strong>ftp localhost</strong>
Connected to localhost.
220 oshibana FTP server (Version 6.4/OpenBSD) ready.
Name (localhost:ericj): <strong>ericj</strong>
331 Password required for ericj.
Password: <strong>*********</strong>
230- OpenBSD 3.4 (GENERIC) #18: Wed Sep 17 03:34:47 MDT 2003
230- 
230- Welcome to OpenBSD: The proactively secure Unix-like operating system.
230- 
230- Please use the sendbug(1) utility to report bugs in the system.
230- Before reporting a bug, please try to reproduce it with the latest
230- version of the code.  With bug reports, please try to ensure that
230- enough information to reproduce the problem is enclosed, and if a
230- known fix for it exists, include that as well.
230- 
230 User ericj logged in.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; <strong>cd /</strong>
250 CWD command successful.
ftp&gt; <strong>ls</strong>
227 Entering Passive Mode (127,0,0,1,60,7)
150 Opening ASCII mode data connection for 'file list'.
altroot
bin
dev
etc
home
mnt
root
sbin
stand
tmp
usr
var
bsd
sys
boot
226 Transfer complete.
ftp&gt; <strong>quit</strong>
221 Goodbye.
</pre></blockquote>

<p>
Como puede ver, el acceso est&aacute; permitido para todo el servidor.
En un mundo perfecto esto deber&iacute;a ser as&iacute;,
deber&iacute;amos poder fiarnos de todos los usuarios, pero no es
as&iacute;.  Para limitar un usuario, a&ntilde;ada su nombre al fichero
<em>/etc/ftpchroot</em>.  He aqu&iacute; un ejemplo que muestra
c&oacute;mo restringir al usuario &quot;ericj&quot;:

<blockquote><pre>
$ <strong>cat /etc/ftpchroot</strong>
#       $ OpenBSD: ftpchroot,v 1.3 1996/07/18 12:12:47 deraadt Exp $
#
# list of users (one per line) given ftp access to a chrooted area.
# read by ftpd(8).
ericj
</pre></blockquote>

<p>
Esto es suficiente para evitar que el usuario &quot;ericj&quot; se
escape de su propio directorio.  Como puede ver en el siguiente ejemplo,
el directorio <em>/</em> ha cambiado de repente a su directorio de
usuario.

<blockquote><pre>
$ <strong>ftp localhost</strong>
Connected to localhost.
220 oshibana FTP server (Version 6.4/OpenBSD) ready.
Name (localhost:ericj): <strong>ericj</strong>
331 Password required for ericj.
Password: <strong>*********</strong>
230 User ericj logged in.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; <strong>cd /</strong>
250 CWD command successful.
ftp&gt; <strong>ls</strong>
227 Entering Passive Mode (127,0,0,1,92,171)
150 Opening ASCII mode data connection for 'file list'.
.login
.mailrc
.profile
.rhosts
.ssh
.cshrc
work
mail
src
226 Transfer complete.
ftp&gt; <strong>quit</strong>
221 Goodbye.
</pre></blockquote>

<p>
<a name="Patches"></a>
<h2>10.15 - C&oacute;mo se aplican parches en OpenBSD</h2>

<p>
El &aacute;rbol de fuentes de OpenBSD experimenta cambios y mejoras
continuamente, y al mismo tiempo se ponen a disponibilidad
p&uacute;blica parches para problemas comunes con bastante frecuencia.
Estos parches aparecen en la p&aacute;gina web de erratas, que puede
encontrar en
<a href="../../es/errata.html">http://www.openbsd.org/es/errata.html</a>,
y se encuentran separados por categor&iacute;as.  Estas
categor&iacute;as corresponden a los parches que se deber&iacute;an
aplicar a las diferentes arquitecturas, o a parches independientes de la
arquitectura.

<p>
Sin embargo, no se producen parches para las nuevas funcionalidades
a&ntilde;adidas al sistema, y s&oacute;lo se producen para solucionar
problemas de fiabilidad o de seguridad que deban ser atajados
inmediatamente, aunque la &uacute;ltima palabra sobre si se deben
aplicar o no la tiene siempre el administrador del sistema.

<p>
A modo de ejemplo parchear&eacute;
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=talkd&amp;sektion=8">talkd(8)</a> 
con un parche de seguridad obtenido de
<a href="../../es/errata.html">errata.html</a>.

<p>
<h3>&iquest;En qu&eacute; se diferencian estos parches de los que se
pueden encontrar en el &aacute;rbol de fuentes?</h3>

<p>
Todos los parches que se env&iacute;an a
<a href="../../es/errata.html">http://www.openbsd.org/es/errata.html</a>
son parches que se aplican directamente al &aacute;rbol de fuentes de la
versi&oacute;n oficial m&aacute;s reciente.  Los parches que se aplican
al &aacute;rbol de CVS m&aacute;s reciente tambi&eacute;n incluyen otros
cambios que no son deseables en un sistema con la versi&oacute;n
oficial.

<p>
<h3>Preparaci&oacute;n del sistema para la aplicaci&oacute;n de
parches</h3>

<p>
Los parches para el Sistema Operativo OpenBSD se distribuyen como
ficheros <tt>diff</tt>, que son ficheros de texto en los que se
encuentran las diferencias con el c&oacute;digo fuente original.
<strong>NO</strong> se distribuyen en formato binario.  Esto quiere
decir que para aplicar un parche al sistema, antes es necesario disponer
del c&oacute;digo fuente de la versi&oacute;n final (<em>-release</em>)
de OpenBSD.  Esto no significa que deba disponer de TODO el
c&oacute;digo fuente del sistema operativo, sino que debe tener todo el
c&oacute;digo para el programa al que vaya a aplicar el parche.  Por
ejemplo, si va a aplicar un parche al n&uacute;cleo del sistema, debe
tener a mano todo el c&oacute;digo fuente para el n&uacute;cleo.

<p>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cvs&amp;sektion=1">
cvs(1)</a> es una herramienta muy &uacute;til que puede usar para
obtener el c&oacute;digo fuente que necesite por medio de los servidores
an&oacute;nimos de cvs ubicados alrededor del mundo.  Puede ver un
listado de estos servidores en
<a href="../../es/anoncvs.html">
http://www.openbsd.org/es/anoncvs.html</a>.

<p>
Para obtener obtener el c&oacute;digo fuente de talkd(8) para OpenBSD
<i>3.4-release</i> usando
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cvs&amp;sektion=1">
cvs(1)</a>, hay que hacer lo siguiente:

<div style="margin-left: 2em">
<pre>
$ <b>export CVSROOT=anoncvs@anoncvs5.usa.openbsd.org:/cvs</b>
$ <b>cvs co -rOPENBSD_3_4_BASE src/libexec/talkd/</b>
cvs server: Updating src/libexec/talkd
U src/libexec/talkd/announce.c
U src/libexec/talkd/talkd.c
U src/libexec/talkd/talkd.h
</pre>
</div>

<p>
Para encontrar en el CVS el camino hasta el c&oacute;digo que necesita,
puede verlo en la l&iacute;nea <em>Index:</em> del parche.  En este caso
el camino en el CVS era <em>src/libexec/talkd/</em>.  Compruebe siempre
el n&uacute;mero de revisi&oacute;n de OPENBSD_version_number_BASE.  Sin
&quot;_BASE&quot; obtendr&aacute; el c&oacute;digo de la rama estable, y
&eacute;sta puede contener otros cambios que sin duda
interferir&aacute;n.  Si ya est&aacute; siguiendo la rama de parches,
los parches ya deber&iacute;an estar en ese c&oacute;digo fuente, pero
por si acaso deber&iacute;a comprobarlo y asegurarse.  Siempre puede
mirar en
<a href="../../plus.html">http://www.openbsd.org/plus.html</a> para
ver qu&eacute; parches se han aplicado a la rama de parches.  Si los
parches todav&iacute;a no han sido aplicados, tendr&aacute; que obtener
el c&oacute;digo fuente de la &uacute;ltima versi&oacute;n usando la
orden anterior.

<p>
Los usuarios que hayan adquirido los CDs oficiales de OpenBSD pueden
obtener el c&oacute;digo fuente directamente desde el CD.  Mire en la
car&aacute;tula del CD para saber c&oacute;mo extraer el c&oacute;digo
fuente desde el mismo.  En este caso no ser&aacute; necesaria la
obtenci&oacute;n del c&oacute;digo fuente por medio de anoncvs.

<blockquote><pre>
Aplicar del siguiente modo:
        cd /usr/src
        patch -p0 &lt; 026_talkd.patch
        cd libexec/talkd
        make obj &amp;&amp; make depend &amp;&amp; make &amp;&amp; make install

Index: libexec/talkd/announce.c <strong>&lt;------ Camino a los fuentes </strong>
===================================================================
RCS file: /cvs/src/libexec/talkd/announce.c,v
retrieving revision 1.8
retrieving revision 1.9
diff -u -r1.8 -r1.9
--- libexec/talkd/announce.c    1998/08/18 03:42:10     1.8
+++ libexec/talkd/announce.c    2000/07/06 00:01:45     1.9
@@ -160,6 +160,6 @@
                *(bptr++) = '\n';
        }
        *bptr = '\0';
-       fprintf(tf, big_buf);
+       fprintf(tf, "%s", big_buf);
        fflush(tf);
 }
</pre></blockquote>

<p>
Una vez que haya obtenido el c&oacute;digo fuente correcto, puede
obtener el parche y ponerlo en <em>src/</em>.

<p>
<h3>Aplicaci&oacute;n de los parches</h3>

<p>
<div style="margin-left: 2em">
<pre>
$ <strong>cd /usr/src</strong>
$ <strong>patch -p0&lt;/path/to/026_talkd.patch</strong>
Hmm...  Looks like a unified diff to me...
The text leading up to this was:
--------------------------
|Aplicar del siguiente modo:
|       cd /usr/src
|       patch -p0 &lt; 026_talkd.patch
|       cd libexec/talkd
|       make obj &amp;&amp; make depend &amp;&amp; make &amp;&amp; make install
|
|Index: libexec/talkd/announce.c
|===================================================================
|RCS file: /cvs/src/libexec/talkd/announce.c,v
|retrieving revision 1.8
|retrieving revision 1.9
|diff -u -r1.8 -r1.9
|--- libexec/talkd/announce.c   1998/08/18 03:42:10     1.8
|+++ libexec/talkd/announce.c   2000/07/06 00:01:45     1.9
--------------------------
Patching file libexec/talkd/announce.c using Plan A...
Hunk #1 succeeded at 160. <strong>&lt;------------ Parche con &eacute;xito</strong>
done
$ <strong>cd /usr/src/libexec/talkd/</strong>
$ <strong>ls</strong>
CVS             announce.c      print.c         table.c         talkd.c
Makefile        announce.c.orig process.c       talkd.8         talkd.h
$ <strong>make obj &amp;&amp; make depend &amp;&amp; make</strong>
making /home/ericj/lsrc/src/libexec/talkd/obj
mkdep -a /home/ericj/lsrc/src/libexec/talkd/talkd.c /home/ericj/lsrc/sr
c/libexec/talkd/announce.c /home/ericj/lsrc/src/libexec/talkd/process.c
/home/ericj/lsrc/src/libexec/talkd/table.c /home/ericj/lsrc/src/libexec
/talkd/print.c
cc -O2     -c /home/ericj/lsrc/src/libexec/talkd/talkd.c
cc -O2     -c /home/ericj/lsrc/src/libexec/talkd/announce.c
cc -O2     -c /home/ericj/lsrc/src/libexec/talkd/process.c
cc -O2     -c /home/ericj/lsrc/src/libexec/talkd/table.c
cc -O2     -c /home/ericj/lsrc/src/libexec/talkd/print.c
cc   -o ntalkd talkd.o announce.o process.o table.o print.o
nroff -Tascii -mandoc /home/ericj/lsrc/src/libexec/talkd/talkd.8 &gt; talk
d.cat8
$ <strong>sudo make install</strong>
install -c -s -o root -g bin  -m 555 ntalkd /usr/libexec
install -c -o root -g bin -m 444 talkd.cat8 /usr/share/man/cat8/talkd.0
/usr/share/man/cat8/ntalkd.0 -&gt; /usr/share/man/cat8/talkd.0
</pre>
</div>

<p>
Una vez hecho esto, reinicie ese servicio.


<p>
<a name="httpdchroot"></a>
<h2>10.16 - Acerca de chroot() Apache</h2>
<p>
En OpenBSD, el servidor de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=httpd&amp;sektion=8">httpd(8)</a>
de Apache tiene el entorno
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=chroot&amp;sektion=2">chroot(2)</a>
activado por definici&oacute;n.  Aunque esto sea un incremento en la
seguridad, puede crear problemas si no se est&aacute; preparado para
ello.

<p>
<h3>&iquest;Qu&eacute; es <em>chroot</em>?</h3>

<p>
Una aplicaci&oacute;n con el entorno
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=chroot&amp;sektion=2">chroot(2)</a>
activado se encuentra encerrada en un directorio particular y no puede
pasar al resto del &aacute;rbol del directorio, y ve ese directorio como
su directorio ra&iacute;z (&quot;<tt>/</tt>&quot;).  En el caso de
httpd(8), el programa se inicia, abre sus archivos de registro, se
vincula a sus puertos TCP (aunque a&uacute;n no aceptar&aacute; datos),
y lee su configuraci&oacute;n.  A continuaci&oacute;n, se bloquea en
<i>/var/www</i> y pierde los privilegios, y entonces empieza a aceptar
requerimientos.  Esto quiere decir que todos los archivos que sirva y
que utilice Apache deben estar en el directorio <i>/var/www</i>.  Esto
representa una gran ventaja para la seguridad;  si hubiera alg&uacute;n
problema de seguridad con Apache, el da&ntilde;o quedar&iacute;a
confinado a un solo directorio con permisos de s&oacute;lo lectura y sin
recursos con los que causar ning&uacute;n da&ntilde;o.

<p>
<h3>&iquest;Qu&eacute; implicaciones tiene esto para el usuario?</h3>

<p>
Para ser francos, chroot(2) Apache es algo nuevo, y muchas aplicaciones
y configuraciones del sistema viejas no funcionar&aacute;n como hasta
ahora.

<ul>
<li><b>Composiciones hist&oacute;ricas del sistema de archivos:</b>  Los
servidores que se hayan actualizado partiendo desde versiones m&aacute;s
antiguas de OpenBSD pueden tener ficheros de <em>web</em> ubicados en
los directorios de usuario, lo que l&oacute;gicamente no
funcionar&aacute; en un entorno chroot(2), ya que httpd(8) no
podr&aacute; llegar hasta el directorio <i>/home</i>.  Los
administradores tambi&eacute;n pueden encontrarse con que su
partici&oacute;n /var/www es demasiado peque&ntilde;a para contener en
ella todos los ficheros de <em>web</em>.  La soluci&oacute;n est&aacute;
en reestructurarlo o en no utilizar la funcionalidad de chroot(2).  Y,
por supuesto, se puede usar enlaces simb&oacute;licos en los directorios
de usuario que apunten a subdirectorios en <i>/var/www</i>.  Pero NO se
puede usar enlaces en <i>/var/www</i> que apunten a otra parte del
sistema de archivos;  eso no funcionar&aacute; debido a que FTP chroot
evitar&aacute; (otra vez) que se pueda acceder a los objetivos de los
enlaces simb&oacute;licos.  Una soluci&oacute;n para esto es no usar
<i>/home</i> como directorio de usuario para estos usuarios, y en su
lugar usar algo parecido a <i>/var/www/home</i>.

<li><b>Rotaci&oacute;n de registros:</b>  Generalmente los registros se
rotan mediante un cambio en el nombre de archivo, y luego enviando una
se&ntilde;al SIGUSR1 a httpd(8) para hacer que Apache cierre sus viejos
archivos de registro y abra otros nuevos.  Ahora esto ya no es posible,
ya que httpd(8) no podr&aacute; abrir sus propios archivos de registro
una vez que ha perdido los privilegios.  Hay que parar httpd(8) y
reiniciarlo:

<pre>
     # <b>apachectl stop && apachectl start</b>
</pre>

<p>
Tambi&eacute;n se puede usar otras estrategias, como efectuar los
registros en un
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pipe&amp;sektion=2">
pipe(2)</a> y usar un rotador de registros externo en el otro extremo
del pipe(2).

<li><b>M&oacute;dulos de Apache:</b>  En principio, los m&oacute;dulos
de Apache ya existentes se cargar&aacute;n, sin embargo puede que
algunos no funcionen correctamente con chroot(2), y que muchos tengan
problemas con
&quot;<tt><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=apachectl&amp;sektion=8">apachectl</a> restart</tt>&quot;,
generando un error que har&aacute; que termine httpd(8).

<li><b>CGI:</b>  La mayor&iacute;a de CGI existentes funcionar&aacute;n
sin m&aacute;s.  Puede que necesiten programas o bibliotecas fuera de
<i>/var/www</i>.  Algunos se pueden reparar compil&aacute;ndolos de modo
que se est&eacute;n enlazados est&aacute;ticamente (sin que necesiten
bibliotecas en otros directorios), y la mayor&iacute;a se pueden reparar
llenando el directorio <i>/var/www</i> con los ficheros requeridos por
la aplicaci&oacute;n, aunque esto no es f&aacute;cil y para ello se
requiere unos conocimientos de programaci&oacute;n considerables.  Para
la mayor&iacute;a de usuarios ser&aacute; m&aacute;s f&aacute;cil
desactivar la funcionalidad chroot(2) hasta que est&eacute;n
actualizados.
</ul>

<p>
En algunos casos, se puede alterar la aplicaci&oacute;n o su
configuraci&oacute;n para que se ejecute sin chroot.  En otros casos, no
quedar&aacute; m&aacute;s remedio que desactivar esta funcionalidad
usando la opci&oacute;n <tt>-u</tt> de httpd(8) en
<i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&amp;sektion=8">/etc/rc.conf</a></i>.

<a name="rootshell"></a>
<h2>10.17 - &iexcl;No me gusta el int&eacute;rprete preasignado al
usuario <i>root</i>!</h2>

<p>
El int&eacute;rprete de &oacute;rdenes preasignado al superusuario
(<i>root shell</i>) en OpenBSD es
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=csh&amp;sektion=1">
csh</a>, debido principalmente a una cuesti&oacute;n de
tradici&oacute;n, aunque csh(1) no es ning&uacute;n requisito
obligatorio para el ingreso como superusuario (pero antes de cambiarlo
es muy aconsejable leer el resto de estas l&iacute;neas).

<p>
Algunos usuarios que provienen de otros sistemas operativos tipo Unix se
encuentran con que csh(1) no es nada familiar, y en seguida preguntan
c&oacute;mo pueden cambiarlo.  Existen algunas opciones:

<ul>
<li><b>&iexcl;No hay que ingresar nunca como <i>root</i>!</b>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=su&amp;sektion=1">
su</a> y
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sudo&amp;sektion=8">
sudo</a> son dos buenas razones para no tener que ingresar en una
m&aacute;quina directamente como usuario <i>root</i> una vez realizada
la configuraci&oacute;n inicial despu&eacute;s de la instalaci&oacute;n.
<li><b>Se puede invocar al int&eacute;rprete que se desee despu&eacute;s
del ingreso.</b>  Si un usuario prefiere ksh(1) o cualquier otro
int&eacute;rprete de &oacute;rdenes, basta con invocarlo desde el
int&eacute;rprete preasignado.
<li><b>Es posible cambiar la asignaci&oacute;n del int&eacute;rprete de
<i>root</i>.</b>  Para ello hay que usar la orden
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=chsh&amp;sektion=1">
chsh</a> o
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">
vipw</a>.
</ul>

<p>
Una regla tradicional en Unix es la de usar para el superusuario
<b>s&oacute;lo</b> int&eacute;rpretes de &oacute;rdenes compilados de
modo est&aacute;tico debido a que, si el sistema tuviera que ser
iniciado en modo mono-usuario, las particiones que no fueran la de
<i>root</i> no se montar&iacute;an y un int&eacute;rprete enlazado de
modo din&aacute;mico no podr&iacute;a acceder a las bibliotecas ubicadas
en la partici&oacute;n <tt>/usr</tt>.  De cualquier modo esto no
representa un problema importante para OpenBSD, ya que el sistema
pedir&iacute;a que se asignase un int&eacute;rprete en cuanto se
iniciara en modo mono-usuario, y el int&eacute;rprete predeterminado en
el sistema es
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sh&amp;sektion=1">
sh</a>.  Los tres int&eacute;rpretes de &oacute;rdenes est&aacute;ndar
en OpenBSD,
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=csh&amp;sektion=1">
csh</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sh&amp;sektion=1">
sh</a> y
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ksh&amp;sektion=1">
ksh</a>), est&aacute;n enlazados de modo est&aacute;tico, y por lo tanto
se pueden utilizar en el modo mono-usuario.

<p>
Algunas personas dicen que no se debe cambiar nunca el int&eacute;rprete
preasignado del superusuario, aunque no existe ning&uacute;n motivo para
no hacerlo en OpenBSD.  De cualquier modo esto no es importante, ya que
no se debe ingresar en un sistema directamente como usuario <i>root</i>.

<a name="ksh"></a>
<h2>10.18 - &iquest;Qu&eacute; m&aacute;s puedo hacer con
el int&eacute;rprete <i>ksh</i>?</h2>

<p>
En OpenBSD, 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ksh&amp;sektion=1">
ksh</a> es <a href="http://web.cs.mun.ca/~michael/pdksh/">pdksh</a>,
Public Domain Korn Shell, y es el mismo fichero binario que
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sh&amp;sektion=1">
sh</a>.

<p>
Los usuarios que est&eacute;n acostumbrados a <i>bash</i>, muy usado en
los sistemas basados en Linux, es probable que encuentren
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ksh&amp;sektion=1">
ksh</a> muy parecido.  Ksh(1) dispone de la mayor&iacute;a de
funcionalidades que se encuentran en <i>bash</i>, incluida la
terminaci&oacute;n mediante tabulador, la edici&oacute;n de la
l&iacute;na de &oacute;rdenes y de su historial por medio de las flechas
del teclado, y el uso de CTRL-A/CTRL-E para saltar al principio/final de
la l&iacute;nea de &oacute;rdenes.  Si se requieren otras
funcionalidades de <i>bash</i>, se puede instalar <i>bash</i> como un
<a href="faq8.html#Ports">porte compilable</a> o como un
<a href="faq8.html#Packages">paquete precompilado</a>.

<p>
El punto de inserci&oacute;n (<i>prompt</i>) de &oacute;rdenes de
<i>ksh</i> se puede cambiar f&aacute;cilmente por algo que provea
m&aacute;s informaci&oacute;n que el predefinido &quot;$ &quot; mediante
la configuraci&oacute;n de la variable <tt>PS1</tt>.  Por ejemplo, si
a&ntilde;ado la siguiente l&iacute;nea:

<pre>
     export PS1='$PWD $ '
</pre>

al fichero <tt>/etc/profile</tt>, el punto de inserci&oacute;n se
ver&iacute;a como:

<pre>
     /home/nick $
</pre>

<p>
En el fichero
<a href="http://www.openbsd.org/cgi-bin/cvsweb/~checkout~/src/etc/ksh.kshrc?content-type=text/plain"><tt>/etc/ksh.kshrc</tt></a>,
se incluyen muchas funcionalidades y ejemplos, y este fichero se puede
invocar desde el fichero <tt>.profile</tt>.

<p>
<font color="#0000e0">
<a href="index.html">[&Iacute;ndice de documentos]</a>
<a href="faq9.html">[Secci&oacute;n 9 - Consejos para usuarios de Linux]</a>
<a href="faq11.html">[Secci&oacute;n 11 - Mejora del rendimiento]</a>
</font>

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../images/back.gif" border="0" alt="[&iacute;ndice]"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
Originally [OpenBSD: faq10.html,v 1.96 ]<br>
$Translation: faq10.html,v 1.52 2004/01/04 19:59:58 horacio Exp $<br>
$OpenBSD: faq10.html,v 1.50 2004/01/04 22:23:56 horacio Exp $
</small>
</body>
</html>
