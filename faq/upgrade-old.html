<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>OpenBSD Upgrading Mini-FAQ - Old Versions</title>
</head>
<body bgcolor="#FFFFFF" text="#000000" link="#23238E">


<h1>MINI-FAQ: Upgrading OpenBSD - Old Versions</h1>

<blockquote>
<p>
This document contains upgrade minifaq entries for OpenBSD versions
that are no longer actively supported. For information on the current
version, see
the <a href="current.html">Following <i>-current</i></a> page.
</p>
</blockquote>

<h2>Upgrading from 4.5 to 4.6</h2>
<ul>
<li><a href="#20090304">2009/03/04 - new user and group for smtpd</a>
<li><a href="#20090316">2009/03/16 - makemap(8) now run through mailwrapper(8)</a>
<li><a href="#20090324">2009/03/24 - "redistribute default" behaviour change in ospfd(8) and ripd(8)</a>
<li><a href="#20090406">2009/04/06 - incompatible changes to pf(4)</a>
<li><a href="#20090407">2009/04/07 - fragment reassembly on by default</a>
<li><a href="#20090426">2009/04/26 - require-order off by default in pfctl(8)</a>
<li><a href="#20090520">2009/05/20 - new user and group for rpc.rwalld</a>
<li><a href="#20090525">2009/05/25 - update of daily(8), weekly, monthly,
                                     security(8)</a>
<li><a href="#20090531">2009/05/31 - pf enabled by default</a>
<li><a href="#20090602">2009/06/02 - tmux(1) moved from ports to base</a>
<li><a href="#20090603">2009/06/03 - httpd ABI change</a>
<li><a href="#20090626">2009/06/26 - updated lynx(1)</a>
<li><a href="#20090703">2009/07/03 - updated bnx(4) driver</a>
</ul>

<h2>Upgrading from 4.4 to 4.5</h2>
<ul>
<li><a href="#20080907">2008/09/07 - ifconfig(8) syntax change</a>
<li><a href="#20080913">2008/09/13 - xcompmgr(1) moved from ports to xbase</a>
<li><a href="#20080929">2008/09/29 - Perl updated to 5.10.0</a>
<li><a href="#20081003">2008/10/03 - sm-client.st moved</a>
<li><a href="#20081102">2008/11/02 - Xserver updated to 1.5.2</a>
<li><a href="#20081103">2008/11/03 - Perl updated to 5.10.0</a>
<li><a href="#20081105">2008/11/05 - Perl updated to 5.10.0</a>
<li><a href="#20081106">2008/11/06 - Xserver updated to 1.5.2</a>
<li><a href="#20081107">2008/11/07 - Perl updated to 5.10.0</a>
<li><a href="#20081111">2008/11/11 - PIE support added to gcc 3.3.5 & csu</a>
<li><a href="#20081116">2008/11/16 - mixerctl(1) name changes</a>
<li><a href="#20081126">2008/11/26 - btd needs user and group</a>
<li><a href="#20090204">2009/02/04 - Perl updated to 5.10.0</a>
<li><a href="#20090215">2009/02/15 - ifconfig(8) syntax change</a>
<li><a href="#20090218">2009/02/18 - pfsync(4) version number incremented</a>
</ul>

<h2>Upgrading from 4.3 to 4.4</h2>
<ul>
<li><a href="#20080323">2008/03/23 - cwm configuration and command line options changed</a>
<li><a href="#20080328">2008/03/28 - landisk shared libraries enabled</a>
<li><a href="#20080421">2008/04/21 - command line options for rtadvd(8) changed</a>
<li><a href="#20080508">2008/05/08 - file(1) updated, needs new /etc/magic</a>
<li><a href="#20080522">2008/05/22 - spamd(8) sync mode protocol version changed</a>
<li><a href="#20080606">2008/06/06 - httpd(8) manual moved</a>
<li><a href="#20080607">2008/06/07 - support for dhcpd.interfaces removed</a>
<li><a href="#20080609">2008/06/09 - nmeaattach(8) removed</a>
<li><a href="#20080609b">2008/06/09 - New user and group _rtadvd</a>
<li><a href="#20080610">2008/06/10 - per-address counters off by default on pf(4) tables</a>
<li><a href="#20080613">2008/06/13 - mailmode in mg(1) removed</a>
<li><a href="#20080616">2008/06/16 - pfsync(4) version number incremented</a>
<li><a href="#20080627">2008/06/27 - New user and group _ypldap</a>
<li><a href="#20080709">2008/07/09 - yacc(1) updated</a>
<li><a href="#20080710">2008/07/10 - TCP/UDP baddynamic lists, sysctl(8), named(8) and /etc/rc</a>
<li><a href="#20080711-0">2008/07/11 - openchrome(4) video driver</a>
<li><a href="#20080711-1">2008/07/11 - ati(4) video driver updated</a>
<li><a href="#20080719">2008/07/19 - softraid metadata handling rewrite</a>
<li><a href="#20080724">2008/07/24 - changes in libc and libm</a>
</ul>

<h2>Upgrading from 4.2 to 4.3</h2>
<ul>
<li><a href="#20070903">2007/09/03 - _cxa_atexit support and sys/net headers flag day</a>
<li><a href="#20071008">2007/10/08 - new user for ospf6d</a>
<li><a href="#20071020">2007/10/20 - libexpat moved to base</a>
<li><a href="#20071030">2007/10/30 - httpd.conf changes for module configuration
</a>
<li><a href="#20071125">2007/11/25 - config(8) flag day</a>
<li><a href="#20071128">2007/11/28 - AGP updates</a>
<li><a href="#20071207">2007/12/07 - _hoststated user gets renamed to _relayd</a>
<li><a href="#20080131">2008/01/31 - new user for snmpd</a>
<li><a href="#20080205">2008/02/05 - carp(4) flag day</a>
<li><a href="#20080303">2008/03/03 - default xenocara location changed</a>
</ul>


<h2>Upgrading from 4.1 to 4.2</h2>
<ul>
<li><a href="#20070326">2007/03/26 - Xenocara replaces XF4 in <i>-current</i></a>
<li><a href="#20070327">2007/03/27 - updated ahci(4) may cause device
name change for SATA disks</a>
<li><a href="#20070331">2007/03/31 - bgpd filter language change</a>
<li><a href="#20070510">2007/05/10 - packages are using libexpat shipped with xenocara</a>
<li><a href="#20070529">2007/05/29 - [i386] apm(4) takes precedence over acpi(4)</a>
<li><a href="#20070710">2007/07/10 - updated wpi(4) requires new firmware</a>
<li><a href="#20070726">2007/07/26 - changes in the way sudo(8) passes environment</a>
<li><a href="#20070801">2007/08/01 - [alpha] some de(4) NICs will become dc(4)</a>
</ul>


<h2>Upgrading from 4.0 to 4.1</h2>
<ul>
<li><a href="#20060926">2006/09/26 - Switch to gcc3 (alpha)</a>
<li><a href="#20061006">2006/10/06 - 'flags S/SA keep state' implicit in pf.conf(5)</a>
<li><a href="#20061011">2006/10/11 - disklabel not in FreeBSD or NetBSD partitions</a>
<li><a href="#20061012">2006/10/12 - don't boot from NetBSD partitions</a>
<li><a href="#20061029">2006/10/29 - new user for ripd(8)</a>
<li><a href="#20061227">2006/12/27 - ARM (zaurus/armish) Flag day</a>
<li><a href="#20070131">2007/01/31 - new user for hoststated(8)</a>
<li><a href="#20070202">2007/02/02 - new way to enable/disable system
accounting on boot</a>
<li><a href="#20070226">2007/02/26 - spamd: greylisting on by
default; config files moved to /etc/mail</a>
</ul>

<h2>Upgrading from 3.9 to 4.0</h2>
<ul>
<li><a href="#20060327">2006/03/27 - New iwi(4) firmware</a>
<li><a href="#20060518">2006/05/18 - spppcontrol(8) removal</a>
<li><a href="#20060526">2006/05/26 - ipsecadm(8) removal</a>
<li><a href="#20060621">2006/06/21 - dvmrpd(8) added</a>
<li><a href="#20060625">2006/06/25 - wicontrol(8) removal</a>
<li><a href="#20060727">2006/07/27 - new compiler option</a>
</ul>

<h2>Upgrading from 3.8 to 3.9</h2>
<ul>
<li><a href="#20050927">2005/09/27 - build requires new xargs feature</a>
<li><a href="#20051006">2005/10/06 - Changes to MAKEDEV(8) and ksh(1)</a>
<li><a href="#20051116">2005/11/16 - New version of ftp-proxy(8)</a>
<li><a href="#20051216">2005/12/16 - libresolv removed</a>
<li><a href="#20060104">2006/01/04 - mac68k switch to wscons(4)</a>
<li><a href="#20060113">2006/01/13 - types changes</a>
<li><a href="#20060131">2006/01/31 - XKB configuration updates</a>
<li><a href="#20060221">2006/02/21 - ipsec.conf(5) updates</a>
</ul>

<h2>Upgrading from 3.7 to 3.8</h2>
<ul>
<li><a href="#20050329">2005/03/29 - Exception handling flag day (i386)</a>
<li><a href="#20050331">2005/03/31 - mmap(2) flag day (vax)</a>
<li><a href="#20050413">2005/04/13 - New user and group: _hostapd</a>
<li><a href="#20050527">2005/05/27 - pf <i>log-all</i> becomes <i>log (all)</i></a>
<li><a href="#20050601">2005/06/01 - mmap now counted in datasize rlimit</a>
<li><a href="#20050609">2005/06/09 - bgpd configuration change</a>
<li><a href="#20050802">2005/08/02 - New features in crunchgen</a>
<li><a href="#20050806">2005/08/06 - building LC_CTYPE locales</a>
<li><a href="#20050927">2005/09/27 - build requires new xargs feature</a>
<li><a href="#20051006">2005/10/06 - Changes to MAKEDEV(8) and ksh(1)</a>
</ul>


<h2>Upgrading from 3.6 to 3.7</h2>
<a href="#20041027">2004/10/27 - Exception handling flag day (amd64, cats,
    hppa, sgi, sparc64)</a><br>
<a href="#20041029">2004/10/29 - Switch to gcc3 (macppc)</a><br>
<a href="#20041111">2004/11/11 - bgpd behaviour change</a><br>
<a href="#20041124">2004/11/24 - New user and group: _ftp</a><br>
<a href="#20041230">2004/12/30 - Switch to gcc3 (i386)</a><br>
<a href="#20050118">2005/01/18 - New user and group: _ospfd</a><br>
<a href="#20050124">2005/01/24 - pfsync takes syncdev instead of syncif</a><br>
<a href="#20050202">2005/02/02 - POSIX hex and octal constants in (k)sh</a><br>
<p>

    <h2>Upgrading from 3.5 to 3.6</h2>
    <p>
      <a href="#3.5.1">3.5.1: pty device minor numbers changed</a><br>
      <a href="#3.5.2">3.5.2: New user and group _dhcp</a><br>
      <a href="#3.5.3">3.5.3: New user and group _mopd</a><br>
      <a href="#3.5.4">3.5.4: New user and group _tftpd</a><br>
      <a href="#3.5.5">3.5.5: New user and group _rbootd</a><br>
      <a href="#3.5.6">3.5.6: cksum moves to /bin</a><br>
      <a href="#3.5.7">3.5.7: New user and group _afs</a><br>
      <a href="#3.5.8">3.5.8: New user and group _ppp</a><br>
      <a href="#3.5.9">3.5.9: New user and group _ntp</a><br>
      <a href="#3.5.10">3.5.10: Library bump flag day</a><br>
      <a href="#3.5.11">3.5.11: Changes in pf anchors</a><br>
    </p>

    <h2>Upgrading from 3.4 to 3.5</h2>
    <p>
      <a href="#3.4.1">3.4.1: svnd device minor numbers changed</a><br>
      <a href="#3.4.2">3.4.2: New user and group _pflogd</a><br>
      <a href="#3.4.3">3.4.3: Interface cloning</a><br>
      <a href="#3.4.4">3.4.4: New user and group _bgpd</a><br>
      <a href="#3.4.5">3.4.5: New version of join(1)</a><br>
      <a href="#3.4.6">3.4.6: sudo build change</a><br>
      <a href="#3.4.7">3.4.7: New user and group _tcpdump</a><br>
      <a href="#3.4.8">3.4.8: machdep.c change (i386)</a><br>
      <a href="#3.4.9">3.4.9: Update bsd.own.mk</a><br>
      <a href="#3.4.10">3.4.10: Switch to gcc3 (sparc64)</a><br>
    </p>
  
    <h2>Upgrading from 3.3 to 3.4</h2>

    <p>
      <a href="#3.3.1">3.3.1: i386 W^X support </a><br>
      <a href="#3.3.2">3.3.2: mquery syscall change</a><br>
      <a href="#3.3.3">3.3.3: i386 flag day, exe addr/MAXDSIZ change</a><br>
      <a href="#3.3.4">3.3.4: Removal of KerberosIV authentication</a><br>
      <a href="#3.3.5">3.3.5: config change</a><br>
      <a href="#3.3.6">3.3.6: Use __attribute__((bounded)) on certain
                functions</a><br>
      <a href="#3.3.7">3.3.7: New user and group _syslogd</a><br>
      <a href="#3.3.8">3.3.8: New format attribute __kprintf__ in kernel 
		headers</a><br>
    </p>
    
    <h2>Upgrading from 3.2 to 3.3</h2>
    
    <p>
      <a href="#3.2.1">3.2.1: New Perl</a><br>
      <a href="#3.2.2">3.2.2: New groups _radius, _token and _shadow</a><br>
      <a href="#3.2.3">3.2.3: Important compiler changes</a><br>
      <a href="#3.2.4">3.2.4: New user and group _spamd</a><br>
      <a href="#3.2.5">3.2.5: Alias for ipv6-icmp</a><br>
      <a href="#3.2.6">3.2.6: New group _lkm</a><br>
      <a href="#3.2.7">3.2.7: New libpthread</a><br>
      <a href="#3.2.8">3.2.8: Linker changes for ELF architectures </a><br>
      <a href="#3.2.9">3.2.9: Removal of /var/at and crontab changes </a><br>
    </p>

<h2>Upgrading from 3.1</h2>

    <p>
      <a href="#3.1.1">3.1.1: New users/groups</a><br>
      <a href="#3.1.2">3.1.2: New group for crontab(1) and at(1)</a><br>
      <a href="#3.1.3">3.1.3: New Binutils</a><br>
      <a href="#3.1.4">3.1.4: New S/Key configuration</a><br>
      <a href="#3.1.5">3.1.5: New permissions for lp*</a><br>
      <a href="#3.1.6">3.1.6: atrun(8) no longer needed</a><br>
      <a href="#3.1.7">3.1.7: nat.conf merged into pf.conf</a><br>
      <a href="#3.1.8">3.1.8: New fbtab entry needed for xdm</a><br>
      <a href="#3.1.9">3.1.9: Use __attribute__((sentinel)) on certain
                functions</a><br>
    </p>

<h2>Upgrading from 3.0</h2>

    <p>
      <a href="#3.0.1">3.0.1: New keyword supported by mtree(8)</a><br>
      <a href="#3.0.2">3.0.2: Removal of libdl on ELF platforms</a><br>
      <a href="#3.0.3">3.0.3: New regression framework</a><br>
      <a href="#3.0.4">3.0.4: ssh config files moved to /etc/ssh/</a><br>
    </p>

<h2>Upgrading from 2.9</h2>

    <p>
      <a href="#2.9.1">2.9.1: New users/groups - <em>proxy</em>,
        <em>smmsp</em> and <em>popa3d</em></a><br>
      <a href="#2.9.2">2.9.2: New packet filter: <em>pf</em></a><br>
      <a href="#2.9.3">2.9.3: Changes to <em>make</em></a><br>
      <a href="#2.9.4">2.9.4: Build fails because of KerberosV
        errors</a><br>
      <a href="#2.9.5">2.9.5: New <em>sendmail</em> version</a><br>
      <a href="#2.9.6">2.9.6: <tt>/etc/primes</tt> Moved</a>
    </p>

<h2>Upgrading from 2.8</h2>
    
    <p>
      <a href="#2.8.1">2.8.1: New <em>auth</em> group</a><br
      />

      <a href="#2.8.2">2.8.2: New <em>wscons</em> console system</a><br />

      <a href="#2.8.3">2.8.3: Kernel compile fails with undefined
	symbols</a>
    </p>

<h2>Upgrading from 2.7</h2>

<p>
<a href="#2.7.1">
2.7.1: What are the major problems upgrading from 2.7 to 2.8?
</a>
</p>

<h2>Upgrading from 2.6</h2>

<p>
<a href="#2.6.1">
2.6.1: Termcap entries are too long.
</a> <br />

<a href="#2.6.2">
2.6.2: My <em>pn</em> (or <em>mx</em>, <em>al</em>, <em>ax</em>)
device is no longer recognized by the kernel.
</a> <br />

<a href="#2.6.3">
2.6.3: Upgrading gcc 2.95.1 to 2.95.2
</a> <br />

<a href="#2.6.4">
2.6.4: Upgrading Kerberos.
</a> <br />

<a href="#2.6.5">
2.6.5: Upgrading M4.
</a> <br />

<a href="#2.6.6">
2.6.6: Upgrading Sendmail.
</a> <br />

<a href="#2.6.7">
2.6.7: After upgrading, kernels that include 
<em>apm(8)</em> support no longer boot.
</a> <br />

<a href="#2.6.8">
2.6.8: Default group for <em>daemon</em> user changed.

</a>
</p>


<h2>Upgrading from 2.5</h2>

<p>
<a href="#2.5.1">
2.5.1: What are the major problems upgrading from 2.5 to 2.6?
</a> <br />
<a href="#2.5.2">
2.5.2: How do I upgrade <em>gcc</em> to <em>egcs</em>
</a>
</p>

<blockquote>
<p>
<a href="#2.5.2.1">2.5.2.1 - i386 and sparc are no longer #define'ed </a><br />
<a href="#2.5.2.2">2.5.2.2 - Build fails in xlint </a><br />
<a href="#2.5.2.3">2.5.2.3 - Core Dump on uthread_autoinit.c </a><br />
<a href="#2.5.2.4">2.5.2.4 - egcs seems much slower than gcc </a><br />
<a href="#2.5.2.5">2.5.2.5 - egcs generates larger code than gcc </a><br />
<a href="#2.5.2.6">2.5.2.6 - After installing egcs I have very little disk space 
left </a><br />
<a href="#2.5.2.7">2.5.2.7 - My build fails to build libcurses</a><br />
<a href="#2.5.2.8">2.5.2.8 - make obj fails</a>
</p>
</blockquote>

<p>
<a href="#2.5.3">
2.5.3: My <em>make build</em> dies with <em>unimplemented syscall</em> errors.
</a> <br />

<a href="#2.5.4">
2.5.4: Link to the new 2.6 directory.
</a> <br />

<a href="#2.5.5">
2.5.5: After an <strong>(U)</strong>pgrade, extraction of <em>base26.tar.gz</em>
fails with a message.
</a>
</p>

<h2>Upgrading from 2.4</h2>

<p>
<a href="#2.4.1">
2.4.1: Man page changes
</a> <br />

<a href="#2.4.2">
2.4.2: <em>cap_mkdb</em> syntax changed
</a> <br />

<a href="#2.4.3">
2.4.3: Snake
</a>
</p>

<h2>Upgrading from 2.3</h2>

<p>
<a href="#2.3.1">
2.3.1: New User: <em>named</em>
</a> <br />

<a href="#2.3.2">
2.3.2: I tried the build, but it failed when trying to compile
<em>ssleay</em>.
</a> <br />

<a href="#2.3.3">
2.3.3: I tried the build, but it failed when trying to make
something for the PowerPC.
</a>
</p>


&nbsp;<hr width="30%">

<a name="1.0"></a>

<a name="4.5"></a>
<h2>Upgrading from 4.5 to 4.6</h2>
<a name="20090304"></a>
<h3>2009/03/04 - new user and group for smtpd</h3>
The following needs to be run:
<pre>
useradd -u 95 -g =uid -c "SMTP Daemon" -d /var/empty -s /sbin/nologin _smtpd
</pre>
    
<p>
<a name="20090316"></a>
<h3>2009/03/16 - makemap(8) now run through mailwrapper(8)</h3>
Since the connection of smtpd(8) to the build, makemap(8) is run through
mailwrapper(8) to avoid conflict between sendmail and smtpd version of
the binary. For this to work, one has to manually add the following line to
/etc/mailer.conf:
<pre>
makemap         /usr/libexec/sendmail/makemap
</pre>

<a name="20090324"></a>
<h3>2009/03/24 - "redistribute default" behaviour change in ospfd(8) and ripd(8)</h3>
"redistribute default", set in ospfd.conf(5) and ripd.conf(5) configuration
files, require now the presence of a default route in the kernel routing
table otherwise no route will be announced by ospfd(8) and ripd(8).

<p>
<a name="20090406"></a>
<h3>2009/04/06 - incompatible changes to pf(4)</h3>
Packet normalization ("scrubbing") has been integrated with the
main ruleset. This is now specified by adding the "scrub (options)"
parameter to rules. For example:

<pre>
        scrub in all no-df max-mss 1440
</pre>

can be replaced with a rule using the new "match" action:

<pre>
        match in all scrub (no-df max-mss 1440)
</pre>

Since ruleset ordering is enforced by default, this will either
have to be moved to the main ruleset (before "pass quick" rules),
or ruleset order checking must be disabled:

<pre>
        set require-order no
</pre>

Packet reassembly has been simplified. "Crop" and "drop-ovl" have
been removed; only full reassembly remains. It's enabled like this:

<pre>
        set reassemble yes|no [no-df]
</pre>

If "no-df" is given, fragments (and only fragments!) with the df bit
set have it cleared before entering the fragment cache, and thus the
reassembled packet doesn't have df set either. Non-fragmented packets
are unaffected by no-df.

<p>
<a name="20090407"></a>
<h3>2009/04/07 - fragment reassembly on by default in pf(4)</h3>
Since there is little to no reason not to use fragment reassembly,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&sektion=4">pf(4)</a>
was changed so that it is now enabled by default.

<p>
<a name="20090426"></a>
<h3>2009/04/26 - require-order off by default in pfctl(8)</h3>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&sektion=8">pfctl(8)</a>
was changed so that "set require-order" is now disabled by default.
This is advisory only, no configuration change is necessary.

<p>
<a name="20090520"></a>
<h3>2009/05/20 - new user and group for rpc.rwalld</h3>
The following needs to be run:
<pre>
useradd -u 96 -g =uid -c "rpc.rwalld" -d /var/empty -s /sbin/nologin _rwalld
</pre>

<p>
<a name="20090525"></a>
<h3>2009/05/25 - update of daily(8), weekly, monthly, security(8)</h3>
When updating your periodic maintenance scripts to the latest versions,
pay attention to the following changes:
<ul>
<li>The scripts daily, weekly, and monthly now all use the PATH variable
from the root crontab(5), which is /bin:/sbin:/usr/bin:/usr/sbin by default.
The daily(8) PATH no longer includes /usr/local/bin, the weekly(8) PATH no
longer includes /usr/libexec.  In daily.local, weekly.local and monthly.local,
you can still add additional directories to the PATH.
<li>All four scripts now suppress section headers when there is no content
to follow.  When a script produces no output whatsoever, it does not send
mail to root any more.  This may require adjustment of your parser scripts.
<li>The security(8) script now uses some shell functions from daily(8),
so it cannot run stand-alone.  Use "sudo /bin/sh /etc/daily" in case you
need to run it manually.
</ul>

<p>
<a name="20090531"></a>
<h3>2009/05/31 - pf enabled by default</h3>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&sektion=4">pf(4)</a>
is now enabled by default in rc.conf.

<p>
<a name="20090602"></a>
<h3>2009/06/02 - tmux(1) moved from ports to base</h3>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tmux&amp;sektion=1">tmux(1)</a>
has moved from ports to base. If you installed it from ports,
please remove it with pkg_delete.

<p>
<a name="20090603"></a>
<h3>2009/06/03 - httpd ABI change</h3>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=httpd&amp;sektion=8">httpd(8)</a>
was fixed to report correct size of big files, this introduced a change
to its ABI. Because of this some third party modules will have to be rebuilt
or packages updated.

<p>
<a name="20090626"></a>
<h3>2009/06/26 - lynx(1) update</h3>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lynx&amp;sektion=1">lynx(1)</a>
has been updated to 2.8.6rel.5.  Some directives of configuration
file /etc/lynx.cfg have changed therefore you have to update it:
<blockquote><pre>
# cd /tmp
# ftp ftp://mirror/path/to/snapshots/arch/etc46.tgz
# tar xzpf etc46.tgz ./etc/lynx.cfg
# mv etc/lynx.cfg /etc
</pre></blockquote>
Merge your local changes afterwards.

<p>
<a name="20090703"></a>
<h3>2009/07/03 - updated bnx(4) driver</h3>
<!-- this shouldn't be needed in the 4.6 notes -->
The
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bnx&amp;sektion=4">bnx(4)</a>
driver has been updated to support new controllers.
This includes a change in the way firmware handling is done.
Users with bnx must create the new firmware files before booting a new kernel:
<blockquote><pre>
# cd /sys/dev/microcode/bnx
# make obj clean
# make
# make install
</pre></blockquote>
Alternatively, if upgrading from a binary snapshot on a running system (rather
than via the installer), be sure to extract base46.tgz before rebooting onto the
new kernel.



<a name="4.4"></a>
<h2>Upgrading from 4.4 to 4.5</h2>
<a name="20080907"></a>
<h3>2008/09/07 - ifconfig(8) syntax change</h3>
Some <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>
options have changed. To list supported media types, you should now use:
<pre>
    <b>ifconfig &lt;interface&gt; media</b>
</pre>
The option to scan for wireless networks was also changed, but was
<a href="#20090215">revised later</a>.

<p>
<a name="20080913"></a>
<h3>2008/09/13 - xcompmgr(1) moved from ports to xbase</h3>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=xcompmgr&amp;sektion=1">xcompmgr(1)</a>
has moved from ports to xbase. If you installed it from ports,
please remove it with pkg_delete.

<p>
<a name="20080929"></a>
<h3>2008/09/29 - update to Perl 5.10.0</h3>
Due to the changes in the Perl distribution, you will need to manually
remove the old perl obj directory before building.  e.g.
<pre>
    # rm -rf /usr/obj/gnu/usr.bin/perl
</pre>
You can then recreate the obj dir:
<pre>
    # cd /usr/src/gnu/usr.bin/perl
    # make -f Makefile.bsd-wrapper obj
</pre>

Note that because this is a major Perl update, you will need to
rebuild/reinstall any Perl XS modules.  These are modules that
include a shared object that is loaded into the running perl process.
To see a list of XS modules installed via the package subsystem,
run:
<pre>
    # cd /var/db/pkg
    # fgrep .so p5-*/+CONTENTS | sed 's/+CONTENTS.*//' | sort -u
</pre>
Updating to the latest package snapshots with "pkg_add -ui" will take
care of these updates. After you have updated, you need to uninstall
several modules which are now provided as part of Perl in base:

<pre>
    # pkg_delete p5-Archive-Tar p5-Compress-Raw-Zlib p5-Compress-Zlib \
      p5-IO-Compress-Base p5-IO-Compress-Zlib p5-IO-Zlib p5-Module-Build \
      p5-Module-CoreList p5-Module-Load p5-version p5-Digest-SHA
</pre>

<p>
<a name="20081003"></a>
<h3>2008/10/03 - sm-client.st moved</h3>
The (optional) sendmail status file for email submission has moved
from <tt>/var/spool/clientmqueue/sm-client.st</tt> to
<tt>/var/log/sm-client.st</tt> to be consistent with the location
of the <tt>/var/log/sendmail.st</tt> file.

<p>
<a name="20081102"></a>
<h3>2008/11/02 - Xserver updated to 1.5.2</h3>
<tt>RgbPath</tt> is no longer a valid keyword in the <b>Files</b>
section of the <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=xorg.conf">xorg.conf(5)</a>
configuration file. The corresponding entry should be removed from
existing configuration files. This directive was ignored for a couple
of releases already.
<p>
The <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=i810">i810(4)</a>
driver for intel chipset has been completely replaced by the 
<a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=intel">intel(4)</a>
driver. <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=xorg.conf">xorg.conf(5)</a>
configuration files should be updated accordingly.

<p>
<a name="20081103"></a>
<h3>2008/11/03 - update to Perl 5.10.0</h3>
Another module now installed by base Perl was found - please remove it.
<pre>
    # pkg_delete p5-Locale-Maketext-Simple
</pre>

<p>
<a name="20081105"></a>
<h3>2008/11/05 - update to Perl 5.10.0</h3>
There are a couple more modules installed by base Perl to remove.
<pre>
    # pkg_delete p5-Pod-Escapes p5-Pod-Simple
</pre>

<p>
<a name="20081106"></a>
<h3>2008/11/06 - Xserver updated to 1.5.2</h3>
Several xserver modules and drivers have been deprecated. To make sure
that <tt>X -configure</tt> doesn't try to configure the obsolete
modules, it is recommended to prune old contents of
<tt>/usr/X11R6/lib/modules</tt> before installing a new snapshot.

<p>
<a name="20081107"></a>
<h3>2008/11/07 - update to Perl 5.10.0</h3>
More modules moved to base, as above.
<pre>
    # pkg_delete p5-ExtUtils-ParseXS p5-ExtUtils-CBuilder \
      p5-Module-Pluggable p5-Time-Piece
</pre>

<p>
<a name="20081111"></a>
<h3>2008/11/11 - PIE support added to gcc 3.3.5 & csu</h3>
Support for position independent executables (PIE) has been added to
gcc 3.3.5 and csu.  To upgrade follow these steps:
<ul>
<li>Build and install gcc:
<pre>
     # cd /usr/src/gnu/usr.bin/gcc
     # make -f Makefile.bsd-wrapper obj
     # make -f Makefile.bsd-wrapper depend
     # make -f Makefile.bsd-wrapper
     # make -f Makefile.bsd-wrapper install
     # make -f Makefile.bsd-wrapper clean
</pre>
<li><a href="faq5.html#BldUserland">Build and install userland</a>
</ul>

<p>
<a name="20081116"></a>
<h3>2008/11/16 - mixerctl(1) name changes</h3>
The mixer item name <tt>headphones</tt> was shortened to <tt>hp</tt>,
and <tt>speaker</tt> was shortened to <tt>spkr</tt>.
This may require changes to mixerctl.conf(5).

<p>
<a name="20081126"></a>
<h3>2008/11/26 - btd needs new user and group</h3>
The newly added Bluetooth daemon <tt>btd</tt> drops privileges to a new user
and group _btd.
As <i>root</i>, add both the new user and its corresponding group using
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=useradd&amp;sektion=8">useradd(8)</a>:
<blockquote><pre>
# useradd -u94 -g=uid -c"Bluetooth Daemon" -d/var/empty -s/sbin/nologin _btd</b>
</pre></blockquote>

<p>
<a name="20090204"></a>
<h3>2009/02/04 - update to Perl 5.10.0</h3>
Another module moved to base, please remove it.
<pre>
    # pkg_delete p5-Module-Loaded
</pre>

<p>
<a name="20090215"></a>
<h3>2009/02/15 - ifconfig(8) syntax change</h3>
The <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>
option for scanning wireless networks has changed.
You should now use:
<pre>
    <b>ifconfig &lt;interface&gt; scan</b>
</pre>

<p>
<a name="20090218"></a>
<h3>2009/02/18 - pfsync(4) version number incremented</h3>
Due to protocol and implementation changes to the pfsync(4) interface, the
pfsync(4) protocol number has been incremented. Firewalls with differing
versions will be unable to synchronise state tables, and existing connections
will be terminated on failover.



<a name="4.3"></a>
<h2>Upgrading from 4.3 to 4.4</h2>
<p>
<a name="20080323"></a>
<h3>2008/03/23 - cwm configuration and command line options changed</h3>
The cwm(1) window manager got a new config parser, so the configuration
needs to be changed according to
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cwmrc&amp;sektion=5">cwmrc(5)</a>.
The command line option "-f" (font) and "-s" (sticky) were replaced by
config directives.
Remove these options from your .xsession, or your xdm(1) login will
fail!

<p>
<a name="20080328"></a>
<h3>2008/03/28 - landisk shared libraries enabled</h3>
To switch from static build on landisk to shared it is necessary to first
build and install gcc and ld.so before building the rest of the system:
<blockquote><pre>
# <b>cd /usr/src/gnu/usr.bin/gcc</b>
# <b>make -f Makefile.bsd-wrapper obj</b>
# <b>make -f Makefile.bsd-wrapper depend</b>
# <b>make -f Makefile.bsd-wrapper</b>
# <b>make -f Makefile.bsd-wrapper install</b>
# <b>cd /usr/src/share/mk</b>
# <b>make install</b>
# <b>cd /usr/src/libexec/ld.so</b>
# <b>make obj</b>
# <b>make depend</b>
# <b>make</b>
# <b>make install</b>
</pre></blockquote>
Then follow the
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=release&amp;sektion=8">
release(8)</a>:
directions to build the full system.

<p>
<a name="20080421"></a>
<h3>2008/04/21 - command line options for rtadvd(8) changed</h3>
The <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rtadvd">rtadvd(8)</a>
IPv6 router advertisement daemon had the command line options
<tt>"-f"</tt> (foreground), <tt>"-d"</tt> (debug) and <tt>"-D"</tt>
(even more debug).
These options were merged to <tt>-d</tt> which does the same now as the
combination of the three old options and is more OpenBSD-like.

<p>
<a name="20080508"></a>
<h3>2008/05/08 - file(1) updated, needs new /etc/magic</h3>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=file">file(1)</a>
has been updated to a newer version which requires a new
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=magic">magic(5)</a>
file to be installed:
<blockquote><pre>
# <b>cd /tmp</b>
# <b>ftp ftp://mirror/path/to/snapshots/arch/etc43.tgz</b>
# <b>tar xzpf etc43.tgz ./etc/magic</b>
# <b>mv etc/magic /etc</b>
</pre></blockquote>

<p>
<a name="20080522"></a>
<h3>2008/05/22 - spamd(8) sync mode protocol version changed</h3>
The protocol that <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=spamd">spamd(8)</a> 
uses when run in sync mode was changed to fix a number of bugs and the
protocol version was incremented.
Because of this, new versions of spamd can not sync with old versions
(they will skip packets from one another).
Therefore all instances in a spamd sync group must be upgraded at the
same time.

<p>
<a name="20080606"></a>
<h3>2008/06/06 - httpd(8) manual moved</h3>
The Apache manual for
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=httpd">httpd(8)</a> 
has been moved out of <tt>/var/www/htdocs/manual/</tt> to
<tt>/usr/share/doc/html/httpd/</tt>.
It has also been moved from the <i>etcXX</i> set to the <i>miscXX</i>
file set.

<p>
<a name="20080607"></a>
<h3>2008/06/07 - support for dhcpd.interfaces removed</h3>
Support for <tt>/etc/dhcpd.interfaces</tt> has been removed.
The file has been deprecated in favor of the <tt>dhcpd_flags</tt>
setting in <tt>/etc/rc.conf.local</tt>.

<p>
<a name="20080609"></a>
<h3>2008/06/09 - nmeaattach(8) removed</h3>
The
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nmeaattach">nmeaattach(8)</a>
command and the nmeaattach_flags option in /etc/rc.conf have been
removed in -current.
Use
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ldattach">
ldattach(8)</a> instead.
It has a slightly different synopsis than nmeaattach(8): <tt>nmeaattach
cuaU0</tt> becomes <tt>ldattach nmea cuaU0</tt>.

<p>
<a name="20080609b"></a>
<h3>2008/06/09 - New user and group _rtadvd</h3>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rtadvd&amp;sektion=8">rtadvd(8)</a>
daemon now drops privileges after initialization to a new user and group _rtadvd.
As <i>root</i>, add the user and group using
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=useradd&amp;sektion=8">useradd(8)</a>:
<blockquote><pre>
<b>useradd -u92 -g=uid -c"IPv6 Router Advertisement Daemon" -d/var/empty -s/sbin/nologin _rtadvd</b>
</pre></blockquote>

<p>
<a name="20080610"></a>
<h3>2008/06/10 - per-address counters off by default on pf(4) tables</h3>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf">pf(4)</a>
tables now require the <tt>counters</tt> option in order to enable
per-address byte and packet counters, eg:
<br>
<blockquote><tt>
table &lt;webservers&gt; counters { 192.168.33.4, 192.168.33.16/29 }
</tt></blockquote>
See <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf">pf.conf(5)</a>
for details.

<p>
<a name="20080613"></a>
<h3>2008/06/13 - mailmode in mg(1) removed</h3>
Because mail-mode in
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mg">mg(1)</a>
was merely a buggy reimplementation of auto-fill-mode it has been
removed.
If you are using this please change your commands accordingly:<br>
<blockquote><tt>
mail-mode => auto-fill-mode<br>
mail-set-margin => set-fill-column
</tt></blockquote>
Don't forget to change your .mg file as well.

<p>
<a name="20080616"></a>
<h3>2008/06/16 - pfsync(4) version number incremented</h3>
Due to changes in the
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf">pf(4)</a>
state table, the
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfsync">pfsync(4)</a>
protocol version number has been incremented; firewalls with differing
version numbers will be unable to synchronise state tables, and existing
connections will be terminated on failover.

<a name="20080627"></a>
<h3>2008/06/27 - New user and group _ypldap</h3>
An upcoming ypldap(8) daemon needs a new user and group.
As <i>root</i>, add the user and group using
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=useradd&amp;sektion=8">useradd(8)</a>:
<blockquote><pre>
useradd -u93 -g=uid -c"YP to LDAP Daemon" -d/var/empty -s/sbin/nologin _ypldap
</pre></blockquote>

<p>
<a name="20080709"></a>
<h3>2008/07/09 - yacc(1) updated</h3>
A rebuild and install of
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=yacc">yacc(1)</a>
is needed before doing a make build with a clean obj dir to make sure all
yacc generated parsers get regenerated.

<p>
<a name="20080710"></a>
<h3>2008/07/10 - TCP/UDP baddynamic lists, sysctl(8), named(8) and /etc/rc</h3>
The kernel 
<em>net.inet.tcp.baddynamic</em> and <em>net.inet.udp.baddynamic</em> sysctls
and the
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8">sysctl(8)</a>
utility
have been extended to cover the full range of TCP/UDP ports. These lists 
identify source ports to never allocate dynamically so to avoid conflicts with
well-known services. The <tt>/etc/rc</tt>
script now automatically populates these lists from <tt>/etc/services</tt>
at boot time. 
<p>
The new version of
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=named&amp;sektion=8">named(8)</a>
(9.4.2-P1) that has just been imported uses random source ports for queries and
requires this facility for robust operation.
<p>
To avoid any incompatibility, the kernel,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8">sysctl(8)</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=named&amp;sektion=8">named(8)</a> and
<tt>/etc/rc</tt>
should be updated in unison (build and install kernel before "make build").
<p>
<a name="20080711-0"></a>
<h3>2008/07/11 - openchrome(4) driver for Xenocara</h3>
The <a href="http://www.openchrome.org">xf86-video-openchrome</a> driver has been added to Xenocara for via chipsets in place of th
e old, obsolete, version of xf86-video-via that was there before.
<br>
If you're using a VIA chipset with a configuration file, replace
<blockquote><tt>
  Driver "via"
</tt></blockquote>
with
<blockquote><tt>
  Driver "openchrome"
</tt></blockquote>
in <tt>/etc/X11/xorg.conf</tt> to use the new driver. See the
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=openchrome&amp;sektion=4">openchrome(4)</a>
manual page for more configuration options.

<p>
<a name="20080711-1"></a>
<h3>2008/07/11 - ati(4) video driver updated</h3>
The ati(4) driver has been updated. This update of xf86-video-ati brings about some important changes.
<br>
<p>
No more <a href="http://dri.freedesktop.org/wiki/MergedFB">MergedFB</a>:
<br>
<blockquote>
Support for MergedFB mode has been removed in favor of xrandr(1).
</blockquote>

<p>
Quirk option for Macbooks changed:
<blockquote>
Users with Macs or Macbooks that use the following quirk
<blockquote>
<pre>
Option      "iBookHacks" "on"
</pre>
</blockquote>
should read the
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=radeon&amp;sektion=4">radeon(4)</a>
man page, specifically the <tt>"MacModel"</tt> section, if there are problems.
<br>
As of this revision this quirk has been removed.
</blockquote>

<p>
<a name="20080719"></a>
<h3>2008/07/19 - softraid metadata handling rewrite</h3>
The metadata handling in <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=softraid&amp;sektion=4">softraid(4)</a>
has been rewritten from scratch. The new code is not compatible with the old metadata format and hence users must
backup and recreate their softraid volumes. Softraid volumes made prior to this change will not assemble when
booting a kernel with this code.

<p>
<a name="20080724"></a>
<h3>2008/07/24 - changes in libc and libm</h3>
Due to the changes in libc and libm, the following steps have to
be taken before the rest of the system is built.

<p>0. Make sure you have obj.

<blockquote><pre>
# <b>cd /usr/src</b>
# <b>make obj</b>
</pre></blockquote>

<p>1. Install headers, build and install libc.

<blockquote><pre>
# <b>cd /usr/src/include</b>
# <b>make prereq</b>
# <b>make includes</b>
# <b>cd /usr/src/lib/libc</b>
# <b>make cleandir</b>
# <b>make depend</b>
# <b>make</b>
# <b>make install</b>
</pre></blockquote>

<p>2. Build and install libm.

<blockquote><pre>
# <b>cd /usr/src/lib/libm</b>
# <b>make cleandir</b>
# <b>make depend</b>
# <b>make</b>
# <b>make install</b>
</pre></blockquote>

<p>3. Build and install libiberty.

<blockquote><pre>
# <b>cd /usr/src/gnu/lib/libiberty</b>
# <b>make -f Makefile.bsd-wrapper cleandir</b>
# <b>make -f Makefile.bsd-wrapper depend</b>
# <b>make -f Makefile.bsd-wrapper</b>
# <b>make -f Makefile.bsd-wrapper install</b>
</pre></blockquote>

<p>4. Build and install gcc.

<pre>
    <b>If your platform uses gcc 2.95.3:</b>
       # <b>rm -r /usr/obj/gnu/egcs/gcc/*</b>
       # <b>cd /usr/src/gnu/egcs/gcc</b>
        <i>- or -</i>
    <b>If your platform uses gcc 3.3.5:</b>

       # <b>rm -r /usr/obj/gnu/usr.bin/gcc/*</b>
       # <b>cd /usr/src/gnu/usr.bin/gcc</b>

    <b>Common build procedure for v3.3.5 or v2.95.3</b>
    # <b>make -f Makefile.bsd-wrapper clean</b>
    # <b>make -f Makefile.bsd-wrapper obj</b>
    # <b>make -f Makefile.bsd-wrapper depend</b>
    # <b>make -f Makefile.bsd-wrapper</b>
    # <b>make -f Makefile.bsd-wrapper install</b>
</pre>

As usual, starting from a snapshot is CONSIDERABLY easier and highly
recommended.




<a name="4.2"></a>
<h2>Upgrading from 4.2 to 4.3</h2>

<p>
<a name="20070903"></a>
<h3>2007/09/03 - _cxa_atexit support and sys/net headers flag day</h3>
<p>
Support for _cxa_atexit has been added to csu, libc, gcc and libstdc++ as well as changes to sys/net headers require special handling.
To upgrade follow these steps:
<ul>
<li><a href="faq5.html#BldKernel">Build and install a new kernel</a>
<li>Reboot
<li>Build and install csu:
<pre>
     # cd /usr/src/lib/csu
     # make obj && make depend && make && make install && make clean
</pre>
<li>Build and install gcc:
<pre>
     # cd /usr/src/gnu/usr.bin/gcc
     # make -f Makefile.bsd-wrapper obj
     # make -f Makefile.bsd-wrapper depend
     # make -f Makefile.bsd-wrapper
     # make -f Makefile.bsd-wrapper install
     # make -f Makefile.bsd-wrapper clean
</pre>
<li><a href="faq5.html#BldUserland">Build and install userland</a>
</ul>

<a name="20071020"></a>
<h3>2007/10/20 - libexpat moved to base</h3>
<p>
libexpat has been moved from xenocara (xbase) to src (base);
if you are using binary snapshots and packages, things will just
update as they should, once new snapshots are available.
<p>
If you are building software from source, it is vital that
you clean up your system:
<pre>
	# mv /usr/X11R6/lib/libexpat.so.* /usr/lib
	# rm /usr/X11R6/lib/libexpat*
	# rm /usr/X11R6/include/expat*
</pre>

<a name="20071008"></a>
<h3>2007/10/08 - new user for ospf6d</h3>

<i>A ospf6d daemon has been imported</i> in order to use this daemon, a new
user and group are required.

As <i>root</i>, add the following user and group, using
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=useradd&amp;sektion=8">useradd(8)</a>:

<blockquote><pre>
# useradd -u90 -g=uid -c"OSPF6 Daemon" -d/var/empty -s/sbin/nologin _ospf6d
</pre></blockquote>

This step will add both the new user and its corresponding group.
Your environment may allow you to copy/paste those commands.

<a name="20071030"></a>
<h3>2007/10/30 - httpd.conf changes for module configuration</h3>
<p>
Packages for <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=httpd">httpd(8)</a>
modules now install configuration files in <tt>/var/www/conf/modules.samples</tt>
and direct the user to create symbolic links in <tt>/var/www/conf/modules</tt>.
Add the following lines to <tt>/var/www/conf/httpd.conf</tt> after the
<tt>LoadModule</tt> directives (towards the end of section 1):
<pre>
	#
	# Include extra module configuration files
	#
	Include /var/www/conf/modules/*.conf
</pre>

<a name="20071125"></a>
<h3>2007/11/25 - config(8) flag day</h3>
<p>
Extended capabilities require
<a href=http://www.openbsd.org/cgi-bin/man.cgi?query=config>config(8)</a> to
be rebuilt on your system:
<pre>
	# cd /usr/src/usr.sbin/config
	# make clean
	# make obj
	# make depend
	# make
	# make install
</pre>
Then <a href="faq5.html#BldKernel">build and install a new kernel</a> as usual.

<a name="20071128"></a>
<h3>2007/11/28 - new AGP driver</h3>
<p>
The new <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=agp">agp(4)</a>
driver requires an update to the X server after installing
a new kernel if your machine requires AGP support for X or XVideo.
<p>
After installing a new kernel, install new kernel headers, rebuild the X server
(or install a new X snapshot) and make sure <tt>/dev/agp0</tt> is created.
<pre>
	# cd /usr/src/include
	# make includes
	# cd /usr/src/xenocara/xserver
	# make -f Makefile.bsd-wrapper build
	# cd /usr/src/etc/etc.`uname -m`
	# install -c MAKEDEV /dev
	# cd /dev
	# ./MAKEDEV agp0
</pre>

<a name="20071207"></a>
<h3>2007/12/07 - _hoststated user gets renamed to _relayd</h3>
The hoststated(8) daemon has been renamed to
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=relayd&amp;sektion=8">relayd(8)</a>,
so the user and group need to be changed accordingly.

<p>
Use
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>,
edit the password files and your favorite editor to edit the
<tt>/etc/group</tt> file, changing "<tt>_hoststated</tt>" to
"<tt>_relayd</tt>" in both.
Leave the rest of the line alone in each case.

<a name="20080131"></a>
<h3>2008/01/31 - new user for snmpd</h3>

<i>A SNMP daemon has been imported</i> in order to use this daemon, a new
user and group are required.

As <i>root</i>, add the following user and group, using
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=useradd&amp;sektion=8">useradd(8)</a>:

<blockquote><pre>
# useradd -u91 -g=uid -c"SNMP Daemon" -d/var/empty -s/sbin/nologin _snmpd
</pre></blockquote>

This step will add both the new user and its corresponding group.
Your environment may allow you to copy/paste those commands.

<a name="20080205"></a>
<h3>2008/02/05 - carp(4) flag day</h3>
carp(4) has been changed to make it easier to configure.
If you are running carp with ARP or IP balancing your configuration needs to be changed accordingly:
<ul>
<li> Multiple carp(4) interfaces sharing an IP have been replaced with the <tt>carpnodes</tt> option.
<li> The <tt>net.inet.carp.arpbalance</tt> sysctl has been replaced with balancing mode <tt>arp</tt>.
<li> The <tt>LINK0,1,2</tt> flags used for IP balancing have been replaced with the balancing modes <tt>ip</tt>, <tt>ip-stealth</tt> and <tt>ip-unicast</tt>. 
</ul>

<a name="20080303"></a>
<h3>2008/03/03 - default xenocara tree location changed</h3>
The default location of the xenocara source tree is now <tt>/usr/xenocara</tt>.
This is important for people who <a href="faq5.html#Xbld">build X
from source</a>.
Just move your xenocara tree:

<blockquote><pre>
# mv /usr/src/xenocara /usr
</pre></blockquote>

and update it to -current.

<p>

<a name="4.1"></a>

<p>
<h2>Upgrading from 4.1 to 4.2</h2>

<a name="20070326"></a>
<h3>2007/03/26 - Xenocara replaces XF4 in <i>-current</i></h3>
The <a href="http://www.xenocara.org/">xenocara</a> tree is to be used
now instead of the XF4 tree to build X for OpenBSD.
More details can be found on
<a href="http://undeadly.org/cgi?action=article&sid=20070328153001">undeadly.org</a>.
<p>
If you still have <tt>Option "xkbrules" "xfree86"</tt> in your
<tt>/etc/X11/xorg.conf</tt> configuration file, you now need to change
it to <tt>Option "xkbrules" "xorg"</tt>.
<p>
If you really wish to build Xenocara from source (don't, use snapshots!)
<a href="http://www.openbsd.org/cgi-bin/cvsweb.cgi/xenocara/README?rev=HEAD&content-type=text/x-cvsweb-markup"
>xenocara/README</a> and
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=release&amp;sektion=8">release(8)</a>


<a name="20070327"></a>
<h3>2007/03/27 - updated ahci(4) may cause device name change for SATA disks</h3>
<p>
Recent changes to the <tt>ahci(4)</tt> subsystem can cause SATA disks
which were formerly recognized as wd* (e.g <tt>wd0</tt>) devices to turn
up as sd* (e.g <tt>sd0</tt>) devices instead.

<p>
This is a potential problem if you upgrade from an earlier snapshot.
Watch the <tt>dmesg</tt> output at boot.
A drive which turned up earlier as:

<p>
<blockquote><tt>
pciide1 at pci0 dev 31 function 2 "Intel 82801GBM AHCI SATA" rev 0x02: DMA, channel 0 wired to native-PCI, channel 1 wired to native-PCI<br>
pciide1: using apic 2 int 11 (irq 11) for native-PCI interrupt<br>
wd0 at pciide1 channel 0 drive 0: &lt;FUJITSU MHV2080BH&gt;<br>
wd0: 16-sector PIO, LBA48, 76319MB, 156301488 sectors<br>
wd0(pciide1:0:0): using PIO mode 4, Ultra-DMA mode 5
</tt></blockquote>

now instead turns up as

<p>
<blockquote><tt>
ahci0 at pci0 dev 31 function 2 "Intel 82801GBM AHCI SATA" rev 0x02: AHCI 1.1: apic 2 int 16 (irq 11)<br>
scsibus1 at ahci0: 32 targets<br>
sd0 at scsibus1 targ 0 lun 0: &lt;ATA, FUJITSU MHV2080B, 0084&gt; SCSI2 0/direct fixed<br>
sd0: 76319MB, 76319 cyl, 64 head, 32 sec, 512 bytes/sec, 156301488 sec total
</tt></blockquote>

<p>
The recommended workaround is to edit your <tt>/etc/fstab</tt> file,
changing the relevant <tt>/dev/wd</tt> entries to refer to
<tt>/dev/sd</tt> devices and partitions instead.

<p>
The other option is to disable <tt>ahci</tt> using <tt>config(8)</tt> or
<tt>boot -c</tt>.

<p>
Refer to the manpages for
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ahci&amp;sektion=4">ahci(4)</a>
and
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;sektion=8">config(8)</a>
for all the details.

<a name="20070331"></a>
<h3>2007/03/31 - bgpd filter language change</h3>
<p>
bgpd filters using only <tt>prefixlen</tt> as filter parameter need to include
now a address family identifier like <tt>inet</tt> or <tt>inet6</tt>:

<p>
<blockquote><tt>
allow from any inet prefixlen 8 - 24<br>
deny from any inet6 prefixlen &gt; 64<br>
</tt></blockquote>

<a name="20070510"></a>
<h3>2007/05/10 - packages are using libexpat shipped with xenocara</h3>
The libexpat port has been removed.
Packages now use the libexpat which is shipped with xenocara instead.

<p>
Many packages depend on libexpat through other dependencies. For instance,
the many packages which use gettext, also depend on libexpat.

<p>
This means that before you can install new packages or upgrade your system
to a more recent snapshot of packages, you most likely need to have
<tt>xbase42.tgz</tt> installed, even if the packages you are installing
don't have a graphical operation.
Refer to the
<a href="faq4.html#AddFileSet">FAQ</a> about adding
<tt>xbase42.tgz</tt> to an installed system.
If you don't do this and try to install a package that requires libexpat,
pkg_add(1) will give an error message.

<p>
If this is the first time any X file sets are installed on your system,
the shared library cache must be updated after the installation using
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ldconfig&amp;sektion=8"
>ldconfig(8)</a>.
To add all the X libraries to the cache:

<blockquote><pre>
# <b>ldconfig -m /usr/X11R6/lib</b>
</pre></blockquote>

Alternatively, you can just reboot your system, and this will happen
automatically.

<p>
Finally, after upgrading all your packages to a more recent snapshot,
clean up by removing the old expat package from your system:

<blockquote><pre>
# <b>pkg_delete expat</b>
</pre></blockquote>


<a name="20070529"></a>
<h3>2007/05/29 - [i386] apm(4) takes precedence over acpi(4)</h3>
<p>
The device detection on i386 has been modified to make
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=apm&amp;sektion=4&amp;arch=i386">
apm(4)</a> take precedence over
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=acpi&amp;sektion=4">
acpi(4)</a>.
It means that if your hardware has both apm and acpi devices, only apm will
attach.
If for some reason you prefer to use acpi, disable <tt>apm</tt> on your
acpi-enabled kernel using <tt>config(8)</tt> or <tt>boot -c</tt>.


<a name="20070710"></a>
<h3>2007/07/10 - updated wpi(4) requires new firmware</h3>
<p>
Recent changes to the <tt>wpi(4)</tt> driver require that the <tt>wpi-firmware</tt> package be updated to revision 2.14.4.

<p>
As usual, you can find a prepackaged version of the firmware at:<br>
<a href="http://damien.bergamini.free.fr/packages/openbsd/wpi-firmware-2.14.4.tgz">http://damien.bergamini.free.fr/packages/openbsd/wpi-firmware-2.14.4.tgz</a>

<a name="20070726"></a>
<h3>2007/07/10 - changes in the way sudo(8) passes environment</h3>

For
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sudo&amp;sektion=8#SECURITY+NOTES"
>security reasons</a>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sudo&amp;sektion=8">sudo(8)</a>
will now reset the environment to a small default set
with only certain variables preserved from the previous environment.

<p>
In order for many things to continue to work as expected, add the following
line to your <tt>/etc/sudoers</tt> file using
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=visudo&amp;sektion=8">visudo(8)</a>:
<blockquote><pre>
# Defaults specification
Defaults env_keep +="DESTDIR FETCH_CMD FLAVOR FTPMODE MAKE MULTI_PACKAGES OKAY_FILES PKG_DBDIR PKG_DESTDIR PKG_CACHE PKG_PATH PKG_TMPDIR PORTSDIR RELEASEDIR SUBPACKAGE"
</pre></blockquote>

<a name="20070801"></a>
<h3>2007/08/01 - [alpha] some de(4) NICs will become dc(4)</h3>
On the <a href="../alpha.html">alpha</a> platform, some NICs which had
been supported by the
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=de&amp;sektion=4">de(4)</a>
driver will now be supported by
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dc&amp;sektion=4">dc(4)</a>.

<p>
IF your NIC is one of these, you will need to alter at least your <tt>/etc/hostname.deX</tt>
(hint: hard link) and your pf.conf files as appropriate.

<p>
Again, this is <i>only</i> on the Alpha platform.

<a name="4.0"></a>

<h2>Upgrading from 4.0 to 4.1</h2>
<a name="20060926"></a>
<h3>2006/09/26 - Switch to gcc3 (alpha)</h3>
OpenBSD/alpha has converted to gcc3.
To upgrade,
<pre>
    # rm -rf /usr/include/g++
    # cp /usr/src/share/mk/bsd.own.mk /usr/share/mk/
</pre>
Now, <a href="faq5.html#NewCompiler">build gcc3</a>, (using the gcc3
directory) then build new ld.so:
<pre>
    cd /usr/src/libexec/ld.so
    make clean
    make obj
    make depend
    make
    make install
</pre>

Now, build the kernel and system as <a href="faq5.html#Bld">usual</a>.
<p>

<a name="20061006"></a>
<h3>2006/10/06 - 'flags S/SA keep state' implicit in pf.conf(5)</h3>
<i>flags S/SA keep state</i> is now the default for pass rules in
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5">pf.conf(5)</a>,
and new <i>no state</i> and <i>flags any</i> options have been added to
override these defaults.  Current rulesets will continue to load, but the
behaviour may be slightly changed as these defaults are more restrictive.
Rulesets with stateless filtering (<i>no state</i>) or a requirement to
create states on intermediate packets (<i>flags any</i>) should be updated
to explicitly request the desired behaviour.
<p>
In particular care should be taken with the
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=enc&amp;sektion=4">enc0</a>
interface, as floating states are a potential problem for filtering IPsec
traffic: states need to be interface bound, to avoid permitting unencrypted
traffic should
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=isakmpd&amp;sektion=8">isakmpd(8)</a>
exit. Therefore all rules on the enc0 interface should explicitly set
<i>keep state (if-bound)</i>.
<p>

<a name="20061011"></a>
<h3>2006/10/11 - disklabel not in FreeBSD or NetBSD partitions</h3>
<i>FreeBSD and NetBSD DOS MBR partitions</i> are no longer used to store
disklabels, and are no longer searched for a disklabel. As a result disks with
only FreeBSD or NetBSD DOS MBR partitions will no longer have an 'a' partition
created in the spoofed disklabel. The disklabel on such disks will be stored
and loaded from sector 1, and this could find an old accidental disklabel. Use
fdisk(8) to change the partition type to OpenBSD ('A6') to use the existing
disklabel.
<p>

<a name="20061012"></a>
<h3>2006/10/12 - don't boot from NetBSD partitions</h3>
<i>amd64, i386, macppc, and mvmeppc</i> no longer try to boot from the first
NetBSD partition when no OpenBSD partition is found.
<p>

<a name="20061029"></a>
<h3>2006/10/29 - new user for ripd(8)</h3>
<i>A new RIP daemon has been imported</i> in order to use this daemon, a new
user and group are required.

As <i>root</i>, add the following user and group, using
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=useradd&amp;sektion=8">useradd(8)</a>:

<blockquote><pre>
# useradd -u88 -g=uid -c"RIP Daemon" -d/var/empty -s/sbin/nologin _ripd
</pre></blockquote>

This step will add both the new user and its corresponding group.
Your environment may allow you to copy/paste those commands.
<p>

<a name="20061227"></a>
<h3>2006/12/27 - ARM (zaurus/armish) Flag day</h3>
<i>The syscall mechanism for arm has changed</i> which will cause binaries
and shared libraries from before Nov 7 to no longer work. It is necessary to
update from snapshot to get past this ABI change.
<p>

<a name="20070131"></a>
<h3>2007/01/31 - new user for hoststated(8)</h3>
<i>A HostState daemon has been imported</i> in order to use this daemon, a new
user and group are required.

As <i>root</i>, add the following user and group, using
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=useradd&amp;sektion=8">useradd(8)</a>:

<blockquote><pre>
# useradd -u89 -g=uid -c"HostState Daemon" -d/var/empty -s/sbin/nologin _hoststated
</pre></blockquote>

This step will add both the new user and its corresponding group.
Your environment may allow you to copy/paste those commands.
<p>

<a name="20070202"></a>
<h3>2007/02/02 - new way to enable/disable system accounting on boot</h3>
In order to enable accounting on boot you need to set the new rc.conf
variable "accounting=YES". The presence of the /var/account/acct file
does not make it start automatically anymore.
<p>


<a name="20070226"></a>
<h3>2007/02/26 - spamd: greylisting on by default; config files moved
to /etc/mail</h3>
<p>
Greylisting is now the default runtime mode for spamd(8); the
<tt>-g</tt> flag is obsolete.
To disable greylisting and run in blacklist-only mode, use the
<tt>-b</tt> flag.
In order to control which address spamd binds to, use the new
<tt>-l</tt> flag.

<p>
spamd-setup(8) can also be told to run in blacklist-only mode by passing
the new <tt>-b</tt> flag.

<p>
The spamd.conf(5) file has moved from <tt>/etc</tt> to <tt>/etc/mail</tt>.

<p>
Refer to the manpages for
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=spamd&amp;sektion=8">spamd(8)</a>
and
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=spamd-setup&amp;sektion=8">spamd-setup(8)</a>
for all the details.




<a name="3.9"></a>
<h2>Upgrading from 3.9 to 4.0</h2>

<a name="20060327"></a>
<h3>2006/03/27 - New iwi(4) firmware</h3>
iwi(4) now requires firmware version 3.0 to run.  Due to license problems
the firmware is not currently distributed with OpenBSD.
The firmware can be installed via the pkg tools with the
package at
<a href="http://damien.bergamini.free.fr/iwifw/OpenBSD/iwi-firmware-3.0.tgz">http://damien.bergamini.free.fr/iwifw/OpenBSD/iwi-firmware-3.0.tgz</a>.
<p>


<a name="20060518"></a>
<h3>2006/05/18 - spppcontrol(8) removal</h3>
In-kernel PPP configuration is now fully supported by
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>.
The obsolete
<em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=spppcontrol&amp;sektion=8&amp;manpath=OpenBSD+3.9">spppcontrol(8)</a></em>
utility has been removed from the tree.
See the manual pages
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sppp&amp;sektion=4">sppp(4)</a>
and
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppoe&amp;sektion=4">pppoe(4)</a>
for configuration examples.
<p>
Previously, the /etc/hostname.pppoe0 file looked like this:
<pre>
pppoedev ne0
!/sbin/ifconfig ne0 up
!/usr/sbin/spppcontrol \$if myauthproto=pap myauthname=testcaller \
        myauthkey=donttell
!/sbin/ifconfig \$if inet 0.0.0.0 0.0.0.1 netmask 0xffffffff
!/sbin/route add default 0.0.0.1
up
</pre>
This should be updated according to the following example:
<pre>
inet 0.0.0.0 255.255.255.255 0.0.0.1 pppoedev ne0 \
	authproto pap authname testcaller authkey donttell up
!/sbin/route add default 0.0.0.1
</pre>
And the physical interface must be marked UP:
<pre>
# echo "up" > /etc/hostname.ne0
</pre>
<p>

<a name="20060526"></a>
<h3>2006/05/26 - ipsecadm(8) removal</h3>
IPsec configuration is now fully supported by
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipsecctl&amp;sektion=8">ipsecctl(8)</a>.
The obsolete
<em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipsecadm&amp;sektion=8&amp;manpath=OpenBSD+3.9">ipsecadm(8)</a></em>
utility has been removed from the tree.
See the
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec.conf&amp;sektion=5">ipsec.conf(5)</a>
manual page for configuration examples.
<p>

<a name="20060621"></a>
<h3>2006/06/21 - dvmrpd(8) added</h3>
A mrouted(8) replacement has been started and imported, in order to use
(note: not very useful yet) this new daemon the user _dvmrpd must be added:<p>
<pre>
# useradd -u87 -g=uid -c"DVMRP Daemon" -d/var/empty -s/sbin/nologin _dvmrpd
</pre>

<a name="20060625"></a>
<h3>2006/06/25 - wicontrol(8) removal</h3>
Wireless configuration for
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=wi&amp;sektion=4">wi(4)</a>
is now fully supported by
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>.
The obsolete
<em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=wicontrol&amp;sektion=8&amp;manpath=OpenBSD+3.9">wicontrol(8)</a></em>
utility has been removed from the tree.
<p>

<a name="20060727"></a>
<h3>2006/07/27 - new compiler option</h3>
The kernel on all platforms is now built with the recently introduced
<i>-Wstack-larger-than</i> compiler option. Before building a kernel, the
compiler needs to be built and installed.

<p>
Follow the instructions in
<a href="faq5.html#NewCompiler">FAQ 5 - How do I bootstrap a newer version of
the compiler</a> for details.
<p>

<a name="3.8"></a>
<h2>Upgrading from 3.8 to 3.9</h2>
<p>
<a name="20050927"></a>
<h3>2005/09/27 - build requires new xargs feature</h3>

Build and install xargs(1).
<pre>
     # cd /usr/src/usr.bin/xargs && make obj && make && make install
</pre>
Then run make build.

<p>
<a name="20051006"></a>
<h3>2005/10/06 - Changes to MAKEDEV(8)</h3>
    
Changes were done to MAKEDEV to greatly increase its speed.
These changes depend on changes made to ksh earlier.
Therefore install media built prior to this date can not be used.
<br>

<p>
<a name="20051116"></a>
<h3>2005/11/16 - New version of ftp-proxy(8)</h3>
    
ftp-proxy was replaced by what was previously called pftpx.
The new ftp-proxy runs stand-alone and not from inetd.conf as it used to.
<p>
Upgrade instructions are as follows:
<p>
Stop the old ftp-proxy by installing a new /etc/inetd.conf or just disable
its entry in /etc/inetd.conf manually.

<pre>
cp /usr/src/etc/inetd.conf /etc/inetd.conf
</pre>

Then send inetd a HUP signal via kill:
<p>
<pre>
kill -HUP `cat /var/run/inetd.pid`
</pre>

Start the new ftp-proxy by installing new
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&amp;sektion=8"><i>/etc/rc</i></a>
and
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&amp;sektion=8"><i>/etc/rc.conf</i></a>
and setting ftpproxy_flags="" in /etc/rc.conf.local.

<pre>
cp /usr/src/etc/{rc,rc.conf} /etc
echo 'ftpproxy_flags=""' >> /etc/rc.conf.local
</pre>

Alternatively, it can be started by simply calling
/usr/sbin/ftp-proxy from /etc/rc.local
<p>

The new proxy uses <a href="pf/anchors.html"><i>anchors</i></a> to allow
data connections which means that
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5"><i>/etc/pf.conf</i></a>
must be adapted.  In the NAT section you need:
<p>

<pre>
nat-anchor "ftp-proxy/*"
rdr-anchor "ftp-proxy/*"
</pre>

They are mandatory, even if you don't use NAT otherwise.
The following rule, that is probably already there for the old ftp-proxy,
must stay:
<pre>
rdr pass on $int_if proto tcp from $lan to any port 21 -> \
    127.0.0.1 port 8021
</pre>

In the rule section this is needed:

<pre>
anchor "ftp-proxy/*"
</pre>

Rules that allow the proxy to make FTP control connections
(destination port 21/tcp) must stay.
Rules that allow FTP data connections are no longer needed.
Those rules may contain "user proxy" or "to port &gt; 49151".

Care has been taken to keep the commandline switches similar, but some
may differ.
See the
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8">ftp-proxy</a>
man page.
<p>

One case warrants special mention: if you have old clients that rely on
active mode data connections which use 20/tcp as a source port, you need the
'-r' switch.  (for this you had to run the old proxy with "-u root").
<p>
Run ftp-proxy with "-d -D7" if you run into trouble and want to diagnose
what's happening.

<p>
<a name="20051216"></a>
<h3>2005/12/16 - libresolv removed</h3>

You need to remove libresolv from your machine as it is no
longer installed.
<pre>
     # rm /usr/lib/libresolv*
</pre>

<p>
<a name="20060104"></a>
<h3>2006/01/04 - mac68k switch to wscons(4)</h3>
Before rebooting the new kernel, system files have to be updated for
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=wscons&amp;sektion=4">wscons(4)</a>.

<pre>
     # cp /usr/src/etc/etc.mac68k/MAKEDEV /dev
     # cd /dev &amp;&amp; sh ./MAKEDEV wscons
</pre>

<p>
In <tt>/etc/ttys</tt>, change the getty on <em>ttye0</em> to <em>ttyC0</em>
and reboot into the new kernel.
</p>

<p>
<a name="20060113"></a>
<h3>2006/01/13 - types changes</h3>
Before doing a "make build", the compiler needs to be built and installed.
Otherwise, you will be unable to build libstdc++.

<p>
Follow the instructions in <a href="faq5.html#NewCompiler">FAQ 5 -
How do I bootstrap a newer version of the compiler</a> for details.

<a name="20060131"></a>
<h3>2006/01/31 - xkb configuration updates</h3>
After the X.Org 6.9 merge, XKB configuration has changed,
requiring changes to /etc/X11/xorg.conf. The most noticeable changes are:
<ul>
<li><b>us_intl</b> layout replaced by the <b>alt-intl</b> variant
of the <b>us</b> layout.
Update your configuration file to use:
<pre>
      Option "XkbLayout" "us"
      Option "XkbVariant" "alt-intl"
</pre>
<li><b>de_CH</b> and <b>fr_CH</b> layouts have been replaced by the
<b>ch</b> layout with <b>de</b> and <b>fr</b> variants:
<pre>
      Option "XkbLayout" "ch"
      Option "XkbVariant" "de"
</pre>
</ul>
<p>

<a name="20060221"></a>
<h3>2006/02/21 - ipsec.conf(5) updates</h3>
When <b>ike rules</b> do not include main mode parameters,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipsecctl&amp;sektion=8">ipsecctl(8)</a>
will now choose AES instead of 3DES for main mode encryption.
To interoperate with peers using stable, add these values to their
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec.conf&amp;sektion=5">ipsec.conf(5)</a>
files to switch to the new defaults:
<pre>
        main auth hmac-sha1 enc aes
</pre>
<p>


<a name="3.7"></a>
<h2>Upgrading from 3.7 to 3.8</h2>


<p>
<a name="20050329"></a>
<h3>2005/03/29 - Exception handling flag day (i386)</h3>

OpenBSD/i386 has converted to DWARF-based exception handling.  To
upgrade, first <a href="faq5.html#NewCompiler">build and install
gcc3</a> and then build and install a new version of libstdc++:
<pre>
     # cd /usr/src/gnu/lib/libstdc++
     # make -f Makefile.bsd-wrapper cleandir
     # make -f Makefile.bsd-wrapper obj
     # make -f Makefile.bsd-wrapper
     # make -f Makefile.bsd-wrapper install
</pre>

<p>


<a name="20050331"></a>
<h3>2005/03/31 - mmap(2) flag day (vax)</h3>

Virtual memory limits have changed on OpenBSD/vax. The statical-linked nature
of OpenBSD/vax requires special handling of this. The following steps must be
followed to build a usable system.
<ul>
<li>Update your source tree
<li>Build and install a new kernel, do not reboot yet
<li>Build and install a new libc:
<pre>
     # cd /usr/src/lib/libc && make depend && make && env NOMAN=1 make install
</pre>
<li><a href="faq5.html#NewCompiler">Build and install gcc2</a>
<li>Build and install a new make:
<pre>
     # cd /usr/src/usr.bin/make && make depend && make && make install
</pre>
<li>Build and install new binutils:
<pre>
    # cd /usr/src/gnu/usr.bin/binutils
    # make -f Makefile.bsd-wrapper depend
    # make -f Makefile.bsd-wrapper
    # make -f Makefile.bsd-wrapper install
</pre>
<li>Reboot.
<li>Build and install the system as usual:
<pre>
    # cd /usr/src && make build
</pre>
</ul>

<p>
<a name="20050413"></a>
<h3>2005/04/13 - New user and group: _hostapd</h3> 
The new, privilege separated HostAP daemon needs
a new user and group "_hostapd".
Add the user and group by running

<pre>
    useradd -u86 -g=uid -c"HostAP Daemon" -d/var/empty -s/sbin/nologin _hostapd
</pre>
as root.


<p>
<a name="20050527"></a>
<h3>2005/05/27 - pf <i>log-all</i> becomes <i>log (all)</i></h3>

The pf.conf(5) keyword <i>log-all</i> has been removed. The new syntax
for this feature is now <i>log (all)</i>.


<p>
<a name="20050601"></a>
<h3>2005/06/01 - mmap now counted in datasize rlimit</h3>

Anonymous memory allocated via mmap(2) is now counted towards a
process's datasize resource limit.  As a result, processes will
appear to be taking up more memory than they used to and the old
resource limits may be too small.  To fix the resource limit problem,
update <tt>/etc/login.conf</tt>:
<pre>
     # cd /usr/src/etc
     # cp login.conf /etc
</pre>
then log out and log back in again.


<p>
<a name="20050609"></a>
<h3>2005/06/09 - bgpd configuration change</h3>

The bgpd.conf(5) keywords <i>network connected [set ...]</i> and
<i>network static [set ...]</i> are deprecated. They should be replaced
with <i>network inet connected [set ...]</i> respectively <i>network
inet static [set ...]</i>.


<p>
<a name="20050802"></a>
<h3>2005/08/02 - New features in crunchgen</h3>

crunchgen(1) has been updated to handle supplementary library directories.
Be sure to rebuild and reinstall crunchgen before you attempt to make
a release or rebuild any install media.


<p>
<a name="20050806"></a>
<h3>2005/08/06 - building LC_CTYPE locales</h3>

Build and install mklocale(1).
<pre>
     # cd /usr/src/usr.bin/mklocale && make obj && make depend && make && make install
</pre>
Then run make build.



<a name="3.6"></a>
<h2>Upgrading from 3.6 to 3.7</h2>

<a name="20041029"></a>
<h3>2004/10/29 - Switch to gcc3 (macppc)</h3>
OpenBSD/macppc has converted to gcc3.
To upgrade,
<pre>
    # rm -rf /usr/include/g++
</pre>

Now, <a href="faq5.html#NewCompiler">build gcc3</a>, (using the gcc3
directory) then build the kernel and system as
<a href="faq5.html#Bld">usual</a>.

<a name="20041111"></a>
<h3>2004/11/11 - bgpd behaviour change</h3>
The new <i>rde route-age [evaluate|ignore]</i> changed behaviour of bgpd.
Until now <i>evaluate</i> was the implicit default but now the default
is <i>ignore</i>.
Route age evaluation is not specified in RFC 1771 and results in non
deterministic decisions in preference for more stable links.


<a name="20041124"></a>
<h3>2004/11/24 - New user and group: _ftp</h3> 
The FTP daemon is being reworked to use privilege separation.
Thus a new user and group "_ftp" are required.
Add the user and group by running

<pre>
    useradd -u84 -g=uid -c"FTP Daemon" -d/var/empty -s/sbin/nologin _ftp
</pre>
as root.


<a name="20041230"></a>
<h3>2004/12/30 - Switch to gcc3 (i386)</h3>
OpenBSD/i386 has converted to gcc3.
To upgrade,

<pre>
    # rm -rf /usr/include/g++
</pre>

Now, <a href="faq5.html#NewCompiler">build gcc3</a>, (using the gcc3
directory) then build the kernel and system as
<a href="faq5.html#Bld">usual</a>.

<p>

<a name="20050118"></a>
<h3>2005/01/18 - New user and group: _ospfd</h3> 
The upcoming ospf daemon needs its own user and group _ospfd.
Add them by running

<pre>
    useradd -u85 -g=uid -c"OSPF Daemon" -d/var/empty -s/sbin/nologin _ospfd
</pre>
as root.


<a name="20050124"></a>
<h3>2005/01/24 - pfsync takes syncdev instead of syncif</h3>
When configuring the
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfsync&amp;sektion=4">pfsync</a>
device, use 'syncdev' instead of the deprecated keyword 'syncif'. 


<a name="20050202"></a>
<h3>2005/02/02 - POSIX hex and octal constants in (k)sh</h3>
Both
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sh&amp;sektion=1">sh(1)</a>
and
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ksh&amp;sektion=1">ksh(1)</a>
now interpret c-like hex (0x...) and octal (0...) constants in arithmetic
expressions.
As a consequence, the MAKEDEV script needs to be updated:
<pre>
     # cp /usr/src/etc/etc.`machine`/MAKEDEV /dev
</pre>

<p>


<p>
    <a name="3.5"></a>
    <h2>
      Upgrading from 3.5 to 3.6
    </h2>

    <a name="3.5.1"></a>
    <h3>
      3.5.1: pty device minor numbers changed (2004/04/11)
    </h3>
    <p>
      The device minor numbers of
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pty&amp;sektion=4">pty</a>
      devices have changed to increase the maximum number of pseudo-terminals
      from 256 to 992, so you will need to run the updated
      <tt>/dev/MAKEDEV</tt> before booting the new kernel:
        <ul>
          <li>Update your source code tree
          <li>Build and install a new kernel
          <li>Build the rest of the system (<em>make build</em>)
          <li>Copy the new MAKEDEV script to the <tt>/dev</tt> directory and 
              create the new pty devices.
<pre>
     # cp /usr/src/etc/etc.`machine`/MAKEDEV /dev
     # cd /dev && ./MAKEDEV pty0
</pre>
          <li>Boot the new kernel
	  <li>Remove the old pty devices no longer in use:
<pre>
     # cd /dev && rm -f [pt]ty[rq]*
</pre>
	  <li> Or, for the vax platform:
<pre>
     # cd /dev && rm -f [pt]tyr*
</pre>
        </ul>

    <a name="3.5.2"></a>
    <h3>
      3.5.2: New user and group _dhcp (2004/04/12)
    </h3>
    <p>The various dhcp related daemons are being reworked to drop privileges
      or to use privilege separation. Thus a new user and group _dhcp are
      required.
      Add the group by running
<pre>
  # groupadd -g 77 _dhcp
</pre>
      as root, and add the user entry using
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
<pre>
  _dhcp:*:77:77::0:0:DHCP programs:/var/empty:/sbin/nologin
</pre>
    <p>

    <a name="3.5.3"></a>
    <h3>
      3.5.3: New user and group _mopd (2004/04/14)
    </h3>
    <p>The <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mopd&amp;sektion=8"
      >mopd(8)</a> daemon now drops privileges after initialization,
      and requires a new user and group _mopd.
      Add the group by running
<pre>
  # groupadd -g 78 _mopd
</pre>
      as root, and add the user entry using
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
<pre>
  _mopd:*:78:78::0:0:MOP Daemon:/var/empty:/sbin/nologin
</pre>
    <p>

    <a name="3.5.4"></a>
    <h3>
      3.5.4: New user and group _tftpd (2004/04/17)
    </h3>
    <p>The <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftpd&amp;sektion=8"
      >tftpd(8)</a> daemon now drops privileges after initialization to
      a new user and group _tftpd instead of nobody.
      Add the group by running
<pre>
  # groupadd -g 79 _tftpd
</pre>
      as root, and add the user entry using
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
<pre>
  _tftpd:*:79:79::0:0:TFTP Daemon:/var/empty:/sbin/nologin
</pre>
    <p>

    <a name="3.5.5"></a>
    <h3>
      3.5.5: New user and group _rbootd (2004/04/30)
    </h3>
    <p>The <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rbootd&amp;sektion=8"
      >rbootd(8)</a> daemon now drops privileges after initialization to
      a new user and group _rbootd.
      Add the group by running
<pre>
  # groupadd -g 80 _rbootd
</pre>
      as root, and add the user entry using
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
<pre>
  _rbootd:*:80:80::0:0:rbootd Daemon:/var/empty:/sbin/nologin
</pre>
    <p>

    <a name="3.5.6"></a>
    <h3>
      3.5.6: cksum moves (2004/05/02)
    </h3>
    <p>The <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cksum&amp;sektion=1">cksum(1)</a> utility has moved from <tt>/usr/bin</tt> to <tt>/bin</tt>.
      After you have completed a <em>make build</em>, run the following as
      root:
<pre>
  # rm -f /usr/bin/cksum /usr/bin/sum
</pre>
    <p>

    <a name="3.5.7"></a>
    <h3>
      3.5.7: New user and group _afs (2004/05/06)
    </h3>
    <p>The <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=afsd&amp;sektion=8"
      >afsd(8)</a> daemon is about to be privilege separated. A new user
      and group _afs are required for this. Add the group by running
<pre>
  # groupadd -g 81 _afs
</pre>
      as root, and add the user entry using
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
<pre>
  _afs:*:81:81::0:0:afs Daemon:/var/empty:/sbin/nologin
</pre>
    <p>You need to change owner of the cache by running
<pre>
  # chown -R _afs:_afs /var/spool/afs
</pre>
    <p>

    <a name="3.5.8"></a>
    <h3>
      3.5.8: New user and group _ppp (2004/05/06)
    </h3>
    <p>The <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppoe&amp;sektion=8"
      >pppoe(8)</a> program now drops privileges to a new user and group _ppp.
      Add the group by running
<pre>
  # groupadd -g 82 _ppp
</pre>
      as root, and add the user entry using
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
<pre>
  _ppp:*:82:82::0:0:PPP utilities:/var/empty:/sbin/nologin
</pre>
    <p>

    <a name="3.5.9"></a>
    <h3>
      3.5.9: New user and group _ntp (2004/05/30)
    </h3>
    <p>The upcoming
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ntpd&amp;sektion=8">ntpd(8)</a>
      program needs a new user and group _ntp.
      Add the group by running
<pre>
  # groupadd -g 83 _ntp
</pre>
      as root, and add the user entry using
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
<pre>
  _ntp:*:83:83::0:0:NTP Daemon:/var/empty:/sbin/nologin
</pre>
    <p>

    <a name="3.5.10"></a>
    <h3>
      3.5.10: Library bump flag day (2004/07/13)
    </h3>
    <p>Library and system interface changes have been made that require
	a bump of the major version number of every library.   The following
	steps must be followed to build a usable system.
	 <ul>
          <li>update your source code tree
          <li>Build a new kernel
	  <li>Install the new kernel and reboot
	  <li>install new header files:
<pre>
     # cd /usr/src && make obj && make cleandir && make includes
</pre>
	  <li>build and install a new version of libc
<pre>
     # cd /usr/src/lib/libc && make depend && make && env NOMAN=1 make install
</pre>
	  <li>Build and install the system as usual
<pre>
     # cd /usr/src && make build
</pre>
	 </ul>
    <p>

    <a name="3.5.11"></a>
    <h3>
      3.5.11: Changes in pf anchors (2004/08/07)
    </h3>
    <p>Users of authpf should change their anchor rule in the main
	ruleset from
<pre>
     anchor authpf
</pre>
	to
<pre>
     anchor "authpf/*"
</pre>
    <p>

    <a name="3.4"></a>
    <h2>
      Upgrading from 3.4 to 3.5
    </h2>

    <a name="3.4.1"></a>
    <h3>
      3.4.1: svnd device minor numbers changed (2003/10/10)
    </h3>
    <p>
      The device minor numbers of 
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=svnd&amp;sektion=4">svnd</a>
      devices have changed, so you will need to run the updated
      <tt>/dev/MAKEDEV</tt> after installing the new kernel:
        <ul>
          <li>update your source code tree
          <li>Build a new kernel
          <li>copy the new MAKEDEV script to the dev directory, remove
              the existing svnd(4) and rsvnd devices, and create new ones:
<pre>
     # cp /usr/src/etc/etc.`machine`/MAKEDEV /dev
     # cd /dev
     # rm svnd* rsvnd*
     # ./MAKEDEV vnd
</pre>
          <li>Continue with build and release process
        </ul>

      This affects anyone using svnd devices, which includes those who
      <tt>make release</tt>.
    <p>

    <a name="3.4.2"></a>
    <h3>
      3.4.2: New user and group _pflogd (2003/10/23)
    </h3>
    <p>The <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8"
      >pflogd(8)</a> daemon now runs in privilege separated mode, and requires a new
      user and group _pflogd.
      Add the group by running
<pre>
  # groupadd -g 74 _pflogd
</pre>
      as root, and add the user entry using
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
<pre>
  _pflogd:*:74:74::0:0:pflogd privsep:/var/empty:/sbin/nologin
</pre>
    <p>

    <a name="3.4.3"></a>
    <h3>
      3.4.3: Interface cloning (2003/12/07)
    </h3>
    <p>Several pseudo network drivers (like
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gif&amp;sektion=4">gif(4)</a>,
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lo&amp;sektion=4">lo(4)</a>, and
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tun&amp;sektion=4">tun(4)</a>)
      have been moved to support cloning, i.e. creation and destruction of
      devices on the fly. If you depend on these interfaces, you have to
      install an updated
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>
      and
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=netstart&amp;sektion=8">netstart(8)</a>
      before rebooting your new kernel.

    <p>First build and install your new kernel as usual, then
      <pre>
  # cd /usr/src && make includes
  # cd sbin/ifconfig
  # make obj depend
  # make
  # make install
  # cp /usr/src/etc/netstart /etc
      </pre>
      Now reboot your machine and proceed with building a new userland.
    <p>

    <a name="3.4.4"></a>
    <h3>
       3.4.4: New user and group _bgpd (2003/12/17)
    </h3>
    <p>The new <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bgpd&amp;sektion=8"
      >bgpd(8)</a> daemon runs in privilege separated mode, and requires a new
      user and group _bgpd.
      Add the group by running
<pre>
  # groupadd -g 75 _bgpd
</pre>
      as root, and add the user entry using
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
<pre>
  _bgpd:*:75:75::0:0:BGP Daemon:/var/empty:/sbin/nologin
</pre>
    <p>

    <a name="3.4.5"></a>
    <h3>
	3.4.5: New version of join(1) (2003/12/28)
    </h3>
    <p>The
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=join&amp;sektion=1">join(1)</a>
    command has been updated to follow the POSIX standard when writing
    non-matching lines.
    As a consequence
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=security&amp;sektion=8">security(8)</a>
    has to be updated:
     <pre>
  # cp /usr/src/etc/security /etc
     </pre>
    <p>

    <a name="3.4.6"></a>
    <h3>
	3.4.6: sudo build change (2004/01/15)
    </h3>
    <p>The way the
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sudo&amp;sektion=8">sudo(8)</a>
    command is built has changed.  A side-effect of this is that you will
    need to run:
     <pre>
  # rm -f /usr/obj/usr.bin/sudo/*
     </pre>
    before you can successfully do a "make build".  If this is not done,
    the build will abort when attempting to make obj dirs.
    <p>

    <a name="3.4.7"></a>
    <h3>
      3.4.7: New user and group _tcpdump (2004/01/19)
    </h3>
    <p>The <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8"
      >tcpdump(8)</a> command now runs in privilege separated mode, and requires a new
      user and group _tcpdump.
      Add the group by running
<pre>
  # groupadd -g 76 _tcpdump
</pre>
      as root, and add the user entry using
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
<pre>
  _tcpdump:*:76:76::0:0:tcpdump:/var/empty:/sbin/nologin
</pre>

    <p>
    <a name="3.4.8"></a>
    <h3>
      3.4.8: machdep.c change (i386) (2004/02/01)
    </h3>

    <p>
    A change to <tt>machdep.c</tt> requires that binutils be rebuilt
    before the kernel can be compiled.
    This only affects i386.

<pre>
  # cd /usr/src/gnu/usr.bin/binutils
  # make -f Makefile.bsd-wrapper cleandir
  # make -f Makefile.bsd-wrapper obj
  # make -f Makefile.bsd-wrapper depend
  # make -f Makefile.bsd-wrapper
  # make -f Makefile.bsd-wrapper install
</pre>

    <p> Now you can rebuild the kernel and rest of the system according
    to section <a href="#1.5">1.5</a>

    <p>
    <a name="3.4.9"></a>
    <h3>
      3.4.9: Update bsd.own.mk (2004/02/20)
    </h3>

    <p>
    You must update <tt>/usr/share/mk/bsd.own.mk</tt> to get the USE_GCC3
    definition:

<pre>
    # cd /usr/src/share/mk
    # make install
</pre>

    <p>
    <a name="3.4.10"></a>
    <h3>
      3.4.10: Switch to gcc3 (sparc64) (2004/02/20)
    </h3>

    <p>
    OpenBSD/sparc64 has converted to gcc3.
    To upgrade,

<pre>
    # rm -rf /usr/include/g++
</pre>
    Now, <a href="#1.8">build gcc3</a>, (using the gcc3 directory) then
    build the kernel and system as <a href="#1.5">usual</a>.


    <a name="3.3"></a>
    <h2>
      Upgrading from 3.3 to 3.4
    </h2>
    
    <a name="3.3.1"></a>
    <h3>
      3.3.1: i386 W^X support (2003/04/16)
    </h3>

    <p>To enable i386 Writable xor eXecute support, OpenBSD/i386 has
      changed from a.out executable format to ELF. The flexibility of 
      ELF allows better control over the executable layout which
      allows for W^X support. a.out compatibility is only available in a
      limited form. Static a.out binaries will work as before, dynamic
      a.out binaries ARE NOT SUPPORTED.
    </p>
    <p>SOURCE UPGRADES FROM a.out -&gt; ELF WILL NOT BE SUPPORTED.
      INSTALL A SNAPSHOT and then you can rebuild from source.
      This is i386-only, other architectures are NOT affected by this change.
    </p>

    <a name="3.3.2"></a>
    <h3>
      3.3.2: mquery syscall change (2003/04/28)
    </h3>

    <p>The parameters to the mquery system call were changed to match mmap().
      This requires the system to be upgraded in the correct order:

      <pre>
      1. Build and boot new kernel.
      2. (cd /usr/src && sudo make includes)
      3. (cd /usr/src/libexec/ld.so && make && sudo make install)
      4. 'make build'
      </pre>

      Only i386 uses mquery, so other architectures do not need to
      follow this strict build order.

    <a name="3.3.3"></a>
    <h3>
      3.3.3: i386 flag day, exe addr/MAXDSIZ change (2003/05/05)
    </h3>

    <p>To allow MAXDSIZ to be changed back to 1G, the base
      address of all executables changes from 0 to 0x1c000000. The
      combination of these changes requires updating from snapshot.
      Updating from source is not supported.  This only affects i386.
    </p>
    
    <a name="3.3.4"></a>
    <h3>
      3.3.4: Removal of KerberosIV authentication (2003/05/13)
    </h3>

    <p>KerberosIV-based authentication has been removed. As a result, 
       you will need to remove all references to <tt>krb4</tt> in
       <tt>/etc/login.conf</tt>. 
    </p>

    <a name="3.3.5"></a>
    <h3>
      3.3.5: <tt>config</tt> change (2003/05/23)
    </h3>

    <p>Moving swapgeneric.c required a change to 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;sektion=8">config(8)</a>.
      Before building a new kernel, you must first build and install
      the updated config(8):
<pre>
  # cd /usr/src/usr.sbin/config
  # make clean
  # make obj
  # make
  # make install
</pre>
      Now, <tt>config</tt> your kernel configuration and run 
      "<tt>make depend</tt>" in your kernel compile directory as detailed
      <a href="#1.5">above</a>. 

   <a name="3.3.6"></a>
   <h3>
    3.3.6: Use __attribute__((bounded)) on certain functions (2003/06/26)
   </h3>
      
   <p>
     __attribute__((bounded)) is now used to detect incorrect arguments
     for functions which take buffer lengths as one of their parameters.
     <br><br>You will need to rebuild gcc according to section
     <a href="#1.8">1.8</a>
     of the Mini-FAQ before proceeding with <tt>make build</tt>.
   </p>

    <a name="3.3.7"></a>
    <h3>
      3.3.7: New user and group _syslogd (2003/07/31)
    </h3>
    <p>The <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8"
      >syslogd(8)</a> daemon now runs in privilege separated mode, and requires a new
      user and group _syslogd.
      Add the group by running
<pre>
  # groupadd -g 73 _syslogd
</pre>
      as root, and add the user entry using
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
<pre>
  _syslogd:*:73:73::0:0:Syslog Daemon:/var/empty:/sbin/nologin
</pre>
    <p>

    <a name="3.3.8"></a>
    <h3>
      3.3.8: Use format attribute __kprintf__ in kernel headers (2003/08/23)
    </h3>
    <p>
      A new format attribute __kprintf__ is now used in kernel header files to 
      make gcc aware of the format extensions in the kernel
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=printf&amp;sektion=9">printf(9)</a>.
      <br><br>You will need to rebuild gcc according to section <a href="#1.8">1.8</a>
     of the Mini-FAQ before proceeding with <tt>make build</tt>. You only need to rebuild
     gcc once from current sources to also support the __bounded__ attribute described
     in section <a href="#3.3.6">3.3.6</a>.
    </p>

    <a name="3.2"></a>
    <h2>
      Upgrading from 3.2 to 3.3
    </h2>

    <a name="3.2.1"></a>
    <h3>
      3.2.1: New Perl (2002/11/05)
    </h3>

    <p>Perl has been updated to version 5.8.0.<br>
      In Perl 5.8.0, the XS module API has changed due to a switch
      from stdio to PerlIO (see the perldelta manual page for more information).
      This means that any XS modules (perl .so files) you have installed
      <strong>must</strong> be rebuilt.  If you encounter an error such as
      <em>Undefined symbol "perl_get_sv"</em> this is your problem.  If the
      only modules you have installed were installed as packages or via the
      ports system, you can check your system for XS modules by running:
      <pre>
	# grep '\.so' /var/db/pkg/p5-*/+CONTENTS | cut -d: -f1 | sort -u
      </pre>
      You can then remove the offending modules with <em>pkg_delete -f</em>
      and rebuild/install them from the ports tree.

    <a name="3.2.2"></a>
    <h3>
      3.2.2: New groups _radius, _token and _shadow (2002/11/21)
    </h3>
    <p>Several new groups have been added:
      <ul>
      <li>The <em>_radius</em> group controls read-only access to
	  <tt>/etc/raddb/servers</tt> file.
      <li>The <em>_token</em> group controls read-only access to the
	  token databases used by 
	  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tokeninit&amp;sektion=8">tokeninit(8)</a>,
	  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tokenadm&amp;sektion=8">tokenadm(8)</a>, and
	  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=login_token&amp;sektion=8">login_token(8)</a>.
      <li>The <em>_shadow</em> group controls read-only access to
	  the shadow password database.
      </ul>

      You will need to add these groups and adjust the permissions on
      some files before running a &quot;make build&quot;.  The following
      commands, run as root, will do this:
	<pre>
	  # groupadd -g 63 _radius
	  # chgrp _radius /etc/raddb /etc/raddb/servers
	  # chmod g+x /etc/raddb
	  # chmod g+r /etc/raddb/servers

	  # groupadd -g 64 _token
	  # chgrp _token /etc/activ.db /etc/crypto.db /etc/snk.db
	  # chmod 0640 /etc/activ.db /etc/crypto.db /etc/snk.db

	  # groupadd -g 65 _shadow
	  # chgrp _shadow /etc/spwd.db
	  # chmod 0640 /etc/spwd.db
	</pre>

      Don't worry about error messages indicating that a file was not found.
      That just means you haven't setup <em>token</em> or <em>radius</em> authentication.

    <a name="3.2.3"></a>
    <h3>
      3.2.3: Important compiler changes (2002/12/02)
    </h3>
    <p>The <a href="http://www.trl.ibm.com/projects/security/ssp">propolice</a>
      stack protection extension has been merged into
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gcc-local&amp;sektion=1"
      >gcc</a>. This requires a slightly different upgrade scenario:
      <ul>
      <li>Do <b>not</b> build a new kernel yet.
      <li>Do <b>not</b> rebuild gcc yet.
      <li>Build and install a new ld.so dynamic loader if your system has
        shared libraries.
        <pre>
	  # cd /usr/src
	  # make obj
          For ELF platforms (alpha, macppc, sparc, sparc64):
          # cd /usr/src/libexec/ld.so
          # make depend &amp;&amp; make &amp;&amp; make install
	  For a.out platforms (amiga, hp300, i386, mac68k, mvme68k):
          # cd /usr/src/gnu/usr.bin/ld/rtld
          # make depend &amp;&amp; make &amp;&amp; make install
	</pre>
      <li>Rebuild and install a new libc, following the first few commands
        from <i>make build</i>.
	<pre>
          # cd /usr/src/include
	  # make prereq &amp;&amp; make includes
	  # cd /usr/src/lib/libc
	  # make depend &amp;&amp; make NOMAN=1 &amp;&amp; make NOMAN=1 install
	</pre>
	Note that, if your compiler is too old, it will not be able to build
	libc. In this case, you'll have to do a binary upgrade from a snapshot.
      <li>Rebuild and install gcc, as told in section <a href="#1.8">1.8</a>.
      <li>You can now recompile a kernel.
        Be sure to run
        <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;sektion=8"
	>config</a> again to regenerate the kernel Makefile.
      <li>Reboot on the new kernel, and run a <i>make build</i> to
        benefit from the stack protection.
      </ul>

    <a name="3.2.4"></a>
    <h3>
      3.2.4: New user and group _spamd (2002/12/24)
    </h3>
    <p>A new user and a new group _spamd for the
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=spamd&amp;sektion=8"
      >spamd(8)</a> daemon have been added.
      Add the group by running
<pre>
  # groupadd -g 62 _spamd
</pre>
      as root, and add the user entry using
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
<pre>
  _spamd:*:62:62::0:0:Spam daemon:/var/empty:/sbin/nologin
</pre>

    <a name="3.2.5"></a>
    <h3>
      3.2.5: Alias for ipv6-icmp (2002/12/30)
    </h3>

    <p>A new alias for ipv6-icmp, <em>icmp6</em> , has been added to
      <tt>/etc/protocols</tt>.  If you wish to use the <em>icmp6</em> alias
      (used in the
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8">pfctl(8)</a>
      regression tests) you must modify the <em>ipv6-icmp</em> line in
      <tt>/etc/protocols</tt>, adding the <em>icmp6</em> keyword before the #.
      The line should read as follows:
    </p>
<pre>
  ipv6-icmp 58    IPv6-ICMP icmp6 # ICMP for IPv6
</pre>

    <a name="3.2.6"></a>
    <h3>
      3.2.6: New group _lkm (2003/01/05)
    </h3>

    <p>The <em>_lkm</em> group controls access to
	  <tt>/dev/lkm</tt>.
	  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=modstat&amp;sektion=8">modstat(8)</a>
          is now setgid _lkm.
    <p>
      You will need to add this group and adjust the permissions on
      <tt>/dev/lkm</tt> before running a &quot;make build&quot;.  The following
      commands, run as root, will do this:
<pre>
  # groupadd -g 61 _lkm
  # chgrp _lkm /dev/lkm
</pre>

    <a name="3.2.7"></a>
    <h3>
      3.2.7: New libpthread (2003/01/14)
    </h3>

    <p><em>libc_r</em> and <em>libnpthread</em> have been removed and
    replaced by <em>libpthread</em>.  Threaded programs should still
    be compiled using the <em>-pthread</em> option; the compiler does
    the right thing.

    <p>Before removing <em>libc_r</em> and <em>libnpthread</em> threaded
    applications must be re-compiled using <em>libpthread</em>.  The
    recommended build sequence is:

    <ol>
      <li>
        <p>build gcc according to section <a href="#1.8">1.8</a>.
      <li>
        <p>re-build the system according to section <a href="#1.5">1.5</a>.
      <li>
        <p>re-build all threaded ports.
      <li>
        <p>remove the now unused libraries:
<pre>
  # rm /usr/lib/libc_r* /usr/lib/libnpthread*
</pre>
    </ol>

    <a name="3.2.8"></a>
    <h3>
      3.2.8: Linker changes for ELF architectures (2003/01/17)
    </h3>

    <p>Binutils/ld have been changed to introduce a new security feature to ELF
    executables. Instead of allowing the data section of executables and
    shared libraries to be marked executable by the linker, the layout has
    been changed to only mark the appropriate sections of the program image
    as executable. This change only affects ELF based architectures: alpha,
    sparc, sparc64, macppc.
    <p>
    It is recommended that binutils be rebuilt before the rest of the system.
    <p>
<pre>
  # cd /usr/src/gnu/usr.bin/binutils
  # make -f Makefile.bsd-wrapper cleandir
  # make -f Makefile.bsd-wrapper obj
  # make -f Makefile.bsd-wrapper depend
  # make -f Makefile.bsd-wrapper
  # make -f Makefile.bsd-wrapper install
</pre>
    <p>
    Then re-build the system according to section <a href="#1.5">1.5</a>

    <a name="3.2.9"></a>
    <h3>
      3.2.9: Removal of /var/at and crontab changes (2003/02/19)
    </h3>

    <p>The contents of <tt>/var/at</tt> have been merged into <tt>/var/cron</tt>
    now that <em>at</em> has been integrated into <em>cron</em>.  Furthermore,
    the <em>cron</em> allow and deny files have been renamed cron.allow and
    cron.deny for POSIX compliance and consistency with at.allow and at.deny.
    <p>
    First re-build the system according to section <a href="#1.5">1.5</a>
    Then move the existing files and restart cron as follows:
    <p>
<pre>
  # mv /var/at/* /var/cron
  # mv /var/cron/jobs /var/cron/atjobs
  # mv /var/cron/allow /var/cron/cron.allow
  # mv /var/cron/deny /var/cron/cron.deny
  # rm -rf /var/at 
  # kill `cat /var/run/cron.pid`
  # /usr/sbin/cron
</pre>
    <p>
    Disregard any warnings about missing allow or deny files.
    Not all of them are part of the default installation.
    <p>
    If you do not already have a cron.deny file (it was not installed
    prior to OpenBSD 3.3) you will need one to run <em>crontab</em> as
    a user other than the superuser.
<pre>
  # install -c -o root -g crontab -m 660 /dev/null /var/cron/cron.deny
</pre>


    <a name="3.2"></a>
    <h2>
      Upgrading from 3.2
    </h2>

    <a name="3.2.1"></a>
    <h3>
      3.2.1: New Perl (2002/11/05)
    </h3>

    <p>Perl has been updated to version 5.8.0.<br>
      In Perl 5.8.0, the XS module API has changed due to a switch
      from stdio to PerlIO (see the perldelta manual page for more information).
      This means that any XS modules (perl .so files) you have installed
      <strong>must</strong> be rebuilt.  If you encounter an error such as
      <em>Undefined symbol "perl_get_sv"</em> this is your problem.  If the
      only modules you have installed were installed as packages or via the
      ports system, you can check your system for XS modules by running:
      <pre>
	# grep '\.so' /var/db/pkg/p5-*/+CONTENTS | cut -d: -f1 | sort -u
      </pre>
      You can then remove the offending modules with <em>pkg_delete -f</em>
      and rebuild/install them from the ports tree.

    <a name="3.2.2"></a>
    <h3>
      3.2.2: New groups _radius, _token and _shadow (2002/11/21)
    </h3>
    <p>Several new groups have been added:
      <ul>
      <li>The <em>_radius</em> group controls read-only access to
	  <tt>/etc/raddb/servers</tt> file.
      <li>The <em>_token</em> group controls read-only access to the
	  token databases used by 
	  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tokeninit&amp;sektion=8">tokeninit(8)</a>,
	  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tokenadm&amp;sektion=8">tokenadm(8)</a>, and
	  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=login_token&amp;sektion=8">login_token(8)</a>.
      <li>The <em>_shadow</em> group controls read-only access to
	  the shadow password database.
      </ul>

      You will need to add these groups and adjust the permissions on
      some files before running a &quot;make build&quot;.  The following
      commands, run as root, will do this:
	<pre>
	  # groupadd -g 63 _radius
	  # chgrp _radius /etc/raddb /etc/raddb/servers
	  # chmod g+x /etc/raddb
	  # chmod g+r /etc/raddb/servers

	  # groupadd -g 64 _token
	  # chgrp _token /etc/activ.db /etc/crypto.db /etc/snk.db
	  # chmod 0640 /etc/activ.db /etc/crypto.db /etc/snk.db

	  # groupadd -g 65 _shadow
	  # chgrp _shadow /etc/spwd.db
	  # chmod 0640 /etc/spwd.db
	</pre>

      Don't worry about error messages indicating that a file was not found.
      That just means you haven't setup <em>token</em> or <em>radius</em> authentication.

    <a name="3.2.3"></a>
    <h3>
      3.2.3: Important compiler changes (2002/12/02)
    </h3>
    <p>The <a href="http://www.trl.ibm.com/projects/security/ssp">propolice</a>
      stack protection extension has been merged into
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gcc-local&amp;sektion=1"
      >gcc</a>. This requires a slightly different upgrade scenario:
      <ul>
      <li>Do <b>not</b> build a new kernel yet.
      <li>Do <b>not</b> rebuild gcc yet.
      <li>Build and install a new ld.so dynamic loader if your system has
        shared libraries.
        <pre>
	  # cd /usr/src
	  # make obj
          For ELF platforms (alpha, macppc, sparc, sparc64):
          # cd /usr/src/libexec/ld.so
          # make depend &amp;&amp; make &amp;&amp; make install
	  For a.out platforms (amiga, hp300, i386, mac68k, mvme68k):
          # cd /usr/src/gnu/usr.bin/ld/rtld
          # make depend &amp;&amp; make &amp;&amp; make install
	</pre>
      <li>Rebuild and install a new libc, following the first few commands
        from <i>make build</i>.
	<pre>
          # cd /usr/src/include
	  # make prereq &amp;&amp; make includes
	  # cd /usr/src/lib/libc
	  # make depend &amp;&amp; make NOMAN=1 &amp;&amp; make NOMAN=1 install
	</pre>
	Note that, if your compiler is too old, it will not be able to build
	libc. In this case, you'll have to do a binary upgrade from a snapshot.
      <li>Rebuild and install gcc, as told in section <a href="#1.8">1.8</a>.
      <li>You can now recompile a kernel.
        Be sure to run
        <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;sektion=8"
	>config</a> again to regenerate the kernel Makefile.
      <li>Reboot on the new kernel, and run a <i>make build</i> to
        benefit from the stack protection.
      </ul>

    <a name="3.2.4"></a>
    <h3>
      3.2.4: New user and group _spamd (2002/12/24)
    </h3>
    <p>A new user and a new group _spamd for the
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=spamd&amp;sektion=8"
      >spamd(8)</a> daemon have been added.
      Add the group by running
<pre>
  # groupadd -g 62 _spamd
</pre>
      as root, and add the user entry using
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
<pre>
  _spamd:*:62:62::0:0:Spam daemon:/var/empty:/sbin/nologin
</pre>

    <a name="3.2.5"></a>
    <h3>
      3.2.5: Alias for ipv6-icmp (2002/12/30)
    </h3>

    <p>A new alias for ipv6-icmp, <em>icmp6</em> , has been added to
      <tt>/etc/protocols</tt>.  If you wish to use the <em>icmp6</em> alias
      (used in the
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8">pfctl(8)</a>
      regression tests) you must modify the <em>ipv6-icmp</em> line in
      <tt>/etc/protocols</tt>, adding the <em>icmp6</em> keyword before the #.
      The line should read as follows:
    </p>
<pre>
  ipv6-icmp 58    IPv6-ICMP icmp6 # ICMP for IPv6
</pre>

    <a name="3.2.6"></a>
    <h3>
      3.2.6: New group _lkm (2003/01/05)
    </h3>

    <p>The <em>_lkm</em> group controls access to
	  <tt>/dev/lkm</tt>.
	  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=modstat&amp;sektion=8">modstat(8)</a>
          is now setgid _lkm.
    <p>
      You will need to add this group and adjust the permissions on
      <tt>/dev/lkm</tt> before running a &quot;make build&quot;.  The following
      commands, run as root, will do this:
<pre>
  # groupadd -g 61 _lkm
  # chgrp _lkm /dev/lkm
</pre>

    <a name="3.2.7"></a>
    <h3>
      3.2.7: New libpthread (2003/01/14)
    </h3>

    <p><em>libc_r</em> and <em>libnpthread</em> have been removed and
    replaced by <em>libpthread</em>.  Threaded programs should still
    be compiled using the <em>-pthread</em> option; the compiler does
    the right thing.

    <p>Before removing <em>libc_r</em> and <em>libnpthread</em> threaded
    applications must be re-compiled using <em>libpthread</em>.  The
    recommended build sequence is:

    <ol>
      <li>
        <p>build gcc according to section <a href="#1.8">1.8</a>.
      <li>
        <p>re-build the system according to section <a href="#1.5">1.5</a>.
      <li>
        <p>re-build all threaded ports.
      <li>
        <p>remove the now unused libraries:
<pre>
  # rm /usr/lib/libc_r* /usr/lib/libnpthread*
</pre>
    </ol>

    <a name="3.2.8"></a>
    <h3>
      3.2.8: Linker changes for ELF architectures (2003/01/17)
    </h3>

    <p>Binutils/ld have been changed to introduce a new security feature to ELF
    executables. Instead of allowing the data section of executables and
    shared libraries to be marked executable by the linker, the layout has
    been changed to only mark the appropriate sections of the program image
    as executable. This change only affects ELF based architectures: alpha,
    sparc, sparc64, macppc.
    <p>
    It is recommended that binutils be rebuilt before the rest of the system.
    <p>
<pre>
  # cd /usr/src/gnu/usr.bin/binutils
  # make -f Makefile.bsd-wrapper cleandir
  # make -f Makefile.bsd-wrapper obj
  # make -f Makefile.bsd-wrapper depend
  # make -f Makefile.bsd-wrapper
  # make -f Makefile.bsd-wrapper install
</pre>
    <p>
    Then re-build the system according to section <a href="#1.5">1.5</a>

    <a name="3.2.9"></a>
    <h3>
      3.2.9: Removal of /var/at and crontab changes (2003/02/19)
    </h3>

    <p>The contents of <tt>/var/at</tt> have been merged into <tt>/var/cron</tt>
    now that <em>at</em> has been integrated into <em>cron</em>.  Furthermore,
    the <em>cron</em> allow and deny files have been renamed cron.allow and
    cron.deny for POSIX compliance and consistency with at.allow and at.deny.
    <p>
    First re-build the system according to section <a href="#1.5">1.5</a>
    Then move the existing files and restart cron as follows:
    <p>
<pre>
  # mv /var/at/* /var/cron
  # mv /var/cron/jobs /var/cron/atjobs
  # mv /var/cron/allow /var/cron/cron.allow
  # mv /var/cron/deny /var/cron/cron.deny
  # rm -rf /var/at 
  # kill `cat /var/run/cron.pid`
  # /usr/sbin/cron
</pre>
    <p>
    Disregard any warnings about missing allow or deny files.
    Not all of them are part of the default installation.
    <p>
    If you do not already have a cron.deny file (it was not installed
    prior to OpenBSD 3.3) you will need one to run <em>crontab</em> as
    a user other than the superuser.
<pre>
  # install -c -o root -g crontab -m 660 /dev/null /var/cron/cron.deny
</pre>

    <a name="3.1"></a>
    <h2>
      Upgrading from 3.1
    </h2>
    
    <a name="3.1.1"></a>
    <h3>
      3.1.1: New users/groups
    </h3>

    <p>Several new users/groups have been added. 
      In support of 
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=authpf&amp;sektion=8"
      >authpf(8)</a>, a new group is required. Also, to support
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sshd&amp;sektion=8">sshd(8)</a>'s
      privilege separation feature, a new user and group named <em>sshd</em>
      have been added to the system.
      More new users for system services have been added, they are prefixed
      with &quot;_&quot;.
      Add the following user entries using 
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
    </p>
<pre>
  sshd:*:27:27::0:0:sshd privsep:/var/empty:/sbin/nologin
  _portmap:*:28:28::0:0:portmap:/var/empty:/sbin/nologin
  _identd:*:29:29::0:0:identd:/var/empty:/sbin/nologin
  _rstatd:*:30:30::0:0:rpc.rstatd:/var/empty:/sbin/nologin
  _rusersd:*:32:32::0:0:rpc.rusersd:/var/empty:/sbin/nologin
  _fingerd:*:33:33::0:0:fingerd:/var/empty:/sbin/nologin
  _x11:*:35:35::0:0:X server:/var/empty:/sbin/nologin
</pre>
    
    <p>Add the following to <tt>/etc/group</tt>:</p>
       
<pre>
  sshd:*:27:
  _portmap:*:28:
  _identd:*:29:
  _rstatd:*:30:
  _rusersd:*:32:
  _fingerd:*:33:
  _sshagnt:*:34:
  _x11:*:35:
  authpf:*:72:
</pre>

    <a name="3.1.2"></a>
    <h3>
      3.1.2: New group for crontab(1) and at(1)
    </h3>

    <p>
      The 
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=crontab&amp;sektion=1">
      crontab(1)</a> and
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=at&amp;sektion=1">
      at(1)</a> commands are no longer setuid root, they are now setgid
      <em>crontab</em>.

    <p>
      Before you run &quot;make build&quot;, you will need to add the
      <em>crontab</em> group.
      Add a line like the following to your <tt>/etc/group</tt> file:</p>

<pre>
  crontab:*:66:
</pre>

<p>
      The &quot;make build&quot; will update some, but not all, permissions
      for you.  After &quot;make build&quot; finishes, you must run following
      by hand (assumes <tt>/bin/csh</tt>):
</p>

<pre>
  # chgrp crontab /var/at/at.{allow,deny} /var/cron/{allow,deny}
  # chmod 0640 /var/at/at.{allow,deny} /var/cron/{allow,deny}
  # foreach f ( /var/cron/tabs/* )
	  set u=`basename $f`
 	  chown $u:crontab $f
    end
</pre>

<p>
      Note that you probably will not have all of the allow/deny files;
      this is not a problem.
</p>

    <a name="3.1.3"></a>
    <h3>
      3.1.3: New Binutils
    </h3>

<p>
A new binutils (2.11.2) has gone into the tree, requiring an updated
<em>libiberty</em>. To build this library, follow these steps:
</p>
  
<pre>
  # cd /usr/src/gnu/egcs/libiberty
  # make -f Makefile.bsd-wrapper cleandir
  # make -f Makefile.bsd-wrapper obj
  # make -f Makefile.bsd-wrapper depend
  # make -f Makefile.bsd-wrapper
  # make -f Makefile.bsd-wrapper install
</pre>

    <a name="3.1.4"></a>
    <h3>
      3.1.4: New S/Key configuration
    </h3>

    <p>
      The old S/Key database file, <tt>/etc/skeykeys</tt>, has been replaced by
      a directory, <tt>/etc/skey</tt>, where each record is an individual file
      owned by the user it describes.  You can convert <tt>/etc/skeykeys</tt>
      to the new format by running (as root):
    </p>
<pre>
  # skeyinit -C
  # mv /etc/skeykeys /etc/skeykeys.OLD
</pre>

<p>
      Note that any third-party programs that utilize S/Key directly will need
      to be recompiled.
</p>

    <a name="3.1.5"></a>
    <h3>
      3.1.5: New permissions for lp*
    </h3>

    <p>
      The spool directories used by lpd must now be writable by group
      daemon in order for lpr to be able to spool files.  Additionally,
      the files within the spool directories must be owned by user and
      group daemon.  This can be accomplished as follows:
    </p>
<pre>
 # find /var/spool/output /var/spool/lpd -type d \
	-execdir chgrp daemon {} \; -execdir chmod g+rwx {} \;
 # find /var/spool/output /var/spool/lpd -type f \
	-execdir chown daemon:daemon {} \;
</pre>

    <a name="3.1.6"></a>
    <h3>
      3.1.6: atrun(8) no longer needed
    </h3>

    <p>
      The <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=atrun&amp;sektion=8">atrun(8)</a>
      command is no longer needed.  Its functionality has been incorporated into
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cron&amp;sektion=8">cron(8)</a>.
      You should remove the <tt>/usr/libexec/atrun</tt> job from root's
      crontab by running the following as root:
    </p>
    <pre>
      # crontab -e
    </pre>

    <p>
      You may also wish to remove <tt>/usr/libexec/atrun</tt>,
      <tt>/usr/share/man/cat8/atrun.0</tt> and the
      <tt>/var/at/spool</tt> directory.
    </p>

    <a name="3.1.7"></a>
    <h3>
      3.1.7: nat.conf merged into pf.conf
    </h3>

    <p>
	<tt>/etc/nat.conf</tt> is now merged into <tt>/etc/pf.conf</tt>.
	You need to insert your NAT rules in pf.conf after scrub rules and
	before filter rules.
    </p>
    <p>
	<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8">pfctl(8)</a>
	has a new option to load the ruleset, -f, and the -R and -N options
	have new meanings now. Make sure to check the manpage
	and to update your <tt>/etc/rc</tt>.
    </p>

    <a name="3.1.8"></a>
    <h3>
     3.1.8: New fbtab entry needed for xdm
    </h3>

    <p>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=login&amp;sektion=1">
login(1)</a> needs to chown /dev/wsmouse to the new _x11 user that is used by
xdm for privilege revocation purposes on many architectures. The change to
<tt>/etc/fbtab</tt> needed is architecture dependent. The file is created via
this process (assuming sources in /usr/src):
    </p>
<pre>
  # cat /usr/src/etc/fbtab.head > /etc/fbtab
  # cat /usr/src/etc/etc.`uname -m`/fbtab >> /etc/fbtab
  # cat /usr/src/etc/fbtab.tail >> /etc/fbtab
</pre>
<p>
If you had custom changes to <tt>/etc/fbtab</tt>, you will have to merge them
back into the new file manually.
</p>
   <a name="3.1.9"></a>
   <h3>
    3.1.9: Use __attribute__((sentinel)) on certain functions
   </h3>

   <p>
     __attribute__((sentinel)) is now employed to warn when certain
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=exec&amp;sektion=3">
exec(3)</a>
     functions are used without a terminating NULL pointer.
     <br><br>You will need to rebuild gcc according to section
     <a href="#1.8">1.8</a>
     of the Mini-FAQ before proceeding with <tt>make build</tt>.
   </p>

    <a name="3.0"></a>
    <h2>
      Upgrading from 3.0
    </h2>
    
    <a name="3.0.1"></a>
    <h3>
      3.0.1: New keyword supported by mtree(8)
    </h3>

    <p>
      You must build and install a new version of the
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mtree&amp;sektion=8">
      mtree(8)</a> utility before &quot;make build&quot; will succeed.
    </p>
<pre>
  # cd /usr/src/usr.sbin/mtree
  # make cleandir
  # make obj
  # make depend
  # make
  # make install
</pre>

    <a name="3.0.2"></a>
    <h3>
      3.0.2: Removal of libdl on ELF platforms
    </h3>
    
    <p>
      ELF-based platforms (alpha, macppc and sparc64) do not use libdl
      anymore. The upgrade from a libdl system to a non-libdl is best
      done following these steps:
    </p>

    <ul>
      <li>
	<p>Recompile your system:</p>
<pre>
  # cd /usr/src
  # make build
</pre>
      </li>

      <li>
	<p>
	  If your &quot;make build&quot; completed successfully, you
	  can step ahead and remove libdl.  Note that packages that
	  have been linked against it should be reinstalled after
	  that.  If you are not ready for this, you can skip this step
	  for now.  Snapshots with correct packages will be made
	  available.
	</p>
<pre>
  # rm -f /usr/lib/libdl.* /usr/lib/libdl_pic.a
</pre>
	</li>
      <li>
	<p>
	  With libdl removed, regenerate your shared libraries cache:
	</p>
	
<pre>
  # ldconfig -R
</pre>
      </li>
    </ul>

    <a name="3.0.3"></a>
    <h3>
      3.0.3: New regression framework
    </h3>
    
    <p>
      A new infrastructure for regression tests has been introduced and
      <tt>bsd.regress.mk</tt> has been added.  You will need to install
      this file before running <em>make obj</em>.
    </p>

<pre>
  # cd /usr/src/share/mk
  # make install
</pre>

    <a name="3.0.4"></a>
    <h3>
      3.0.4: ssh config files moved to /etc/ssh/
    </h3>

    <p>
      You need to create /etc/ssh/ first, see section
      <a href="#1.13">1.13</a>
    </p>

    <p>
      Recompile your system:
    </p>
<pre>
  # cd /usr/src
  # make build
</pre>

    <p>
      Move your /etc/ssh*_* files into the newly created /etc/ssh/ directory:
    </p>
<pre>
  # cd /etc
  # mv ssh*_* ssh/
</pre>

    <p>
      You will need to
      <a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/rc.diff?r1=1.188&amp;r2=1.189">
	change your <tt>rc</tt> scripts</a> to reflect
	these changes as well.
    </p>

    <p>
      Update any <tt>HostKey</tt> lines in your sshd_config to reflect
      the new location.  For example:
    </p>
<pre>
  HostKey /etc/ssh_host_key
</pre>

    <p>should be changed to:</p>

<pre>
  HostKey /etc/ssh/ssh_host_key
</pre>

    <p>
      After this, you can restart the sshd daemon.
    </p>

    <a name="2.9"></a> 
    <h2>Upgrading from 2.9</h2>

    <a name="2.9.1"></a> 
    <h3>2.9.1: New users/groups - <em>proxy</em>, <em>smmsp</em>, and
      <em>popa3d</em>.</h3>

    <p>
      First, with the addition of the 
      <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4">
	pf(4)</a> firewalling package, and its 
      <a href=
	 "http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8"
	 >ftp-proxy(8)</a> suite, a new user and group named
      <em>proxy</em> were added to the system. To support this
      addition, add the following user entry using 
      <a href=
	 "http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">
	vipw(8)</a>:</p>
    
<pre>
proxy:*:71:71::0:0:Proxy Services:/nonexistent:/sbin/nologin
</pre>

    <p>Also add the <em>proxy</em> group to /etc/group:</p>

<pre>
proxy:*:71:
</pre>

    <p>Second, as part of the Sendmail 8.12 upgrade, sendmail no
      longer runs setuid root. Both a new user and a new group, named
      <em>smmsp</em>, have been added to the system. Add a line like
      the following to your <tt>/etc/group</tt>:</p>

<pre>
smmsp:*:25:
</pre>

    <p>Then, run 
      <a href=
	 "http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">
	vipw(8)</a> and add the following line for the <em>smmsp</em>
      user:</p>

<pre>
smmsp:*:25:25::0:0:Sendmail Message Submission Program:/nonexistent:/sbin/nologin
</pre>

    <p>Make sure this line appears before any <a href=
      "http://www.openbsd.org/cgi-bin/man.cgi?query=yp&amp;sektion=8">
      yp(8)</a> settings line.</p>

    <p>Finally, a new user and group were added for Solar
      Designer's popa3d server, now part of the core system. Add the
      following to <tt>/etc/group</tt>:</p>

<pre>
popa3d:*:26:
</pre>

    <p>And using <a href=
      "http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">
      vipw(8)</a>, add</p>
<pre>
popa3d:*:26:26::0:0:POP3 server:/var/empty:/sbin/nologin
</pre>

    <a name="2.9.2"></a> 
    <h3>2.9.2: New packet filter: <em>pf</em></h3>

    <p>The IPF firewalling package that has been part of previous
      OpenBSD releases has been replaced with an all-new firewalling
      suite called <a href=
      "http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4">
	pf(4)</a>. As a result, a number of changes need to be
      made.</p>

    <p>First, <em>pf</em> depends on a new device file. To ensure
      that this special device is created, do the following:</p>

<pre>
  # cd /dev
  # cp /usr/src/etc/etc.`machine`/MAKEDEV ./
  # ./MAKEDEV all
</pre>

    <p>Second, a number of filesystem change have occurred. For
      your reference, the following binaries have been replaced:</p>

<pre>
OLD:
/sbin/ipf /sbin/ipfstat /sbin/ipnat /usr/sbin/ipfs
/usr/sbin/ipftest /usr/sbin/ipmon /usr/sbin/ipresend
/usr/sbin/ipsend /usr/sbin/iptest
NEW:
/sbin/pfctl
/usr/libexec/ftp-proxy
</pre>

    <p>Similarly, for the devices:</p>

<pre>
OLD: /dev/ipl /dev/ipnat /dev/ipstate /dev/ipauth
NEW: /dev/pf
</pre>

    <p>And finally, the filter configuration files:</p>

<pre>
OLD: /etc/ipf.rules /etc/ipnat.rules
NEW: /etc/pf.conf /etc/nat.conf
</pre>
    <p>The old ipfilter sample configuration files may be removed:
    </p>
<pre>
  # rm -rf /usr/share/ipf
</pre>

    <p>A mechanism for safely enabling <em>pf</em> has been added
      to the <tt>/etc/rc</tt> and <tt>/etc/rc.conf</tt> files. You
      will need to update these files to include the new hooking
      mechanism. If you wish to enable <em>pf</em>, set PF=YES in
      <tt>/etc/rc.conf</tt>.</p>

    <a name="2.9.3"></a> 
    <h3>2.9.3: Changes to <em>make</em></h3>

    <p>There have been changes to <a href=
      "http://www.openbsd.org/cgi-bin/man.cgi?query=make&amp;sektion=1">
	make(1)</a> and its data files which may cause difficulties in
      the build process. This usually manifests as errors from
      <em>bsd.own.mk</em> during the build. To avoid these issues,
      first update the data files:</p>
<pre>
  # cd /usr/src/share/mk
  # make install
</pre>

    <p>Then build and install the new make.</p>

<pre>
  # cd /usr/src/usr.bin/make
  # make clean &amp;&amp; make obj &amp;&amp; make depend &amp;&amp; make
  # make install
</pre>

    <p>Now proceed with your upgrade.</p>
    
    <a name="2.9.4"></a>
    <h3>2.9.4: Build fails because of KerberosV errors</h3>

    <p>Before you try building the whole system, you need to first
      build KerberosV.</p>

    <p>First, there is a new KerberosV configuration directory in
      <em>/etc</em>. If you have not already done so, use the <a href=
      "http://www.openbsd.org/cgi-bin/man.cgi?query=mtree&amp;sektion=8">
	mtree(8)</a> procedure described in <a href="#1.13">section
	1.13</a> to create it:</p>

    <p>Now, build KerberosV</p>

<pre>
  # cd /usr/src/kerberosV
  # make obj
  # cd lib/roken
  # make 
  # cd ../../usr.bin/asn1_compile
  # make
  # make install
</pre>

    <p>You may also need to update your <tt>/etc/login.conf</tt>,
      to reflect that the file
      <tt>/usr/libexec/auth/login_krb-or-pwd</tt> has been renamed to
      <tt>login_krb<strong>4</strong>-or-pwd</tt>.</p>

    <a name="2.9.5"></a> 
    <h3>2.9.5: New <em>sendmail</em> version</h3>

    <p><a href=
      "http://www.openbsd.org/cgi-bin/man.cgi?query=sendmail&amp;sektion=8">
	sendmail(8)</a> has been upgraded to version 8.12. As this
      version of <em>sendmail</em> no longer runs setuid root,
      significant changes have resulted.</p>

    <ol>
      <li>Both a new user and a new group (<em>smmsp</em>) have
	been added. If you have not yet done so, follow the procedure
	in <a href="#2.9.1">section 2.9.1</a> to create them.</li>

      <li>Several changes to the file hierarchy have occurred,
	including a new <tt>/var/spool/clientmqueue</tt> directory
	and new permissions for <tt>/var/spool/mqueue</tt>. These
	changes can both be made using the <a href=
        "http://www.openbsd.org/cgi-bin/man.cgi?query=mtree&amp;sektion=8">
	  mtree(8)</a> procedure described in <a href="#1.13">section
	  1.13</a>.</li>

      <li>
        <p>Add the following to root's <a href=
          "http://www.openbsd.org/cgi-bin/man.cgi?query=crontab&amp;sektion=1">
	    crontab(1)</a>. This is necessary since <em>sendmail</em>
	  is no longer setuid root, and relies on this entry to do
	  parts of its job:</p>

<pre>
# sendmail clientmqueue runner
*/30    *       *       *       *       /usr/sbin/sendmail -L sm-msp-queue -Ac -q
</pre>

      </li>
      
      <li>
        <p>Upgrade sendmail:</p>

<pre>
  # cd /usr/src/gnu/usr.sbin/sendmail
  # make clean &amp;&amp; make obj &amp;&amp; make depend &amp;&amp; make &amp;&amp; make install
</pre>

        <p><strong>Note:</strong> The files <tt>submit.cf</tt> and
	  <tt>localhost.cf</tt> have been installed to your
	  <tt>/etc/mail</tt> directory. The first of these,
	  <tt>submit.cf</tt> (referred to as the "client"
	  configuration file in current sendmail documentation) is
	  used by mail user agents that want to submit mail locally
	  for delivery via sendmail. Due to the permissions changes
	  described above, this does not require root privileges; the
	  sendmail binary is set-groupid to group smmsp. The second
	  file, <tt>localhost.cf</tt>, is an OpenBSD-ism that runs
	  sendmail only listening on the localhost interface to
	  accept mail from the local host but not accept connections
	  from the network (you almost certainly want this if you
	  also use e.g., <a href=
          "http://www.openbsd.org/cgi-bin/man.cgi?query=smtpd&amp;sektion=8">
	    smtpd(8)</a> listening on the SMTP port on your outside
	  interface). For more details, see the file
	  <tt>SECURITY</tt> in
	  <tt>/usr/src/gnu/usr.sbin/sendmail/sendmail</tt>.</p>

        <p>It is highly recommended that you regenerate and update
	  your sendmail configuration files in <tt>/etc/mail</tt>.
	  You can find some working configuration files in
	  <tt>/usr/share/sendmail/cf</tt>. Note that localhost.cf is
	  generated from openbsd-localhost.mc.</p>
      </li>

      <li>
        <p>If you were running sendmail without the <tt>-bd</tt>
	  option in <tt>/etc/rc.conf</tt>, as the default
	  installation settings do, you will need to use
	  <tt>localhost.cf</tt>. Edit <tt>rc.conf</tt> to use the
	  following:</p>
<pre>
# For normal use: "-L sm-mta -bd -q30m"
sendmail_flags="-L sm-mta -C/etc/mail/localhost.cf -bd -q30m"
</pre>
      </li>

      <li>
        <p>Once your configuration file is ready, <a href=
         "http://www.openbsd.org/cgi-bin/man.cgi?query=kill&amp;sektion=1">
	    kill(1)</a> the existing sendmail:</p>
<pre>
  kill `sed 1q /var/run/sendmail.pid`
</pre>

        <p>Restart the new sendmail with the appropriate options,
	  for example:</p>
<pre>
  /usr/sbin/sendmail -L sm-mta -bd -q30m
</pre>

        <p>for a configuration accepting mail from outside, or</p>

<pre>
  /usr/sbin/sendmail -L sm-mta -C/etc/mail/localhost.cf -bd -q30m
</pre>

        <p>for a local mail-only configuration.</p>
	
        <p><strong>Note:</strong> the <tt>-bd</tt> flag is now
	  needed in both cases.</p>
      </li>
    </ol>

    <p>The new <em>sendmail</em> should now be running.</p>

    <a name="2.9.6"></a> 
    <h3>2.9.6: <tt>/etc/primes</tt> Moved</h3>

    <p><tt>/etc/primes</tt> has been renamed to
      <tt>/etc/moduli</tt>. Simply copy this file from its old
      location or from <tt>/usr/src/etc</tt>.</p>


<a name="2.8"></a> 
<h2>Upgrading from 2.8</h2>


<a name="2.8.1"></a> 
<h3>2.8.1: New <em>auth</em> group</h3>

<p>A new group, <em>auth</em>, gid 11, has been added to the
system. Add a line like the following to your
<tt>/etc/group</tt>:</p>

<pre>
  auth:*:11:
</pre>

<a name="2.8.2"></a> 
<h3>2.8.2: New <em>wscons</em> console system</h3>

<p>The <em>pcvt</em> console driver has been replaced with the
<em>wscons</em> console system. Before using wscons, you will
need to create the new wscons-related devices. Ensure you have
the latest MAKEDEV installed, then make all devices:</p>

<pre>
 # cp /usr/src/etc/etc.i386/MAKEDEV /dev/MAKEDEV
 # cd /dev
 # ./MAKEDEV all
</pre>

<p>If you are running X, change the Pointer section of your
<em>XF86Config</em> file to contain the following:</p>

<pre>
    Protocol    "wsmouse"
    Device      "/dev/wsmouse"
</pre>

<a name="2.8.3"></a> 
<h3>2.8.3: Kernel compile fails with undefined symbols</h3>

<p><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=config&amp;sektion=8">config(8)</a> has been updated. Building with the old
<em>config</em> will result in errors like:</p>
<pre>
  Undefined symbol `_pdevnames_size' referenced
  Undefined symbol `_pdevnames' referenced
</pre>

<p>To correct this, compile and install the new <em>config</em>:</p>
<pre>
  # cd /usr/src/usr.sbin/config
  # make clean &amp;&amp; make depend &amp;&amp; make
  # make install
</pre>

<p>Now, recompile a new kernel as before.</p>


<a name="2.7"></a>
<h2>
Upgrading from 2.7
</h2>

<a name="2.7.1"></a>
<h3>
2.7.1: What are the major problems upgrading from 2.7 to 2.8?
</h3>

<p>
A significant gcc change was introduced that makes it all too easy
to generate self-referencing <em>libc</em> libraries. For this reason, upgrades
should follow exactly this procedure:
</p>

<ol>
<li> <a href="faq5.html#ProbObj">Clean the cruft</a> from your source tree, and fetch
the 2.8 code.</li>

<li>
<p>
 Build and install a new linker. This <strong>must</strong> be done before
a full <em>gcc</em> build.
</p>
<pre>
  $ cd /usr/src/gnu/usr.bin/ld
  $ make clean &amp;&amp; make obj &amp;&amp; make
  $ sudo make install
</pre>
</li>
<li> Build and install the new <em>gcc</em>. Use the
     <a href="faq5.html#NewCompiler">BOOTSTRAP</a> procedure to speed
     things up.
</li>

<li>
<p> Build a new kernel. Do not install it yet </p>
<pre>
  $ cd /usr/src/sys/arch/`machine`/conf
  $ config GENERIC
  $ cd ../compile/GENERIC
  $ make clean &amp;&amp; make depend &amp;&amp; make
</pre>
</li>

<li><p> Because of some libc changes, your machine may hang on startup unless
   your <tt>/etc/resolv.conf</tt> contains <em>lookup file bind</em>.
   Add this line if necessary </p>
<pre>
  # echo &quot;lookup file bind&quot; &gt;&gt; /etc/resolv.conf
</pre>
</li>
<li> Install the new kernel and reboot
<pre>
  # cd /usr/src/sys/arch/`machine`/compile/GENERIC
  # mv /bsd /bsd.old
  # mv bsd /bsd
  # chown root.wheel /bsd
  # shutdown -r now
</pre>
<p>
(If this step fails, you can recover by booting the old kernel - bsd.old -
at the <tt>boot&gt;</tt> prompt.)</p>
</li>
<li> 
<p>Build and install the new make (and support files). 
     Do not skip the <tt>make depend</tt> step.
</p>
<pre>
  $ cd /usr/src/usr.bin/make
  $ make clean &amp;&amp; make obj &amp;&amp; make depend &amp;&amp; make
  $ sudo make install
  $ cd /usr/src/share/mk
  $ sudo make install
</pre>
</li>

<li>
<p>Install the latest <em>mtree</em>, and ensure the necessary directory
     structure is present.</p>
<pre>
  $ cd /usr/src/etc/mtree
  $ sudo install -c -o root -g wheel -m 444 4.4BSD.dist /etc/mtree
  $ sudo mtree -qdef /etc/mtree/
</pre>
</li>

<li> Perform the make build
<pre>
  # cd /usr/src &amp;&amp; make build
</pre>
</li>

<li> <a href="faq5.html#UpdateEtc">Update <tt>/etc</tt> <tt>/var</tt> and 
     <tt>/dev/MAKEDEV</tt></a> by hand.

</li>
</ol>

<a name="2.6"></a>
<h2>
Upgrading from 2.6
</h2>

<a name="2.6.1"></a>
<h3>
2.6.1: Termcap entries are too long.
</h3>

<p>
There is a new <tt>termcaps.master</tt> file. You will need
to regenerate the <tt>terminfo</tt> and <tt>termcaps</tt> files
with the current version of
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tic&amp;sektion=1">tic(1)</a>.
If you are upgrading via <em>make build</em>, the correct version of
tic(1) will be used and this will be done for you.  If not, you will
get the following error:
</p>

<pre>
    terminfo.src is corrupt! You need to update /usr/bin/tic
</pre>

<p>
In this case, you must either rebuild and install tic(1) (being sure
to use the current version of <tt>libcurses</tt>) or simply build
the version of tic(1) in your source tree.
</p>

<a name="2.6.2"></a>
<h3>
2.6.2: My <em>pn</em> (or <em>mx</em>, <em>al</em>, <em>ax</em>) device is no longer
recognized by the kernel.
</h3>

<p> (Note: <em>pn</em> is used below for simplicity. This should
be taken to read <em>pn</em>, <em>mx</em>, <em>al</em>, or <em>ax</em>
as appropriate)
</p>

<p>
These four drivers were replaced with a unified <em>dc</em> driver.
You must change all occurrences of <em>pn*</em>, <em>mx</em>,
<em>al</em>, or <em>ax</em> in your configuration files. This includes:
</p>

<ul>
<li>Updating your kernel configuration file(s). (Hint: start with a
    fresh GENERIC kernel, and modify from there)
</li>
<li>mv'ing <tt>/etc/hostname.pn*</tt>  to <tt>/etc/hostname.dc*</tt>
</li>
<li>Updating your <tt>/etc/ifaliases</tt> file.
</li>
<li>Changing your <tt>/etc/ipnat.rules</tt> and <tt>/etc/ipf.rules</tt> to
    reflect the new interface name.</li>
</ul>

<p>
If you are modifying a custom kernel, make sure you have
included the <em>dcphy</em> device in your kernel config, as follows:
</p>

<pre>
dcphy*  at mii? phy ?                           # Digital Clone PHYs
</pre>

<p>While you are at it, you may also want to add:</p>

<pre>
ukphy*  at mii? phy ?                           # "unknown" PHYs
</pre>

<a name="2.6.3"></a>
<h3>
2.6.3: Upgrading gcc 2.95.1 to 2.95.2
</h3>

<p><em>gcc</em> 2.95.2 was merged into the OpenBSD source tree around
January 19, 2000. In order for <em>gcc</em> to build properly, a more
recent (post 2.6) <em>libiberty</em> is required. To build this library,
do the following:</p>

<pre>
	cd /usr/src/gnu/egcs/libiberty
	make -f Makefile.bsd-wrapper clean
	make -f Makefile.bsd-wrapper obj
	make -f Makefile.bsd-wrapper
	make -f Makefile.bsd-wrapper install
</pre>

<p>
NOTE: On mips-based architectures, such as pmax, you must
perform an explicit <em>ldconfig</em> after new libraries are build.
</p>

<p>Once <em>libiberty</em> is build, you may proceed with a standard
<em>gcc</em> bootstrap:</p>

<pre>
   cd /usr/src/gnu/egcs/gcc
   make -f Makefile.bsd-wrapper clean
   make -f Makefile.bsd-wrapper obj
   make -f Makefile.bsd-wrapper -DBOOTSTRAP
   make -f Makefile.bsd-wrapper -DBOOTSTRAP install
   make -f Makefile.bsd-wrapper clean
   make -f Makefile.bsd-wrapper 
   make -f Makefile.bsd-wrapper install
</pre>

<a name="2.6.4"></a>
<h3>
2.6.4: Upgrading Kerberos.
</h3>

<p>
For Kerberos IV to build correctly, you will have to perform the following
steps:
</p>

<ul>
<li>
<p> Obtain and build the latest <tt>usr.bin/compile_et</tt>. </p>
<pre>
   # cd /usr/src/usr.bin/compile_et
   # make clean &amp;&amp; make depend &amp;&amp; make &amp;&amp; make install
</pre>
</li>

<li>
<p> Obtain and build the latest <tt>lib/libcom_err</tt>. </p>
<pre>
   # cd /usr/src/lib/libcom_err
   # make clean &amp;&amp; make depend &amp;&amp; make &amp;&amp; make install
</pre>
</li>

<li>
<p> Clean out and reinstall the Kerberos header files: </p>
<pre>
  # rm -r /usr/include/kerberosIV/*
  # cd /usr/src/kerberosIV
  # make includes
</pre>
</li>
<li>
<p> Now, rebuild the Kerberos library files:</p>
<pre>
   # cd /usr/src/kerberosIV/lib
   # make clean &amp;&amp; make depend &amp;&amp; make &amp;&amp; make install
</pre>
</li>
<li>
<p> If you are not doing a complete make build, rebuild Kerberos:</p>
<pre>
   # cd /usr/src/kerberosIV
   # make cleandir &amp;&amp; make depend &amp;&amp; make &amp;&amp; make install
</pre>
</li>
<li> Otherwise, simply restart your <em>make build</em>. </li>
</ul>


<a name="2.6.5"></a>
<h3>
2.6.5: Upgrading M4.
</h3>

<p>
The version of m4 that shipped with OpenBSD 2.6 will get into an infinite
loop while processing the sendmail .mc files into .cf files.  Because
of this you will need to install the new version of m4 <strong>before</strong>
you attempt a <em>make build</em>.  In other words:
</p>

<pre>
    # cd /usr/src/usr.bin/m4
    # make &amp;&amp; make install &amp;&amp; make cleandir
</pre>

<a name="2.6.6"></a>
<h3>
2.6.6: Upgrading Sendmail.
</h3>

<p>
In sendmail 8.10.X, locations (and names) of the sendmail configuration files
have changed.  Everything but the pid file now lives in /etc/mail.
Additionally, several files have changed names.
</p>

<table border="0">
<tr>
  <td><strong>OLD</strong></td>
  <td><strong>NEW</strong></td>
</tr>
<tr>
  <td><tt>/etc/sendmail.cf</tt></td>
  <td><tt>/etc/mail/sendmail.cf</tt></td>
</tr>
<tr>
  <td><tt>/etc/sendmail.cw</tt></td>
  <td><tt>/etc/mail/local-host-names</tt></td>
</tr>
<tr>
  <td><tt>/etc/sendmail.ct</tt></td>
  <td><tt>/etc/mail/trusted-users</tt></td>
</tr>
<tr>
  <td><tt>/etc/sendmail.oE</tt></td>
  <td><tt>/etc/mail/error-header</tt></td>
</tr>
<tr>
  <td><tt>/etc/aliases</tt></td>
  <td><tt>/etc/mail/aliases</tt></td>
</tr>
<tr>
  <td><tt>/etc/service.switch</tt></td>
  <td><tt>/etc/mail/service.switch</tt></td>
</tr>
<tr>
  <td><tt>/etc/userdb</tt></td>
  <td><tt>/etc/mail/userdb</tt></td>
</tr>
<tr>
  <td><tt>/usr/share/misc/sendmail.hf</tt></td>
  <td><tt>/etc/mail/helpfile</tt></td>
</tr>
</table>

<p>
There are a couple of ways to convert from the old sendmail config
to the new, but the first step is always the same.
</p>

<ol>
<li> Update <tt>/etc/rc</tt> so that it looks for
     <tt>/etc/mail/sendmail.cf</tt> instead of <tt>/etc/sendmail.cf</tt>
</li>
<li> <tt>mv /etc/sendmail.cf /etc/mail/sendmail.cf</tt> <br />
     This is the path of least resistance and you won't have to change
     the location of any other files.
</li>
<li> Or, build a new .cf file from your .mc source file.  Note that you
     no longer need to specify the line:
     <pre>include(`../m4/cf.m4')</pre>
     since it will be included for you by make.  Also note that when
     adding machines to class w (via "Cw machinename"), you now need
     to do that in the LOCAL_CONFIG section (see <tt>openbsd-lists.mc</tt>
     for an example).
</li>
</ol>

<a name="2.6.7"></a>
<h3>
2.6.7: After upgrading, kernels that include 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=apm&amp;sektion=8&amp;arch=i386">apm(8)</a>
support no longer boot.
</h3>

<p>
You need to update your bootblocks. See
<a href="faq14.html#14.8">Section 14.8</a>
of the OpenBSD FAQ for details.
</p>

<a name="2.6.8"></a>
<h3>
2.6.8: Default group for <em>daemon</em> user changed
</h3>

<p>The default group for the <em>daemon</em> user has been changed
from 31 to 1. Use vipw to effect this change so that the daemon user looks like:
<p><tt>daemon:*:1:1::0:0:The devil himself:/root:/sbin/nologin</tt>
</p>

<a name="2.5"></a>
<h2>Upgrading from 2.5</h2>

<a name="2.5.1"></a>
<h3>
2.5.1: What are the major problems upgrading from 2.5 to 2.6?
</h3>

<h5><em>perl</em> and <em>make</em></h5>
<p>
The latest version of Perl (5.005_03) requires a new version of
<em>make</em> to compile properly. You must rebuild make before
building the new Perl. Do a:
</p>

<pre>
# cd /usr/src/usr.bin/make
# make clean &amp;&amp; make &amp;&amp; make install
</pre>

<p>
Then go ahead and rebuild the new Perl. You will need to clean out the Perl
<code>obj</code> directory by hand before building.
</p>

<p>
Perl developers should take note of the latest changes. From 
millert@openbsd.org:
</p>

<pre>
The version of perl in the OpenBSD source tree (post 2.5) has been
upgraded to 5.005_03.  The build method has changed somewhat but
most of that should be invisible.  The important changes that affect
people are as follows:

1) Perl lib files have moved from /usr/lib/perl5 to the more correct
/usr/libdata/perl5
2) The default site_perl directories now live in /usr/local.  Ie:
if you install a perl module, it will place itself in
/usr/local/libdata/perl5/site_lib.  This makes it easy to
see what non-stock modules you have.  It also means that we
can have perl modules in the ports system easily.
3) The perl library man pages are now install in /usr/share/man/cat3p
You'll need to update your man.conf based on the src/etc/man.conf
to take advantage of them.  This means you can now do
"man 3p less" and get info on the less pragma but "man less"
will still get you the less pager manpage.

If you have modules or other non-stock perl files the simplest thing
to do is to move /usr/lib/perl5 to /usr/libdata/perl5 and add a link
from /usr/lib/perl5 to /usr/libdata/perl5.  Alternately, you could
just edit the installed Config.pm file and fix up the paths there.

</pre>

<h5>Compiler Change: <em>egcs</em> replaces <em>gcc</em></h5>
<p>
This change is likely the most significant change you will encounter.
For detailed instructions, see section <a href="#2.5.2">2.5.2</a>.
</p>

<h5>Kernel Structure - <em>statfs</em> - changed</h5>
<p>
The <tt>statfs</tt> structure has changed as of May 31. You must
rebuild your kernel before attempting a <em>make build</em>.
See <a href="#2.5.3">2.5.3</a> for details.
</p>

<a name="2.5.2"></a>
<h3>
2.5.2: How do I upgrade <em>gcc</em> to <em>egcs</em>
</h3>

<p>
The safest way will be to upgrade to a recent snapshot, once one is 
available. <strong>Look for a snapshot first!</strong>. Bootstrapping the new 
compiler from the old should be a <em>last resort</em>.
</p>

<p>
First, note that some platforms have not been bootstrapped
successfully yet. To date, the following should work, if you are 
careful:
</p>

<ul>
<li><strong>i386</strong>
<li><strong>sparc</strong>
<li><strong>m68k</strong>
<li><strong>alpha</strong>
</ul>

<p>
<strong>mips</strong> and <strong>rs6000</strong> have problems.
</p>

<p>
To test whether your platform can be bootstrapped, grab and install
the egcs-snapshot, available from the 
<a href="../ports.html">ports collection</a>. 
If this works, the in-tree version likely will, too.
This is the <em>safest</em> method of proceeding.
</p>

<p>
Now, before going any further, ensure that your copies of
<em>binutils</em>, <em>gas</em>, and <em>ld</em> are up to date.  Note
that there are two copies of <em>gas</em> and <em>ld</em> in the tree.
On <strong>i386</strong> and <strong>sparc</strong>, the binutils
versions are not used.  Check <tt>/usr/src/gnu/usr.bin/gas</tt> and
<tt>/usr/src/gnu/usr.bin/ld</tt> instead.
</p>

<p>
The following instructions referred to the original egcs snapshot 
(egcs-990517). Since that time, a second snapshot (egcs-990608) has gone
into the tree. If you are coming from vanilla 2.5, it is unlikely that
you will be able to build the latest version directly. In this event, you
will have to bootstrap an intermediate version using these instructions.
</p>

<p>
From espie@openbsd.org:
</p>

<blockquote>
<pre>
Today, the compiler changes.

Exit gcc 2.8.1, enter egcs... or more precisely, gcc 2.95 prerelease.

This is probably going to be a rough ride, but I can't work out all
the kinks on every architecture by myself.

I'm going to start importing stuff *now*. There will be a second message
to tech@ once things are settled...

Thanks to everyone who helped me sorting stuff out, most especially
niklas, turan, and millert.

Why the switch
--------------
as most of you already know, egcs is now the *official* compiler supported
by the FSF.  The upcoming july release as been re-christened gcc 2.95.

Just looking at the log messages will show you many improvements:
support for newer processors is better, C++ is more accurately matching
the ANSI/ISO standards, Fortran 77 is more closely integrated.
There are also countless bug-fixes and code generation improvements.

Also the development is more open. There is a cvs tree, there are several
mailing-lists available, and we are cooperating closely with the egcs
team. More precisely, I've been feeding patches back to the egcs team
so that OpenBSD configurations are officially supported.
Also, the development team is highly responsive to bug-reports, and problems
get fixed.

There also is a band-wagon phenomenon: everyone is switching to egcs,
which means lots of code to test the compiler on, and that we can benefit
from related projects.

Why now
-------
egcs-1.1 was unfit for some purposes. Specifically, code size on i386
was larger than gcc 2.8.1, which yielded floppy-disks problems. 
At 2.5 freeze, the only code fit to include was a somewhat unstable
snapshot.  In the interest of stability, after much pondering, egcs was
not put into 2.5.

Right now, the egcs project is going through a release cycle which will
yield egcs 1.2.  Judging from their time schedule, there is ample margin
between egcs 1.2 and the next release of OpenBSD.  Also, we want to get
in now, so that we get a chance to report problems on less frequently 
used architectures, and get everything fixed for 1.2.

egcs `feature freeze' is supposed to occur on may 7th, and the current
snapshot 19990502 looks solid.

What works and what doesn't
---------------------------
egcs runs an i386 OpenBSD system without problems.  m68k works as well,
with a few work-arounds linked to obscure bugs that will get fixed.
sparc seems to be running as well.  There is some linker trouble on some 
other arches that needs to be fixed before our next release.

Right now, constructors across dynamic libraries are not quite ready.

egcs now features a stand-alone cpp which is going to be better than
the current hackish solution we use. This means a few interface changes
and possibly weird warnings.

Keeping gcc 2.8.1 ?
-------------------
due to size constraints, as soon as egcs is imported, gcc is going
to move to cvs Attic.  If you don't want to deal with egcs now, you'll
have to be careful through your cvs updates.
Some Makefiles are bound to change: includes, gnu/usr.bin, and gnu/lib.
xlint and cpp.sh are going to change as well.

How to bootstrap the compiler
-----------------------------
the simplest way is probably to trust the various arch maintainers
and download a snapshot.

If you want to do stuff the hard way, you must first remake proper
obj dirs:
cd /usr/src
make obj

If you run i386, gas must be up-to-date.
If you run sparc, ld must be up-to-date.

then build libiberty:
cd /usr/src/gnu/egcs/libiberty
make -f Makefile.bsd-wrapper clean
make -f Makefile.bsd-wrapper depend
make -f Makefile.bsd-wrapper 
make -f Makefile.bsd-wrapper install

then the C compiler:
cd /usr/src/gnu/egcs/gcc
make -f Makefile.bsd-wrapper clean
make -f Makefile.bsd-wrapper depend
make -f Makefile.bsd-wrapper 
make -f Makefile.bsd-wrapper install

rebuild the C compiler with the new version:
cd /usr/src/gnu/egcs/gcc
make -f Makefile.bsd-wrapper clean
make -f Makefile.bsd-wrapper depend
make -f Makefile.bsd-wrapper 
make -f Makefile.bsd-wrapper install

rebuild the includes
cd /usr/src/include
make includes

build all egcs libraries and install them
cd /usr/src/gnu/egcs
make -f Makefile.bsd-wrapper clean
make -f Makefile.bsd-wrapper depend
make -f Makefile.bsd-wrapper 
make -f Makefile.bsd-wrapper install

install the new cpp driver
cd /usr/src/usr.bin/cpp
make install

then you're all set, and a standard make build should work...
</pre>


<p>
[author note: Actually, it doesn't quite work. xlint will fail to build.
The fix is simple though. Simply do a 
<code> make &amp;&amp; make install </code>
in the <code>/usr/src/usr.bin/xlint/xlint</code> directory before 
you attempt a <em>make build</em> and proceed. See <a href="#2.5.2.2">2.5.2.2</a>.]
</p>

<pre>
If it doesn't, you're using an arch that didn't go through make build yet.
The most probably occurrence is an Internal Compiler Error, as known as an
ICE.

First try to see if the ICE will go away with -O1 or -O0. In that case, you
can put a work-around in the Makefile until it's fixed 
(see /usr/src/lib/libm/Makefile for an example of how to put in such
work-arounds for m68k).

Then the error needs to be reported to the egcs-bugs mailing list.

At a minimum, you must run the source through the same compiler invocation,
with an addition of -v -save-temps to the options.

-v yields the precise sequence of commands invoked by gcc. -save-temps
will give you a pre-processed C file (.i) or C++ (.ii) that the egcs people
can make sense of... you can't ask them to run OpenBSD on their boxes.

If you have more time, you can try to trim down the pre-processed C file to
the bare minimum that triggers the bug. Dichotomy works nicely.
</pre>
</blockquote>

<p>
If you made it through this procedure, and everything is still working,
congratulations. If not, check the following sections for advice. Problems
not listed here should be posted to tech@openbsd.org.
</p>

<a name="2.5.2.1"></a>
<h5>
2.5.2.1 - <tt>i386</tt> and <tt>sparc</tt> are no longer 
<tt>#define</tt>'ed
</h5>

<p>
This is true. <em>egcs</em> uses the cleaner <tt>__i386__</tt> and
<tt>__sparc__</tt>. If you need to compile code that relies on the old
defines, add a <tt>-Dsparc</tt> or <tt>-Di386</tt> 
to the appropriate location of your Makefile.
</p>

<a name="2.5.2.2"></a>
<h5>
2.5.2.2 - Build fails in xlint
</h5>

<p>
This is due to semantic differences in cpp. The workaround is simple,
and similar to the <em>cap_mkdb</em> issue described in <a href="#2.4.2">2.4.2</a>.
</p>

<p>
Do a:
</p>

<pre>
# cd /usr/src/usr.bin/xlint/xlint
# make &amp;&amp; make install
</pre>

<p>
now re-run make, and the build should continue.
</p>

<a name="2.5.2.3"></a>
<h5>
2.5.2.3 - Core Dump on <tt>uthread_autoinit.c</tt>
</h5>

<p>
You have fallen victim to a linker bug. Here's a relevant message:
</p>

<pre>
From: Marc Espie &lt;Marc.Espie@liafa.jussieu.fr&gt;
Subject: egcs core-dumping on uthread_autoinit.c

If this happens to you, this is a known linker problem... the cc1 you have
was linked in a weird way.

Initially, I made cc1 link against static /usr/lib/libiberty.a to avoid this
problem, but this was cutting things too close, and the bug reappeared,
probably thanks to unrelated changes in libc or elsewhere...

The tree has been patched with a work-around in

src/gnu/egcs/f/lang-options.h

make sure you have the kludged version of that file (at least rev 1.2),
recompile and reinstall cc1, the problem should go away.

What's going on is that the 386 linker gets something wrong because of
the huge strings array in toplev.c, and something gets mislinked, so
that
void f(void) __attribute((constructor)) {}
kills cc1.

As a work-around, I've killed Fortran options help texts, until someone finds
where the linker errs.
</pre>

<a name="2.5.2.4"></a>
<h5>
2.5.2.4 - <em>egcs</em> seems much slower than <em>gcc</em>
</h5>

<p>
It is, but there is a reason. <em>egcs</em> performs more optimizing passes.
Data alignment and other such functionality will be better with 
<em>egcs</em>-generated code.
</p>

<a name="2.5.2.5"></a>
<h5>
2.5.2.5 - <em>egcs</em> generates larger code than <em>gcc</em>
</h5>

<p>
Yes it does. This is especially noticeable with the old <tt>-O2</tt>
gcc switch.  <em>egcs</em> introduces a new option, <tt>-Os</tt> which
optimizes for space.  This is roughly comparable to the old
<tt>-O2</tt> behavior.
</p>

<a name="2.5.2.6"></a>
<h5>
2.5.2.6 - After installing <em>egcs</em> I have very little disk space left
</h5>

<p>
<em>egcs</em> installs into a different subdirectory than gcc 2.8.1. You
may remove <em>gcc</em> once egcs is bootstrapped and working.
</p>

<p>
On a related note, the perl changes mentioned in <a href="#2.5.1">2.5.1</a>
mean that you can remove the <tt>/usr/lib/perl5</tt> directory. The
new location for this data is <tt>/usr/libdata/perl5</tt>.
</p>

<a name="2.5.2.7"></a>
<h5>
2.5.2.7 - My build dies while making libcurses
</h5>

<p>
<em>libcurses</em> now relies on the latest version of <em>cpp</em>.
Fetch the latest version, rebuild <em>cpp</em>, and continue. Eg:
</p>
<pre>
# cd /usr/src/usr.bin/cpp &amp;&amp; make install
</pre>

<p>And try the make build again.</p>

<a name="2.5.2.8"></a>
<h5>
2.5.2.8 - make obj fails
</h5>

<p>
If your <em>make obj</em> fails, citing errors in a Makefile, your
makefile includes are likely out of date. For example:
</p>

<pre>
===&gt; lib/libkvm
"Makefile", line 30: Malformed conditional ((${UVM} == "yes"))
"Makefile", line 30: Missing dependency operator
"Makefile", line 32: if-less endif
"Makefile", line 32: Need an operator
Fatal errors encountered -- cannot continue

</pre>

<p>
This can be solved by rebuilding the makefile includes. Do a:
</p>

<pre>
cd /usr/src/share/mk &amp;&amp; make install
</pre>

<p>
and try the build again.
</p>

<a name="2.5.3"></a>
<h3>
2.5.3: My <em>make build</em> dies with <em>unimplemented syscall</em> errors.
</h3>

<p><strong>Short Answer:</strong> </p>

<p>
The kernel structure <tt>statfs</tt> has changed. You will need to recompile
the kernel before attempting a <em>make build</em>.
</p>

<p><strong>Long Answer:</strong> </p>

<p>
The kernel structure <tt>statfs</tt> has changed. 
The new <tt>struct statfs</tt> has the following features:
</p>

<ul>
<li> Has a <tt>u_int32_t</tt> flags field--now softdep can have a real flag.
</li>

<li> Uses <tt>u_int32_t</tt> instead of longs (nicer on the alpha).  
Note: the man page used to lie about setting invalid/unused fields to -1.  
SunOS does that but our code never has.
</li>

<li> Gets rid of <tt>f_type</tt> completely.  It hasn't been used since NetBSD 
0.9, and having it there but always 0 is confusing.  It is conceivable
that this may cause some old code to not compile, but that is better
than silently breaking.
</li>

<li> Adds a <tt>mount_info</tt> union that contains the <tt>FSTYPE_args</tt>
struct.  This means that <em>mount</em> can now tell you all the options a 
filesystem was mounted with.  This is especially nice for NFS.
</li>
</ul>

<p>
Other changes:
</p>

<ul>
<li> The linux statfs emulation didn't convert between BSD fs names
and linux <tt>f_type</tt> numbers.  Now it does, since the BSD <tt>f_type</tt>
number is useless to linux apps (and has been removed anyway)
</li>

<li> FreeBSD's struct statfs is different from ours (both old and new)
and thus needs conversion.  Previously, the OpenBSD syscalls
were used without any real translation.
</li>

<li> <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount&amp;sektion=8">mount(8)</a>
will now show extra info when invoked with no arguments.
However, to see <em>everything</em> you need to use the -v (verbose) flag. 
</li>
</ul>

<a name="2.5.4"></a>
<h3>
2.5.4: Link to the new 2.6 directory.
</h3>

<p>
When upgrading to 2.6 you'll need to create one simple link for gcc.
</p>

<pre>
   cd /usr/lib/gcc-lib
   ln -s ${ARCH}-unknown-openbsd2.5 ${ARCH}-unknown-openbsd2.6
</pre>

<a name="2.5.5"></a>
<h3>
2.5.5: After an <strong>(U)</strong>pgrade, extraction of <em>base26.tar.gz</em>
fails with a message:
</h3>

<p>
<em>tar: Unable to remove directory ./usr/include/machine &lt;Directory
not empty&gt;
</em>
</p>

<p>In 2.5, <tt>/usr/include/machine</tt> was a directory, and
<tt>/usr/include/i386</tt> was a link to it. In 2.6, this situation
is reversed.
</p>

<p>
To correct the problem, escape to the shell, remove the <tt>/usr/include/machine</tt> directory, and retry the upgrade.
</p>


<a name="2.4"></a>
<h2>Upgrading from 2.4</h2>

<a name="2.4.1"></a>
<h3>2.4.1: Man page changes</h3>
<p>
Several man pages were moved from section 1 to later sections.
Unfortunately, if the old man pages are left in section 1, unwary
users will not see the latest version of the page.
</p>

<p>
The following pages should be removed:
</p>
<pre>
/usr/share/man/cat1/ipf.0
/usr/share/man/cat1/ipnat.0
/usr/share/man/cat1/ipsecadm.0
</pre>

<a name="2.4.2"></a>
<h3>2.4.2: <em>cap_mkdb</em> syntax changed</h3>

<p>
<strong>Symptom:</strong>
</p>

<p>
A <em>make build</em> resulted in an error like this:
</p>

<pre>
cap_mkdb -i -f terminfo terminfo.src
cap_mkdb: illegal option -- i
usage: cap_mkdb [-v] [-f outfile] file1 [file2 ...]
*** Error code 1
</pre>

<p>
<strong>Fix:</strong>
</p>

<p>
The syntax for invoking <em>cap_mkdb</em> has changed slightly.
Before doing a <em>make build</em>, rebuild cap_mkdb from the latest
sources:
</p>

<pre>
# cd /usr/src/usr.bin/cap_mkdb
# make clean &amp;&amp; make &amp;&amp; make install
</pre>

<p>
The make build should then run to completion
</p>


<a name="2.4.3"></a>
<h3>2.4.3: Snake</h3>
<p>
You will need to remove the contents of the obj directory before
upgrading <code>/usr/src/games/snake</code>.
</p>
 
<a name="2.3"></a>
<h2>Upgrading from 2.3</h2>

<a name="2.3.1"></a>
<h3>
2.3.1: New User: <em>named</em>
</h3>

<p>
After 2.3, the <em>named</em> DNS daemon was moved to a chroot jail.
To make this change possible, the <em>named</em> user was created.
If you do not have it already, you will need to create this user to
ensure that all directories get created properly during the build process.
</p>

<p>
Add the following entry to /etc/passwd using <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8">vipw(8)</a>:
</p>

<pre>
named:*:70:70::0:0:BIND Daemon:/var/named:/sbin/nologin
</pre>

<p>
Add the following to /etc/group:
</p>

<pre>
named:*:70:
</pre>


<a name="2.3.2"></a>
<h3>
2.3.2: I tried the build, but it failed when trying to compile
<em>ssleay</em>.
</h3>

<p>
You are likely missing an entry for the <em>named</em> user in your
password file.
</p>

<p>
<strong>Short Answer:</strong>
</p>

<p>
Create this user prior to the build.
</p>

<p>
<strong>Long Answer:</strong>
</p>

<p>
The <em>named</em> user is required in order to set permissions
correctly.  If this user is missing, part of the build process fails.
If you capture your build to a file (say, with a <em>make build
&amp;&gt;/tmp/build.log</em>) you will notice the following message:
</p>

<pre>
(cd /usr/src/etc &amp;&amp; make DESTDIR=/ distrib-dirs)
install -d -o root -g wheel -m 755 /
mtree -def mtree/4.4BSD.dist -p // -u

mtree: unknown user named
mtree: failed at line 1632 of the specification
*** Error code 1 (ignored)
</pre>

<p>
Unfortunately for us, the build continued happily on its way,
totally ignoring the fact that an error occurred.
</p>

<p>
If the <em>named</em> user exists, mtree works properly:
</p>

<pre>
missing: ./var/named (created)
missing: ./var/named/dev (created)
missing: ./var/named/etc (created)
missing: ./etc/afs (created)
missing: ./etc/ssl (created)
missing: ./etc/ssl/private (created)
missing: ./usr/obj (not created: File exists)
missing: ./usr/share/doc/html (created)
missing: ./usr/share/doc/html/lynx_help (created)
missing: ./usr/share/doc/html/lynx_help/keystrokes (created)
missing: ./usr/share/doc/usd/13.viref (created)
missing: ./usr/share/man/cat4/powerpc (created)
missing: ./usr/share/man/man4/alpha (created)
missing: ./usr/share/man/man4/pmax (created)
missing: ./usr/share/man/man4/powerpc (created)
missing: ./usr/share/tmac/mdoc (created)
missing: ./var/www/htdocs/manual/vhosts (created)
missing: ./usr/include/ssl (created)
</pre>

<p>
The reason for the fail, then, is that the <em>/usr/include/ssl</em>
directory was never created. Without the header files, the
<em>ssleay</em> build fails.
</p>

<p>
<strong>Fix:</strong>
</p>

<p>
Create the <em>named</em> user and group. Remove <em>/usr/include/ssl</em>,
<em>/var/named</em>, and any other directory from the list above that was
mistakenly created as a normal file by the <em>make build</em>.
</p>


<a name="2.3.3"></a>
<h3>
2.3.3: I tried the build, but it failed when trying to make something for the
PowerPC.
</h3>

<p>
Your directory tree is incomplete. Specifically, the 
<tt>/usr/share/man/cat4/powerpc</tt> directory is missing. 
</p>

<p>
<strong>Quick Fix:</strong>
</p>

<p>
Create this directory and proceed with the compilation
</p>

<p>
<strong>Complete Fix:</strong>
</p>

<p>
Create the entire directory tree. Do a:
</p>

<pre>
# cd /usr/src/etc &amp;&amp; make DESTDIR=/ distrib-dirs
</pre>

<p>
You will likely see an output like the following:
</p>

<pre>
install -d -o root -g wheel -m 755 /
mtree -def mtree/4.4BSD.dist -p // -u

missing: ./var/named (created)
missing: ./var/named/dev (created)
missing: ./var/named/etc (created)
missing: ./etc/afs (created)
missing: ./etc/ssl (created)
missing: ./etc/ssl/private (created)
missing: ./usr/obj (not created: File exists)
missing: ./usr/share/doc/html (created)
missing: ./usr/share/doc/html/lynx_help (created)
missing: ./usr/share/doc/html/lynx_help/keystrokes (created)
missing: ./usr/share/doc/usd/13.viref (created)
missing: ./usr/share/man/cat4/powerpc (created)
missing: ./usr/share/man/man4/alpha (created)
missing: ./usr/share/man/man4/pmax (created)
missing: ./usr/share/man/man4/powerpc (created)
missing: ./usr/share/tmac/mdoc (created)
missing: ./var/www/htdocs/manual/vhosts (created)
missing: ./usr/include/ssl (created)
</pre>

<p>
Note that /usr/share/man/cat4/powerpc was one of the directories created by this process.
</p>



<p>
--
</p>
<address>
<p>
$OpenBSD: upgrade-old.html,v 1.27 2009/10/25 17:41:12 nick Exp $
<br />
Copyright &copy; 1998-2008, OpenBSD.
<br />
</address>

</body>
</html>

