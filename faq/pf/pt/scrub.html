<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PF: Scrub (Normalização de Pacotes)</title>
<link rev="made" href="mailto:www@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq,pf">
<meta name="distribution"  content="global">
</head>

<!--
Copyright (c) 2003, Nick Holland <nick@openbsd.org>
Copyright (c) 2003-2005, Joel Knight <enabled@myrealbox.com>

Permission to use, copy, modify, and distribute this documentation for
any purpose with or without fee is hereby granted, provided that the
above copyright notice and this permission notice appear in all copies.

THE DOCUMENTATION IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL
WARRANTIES WITH REGARD TO THIS DOCUMENTATION INCLUDING ALL IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE
AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS DOCUMENTATION
-->

<body bgcolor="#ffffff" text="#000000">
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->

<a href="../../../pt/index.html">
<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif" border="0">
</a>
<p>
[<a href="options.html">Anterior: Opções em Tempo de Execução</a>]
[<a href="index.html">Conteúdo</a>]
[<a href="anchors.html">Próximo: Âncoras</a>]

<p>
<h1><font color="#e00000">PF: Scrub (Normalização de Pacotes)</font></h1>
<hr>

<h3>Conteúdo</h3>
<ul>
<li><a href="#intro">Introdução</a>
<li><a href="#options">Opções</a>
</ul>

<hr>

<a name="intro"></a>
<h2>Introdução</h2>
"Scrubbing" é o processo de normalização de pacotes para que não haja
ambiguidades na interpretação pelo destino final do pacote. A diretiva
scrub também remonta pacotes fragmentados, protegendo alguns sistemas
operacionais de algumas formas de ataque, e descarta pacotes TCP que
possuam combinações de
<a href="filter.html#tcpflags">sinalizadores</a> inválidas.
Uma forma simples de uso da diretiva scrub:
<blockquote>
<tt>
scrub in all
</tt>
</blockquote>

<p>
Isso normaliza todos os pacotes chegando em todas as interfaces.

<p>
Uma razão para não fazer scrub em uma interface é no caso de haver
tráfego NFS atravessando-a. Algumas plataformas não-OpenBSD enviam
(e esperam) pacotes estranhos -- pacotes fragmentados com o bit
"do not fragment" marcado, que são (devidamente) rejeitados pelo
<tt>scrub</tt>. Isso pode ser resolvido através do uso da opção
<tt>no-df</tt>. Outra razão é que alguns jogos multijogadores
apresentam problemas de conexão ao passar por um firewall PF com
<tt>scrub</tt> ativado. Fora esses casos, o uso de scrub em todos
os pacotes é uma prática <i>altamente recomendada</i>.

<p>
A sintaxe da diretiva <tt>scrub</tt> é muito similar à sintaxe
das regras de <a href="filter.html">filtragem</a>, o que torna
fácil usar scrub de maneira seletiva em alguns tipos de pacotes
e outros não.
A palavra-chave <tt>no</tt> pode ser usada na frente de <tt>scrub</tt>
para especificar que pacotes não devem passar por scrub.
Assim como <a href="nat.html#except">regras <tt>nat</tt></a>,
a primeira regra que corresponder vence.

<p>
Mais informações sobre os princípios e conceitos de scrub podem ser
encontradas no artigo científico
<i><a href="http://www.icir.org/vern/papers/norm-usenix-sec-01-html/index.html"
>Network Intrusion Detection: Evasion, Traffic Normalization, and
End-to-End Protocol Semantics</a></i>.

<a name="options"></a>
<h2>Opções</h2>
<tt>Scrub</tt> possui as seguintes opções:
<dl>
<dt><tt>no-df</tt>
<dd>Desmarca o bit <i>don't fragment</i> no cabeçalho IP do pacote.
Alguns sistemas operacionais são conhecidos por gerar pacotes
fragmentados com o bit <i>don't fragment</i> marcado. Isso é
particularmente verdadeiro no NFS. <tt>Scrub</tt> descarta
esses pacotes a não ser que a opção <tt>no-df</tt>
seja especificada. Pelo fato de alguns sistemas operacionais gerarem
pacotes <i>don't fragment</i> com campo de identificação
IP zero no cabeçalho, é recomendado o uso de
<tt>no-df</tt> em conjunto com <tt>random-id</tt>.

<dt><tt>random-id</tt>
<dd>Substitui o campo de identificação IP de pacotes com
valores aleatórios para compensar sistemas operacionais que usam
valores previsíveis. Essa opção somente se aplica a pacotes
que não estão fragmentados após a reconstrução opcional de pacotes.

<dt><tt>min-ttl <i>num</i></tt>
<dd>Força um valor mínimo de "Time To Live" (TTL)
nos cabeçalhos de pacotes IP.

<dt><tt>max-mss <i>num</i></tt>
<dd>Força um tamanho máximo para o "Maximum Segment Size" (MSS)
nos cabeçalhos de pacotes TCP.

<dt><tt>fragment reassemble</tt>
<dd>Armazena em buffer os pacotes que chegam fragmentados e os
reconstrói em pacotes completos antes de passá-los para o sistema de
filtragem. A vantagem é que as regras de filtragem têm que lidar apenas
com pacotes completos e podem ignorar fragmentos. A desvantagem é o
aumento do uso de memória para armazenar os fragmentos. Esse é o
comportamento padrão quando nenhuma opção <tt>fragment</tt> for
especificada. Essa também é a única opção <tt>fragment</tt> que funciona
com NAT.

<dt><tt>fragment crop</tt>
<dd>Descarta fragmentos duplicados e elimina sobreposições.
Diferentemente de <tt>fragment reassemble</tt>, os fragmentos não
são armazenados em buffer, mas passados adiante assim que chegam.

<dt><tt>fragment drop-ovl</tt>
<dd>Similar a <tt>fragment crop</tt>,
exceto que todos os fragmentos duplicados e sobrepostos serão
descartados assim como quaisquer fragmentos subsequentes.

<dt><tt>reassemble tcp</tt>
<dd>Normaliza de maneira "stateful" as conexões TCP.
Ao usar <tt>scrub reassemble tcp</tt>, uma direção ("in"/"out") não deve
ser especificada. As seguintes normalizações são realizadas:
	<ul>
	<li>Nenhum lado da conexão pode reduzir seu TTL de IP. Isso
	    é feito para a proteção contra um atacante enviando pacotes
	    que atinjam o firewall, afetando a informação de
	    estado da conexão, e expire antes de atingir a máquina de
	    destino. O TTL de todos pacotes é aumentado para o maior
	    valor possível para a conexão.
	<li>Modula marcas temporais TCP
	    (<a href="http://www.geektools.com/rfc/rfc1323.txt">RFC1323</a>)
	    em cabeçalhos de pacotes para um número aleatório. Isso
	    pode impedir um observador de deduzir a quanto tempo a
	    máquina está ligada ou saber quantas máquinas existem
	    atrás de um gateway NAT.
	</ul>
</dl>

<p>
Exemplos:
<blockquote>
<tt>
scrub in on fxp0 all fragment reassemble min-ttl 15 max-mss 1400<br>
scrub in on fxp0 all no-df<br>
scrub &nbsp;&nbsp; on fxp0 all reassemble tcp
</tt>
</blockquote>

<p>
[<a href="options.html">Anterior: Opções em Tempo de Execução</a>]
[<a href="index.html">Conteúdo</a>]
[<a href="anchors.html">Próximo: Âncoras</a>]

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[voltar]"></a>
<a href="mailto:www@openbsd.org">www@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: scrub.html,v 1.15 ]<br>
$Translation: scrub.html,v 1.8 2009/10/13 19:12:28 alan Exp $<br>
-->
$OpenBSD: scrub.html,v 1.8 2009/10/17 15:58:26 ajacoutot Exp $
</small>

</body>
</html>
